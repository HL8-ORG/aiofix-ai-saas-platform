e186819e1d51925bda71b05766849db4
"use strict";
var __esDecorate = (this && this.__esDecorate) || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {
    function accept(f) { if (f !== void 0 && typeof f !== "function") throw new TypeError("Function expected"); return f; }
    var kind = contextIn.kind, key = kind === "getter" ? "get" : kind === "setter" ? "set" : "value";
    var target = !descriptorIn && ctor ? contextIn["static"] ? ctor : ctor.prototype : null;
    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});
    var _, done = false;
    for (var i = decorators.length - 1; i >= 0; i--) {
        var context = {};
        for (var p in contextIn) context[p] = p === "access" ? {} : contextIn[p];
        for (var p in contextIn.access) context.access[p] = contextIn.access[p];
        context.addInitializer = function (f) { if (done) throw new TypeError("Cannot add initializers after decoration has completed"); extraInitializers.push(accept(f || null)); };
        var result = (0, decorators[i])(kind === "accessor" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);
        if (kind === "accessor") {
            if (result === void 0) continue;
            if (result === null || typeof result !== "object") throw new TypeError("Object expected");
            if (_ = accept(result.get)) descriptor.get = _;
            if (_ = accept(result.set)) descriptor.set = _;
            if (_ = accept(result.init)) initializers.unshift(_);
        }
        else if (_ = accept(result)) {
            if (kind === "field") initializers.unshift(_);
            else descriptor[key] = _;
        }
    }
    if (target) Object.defineProperty(target, contextIn.name, descriptor);
    done = true;
};
var __runInitializers = (this && this.__runInitializers) || function (thisArg, initializers, value) {
    var useValue = arguments.length > 2;
    for (var i = 0; i < initializers.length; i++) {
        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);
    }
    return useValue ? value : void 0;
};
var __setFunctionName = (this && this.__setFunctionName) || function (f, name, prefix) {
    if (typeof name === "symbol") name = name.description ? "[".concat(name.description, "]") : "";
    return Object.defineProperty(f, "name", { configurable: true, value: prefix ? "".concat(prefix, " ", name) : name });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigService = void 0;
const common_1 = require("@nestjs/common");
const config_loader_1 = require("./config-loader");
const logging_1 = require("@aiofix/logging");
/**
 * @class ConfigService
 * @description
 * IAM系统配置服务，负责管理和提供系统中所有配置信息。
 * 该服务是配置管理的核心组件，提供了配置的加载、获取、验证等功能。
 *
 * 主要原理与机制如下：
 * 1. 使用NestJS的依赖注入机制，作为全局服务提供配置访问
 * 2. 在构造函数中异步初始化配置，确保配置在服务启动时加载完成
 * 3. 使用只读配置对象，防止运行时配置被意外修改
 * 4. 提供类型安全的配置访问方法，支持泛型约束
 * 5. 集成环境变量管理，支持动态配置更新
 * 6. 使用自定义的PinoLoggerService进行日志记录，提供高性能的结构化日志
 *
 * 功能与业务规则：
 * 1. 配置加载和初始化
 * 2. 配置获取和验证
 * 3. 环境变量管理
 * 4. 配置模块化访问
 * 5. 类型安全的配置操作
 * 6. 结构化日志记录
 */
let ConfigService = (() => {
    let _classDecorators = [(0, common_1.Injectable)()];
    let _classDescriptor;
    let _classExtraInitializers = [];
    let _classThis;
    var ConfigService = _classThis = class {
        /**
         * @constructor
         * @description
         * 配置服务构造函数，在服务实例化时自动初始化配置。
         * 由于构造函数不能是异步的，所以使用void调用异步初始化方法。
         *
         * @param logger 自定义的Pino日志服务实例
         */
        constructor(logger) {
            /** 环境配置对象 */
            this.environment = {
                production: process.env.NODE_ENV === 'production',
                env: {},
            };
            /** 系统配置对象 */
            this.config = {};
            this.logger = logger;
            void this.initConfig();
        }
        /**
         * @function initConfig
         * @description
         * 初始化配置和环境变量。该方法在服务启动时被调用，负责加载所有配置信息
         * 并设置环境变量。由于构造函数不能是异步的，所以使用独立的异步方法。
         *
         * 主要原理与机制如下：
         * 1. 调用getConfig()方法获取完整的配置对象
         * 2. 遍历环境配置，动态设置process.env环境变量
         * 3. 记录生产环境状态到日志中
         * 4. 确保配置在服务启动前完成加载
         * 5. 使用自定义的PinoLoggerService记录结构化日志
         *
         * 功能与业务规则：
         * 1. 配置加载和初始化
         * 2. 环境变量设置
         * 3. 启动状态日志记录
         * 4. 配置验证和错误处理
         * 5. 结构化日志记录
         *
         * @returns {Promise<void>} 返回一个Promise，表示配置初始化过程
         */
        async initConfig() {
            this.config = (0, config_loader_1.getConfig)();
            // 动态设置环境变量
            if (this.environment.env) {
                Object.entries(this.environment.env).forEach(([key, value]) => {
                    process.env[key] = value;
                });
            }
            this.logger.info(`配置服务初始化完成，生产环境状态: ${this.environment.production}`, logging_1.LogContext.CONFIG, {
                isProduction: this.environment.production,
                nodeEnv: process.env.NODE_ENV,
                configKeys: Object.keys(this.config),
            });
        }
        /**
         * @function getConfig
         * @description
         * 获取完整的配置对象，返回一个只读的配置副本。该方法提供了对系统所有配置的访问，
         * 同时确保返回的配置对象不会被意外修改。
         *
         * 主要原理与机制如下：
         * 1. 使用Object.freeze()创建不可变的配置对象
         * 2. 使用展开运算符创建配置对象的深拷贝
         * 3. 返回只读类型，防止运行时修改
         * 4. 提供类型安全的配置访问
         * 5. 记录配置访问日志，便于审计和调试
         *
         * 功能与业务规则：
         * 1. 完整配置获取
         * 2. 配置对象保护
         * 3. 类型安全访问
         * 4. 配置完整性保证
         * 5. 配置访问审计
         *
         * @returns {Readonly<Partial<IamConfig>>} 返回只读的完整配置对象
         */
        getConfig() {
            this.logger.debug('获取完整配置对象', logging_1.LogContext.CONFIG, {
                configKeys: Object.keys(this.config),
                timestamp: new Date().toISOString(),
            });
            return Object.freeze({ ...this.config });
        }
        /**
         * @function getConfigValue
         * @description
         * 获取指定的配置值，支持泛型类型安全。该方法提供了对特定配置模块的访问，
         * 如果配置键不存在会抛出错误。
         *
         * 主要原理与机制如下：
         * 1. 使用泛型K约束配置键的类型
         * 2. 检查配置键是否存在，不存在则抛出错误
         * 3. 返回只读的配置值，确保类型安全
         * 4. 支持TypeScript的类型推断
         * 5. 记录配置访问日志，便于审计和调试
         *
         * 功能与业务规则：
         * 1. 特定配置获取
         * 2. 配置键验证
         * 3. 类型安全访问
         * 4. 错误处理和提示
         * 5. 配置访问审计
         *
         * @template K - 配置键的类型
         * @param {K} key - 要获取的配置键
         * @returns {Readonly<IamConfig[K]>} 返回只读的配置值
         * @throws {Error} 当配置键不存在时抛出错误
         */
        getConfigValue(key) {
            if (!(key in this.config)) {
                this.logger.error(`配置键不存在: ${String(key)}`, logging_1.LogContext.CONFIG, {
                    requestedKey: String(key),
                    availableKeys: Object.keys(this.config),
                    timestamp: new Date().toISOString(),
                });
                throw new Error(`Configuration key "${String(key)}" not found.`);
            }
            this.logger.debug(`获取配置值: ${String(key)}`, logging_1.LogContext.CONFIG, {
                configKey: String(key),
                timestamp: new Date().toISOString(),
            });
            return this.config[key];
        }
        /**
         * @getter appConfig
         * @description
         * 获取应用基础配置，包含应用名称、版本、环境等基础信息。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的应用配置对象
         */
        get appConfig() {
            return this.config.app ?? {};
        }
        /**
         * @getter databaseConfig
         * @description
         * 获取数据库配置，包含数据库连接、ORM配置、连接池等设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的数据库配置对象
         */
        get databaseConfig() {
            return this.config.database ?? {};
        }
        /**
         * @getter redisConfig
         * @description
         * 获取Redis缓存配置，包含连接信息、缓存策略、分布式锁等设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的Redis配置对象
         */
        get redisConfig() {
            return this.config.redis ?? {};
        }
        /**
         * @getter jwtConfig
         * @description
         * 获取JWT认证配置，包含密钥、令牌过期时间、多租户支持等设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的JWT配置对象
         */
        get jwtConfig() {
            return this.config.jwt ?? {};
        }
        /**
         * @getter emailConfig
         * @description
         * 获取邮件服务配置，包含SMTP设置、邮件模板、发送策略等配置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的邮件配置对象
         */
        get emailConfig() {
            return this.config.email ?? {};
        }
        /**
         * @getter loggingConfig
         * @description
         * 获取日志系统配置，包含日志级别、输出格式、聚合设置等配置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的日志配置对象
         */
        get loggingConfig() {
            return this.config.logging ?? {};
        }
        /**
         * @getter settingConfig
         * @description
         * 获取系统设置配置，包含系统级配置项和全局设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的系统设置配置对象
         */
        get settingConfig() {
            return this.config.setting ?? {};
        }
        /**
         * @getter keycloakConfig
         * @description
         * 获取Keycloak集成配置，包含第三方认证服务的连接和设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的Keycloak配置对象
         */
        get keycloakConfig() {
            return this.config.keycloak ?? {};
        }
        /**
         * @getter dbMikroOrmConnectionOptions
         * @description
         * 获取MikroORM连接配置选项，用于数据库连接和ORM操作。
         *
         * @returns {Readonly<MikroOrmModuleOptions>} 返回只读的MikroORM配置对象
         */
        get dbMikroOrmConnectionOptions() {
            return this.config.database?.dbMikroOrmConnectionOptions ?? {};
        }
        /**
         * @getter dbKnexConnectionOptions
         * @description
         * 获取Knex连接配置选项，用于复杂查询和数据库迁移。
         *
         * @returns {Readonly<KnexModuleOptions>} 返回只读的Knex配置对象
         */
        get dbKnexConnectionOptions() {
            return (this.config.database?.dbKnexConnectionOptions ?? {
                config: {},
            });
        }
        /**
         * @function get
         * @description
         * 获取环境变量值，支持类型推断。该方法提供了对环境变量的类型安全访问，
         * 如果环境变量不存在会抛出错误。
         *
         * 主要原理与机制如下：
         * 1. 使用泛型K约束环境变量键的类型
         * 2. 检查环境变量是否存在，不存在则抛出错误
         * 3. 返回类型安全的环境变量值
         * 4. 支持TypeScript的类型推断和自动补全
         * 5. 记录环境变量访问日志，便于审计和调试
         *
         * 功能与业务规则：
         * 1. 环境变量获取
         * 2. 类型安全访问
         * 3. 错误处理和提示
         * 4. 环境变量验证
         * 5. 环境变量访问审计
         *
         * @template K - 环境变量键的类型
         * @param {K} key - 要获取的环境变量键
         * @returns {string} 返回对应的环境变量值
         * @throws {Error} 当环境变量不存在时抛出错误
         */
        get(key) {
            const value = process.env[key];
            if (!value) {
                this.logger.error(`环境变量未定义: ${key}`, logging_1.LogContext.CONFIG, {
                    requestedKey: key,
                    availableEnvVars: Object.keys(process.env).filter(k => k.startsWith('DB_') || k.startsWith('LOG_') || k.startsWith('JWT_')),
                    timestamp: new Date().toISOString(),
                });
                throw new Error(`Environment variable "${key}" is not defined.`);
            }
            this.logger.debug(`获取环境变量: ${key}`, logging_1.LogContext.CONFIG, {
                envKey: key,
                hasValue: !!value,
                timestamp: new Date().toISOString(),
            });
            return value;
        }
        /**
         * @function isProd
         * @description
         * 检查应用是否运行在生产环境模式。该方法用于判断当前运行环境，
         * 帮助应用根据环境调整行为。
         *
         * 主要原理与机制如下：
         * 1. 从环境配置中获取production标志
         * 2. 返回布尔值表示是否为生产环境
         * 3. 用于条件逻辑和环境相关配置
         *
         * 功能与业务规则：
         * 1. 环境判断
         * 2. 条件逻辑支持
         * 3. 环境相关配置
         * 4. 调试和部署支持
         *
         * @returns {boolean} 返回true表示生产环境，false表示非生产环境
         */
        isProd() {
            return this.environment.production;
        }
    };
    __setFunctionName(_classThis, "ConfigService");
    (() => {
        const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
        __esDecorate(null, _classDescriptor = { value: _classThis }, _classDecorators, { kind: "class", name: _classThis.name, metadata: _metadata }, null, _classExtraInitializers);
        ConfigService = _classThis = _classDescriptor.value;
        if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
        __runInitializers(_classThis, _classExtraInitializers);
    })();
    return ConfigService = _classThis;
})();
exports.ConfigService = ConfigService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY29uZmlnL3NyYy9jb25maWcuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUE0QztBQUc1QyxtREFBNEM7QUFDNUMsNkNBQWdFO0FBMkNoRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBcUJHO0lBRVUsYUFBYTs0QkFEekIsSUFBQSxtQkFBVSxHQUFFOzs7OztRQVlYOzs7Ozs7O1dBT0c7UUFDSCxZQUFZLE1BQXlCO1lBbEJyQyxhQUFhO1lBQ0ksZ0JBQVcsR0FBRztnQkFDN0IsVUFBVSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLFlBQVk7Z0JBQ2pELEdBQUcsRUFBRSxFQUE0QjthQUNsQyxDQUFDO1lBR0YsYUFBYTtZQUNMLFdBQU0sR0FBdUIsRUFBRSxDQUFDO1lBV3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQ3JCLEtBQUssSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3pCLENBQUM7UUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1dBcUJHO1FBQ0ssS0FBSyxDQUFDLFVBQVU7WUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFBLHlCQUFTLEdBQUUsQ0FBQztZQUUxQixXQUFXO1lBQ1gsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUN6QixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRTtvQkFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQzNCLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksQ0FBQyxNQUFNLENBQUMsSUFB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RTtpQkFDcEMsQ0FBQyxDQUFDO2dCQUNILE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLEdBQUcsbUJBQW1CLENBQUMsQ0FBQztZQUNuRSxDQUFDO1lBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxHQUFHLEVBQUUsRUFBRSxvQkFBVSxDQUFDLE1BQU0sRUFBRTtnQkFDckQsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsUUFBUSxFQUFFLENBQUMsQ0FBQyxLQUFLO2dCQUNqQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7YUFDcEMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7OztXQWtCRztRQUNILE1BQU07WUFDSixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDO1FBQ3JDLENBQUM7Ozs7O1FBblVILDZLQW9VQzs7O1FBcFVZLHVEQUFhOzs7O0FBQWIsc0NBQWEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY29uZmlnL3NyYy9jb25maWcuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgTWlrcm9Pcm1Nb2R1bGVPcHRpb25zIH0gZnJvbSAnQG1pa3JvLW9ybS9uZXN0anMnO1xuaW1wb3J0IHsgS25leE1vZHVsZU9wdGlvbnMgfSBmcm9tICduZXN0LWtuZXhqcyc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL2NvbmZpZy1sb2FkZXInO1xuaW1wb3J0IHsgUGlub0xvZ2dlclNlcnZpY2UsIExvZ0NvbnRleHQgfSBmcm9tICdAYWlvZml4L2xvZ2dpbmcnO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgSWFtQ29uZmlnXG4gKiBAZGVzY3JpcHRpb25cbiAqIElBTeezu+e7n+mFjee9ruaOpeWPo++8jOWumuS5ieS6huezu+e7n+S4reaJgOaciemFjee9ruaooeWdl+eahOe7k+aehOOAglxuICog6K+l5o6l5Y+j5YyF5ZCr5LqG5bqU55So5Z+656GA6YWN572u44CB5pWw5o2u5bqT6YWN572u44CB57yT5a2Y6YWN572u44CB6K6k6K+B6YWN572u562J5ZCE5Liq5qih5Z2X55qE6YWN572u5a6a5LmJ44CCXG4gKlxuICog5Li76KaB5Y6f55CG5LiO5py65Yi25aaC5LiL77yaXG4gKiAxLiDkvb/nlKhUeXBlU2NyaXB05o6l5Y+j5a6a5LmJ6YWN572u57uT5p6E77yM56Gu5L+d57G75Z6L5a6J5YWoXG4gKiAyLiDmr4/kuKrphY3nva7mqKHlnZfpg73mnInni6znq4vnmoTlkb3lkI3nqbrpl7TvvIzpgb/lhY3phY3nva7lhrLnqoFcbiAqIDMuIOaUr+aMgemFjee9rueahOW1jOWll+e7k+aehO+8jOS+v+S6jue7hOe7h+WkjeadgueahOmFjee9rumhuVxuICogNC4g5L2/55SoUmVjb3JkPHN0cmluZywgdW5rbm93bj7nsbvlnovmj5DkvpvngbXmtLvmgKfvvIzlhbfkvZPnsbvlnovlnKjov5DooYzml7bnoa7lrppcbiAqXG4gKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAqIDEuIOW6lOeUqOWfuuehgOmFjee9ru+8iGFwcO+8ie+8muW6lOeUqOWQjeensOOAgeeJiOacrOOAgeeOr+Wig+etiVxuICogMi4g5pWw5o2u5bqT6YWN572u77yIZGF0YWJhc2XvvInvvJrmlbDmja7lupPov57mjqXjgIFPUk3phY3nva7nrYlcbiAqIDMuIOe8k+WtmOmFjee9ru+8iHJlZGlz77yJ77yaUmVkaXPov57mjqXjgIHnvJPlrZjnrZbnlaXnrYlcbiAqIDQuIOiupOivgemFjee9ru+8iGp3dO+8ie+8mkpXVOWvhumSpeOAgeS7pOeJjOmFjee9ruetiVxuICogNS4g6YKu5Lu26YWN572u77yIZW1haWzvvInvvJrpgq7ku7bmnI3liqHjgIHmqKHmnb/phY3nva7nrYlcbiAqIDYuIOaXpeW/l+mFjee9ru+8iGxvZ2dpbmfvvInvvJrml6Xlv5fnuqfliKvjgIHovpPlh7rphY3nva7nrYlcbiAqIDcuIOezu+e7n+iuvue9ru+8iHNldHRpbmfvvInvvJrns7vnu5/nuqfphY3nva7poblcbiAqIDguIOesrOS4ieaWuembhuaIkO+8iGtleWNsb2Fr77yJ77yaS2V5Y2xvYWvorqTor4HmnI3liqHphY3nva5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJYW1Db25maWcge1xuICAvKiog5bqU55So5Z+656GA6YWN572uICovXG4gIGFwcDogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIC8qKiDmlbDmja7lupPphY3nva4gKi9cbiAgZGF0YWJhc2U6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiogUmVkaXPnvJPlrZjphY3nva4gKi9cbiAgcmVkaXM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiogSldU6K6k6K+B6YWN572uICovXG4gIGp3dDogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIC8qKiDpgq7ku7bmnI3liqHphY3nva4gKi9cbiAgZW1haWw6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiog5pel5b+X57O757uf6YWN572uICovXG4gIGxvZ2dpbmc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiog57O757uf6K6+572u6YWN572uICovXG4gIHNldHRpbmc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiogS2V5Y2xvYWvpm4bmiJDphY3nva4gKi9cbiAga2V5Y2xvYWs6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG4vKipcbiAqIEBjbGFzcyBDb25maWdTZXJ2aWNlXG4gKiBAZGVzY3JpcHRpb25cbiAqIElBTeezu+e7n+mFjee9ruacjeWKoe+8jOi0n+i0o+euoeeQhuWSjOaPkOS+m+ezu+e7n+S4reaJgOaciemFjee9ruS/oeaBr+OAglxuICog6K+l5pyN5Yqh5piv6YWN572u566h55CG55qE5qC45b+D57uE5Lu277yM5o+Q5L6b5LqG6YWN572u55qE5Yqg6L2944CB6I635Y+W44CB6aqM6K+B562J5Yqf6IO944CCXG4gKlxuICog5Li76KaB5Y6f55CG5LiO5py65Yi25aaC5LiL77yaXG4gKiAxLiDkvb/nlKhOZXN0SlPnmoTkvp3otZbms6jlhaXmnLrliLbvvIzkvZzkuLrlhajlsYDmnI3liqHmj5DkvpvphY3nva7orr/pl65cbiAqIDIuIOWcqOaehOmAoOWHveaVsOS4reW8guatpeWIneWni+WMlumFjee9ru+8jOehruS/nemFjee9ruWcqOacjeWKoeWQr+WKqOaXtuWKoOi9veWujOaIkFxuICogMy4g5L2/55So5Y+q6K+76YWN572u5a+56LGh77yM6Ziy5q2i6L+Q6KGM5pe26YWN572u6KKr5oSP5aSW5L+u5pS5XG4gKiA0LiDmj5DkvpvnsbvlnovlronlhajnmoTphY3nva7orr/pl67mlrnms5XvvIzmlK/mjIHms5vlnovnuqbmnZ9cbiAqIDUuIOmbhuaIkOeOr+Wig+WPmOmHj+euoeeQhu+8jOaUr+aMgeWKqOaAgemFjee9ruabtOaWsFxuICogNi4g5L2/55So6Ieq5a6a5LmJ55qEUGlub0xvZ2dlclNlcnZpY2Xov5vooYzml6Xlv5forrDlvZXvvIzmj5Dkvpvpq5jmgKfog73nmoTnu5PmnoTljJbml6Xlv5dcbiAqXG4gKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAqIDEuIOmFjee9ruWKoOi9veWSjOWIneWni+WMllxuICogMi4g6YWN572u6I635Y+W5ZKM6aqM6K+BXG4gKiAzLiDnjq/looPlj5jph4/nrqHnkIZcbiAqIDQuIOmFjee9ruaooeWdl+WMluiuv+mXrlxuICogNS4g57G75Z6L5a6J5YWo55qE6YWN572u5pON5L2cXG4gKiA2LiDnu5PmnoTljJbml6Xlv5forrDlvZVcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENvbmZpZ1NlcnZpY2Uge1xuICAvKiog546v5aKD6YWN572u5a+56LGhICovXG4gIHByaXZhdGUgcmVhZG9ubHkgZW52aXJvbm1lbnQgPSB7XG4gICAgcHJvZHVjdGlvbjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcbiAgICBlbnY6IHt9IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXG4gIH07XG4gIC8qKiDml6Xlv5fmnI3liqHlrp7kvosgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IFBpbm9Mb2dnZXJTZXJ2aWNlO1xuICAvKiog57O757uf6YWN572u5a+56LGhICovXG4gIHByaXZhdGUgY29uZmlnOiBQYXJ0aWFsPElhbUNvbmZpZz4gPSB7fTtcblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDphY3nva7mnI3liqHmnoTpgKDlh73mlbDvvIzlnKjmnI3liqHlrp7kvovljJbml7boh6rliqjliJ3lp4vljJbphY3nva7jgIJcbiAgICog55Sx5LqO5p6E6YCg5Ye95pWw5LiN6IO95piv5byC5q2l55qE77yM5omA5Lul5L2/55Sodm9pZOiwg+eUqOW8guatpeWIneWni+WMluaWueazleOAglxuICAgKlxuICAgKiBAcGFyYW0gbG9nZ2VyIOiHquWumuS5ieeahFBpbm/ml6Xlv5fmnI3liqHlrp7kvotcbiAgICovXG4gIGNvbnN0cnVjdG9yKGxvZ2dlcjogUGlub0xvZ2dlclNlcnZpY2UpIHtcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcbiAgICB2b2lkIHRoaXMuaW5pdENvbmZpZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBmdW5jdGlvbiBpbml0Q29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDliJ3lp4vljJbphY3nva7lkoznjq/looPlj5jph4/jgILor6Xmlrnms5XlnKjmnI3liqHlkK/liqjml7booqvosIPnlKjvvIzotJ/otKPliqDovb3miYDmnInphY3nva7kv6Hmga9cbiAgICog5bm26K6+572u546v5aKD5Y+Y6YeP44CC55Sx5LqO5p6E6YCg5Ye95pWw5LiN6IO95piv5byC5q2l55qE77yM5omA5Lul5L2/55So54us56uL55qE5byC5q2l5pa55rOV44CCXG4gICAqXG4gICAqIOS4u+imgeWOn+eQhuS4juacuuWItuWmguS4i++8mlxuICAgKiAxLiDosIPnlKhnZXRDb25maWcoKeaWueazleiOt+WPluWujOaVtOeahOmFjee9ruWvueixoVxuICAgKiAyLiDpgY3ljobnjq/looPphY3nva7vvIzliqjmgIHorr7nva5wcm9jZXNzLmVudueOr+Wig+WPmOmHj1xuICAgKiAzLiDorrDlvZXnlJ/kuqfnjq/looPnirbmgIHliLDml6Xlv5fkuK1cbiAgICogNC4g56Gu5L+d6YWN572u5Zyo5pyN5Yqh5ZCv5Yqo5YmN5a6M5oiQ5Yqg6L29XG4gICAqIDUuIOS9v+eUqOiHquWumuS5ieeahFBpbm9Mb2dnZXJTZXJ2aWNl6K6w5b2V57uT5p6E5YyW5pel5b+XXG4gICAqXG4gICAqIOWKn+iDveS4juS4muWKoeinhOWIme+8mlxuICAgKiAxLiDphY3nva7liqDovb3lkozliJ3lp4vljJZcbiAgICogMi4g546v5aKD5Y+Y6YeP6K6+572uXG4gICAqIDMuIOWQr+WKqOeKtuaAgeaXpeW/l+iusOW9lVxuICAgKiA0LiDphY3nva7pqozor4HlkozplJnor6/lpITnkIZcbiAgICogNS4g57uT5p6E5YyW5pel5b+X6K6w5b2VXG4gICAqXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fSDov5Tlm57kuIDkuKpQcm9taXNl77yM6KGo56S66YWN572u5Yid5aeL5YyW6L+H56iLXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGluaXRDb25maWcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5jb25maWcgPSBnZXRDb25maWcoKTtcblxuICAgIC8vIOWKqOaAgeiuvue9rueOr+Wig+WPmOmHj1xuICAgIGlmICh0aGlzLmVudmlyb25tZW50LmVudikge1xuICAgICAgT2JqZWN0LmVudHJpZXModGhpcy5lbnZpcm9ubWVudC5lbnYpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBwcm9jZXNzLmVudltrZXldID0gdmFsdWU7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ2dlci5pbmZvKFxuICAgICAgYOmFjee9ruacjeWKoeWIneWni+WMluWujOaIkO+8jOeUn+S6p+eOr+Wig+eKtuaAgTogJHt0aGlzLmVudmlyb25tZW50LnByb2R1Y3Rpb259YCxcbiAgICAgIExvZ0NvbnRleHQuQ09ORklHLFxuICAgICAge1xuICAgICAgICBpc1Byb2R1Y3Rpb246IHRoaXMuZW52aXJvbm1lbnQucHJvZHVjdGlvbixcbiAgICAgICAgbm9kZUVudjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYsXG4gICAgICAgIGNvbmZpZ0tleXM6IE9iamVjdC5rZXlzKHRoaXMuY29uZmlnKSxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZnVuY3Rpb24gZ2V0Q29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5blrozmlbTnmoTphY3nva7lr7nosaHvvIzov5Tlm57kuIDkuKrlj6ror7vnmoTphY3nva7lia/mnKzjgILor6Xmlrnms5Xmj5Dkvpvkuoblr7nns7vnu5/miYDmnInphY3nva7nmoTorr/pl67vvIxcbiAgICog5ZCM5pe256Gu5L+d6L+U5Zue55qE6YWN572u5a+56LGh5LiN5Lya6KKr5oSP5aSW5L+u5pS544CCXG4gICAqXG4gICAqIOS4u+imgeWOn+eQhuS4juacuuWItuWmguS4i++8mlxuICAgKiAxLiDkvb/nlKhPYmplY3QuZnJlZXplKCnliJvlu7rkuI3lj6/lj5jnmoTphY3nva7lr7nosaFcbiAgICogMi4g5L2/55So5bGV5byA6L+Q566X56ym5Yib5bu66YWN572u5a+56LGh55qE5rex5ou36LSdXG4gICAqIDMuIOi/lOWbnuWPquivu+exu+Wei++8jOmYsuatoui/kOihjOaXtuS/ruaUuVxuICAgKiA0LiDmj5DkvpvnsbvlnovlronlhajnmoTphY3nva7orr/pl65cbiAgICogNS4g6K6w5b2V6YWN572u6K6/6Zeu5pel5b+X77yM5L6/5LqO5a6h6K6h5ZKM6LCD6K+VXG4gICAqXG4gICAqIOWKn+iDveS4juS4muWKoeinhOWIme+8mlxuICAgKiAxLiDlrozmlbTphY3nva7ojrflj5ZcbiAgICogMi4g6YWN572u5a+56LGh5L+d5oqkXG4gICAqIDMuIOexu+Wei+WuieWFqOiuv+mXrlxuICAgKiA0LiDphY3nva7lrozmlbTmgKfkv53or4FcbiAgICogNS4g6YWN572u6K6/6Zeu5a6h6K6hXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxQYXJ0aWFsPElhbUNvbmZpZz4+fSDov5Tlm57lj6ror7vnmoTlrozmlbTphY3nva7lr7nosaFcbiAgICovXG4gIHB1YmxpYyBnZXRDb25maWcoKTogUmVhZG9ubHk8UGFydGlhbDxJYW1Db25maWc+PiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ+iOt+WPluWujOaVtOmFjee9ruWvueixoScsIExvZ0NvbnRleHQuQ09ORklHLCB7XG4gICAgICBjb25maWdLZXlzOiBPYmplY3Qua2V5cyh0aGlzLmNvbmZpZyksXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KTtcbiAgICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7IC4uLnRoaXMuY29uZmlnIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBmdW5jdGlvbiBnZXRDb25maWdWYWx1ZVxuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W5oyH5a6a55qE6YWN572u5YC877yM5pSv5oyB5rOb5Z6L57G75Z6L5a6J5YWo44CC6K+l5pa55rOV5o+Q5L6b5LqG5a+554m55a6a6YWN572u5qih5Z2X55qE6K6/6Zeu77yMXG4gICAqIOWmguaenOmFjee9rumUruS4jeWtmOWcqOS8muaKm+WHuumUmeivr+OAglxuICAgKlxuICAgKiDkuLvopoHljp/nkIbkuI7mnLrliLblpoLkuIvvvJpcbiAgICogMS4g5L2/55So5rOb5Z6LS+e6puadn+mFjee9rumUrueahOexu+Wei1xuICAgKiAyLiDmo4Dmn6XphY3nva7plK7mmK/lkKblrZjlnKjvvIzkuI3lrZjlnKjliJnmipvlh7rplJnor69cbiAgICogMy4g6L+U5Zue5Y+q6K+755qE6YWN572u5YC877yM56Gu5L+d57G75Z6L5a6J5YWoXG4gICAqIDQuIOaUr+aMgVR5cGVTY3JpcHTnmoTnsbvlnovmjqjmlq1cbiAgICogNS4g6K6w5b2V6YWN572u6K6/6Zeu5pel5b+X77yM5L6/5LqO5a6h6K6h5ZKM6LCD6K+VXG4gICAqXG4gICAqIOWKn+iDveS4juS4muWKoeinhOWIme+8mlxuICAgKiAxLiDnibnlrprphY3nva7ojrflj5ZcbiAgICogMi4g6YWN572u6ZSu6aqM6K+BXG4gICAqIDMuIOexu+Wei+WuieWFqOiuv+mXrlxuICAgKiA0LiDplJnor6/lpITnkIblkozmj5DnpLpcbiAgICogNS4g6YWN572u6K6/6Zeu5a6h6K6hXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBLIC0g6YWN572u6ZSu55qE57G75Z6LXG4gICAqIEBwYXJhbSB7S30ga2V5IC0g6KaB6I635Y+W55qE6YWN572u6ZSuXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxJYW1Db25maWdbS10+fSDov5Tlm57lj6ror7vnmoTphY3nva7lgLxcbiAgICogQHRocm93cyB7RXJyb3J9IOW9k+mFjee9rumUruS4jeWtmOWcqOaXtuaKm+WHuumUmeivr1xuICAgKi9cbiAgcHVibGljIGdldENvbmZpZ1ZhbHVlPEsgZXh0ZW5kcyBrZXlvZiBJYW1Db25maWc+KFxuICAgIGtleTogSyxcbiAgKTogUmVhZG9ubHk8SWFtQ29uZmlnW0tdPiB7XG4gICAgaWYgKCEoa2V5IGluIHRoaXMuY29uZmlnKSkge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYOmFjee9rumUruS4jeWtmOWcqDogJHtTdHJpbmcoa2V5KX1gLCBMb2dDb250ZXh0LkNPTkZJRywge1xuICAgICAgICByZXF1ZXN0ZWRLZXk6IFN0cmluZyhrZXkpLFxuICAgICAgICBhdmFpbGFibGVLZXlzOiBPYmplY3Qua2V5cyh0aGlzLmNvbmZpZyksXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbmZpZ3VyYXRpb24ga2V5IFwiJHtTdHJpbmcoa2V5KX1cIiBub3QgZm91bmQuYCk7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYOiOt+WPlumFjee9ruWAvDogJHtTdHJpbmcoa2V5KX1gLCBMb2dDb250ZXh0LkNPTkZJRywge1xuICAgICAgY29uZmlnS2V5OiBTdHJpbmcoa2V5KSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnW2tleV0gYXMgUmVhZG9ubHk8SWFtQ29uZmlnW0tdPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZ2V0dGVyIGFwcENvbmZpZ1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W5bqU55So5Z+656GA6YWN572u77yM5YyF5ZCr5bqU55So5ZCN56ew44CB54mI5pys44CB546v5aKD562J5Z+656GA5L+h5oGv44CCXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj59IOi/lOWbnuWPquivu+eahOW6lOeUqOmFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IGFwcENvbmZpZygpOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5hcHAgPz8ge307XG4gIH1cblxuICAvKipcbiAgICogQGdldHRlciBkYXRhYmFzZUNvbmZpZ1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W5pWw5o2u5bqT6YWN572u77yM5YyF5ZCr5pWw5o2u5bqT6L+e5o6l44CBT1JN6YWN572u44CB6L+e5o6l5rGg562J6K6+572u44CCXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj59IOi/lOWbnuWPquivu+eahOaVsOaNruW6k+mFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IGRhdGFiYXNlQ29uZmlnKCk6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmRhdGFiYXNlID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgcmVkaXNDb25maWdcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPllJlZGlz57yT5a2Y6YWN572u77yM5YyF5ZCr6L+e5o6l5L+h5oGv44CB57yT5a2Y562W55Wl44CB5YiG5biD5byP6ZSB562J6K6+572u44CCXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj59IOi/lOWbnuWPquivu+eahFJlZGlz6YWN572u5a+56LGhXG4gICAqL1xuICBnZXQgcmVkaXNDb25maWcoKTogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcucmVkaXMgPz8ge307XG4gIH1cblxuICAvKipcbiAgICogQGdldHRlciBqd3RDb25maWdcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPlkpXVOiupOivgemFjee9ru+8jOWMheWQq+WvhumSpeOAgeS7pOeJjOi/h+acn+aXtumXtOOAgeWkmuenn+aIt+aUr+aMgeetieiuvue9ruOAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+fSDov5Tlm57lj6ror7vnmoRKV1TphY3nva7lr7nosaFcbiAgICovXG4gIGdldCBqd3RDb25maWcoKTogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuand0ID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgZW1haWxDb25maWdcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPlumCruS7tuacjeWKoemFjee9ru+8jOWMheWQq1NNVFDorr7nva7jgIHpgq7ku7bmqKHmnb/jgIHlj5HpgIHnrZbnlaXnrYnphY3nva7jgIJcbiAgICpcbiAgICogQHJldHVybnMge1JlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+Pn0g6L+U5Zue5Y+q6K+755qE6YKu5Lu26YWN572u5a+56LGhXG4gICAqL1xuICBnZXQgZW1haWxDb25maWcoKTogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuZW1haWwgPz8ge307XG4gIH1cblxuICAvKipcbiAgICogQGdldHRlciBsb2dnaW5nQ29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5bml6Xlv5fns7vnu5/phY3nva7vvIzljIXlkKvml6Xlv5fnuqfliKvjgIHovpPlh7rmoLzlvI/jgIHogZrlkIjorr7nva7nrYnphY3nva7jgIJcbiAgICpcbiAgICogQHJldHVybnMge1JlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+Pn0g6L+U5Zue5Y+q6K+755qE5pel5b+X6YWN572u5a+56LGhXG4gICAqL1xuICBnZXQgbG9nZ2luZ0NvbmZpZygpOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5sb2dnaW5nID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgc2V0dGluZ0NvbmZpZ1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W57O757uf6K6+572u6YWN572u77yM5YyF5ZCr57O757uf57qn6YWN572u6aG55ZKM5YWo5bGA6K6+572u44CCXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj59IOi/lOWbnuWPquivu+eahOezu+e7n+iuvue9rumFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IHNldHRpbmdDb25maWcoKTogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuc2V0dGluZyA/PyB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZ2V0dGVyIGtleWNsb2FrQ29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5ZLZXljbG9ha+mbhuaIkOmFjee9ru+8jOWMheWQq+esrOS4ieaWueiupOivgeacjeWKoeeahOi/nuaOpeWSjOiuvue9ruOAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+fSDov5Tlm57lj6ror7vnmoRLZXljbG9ha+mFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IGtleWNsb2FrQ29uZmlnKCk6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmtleWNsb2FrID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgZGJNaWtyb09ybUNvbm5lY3Rpb25PcHRpb25zXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5ZNaWtyb09STei/nuaOpemFjee9rumAiemhue+8jOeUqOS6juaVsOaNruW6k+i/nuaOpeWSjE9STeaTjeS9nOOAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8TWlrcm9Pcm1Nb2R1bGVPcHRpb25zPn0g6L+U5Zue5Y+q6K+755qETWlrcm9PUk3phY3nva7lr7nosaFcbiAgICovXG4gIGdldCBkYk1pa3JvT3JtQ29ubmVjdGlvbk9wdGlvbnMoKTogUmVhZG9ubHk8TWlrcm9Pcm1Nb2R1bGVPcHRpb25zPiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmRhdGFiYXNlPy5kYk1pa3JvT3JtQ29ubmVjdGlvbk9wdGlvbnMgPz8ge307XG4gIH1cblxuICAvKipcbiAgICogQGdldHRlciBkYktuZXhDb25uZWN0aW9uT3B0aW9uc1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+WS25leOi/nuaOpemFjee9rumAiemhue+8jOeUqOS6juWkjeadguafpeivouWSjOaVsOaNruW6k+i/geenu+OAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8S25leE1vZHVsZU9wdGlvbnM+fSDov5Tlm57lj6ror7vnmoRLbmV46YWN572u5a+56LGhXG4gICAqL1xuICBnZXQgZGJLbmV4Q29ubmVjdGlvbk9wdGlvbnMoKTogUmVhZG9ubHk8S25leE1vZHVsZU9wdGlvbnM+IHtcbiAgICByZXR1cm4gKHRoaXMuY29uZmlnLmRhdGFiYXNlPy5kYktuZXhDb25uZWN0aW9uT3B0aW9ucyA/PyB7XG4gICAgICBjb25maWc6IHt9LFxuICAgIH0pIGFzIFJlYWRvbmx5PEtuZXhNb2R1bGVPcHRpb25zPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZnVuY3Rpb24gZ2V0XG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5bnjq/looPlj5jph4/lgLzvvIzmlK/mjIHnsbvlnovmjqjmlq3jgILor6Xmlrnms5Xmj5Dkvpvkuoblr7nnjq/looPlj5jph4/nmoTnsbvlnovlronlhajorr/pl67vvIxcbiAgICog5aaC5p6c546v5aKD5Y+Y6YeP5LiN5a2Y5Zyo5Lya5oqb5Ye66ZSZ6K+v44CCXG4gICAqXG4gICAqIOS4u+imgeWOn+eQhuS4juacuuWItuWmguS4i++8mlxuICAgKiAxLiDkvb/nlKjms5vlnotL57qm5p2f546v5aKD5Y+Y6YeP6ZSu55qE57G75Z6LXG4gICAqIDIuIOajgOafpeeOr+Wig+WPmOmHj+aYr+WQpuWtmOWcqO+8jOS4jeWtmOWcqOWImeaKm+WHuumUmeivr1xuICAgKiAzLiDov5Tlm57nsbvlnovlronlhajnmoTnjq/looPlj5jph4/lgLxcbiAgICogNC4g5pSv5oyBVHlwZVNjcmlwdOeahOexu+Wei+aOqOaWreWSjOiHquWKqOihpeWFqFxuICAgKiA1LiDorrDlvZXnjq/looPlj5jph4/orr/pl67ml6Xlv5fvvIzkvr/kuo7lrqHorqHlkozosIPor5VcbiAgICpcbiAgICog5Yqf6IO95LiO5Lia5Yqh6KeE5YiZ77yaXG4gICAqIDEuIOeOr+Wig+WPmOmHj+iOt+WPllxuICAgKiAyLiDnsbvlnovlronlhajorr/pl65cbiAgICogMy4g6ZSZ6K+v5aSE55CG5ZKM5o+Q56S6XG4gICAqIDQuIOeOr+Wig+WPmOmHj+mqjOivgVxuICAgKiA1LiDnjq/looPlj5jph4/orr/pl67lrqHorqFcbiAgICpcbiAgICogQHRlbXBsYXRlIEsgLSDnjq/looPlj5jph4/plK7nmoTnsbvlnotcbiAgICogQHBhcmFtIHtLfSBrZXkgLSDopoHojrflj5bnmoTnjq/looPlj5jph4/plK5cbiAgICogQHJldHVybnMge3N0cmluZ30g6L+U5Zue5a+55bqU55qE546v5aKD5Y+Y6YeP5YC8XG4gICAqIEB0aHJvd3Mge0Vycm9yfSDlvZPnjq/looPlj5jph4/kuI3lrZjlnKjml7bmipvlh7rplJnor69cbiAgICovXG4gIGdldDxLIGV4dGVuZHMgc3RyaW5nPihrZXk6IEspOiBzdHJpbmcge1xuICAgIGNvbnN0IHZhbHVlID0gcHJvY2Vzcy5lbnZba2V5XTtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihg546v5aKD5Y+Y6YeP5pyq5a6a5LmJOiAke2tleX1gLCBMb2dDb250ZXh0LkNPTkZJRywge1xuICAgICAgICByZXF1ZXN0ZWRLZXk6IGtleSxcbiAgICAgICAgYXZhaWxhYmxlRW52VmFyczogT2JqZWN0LmtleXMocHJvY2Vzcy5lbnYpLmZpbHRlcihcbiAgICAgICAgICBrID0+XG4gICAgICAgICAgICBrLnN0YXJ0c1dpdGgoJ0RCXycpIHx8IGsuc3RhcnRzV2l0aCgnTE9HXycpIHx8IGsuc3RhcnRzV2l0aCgnSldUXycpLFxuICAgICAgICApLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFbnZpcm9ubWVudCB2YXJpYWJsZSBcIiR7a2V5fVwiIGlzIG5vdCBkZWZpbmVkLmApO1xuICAgIH1cblxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGDojrflj5bnjq/looPlj5jph486ICR7a2V5fWAsIExvZ0NvbnRleHQuQ09ORklHLCB7XG4gICAgICBlbnZLZXk6IGtleSxcbiAgICAgIGhhc1ZhbHVlOiAhIXZhbHVlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogQGZ1bmN0aW9uIGlzUHJvZFxuICAgKiBAZGVzY3JpcHRpb25cbiAgICog5qOA5p+l5bqU55So5piv5ZCm6L+Q6KGM5Zyo55Sf5Lqn546v5aKD5qih5byP44CC6K+l5pa55rOV55So5LqO5Yik5pat5b2T5YmN6L+Q6KGM546v5aKD77yMXG4gICAqIOW4ruWKqeW6lOeUqOagueaNrueOr+Wig+iwg+aVtOihjOS4uuOAglxuICAgKlxuICAgKiDkuLvopoHljp/nkIbkuI7mnLrliLblpoLkuIvvvJpcbiAgICogMS4g5LuO546v5aKD6YWN572u5Lit6I635Y+WcHJvZHVjdGlvbuagh+W/l1xuICAgKiAyLiDov5Tlm57luIPlsJTlgLzooajnpLrmmK/lkKbkuLrnlJ/kuqfnjq/looNcbiAgICogMy4g55So5LqO5p2h5Lu26YC76L6R5ZKM546v5aKD55u45YWz6YWN572uXG4gICAqXG4gICAqIOWKn+iDveS4juS4muWKoeinhOWIme+8mlxuICAgKiAxLiDnjq/looPliKTmlq1cbiAgICogMi4g5p2h5Lu26YC76L6R5pSv5oyBXG4gICAqIDMuIOeOr+Wig+ebuOWFs+mFjee9rlxuICAgKiA0LiDosIPor5Xlkozpg6jnvbLmlK/mjIFcbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IOi/lOWbnnRydWXooajnpLrnlJ/kuqfnjq/looPvvIxmYWxzZeihqOekuumdnueUn+S6p+eOr+Wig1xuICAgKi9cbiAgaXNQcm9kKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmVudmlyb25tZW50LnByb2R1Y3Rpb247XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==