c6a510ecb503b2409bd897a82a917962
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const event_emitter_1 = require("@nestjs/event-emitter");
const nestjs_cls_1 = require("nestjs-cls");
const pino_logger_service_1 = require("./pino-logger.service");
const pino_logger_config_service_1 = require("./pino-logger-config.service");
const pino_logger_factory_1 = require("../factories/pino-logger.factory");
const logging_interface_1 = require("../interfaces/logging.interface");
describe('PinoLoggerService', () => {
    let service;
    let eventEmitter;
    let configService;
    let loggerFactory;
    // let _clsService: ClsService; // 暂时注释掉，因为测试中没有使用
    beforeEach(async () => {
        const mockLogger = {
            debug: jest.fn(),
            info: jest.fn(),
            warn: jest.fn(),
            error: jest.fn(),
            fatal: jest.fn(),
            trace: jest.fn(),
            child: jest.fn(),
            flush: jest.fn(),
        };
        const mockConfigService = {
            getConfig: jest.fn().mockReturnValue({
                level: 'info',
                format: 'json',
                colorize: true,
                timestamp: true,
                requestId: true,
                tenantId: true,
                userId: true,
                performance: true,
                stackTrace: true,
                filePath: undefined,
                rotation: { maxSize: '10m', maxFiles: 5, interval: '1d' },
                remote: undefined,
            }),
            getLevel: jest.fn().mockReturnValue('info'),
            setLevel: jest.fn(),
            updateConfig: jest.fn(),
        };
        const mockLoggerFactory = {
            createLogger: jest.fn().mockReturnValue(mockLogger),
            createChildLogger: jest.fn().mockReturnValue(mockLogger),
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                {
                    provide: pino_logger_service_1.PinoLoggerService,
                    useFactory: (eventEmitter, configService, loggerFactory, cls) => {
                        return new pino_logger_service_1.PinoLoggerService(eventEmitter, configService, loggerFactory, cls);
                    },
                    inject: [
                        event_emitter_1.EventEmitter2,
                        pino_logger_config_service_1.PinoLoggerConfigService,
                        pino_logger_factory_1.PinoLoggerFactory,
                        nestjs_cls_1.ClsService,
                    ],
                },
                {
                    provide: pino_logger_config_service_1.PinoLoggerConfigService,
                    useValue: mockConfigService,
                },
                {
                    provide: pino_logger_factory_1.PinoLoggerFactory,
                    useValue: mockLoggerFactory,
                },
                {
                    provide: event_emitter_1.EventEmitter2,
                    useValue: {
                        emit: jest.fn(),
                    },
                },
                {
                    provide: nestjs_cls_1.ClsService,
                    useValue: {
                        get: jest.fn(),
                        set: jest.fn(),
                        run: jest.fn(),
                        runWith: jest.fn(),
                        enter: jest.fn(),
                        exit: jest.fn(),
                        isActive: jest.fn().mockReturnValue(true),
                    },
                },
            ],
        }).compile();
        service = module.get(pino_logger_service_1.PinoLoggerService);
        eventEmitter = module.get(event_emitter_1.EventEmitter2);
        configService = module.get(pino_logger_config_service_1.PinoLoggerConfigService);
        loggerFactory = module.get(pino_logger_factory_1.PinoLoggerFactory);
        // _clsService = module.get<ClsService>(ClsService);
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('basic logging', () => {
        it('should log debug messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.debug('Debug message', logging_interface_1.LogContext.SYSTEM, { test: 'data' });
            expect(spy).toHaveBeenCalledWith('debug', 'Debug message', logging_interface_1.LogContext.SYSTEM, { test: 'data' }, undefined);
        });
        it('should log info messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.info('Info message', logging_interface_1.LogContext.BUSINESS, { operation: 'test' });
            expect(spy).toHaveBeenCalledWith('info', 'Info message', logging_interface_1.LogContext.BUSINESS, { operation: 'test' }, undefined);
        });
        it('should log warn messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.warn('Warning message', logging_interface_1.LogContext.AUTH, { userId: '123' });
            expect(spy).toHaveBeenCalledWith('warn', 'Warning message', logging_interface_1.LogContext.AUTH, { userId: '123' }, undefined);
        });
        it('should log error messages', () => {
            const error = new Error('Test error');
            const spy = jest.spyOn(service, 'log');
            service.error('Error message', logging_interface_1.LogContext.DATABASE, { query: 'SELECT *' }, error);
            expect(spy).toHaveBeenCalledWith('error', 'Error message', logging_interface_1.LogContext.DATABASE, { query: 'SELECT *' }, error);
        });
        it('should log fatal messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.fatal('Fatal message', logging_interface_1.LogContext.SYSTEM, { critical: true });
            expect(spy).toHaveBeenCalledWith('fatal', 'Fatal message', logging_interface_1.LogContext.SYSTEM, { critical: true }, undefined);
        });
        it('should log trace messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.trace('Trace message', logging_interface_1.LogContext.PERFORMANCE, { duration: 100 });
            expect(spy).toHaveBeenCalledWith('trace', 'Trace message', logging_interface_1.LogContext.PERFORMANCE, { duration: 100 }, undefined);
        });
    });
    describe('specialized logging', () => {
        it('should log performance messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.performance('database_query', 150, logging_interface_1.LogContext.DATABASE, {
                table: 'users',
            });
            expect(spy).toHaveBeenCalledWith('info', 'Performance: database_query took 150ms', logging_interface_1.LogContext.DATABASE, {
                table: 'users',
                operation: 'database_query',
                duration: 150,
                type: 'performance',
            });
        });
        it('should log business messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.business('User registered', {
                userId: '123',
                email: 'test@example.com',
            });
            expect(spy).toHaveBeenCalledWith('info', 'User registered', logging_interface_1.LogContext.BUSINESS, {
                userId: '123',
                email: 'test@example.com',
            });
        });
        it('should log security messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.security('Failed login attempt', {
                ip: '192.168.1.1',
                username: 'test',
            });
            expect(spy).toHaveBeenCalledWith('warn', 'Failed login attempt', logging_interface_1.LogContext.AUTH, {
                ip: '192.168.1.1',
                username: 'test',
            });
        });
    });
    describe('configuration', () => {
        it('should get and set log level', () => {
            jest.spyOn(configService, 'getLevel').mockReturnValue('info');
            jest.spyOn(configService, 'setLevel').mockImplementation(() => undefined);
            service.setLevel('debug');
            expect(configService.setLevel).toHaveBeenCalledWith('debug');
            // setLevel method doesn't call getLevel, so we test getLevel separately
            const level = service.getLevel();
            expect(configService.getLevel).toHaveBeenCalled();
            expect(level).toBe('info');
        });
        it('should get and update config', () => {
            const mockConfig = {
                level: 'warn',
                format: 'json',
                colorize: true,
                timestamp: true,
                requestId: true,
                tenantId: true,
                userId: true,
                performance: true,
                stackTrace: true,
                filePath: undefined,
                rotation: { maxSize: '10m', maxFiles: 5, interval: '1d' },
                remote: undefined,
            };
            jest.spyOn(configService, 'getConfig').mockReturnValue(mockConfig);
            jest
                .spyOn(configService, 'updateConfig')
                .mockImplementation(() => undefined);
            const config = service.getConfig();
            service.updateConfig({ level: 'warn' });
            expect(configService.getConfig).toHaveBeenCalled();
            expect(configService.updateConfig).toHaveBeenCalledWith({
                level: 'warn',
            });
            expect(config).toEqual(mockConfig);
        });
    });
    describe('child logger', () => {
        it('should create child logger', () => {
            const mockChildLogger = {
                debug: jest.fn(),
                info: jest.fn(),
                warn: jest.fn(),
                error: jest.fn(),
                fatal: jest.fn(),
                trace: jest.fn(),
            };
            jest
                .spyOn(loggerFactory, 'createChildLogger')
                .mockReturnValue(mockChildLogger);
            const childLogger = service.child(logging_interface_1.LogContext.DATABASE, {
                tenantId: '123',
            });
            expect(childLogger).toBeDefined();
            expect(childLogger).toBeInstanceOf(pino_logger_service_1.PinoLoggerService);
            expect(loggerFactory.createChildLogger).toHaveBeenCalledWith(expect.anything(), { context: logging_interface_1.LogContext.DATABASE, tenantId: '123' });
        });
    });
    describe('statistics', () => {
        it('should track log statistics', () => {
            // 重置统计
            service.resetStats();
            // 记录一些日志
            service.info('Test message 1', logging_interface_1.LogContext.BUSINESS);
            service.warn('Test message 2', logging_interface_1.LogContext.AUTH);
            service.error('Test message 3', logging_interface_1.LogContext.DATABASE);
            const stats = service.getStats();
            expect(stats.totalLogs).toBeGreaterThanOrEqual(3);
            expect(stats.logsByLevel.info).toBeGreaterThanOrEqual(1);
            expect(stats.logsByLevel.warn).toBeGreaterThanOrEqual(1);
            expect(stats.logsByLevel.error).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.BUSINESS]).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.AUTH]).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.DATABASE]).toBeGreaterThanOrEqual(1);
            expect(stats.averageLogSize).toBeGreaterThan(0);
            expect(stats.lastLogTime).toBeDefined();
        });
        it('should reset statistics', () => {
            // 记录一些日志
            service.info('Test message');
            // 重置统计
            service.resetStats();
            const stats = service.getStats();
            expect(stats.totalLogs).toBe(0);
            expect(stats.logsByLevel.info).toBe(0);
        });
    });
    describe('event emission', () => {
        it('should emit log events', () => {
            service.info('Test message', logging_interface_1.LogContext.BUSINESS, { test: 'data' });
            expect(eventEmitter.emit).toHaveBeenCalledWith('logger.log', expect.objectContaining({
                level: 'info',
                message: 'Test message',
                context: logging_interface_1.LogContext.BUSINESS,
                metadata: { test: 'data' },
            }));
        });
    });
    describe('lifecycle methods', () => {
        it('should flush and close logger', async () => {
            await expect(service.flush()).resolves.not.toThrow();
            await expect(service.close()).resolves.not.toThrow();
        });
        it('should handle module destruction', async () => {
            await expect(service.onModuleDestroy()).resolves.not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvbG9nZ2luZy9zcmMvc2VydmljZXMvcGluby1sb2dnZXIuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELHlEQUFzRDtBQUN0RCwyQ0FBd0M7QUFDeEMsK0RBQTBEO0FBQzFELDZFQUF1RTtBQUN2RSwwRUFBcUU7QUFDckUsdUVBQXVFO0FBRXZFLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxPQUEwQixDQUFDO0lBQy9CLElBQUksWUFBMkIsQ0FBQztJQUNoQyxJQUFJLGFBQXNDLENBQUM7SUFDM0MsSUFBSSxhQUFnQyxDQUFDO0lBQ3JDLGtEQUFrRDtJQUVsRCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxVQUFVLEdBQUc7WUFDakIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2pCLENBQUM7UUFFRixNQUFNLGlCQUFpQixHQUFHO1lBQ3hCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO2dCQUNuQyxLQUFLLEVBQUUsTUFBTTtnQkFDYixNQUFNLEVBQUUsTUFBTTtnQkFDZCxRQUFRLEVBQUUsSUFBSTtnQkFDZCxTQUFTLEVBQUUsSUFBSTtnQkFDZixTQUFTLEVBQUUsSUFBSTtnQkFDZixRQUFRLEVB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QUFjLEVBQUUsOEJBQVUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUVwRSxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUM1QyxZQUFZLEVBQ1osTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixLQUFLLEVBQUUsTUFBTTtnQkFDYixPQUFPLEVBQUUsY0FBYztnQkFDdkIsT0FBTyxFQUFFLDhCQUFVLENBQUMsUUFBUTtnQkFDNUIsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRTthQUMzQixDQUFDLENBQ0gsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3QyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3JELE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEQsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvbG9nZ2luZy9zcmMvc2VydmljZXMvcGluby1sb2dnZXIuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyMiB9IGZyb20gJ0BuZXN0anMvZXZlbnQtZW1pdHRlcic7XG5pbXBvcnQgeyBDbHNTZXJ2aWNlIH0gZnJvbSAnbmVzdGpzLWNscyc7XG5pbXBvcnQgeyBQaW5vTG9nZ2VyU2VydmljZSB9IGZyb20gJy4vcGluby1sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBQaW5vTG9nZ2VyQ29uZmlnU2VydmljZSB9IGZyb20gJy4vcGluby1sb2dnZXItY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGlub0xvZ2dlckZhY3RvcnkgfSBmcm9tICcuLi9mYWN0b3JpZXMvcGluby1sb2dnZXIuZmFjdG9yeSc7XG5pbXBvcnQgeyBMb2dDb250ZXh0LCBMb2dMZXZlbCB9IGZyb20gJy4uL2ludGVyZmFjZXMvbG9nZ2luZy5pbnRlcmZhY2UnO1xuXG5kZXNjcmliZSgnUGlub0xvZ2dlclNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBQaW5vTG9nZ2VyU2VydmljZTtcbiAgbGV0IGV2ZW50RW1pdHRlcjogRXZlbnRFbWl0dGVyMjtcbiAgbGV0IGNvbmZpZ1NlcnZpY2U6IFBpbm9Mb2dnZXJDb25maWdTZXJ2aWNlO1xuICBsZXQgbG9nZ2VyRmFjdG9yeTogUGlub0xvZ2dlckZhY3Rvcnk7XG4gIC8vIGxldCBfY2xzU2VydmljZTogQ2xzU2VydmljZTsgLy8g5pqC5pe25rOo6YeK5o6J77yM5Zug5Li65rWL6K+V5Lit5rKh5pyJ5L2/55SoXG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja0xvZ2dlciA9IHtcbiAgICAgIGRlYnVnOiBqZXN0LmZuKCksXG4gICAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgICB3YXJuOiBqZXN0LmZuKCksXG4gICAgICBlcnJvcjogamVzdC5mbigpLFxuICAgICAgZmF0YWw6IGplc3QuZm4oKSxcbiAgICAgIHRyYWNlOiBqZXN0LmZuKCksXG4gICAgICBjaGlsZDogamVzdC5mbigpLFxuICAgICAgZmx1c2g6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja0NvbmZpZ1NlcnZpY2UgPSB7XG4gICAgICBnZXRDb25maWc6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBsZXZlbDogJ2luZm8nLFxuICAgICAgICBmb3JtYXQ6ICdqc29uJyxcbiAgICAgICAgY29sb3JpemU6IHRydWUsXG4gICAgICAgIHRpbWVzdGFtcDogdHJ1ZSxcbiAgICAgICAgcmVxdWVzdElkOiB0cnVlLFxuICAgICAgICB0ZW5hbnRJZDogdHJ1ZSxcbiAgICAgICAgdXNlcklkOiB0cnVlLFxuICAgICAgICBwZXJmb3JtYW5jZTogdHJ1ZSxcbiAgICAgICAgc3RhY2tUcmFjZTogdHJ1ZSxcbiAgICAgICAgZmlsZVBhdGg6IHVuZGVmaW5lZCxcbiAgICAgICAgcm90YXRpb246IHsgbWF4U2l6ZTogJzEwbScsIG1heEZpbGVzOiA1LCBpbnRlcnZhbDogJzFkJyB9LFxuICAgICAgICByZW1vdGU6IHVuZGVmaW5lZCxcbiAgICAgIH0pLFxuICAgICAgZ2V0TGV2ZWw6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2luZm8nKSxcbiAgICAgIHNldExldmVsOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVDb25maWc6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja0xvZ2dlckZhY3RvcnkgPSB7XG4gICAgICBjcmVhdGVMb2dnZXI6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0xvZ2dlciksXG4gICAgICBjcmVhdGVDaGlsZExvZ2dlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrTG9nZ2VyKSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUGlub0xvZ2dlclNlcnZpY2UsXG4gICAgICAgICAgdXNlRmFjdG9yeTogKFxuICAgICAgICAgICAgZXZlbnRFbWl0dGVyOiBFdmVudEVtaXR0ZXIyLFxuICAgICAgICAgICAgY29uZmlnU2VydmljZTogUGlub0xvZ2dlckNvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgICBsb2dnZXJGYWN0b3J5OiBQaW5vTG9nZ2VyRmFjdG9yeSxcbiAgICAgICAgICAgIGNsczogQ2xzU2VydmljZSxcbiAgICAgICAgICApID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGlub0xvZ2dlclNlcnZpY2UoXG4gICAgICAgICAgICAgIGV2ZW50RW1pdHRlcixcbiAgICAgICAgICAgICAgY29uZmlnU2VydmljZSxcbiAgICAgICAgICAgICAgbG9nZ2VyRmFjdG9yeSxcbiAgICAgICAgICAgICAgY2xzLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluamVjdDogW1xuICAgICAgICAgICAgRXZlbnRFbWl0dGVyMixcbiAgICAgICAgICAgIFBpbm9Mb2dnZXJDb25maWdTZXJ2aWNlLFxuICAgICAgICAgICAgUGlub0xvZ2dlckZhY3RvcnksXG4gICAgICAgICAgICBDbHNTZXJ2aWNlLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaW5vTG9nZ2VyQ29uZmlnU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0NvbmZpZ1NlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaW5vTG9nZ2VyRmFjdG9yeSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0xvZ2dlckZhY3RvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBFdmVudEVtaXR0ZXIyLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IENsc1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogamVzdC5mbigpLFxuICAgICAgICAgICAgc2V0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBydW46IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHJ1bldpdGg6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGVudGVyOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBleGl0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBpc0FjdGl2ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxQaW5vTG9nZ2VyU2VydmljZT4oUGlub0xvZ2dlclNlcnZpY2UpO1xuICAgIGV2ZW50RW1pdHRlciA9IG1vZHVsZS5nZXQ8RXZlbnRFbWl0dGVyMj4oRXZlbnRFbWl0dGVyMik7XG4gICAgY29uZmlnU2VydmljZSA9IG1vZHVsZS5nZXQ8UGlub0xvZ2dlckNvbmZpZ1NlcnZpY2U+KFxuICAgICAgUGlub0xvZ2dlckNvbmZpZ1NlcnZpY2UsXG4gICAgKTtcbiAgICBsb2dnZXJGYWN0b3J5ID0gbW9kdWxlLmdldDxQaW5vTG9nZ2VyRmFjdG9yeT4oUGlub0xvZ2dlckZhY3RvcnkpO1xuICAgIC8vIF9jbHNTZXJ2aWNlID0gbW9kdWxlLmdldDxDbHNTZXJ2aWNlPihDbHNTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnYmFzaWMgbG9nZ2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyBkZWJ1ZyBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuZGVidWcoJ0RlYnVnIG1lc3NhZ2UnLCBMb2dDb250ZXh0LlNZU1RFTSwgeyB0ZXN0OiAnZGF0YScgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2RlYnVnJyxcbiAgICAgICAgJ0RlYnVnIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LlNZU1RFTSxcbiAgICAgICAgeyB0ZXN0OiAnZGF0YScgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGluZm8gbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAnbG9nJyk7XG4gICAgICBzZXJ2aWNlLmluZm8oJ0luZm8gbWVzc2FnZScsIExvZ0NvbnRleHQuQlVTSU5FU1MsIHsgb3BlcmF0aW9uOiAndGVzdCcgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2luZm8nLFxuICAgICAgICAnSW5mbyBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgeyBvcGVyYXRpb246ICd0ZXN0JyB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgd2FybiBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2Uud2FybignV2FybmluZyBtZXNzYWdlJywgTG9nQ29udGV4dC5BVVRILCB7IHVzZXJJZDogJzEyMycgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ3dhcm4nLFxuICAgICAgICAnV2FybmluZyBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5BVVRILFxuICAgICAgICB7IHVzZXJJZDogJzEyMycgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGVycm9yIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuZXJyb3IoXG4gICAgICAgICdFcnJvciBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5EQVRBQkFTRSxcbiAgICAgICAgeyBxdWVyeTogJ1NFTEVDVCAqJyB9LFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgJ0Vycm9yIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LkRBVEFCQVNFLFxuICAgICAgICB7IHF1ZXJ5OiAnU0VMRUNUIConIH0sXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGZhdGFsIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS5mYXRhbCgnRmF0YWwgbWVzc2FnZScsIExvZ0NvbnRleHQuU1lTVEVNLCB7IGNyaXRpY2FsOiB0cnVlIH0pO1xuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdmYXRhbCcsXG4gICAgICAgICdGYXRhbCBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5TWVNURU0sXG4gICAgICAgIHsgY3JpdGljYWw6IHRydWUgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIHRyYWNlIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS50cmFjZSgnVHJhY2UgbWVzc2FnZScsIExvZ0NvbnRleHQuUEVSRk9STUFOQ0UsIHsgZHVyYXRpb246IDEwMCB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAndHJhY2UnLFxuICAgICAgICAnVHJhY2UgbWVzc2FnZScsXG4gICAgICAgIExvZ0NvbnRleHQuUEVSRk9STUFOQ0UsXG4gICAgICAgIHsgZHVyYXRpb246IDEwMCB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3BlY2lhbGl6ZWQgbG9nZ2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyBwZXJmb3JtYW5jZSBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UucGVyZm9ybWFuY2UoJ2RhdGFiYXNlX3F1ZXJ5JywgMTUwLCBMb2dDb250ZXh0LkRBVEFCQVNFLCB7XG4gICAgICAgIHRhYmxlOiAndXNlcnMnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2luZm8nLFxuICAgICAgICAnUGVyZm9ybWFuY2U6IGRhdGFiYXNlX3F1ZXJ5IHRvb2sgMTUwbXMnLFxuICAgICAgICBMb2dDb250ZXh0LkRBVEFCQVNFLFxuICAgICAgICB7XG4gICAgICAgICAgdGFibGU6ICd1c2VycycsXG4gICAgICAgICAgb3BlcmF0aW9uOiAnZGF0YWJhc2VfcXVlcnknLFxuICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXG4gICAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBidXNpbmVzcyBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuYnVzaW5lc3MoJ1VzZXIgcmVnaXN0ZXJlZCcsIHtcbiAgICAgICAgdXNlcklkOiAnMTIzJyxcbiAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdpbmZvJyxcbiAgICAgICAgJ1VzZXIgcmVnaXN0ZXJlZCcsXG4gICAgICAgIExvZ0NvbnRleHQuQlVTSU5FU1MsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6ICcxMjMnLFxuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgc2VjdXJpdHkgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAnbG9nJyk7XG4gICAgICBzZXJ2aWNlLnNlY3VyaXR5KCdGYWlsZWQgbG9naW4gYXR0ZW1wdCcsIHtcbiAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnd2FybicsXG4gICAgICAgICdGYWlsZWQgbG9naW4gYXR0ZW1wdCcsXG4gICAgICAgIExvZ0NvbnRleHQuQVVUSCxcbiAgICAgICAge1xuICAgICAgICAgIGlwOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhbmQgc2V0IGxvZyBsZXZlbCcsICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oY29uZmlnU2VydmljZSwgJ2dldExldmVsJykubW9ja1JldHVyblZhbHVlKCdpbmZvJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbmZpZ1NlcnZpY2UsICdzZXRMZXZlbCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB1bmRlZmluZWQpO1xuXG4gICAgICBzZXJ2aWNlLnNldExldmVsKCdkZWJ1ZycpO1xuXG4gICAgICBleHBlY3QoY29uZmlnU2VydmljZS5zZXRMZXZlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2RlYnVnJyk7XG4gICAgICAvLyBzZXRMZXZlbCBtZXRob2QgZG9lc24ndCBjYWxsIGdldExldmVsLCBzbyB3ZSB0ZXN0IGdldExldmVsIHNlcGFyYXRlbHlcbiAgICAgIGNvbnN0IGxldmVsID0gc2VydmljZS5nZXRMZXZlbCgpO1xuICAgICAgZXhwZWN0KGNvbmZpZ1NlcnZpY2UuZ2V0TGV2ZWwpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChsZXZlbCkudG9CZSgnaW5mbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgYW5kIHVwZGF0ZSBjb25maWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xuICAgICAgICBsZXZlbDogJ3dhcm4nIGFzIExvZ0xldmVsLFxuICAgICAgICBmb3JtYXQ6ICdqc29uJyBhcyBhbnksXG4gICAgICAgIGNvbG9yaXplOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IHRydWUsXG4gICAgICAgIHJlcXVlc3RJZDogdHJ1ZSxcbiAgICAgICAgdGVuYW50SWQ6IHRydWUsXG4gICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHRydWUsXG4gICAgICAgIHN0YWNrVHJhY2U6IHRydWUsXG4gICAgICAgIGZpbGVQYXRoOiB1bmRlZmluZWQsXG4gICAgICAgIHJvdGF0aW9uOiB7IG1heFNpemU6ICcxMG0nLCBtYXhGaWxlczogNSwgaW50ZXJ2YWw6ICcxZCcgfSxcbiAgICAgICAgcmVtb3RlOiB1bmRlZmluZWQsXG4gICAgICB9O1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCAnZ2V0Q29uZmlnJykubW9ja1JldHVyblZhbHVlKG1vY2tDb25maWcpO1xuICAgICAgamVzdFxuICAgICAgICAuc3B5T24oY29uZmlnU2VydmljZSwgJ3VwZGF0ZUNvbmZpZycpXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gdW5kZWZpbmVkKTtcblxuICAgICAgY29uc3QgY29uZmlnID0gc2VydmljZS5nZXRDb25maWcoKTtcbiAgICAgIHNlcnZpY2UudXBkYXRlQ29uZmlnKHsgbGV2ZWw6ICd3YXJuJyB9KTtcblxuICAgICAgZXhwZWN0KGNvbmZpZ1NlcnZpY2UuZ2V0Q29uZmlnKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QoY29uZmlnU2VydmljZS51cGRhdGVDb25maWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgbGV2ZWw6ICd3YXJuJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbmZpZykudG9FcXVhbChtb2NrQ29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NoaWxkIGxvZ2dlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjaGlsZCBsb2dnZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ2hpbGRMb2dnZXIgPSB7XG4gICAgICAgIGRlYnVnOiBqZXN0LmZuKCksXG4gICAgICAgIGluZm86IGplc3QuZm4oKSxcbiAgICAgICAgd2FybjogamVzdC5mbigpLFxuICAgICAgICBlcnJvcjogamVzdC5mbigpLFxuICAgICAgICBmYXRhbDogamVzdC5mbigpLFxuICAgICAgICB0cmFjZTogamVzdC5mbigpLFxuICAgICAgfTtcbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKGxvZ2dlckZhY3RvcnksICdjcmVhdGVDaGlsZExvZ2dlcicpXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWUobW9ja0NoaWxkTG9nZ2VyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGNoaWxkTG9nZ2VyID0gc2VydmljZS5jaGlsZChMb2dDb250ZXh0LkRBVEFCQVNFLCB7XG4gICAgICAgIHRlbmFudElkOiAnMTIzJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoY2hpbGRMb2dnZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY2hpbGRMb2dnZXIpLnRvQmVJbnN0YW5jZU9mKFBpbm9Mb2dnZXJTZXJ2aWNlKTtcbiAgICAgIGV4cGVjdChsb2dnZXJGYWN0b3J5LmNyZWF0ZUNoaWxkTG9nZ2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKCksXG4gICAgICAgIHsgY29udGV4dDogTG9nQ29udGV4dC5EQVRBQkFTRSwgdGVuYW50SWQ6ICcxMjMnIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RhdGlzdGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIGxvZyBzdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgICAgLy8g6YeN572u57uf6K6hXG4gICAgICBzZXJ2aWNlLnJlc2V0U3RhdHMoKTtcblxuICAgICAgLy8g6K6w5b2V5LiA5Lqb5pel5b+XXG4gICAgICBzZXJ2aWNlLmluZm8oJ1Rlc3QgbWVzc2FnZSAxJywgTG9nQ29udGV4dC5CVVNJTkVTUyk7XG4gICAgICBzZXJ2aWNlLndhcm4oJ1Rlc3QgbWVzc2FnZSAyJywgTG9nQ29udGV4dC5BVVRIKTtcbiAgICAgIHNlcnZpY2UuZXJyb3IoJ1Rlc3QgbWVzc2FnZSAzJywgTG9nQ29udGV4dC5EQVRBQkFTRSk7XG5cbiAgICAgIGNvbnN0IHN0YXRzID0gc2VydmljZS5nZXRTdGF0cygpO1xuXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxMb2dzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUxldmVsLmluZm8pLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMubG9nc0J5TGV2ZWwud2FybikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlMZXZlbC5lcnJvcikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlDb250ZXh0W0xvZ0NvbnRleHQuQlVTSU5FU1NdKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKFxuICAgICAgICAxLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlDb250ZXh0W0xvZ0NvbnRleHQuQVVUSF0pLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMubG9nc0J5Q29udGV4dFtMb2dDb250ZXh0LkRBVEFCQVNFXSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChcbiAgICAgICAgMSxcbiAgICAgICk7XG4gICAgICBleHBlY3Qoc3RhdHMuYXZlcmFnZUxvZ1NpemUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sYXN0TG9nVGltZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIC8vIOiusOW9leS4gOS6m+aXpeW/l1xuICAgICAgc2VydmljZS5pbmZvKCdUZXN0IG1lc3NhZ2UnKTtcblxuICAgICAgLy8g6YeN572u57uf6K6hXG4gICAgICBzZXJ2aWNlLnJlc2V0U3RhdHMoKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldFN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxMb2dzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUxldmVsLmluZm8pLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudCBlbWlzc2lvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgbG9nIGV2ZW50cycsICgpID0+IHtcbiAgICAgIHNlcnZpY2UuaW5mbygnVGVzdCBtZXNzYWdlJywgTG9nQ29udGV4dC5CVVNJTkVTUywgeyB0ZXN0OiAnZGF0YScgfSk7XG5cbiAgICAgIGV4cGVjdChldmVudEVtaXR0ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdsb2dnZXIubG9nJyxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGxldmVsOiAnaW5mbycsXG4gICAgICAgICAgbWVzc2FnZTogJ1Rlc3QgbWVzc2FnZScsXG4gICAgICAgICAgY29udGV4dDogTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgICBtZXRhZGF0YTogeyB0ZXN0OiAnZGF0YScgfSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbGlmZWN5Y2xlIG1ldGhvZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmbHVzaCBhbmQgY2xvc2UgbG9nZ2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZmx1c2goKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNsb3NlKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2R1bGUgZGVzdHJ1Y3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5vbk1vZHVsZURlc3Ryb3koKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==