886e0767453f40f0df88132b70f3e3cd
"use strict";
/**
 * @file redis-cache.service.ts
 * @description Redis缓存服务
 *
 * 该文件实现了基于Redis的缓存服务，包括：
 * - 基础的CRUD操作
 * - 缓存统计和健康检查
 * - 连接管理和错误处理
 * - 序列化和反序列化
 *
 * 遵循DDD和Clean Architecture原则，提供高性能的分布式缓存。
 */
var __esDecorate = (this && this.__esDecorate) || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {
    function accept(f) { if (f !== void 0 && typeof f !== "function") throw new TypeError("Function expected"); return f; }
    var kind = contextIn.kind, key = kind === "getter" ? "get" : kind === "setter" ? "set" : "value";
    var target = !descriptorIn && ctor ? contextIn["static"] ? ctor : ctor.prototype : null;
    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});
    var _, done = false;
    for (var i = decorators.length - 1; i >= 0; i--) {
        var context = {};
        for (var p in contextIn) context[p] = p === "access" ? {} : contextIn[p];
        for (var p in contextIn.access) context.access[p] = contextIn.access[p];
        context.addInitializer = function (f) { if (done) throw new TypeError("Cannot add initializers after decoration has completed"); extraInitializers.push(accept(f || null)); };
        var result = (0, decorators[i])(kind === "accessor" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);
        if (kind === "accessor") {
            if (result === void 0) continue;
            if (result === null || typeof result !== "object") throw new TypeError("Object expected");
            if (_ = accept(result.get)) descriptor.get = _;
            if (_ = accept(result.set)) descriptor.set = _;
            if (_ = accept(result.init)) initializers.unshift(_);
        }
        else if (_ = accept(result)) {
            if (kind === "field") initializers.unshift(_);
            else descriptor[key] = _;
        }
    }
    if (target) Object.defineProperty(target, contextIn.name, descriptor);
    done = true;
};
var __runInitializers = (this && this.__runInitializers) || function (thisArg, initializers, value) {
    var useValue = arguments.length > 2;
    for (var i = 0; i < initializers.length; i++) {
        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);
    }
    return useValue ? value : void 0;
};
var __setFunctionName = (this && this.__setFunctionName) || function (f, name, prefix) {
    if (typeof name === "symbol") name = name.description ? "[".concat(name.description, "]") : "";
    return Object.defineProperty(f, "name", { configurable: true, value: prefix ? "".concat(prefix, " ", name) : name });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.RedisCacheService = void 0;
const common_1 = require("@nestjs/common");
const ioredis_1 = __importDefault(require("ioredis"));
const cache_interface_1 = require("../interfaces/cache.interface");
const logging_1 = require("@aiofix/logging");
/**
 * @class RedisCacheService
 * @description Redis缓存服务实现
 *
 * 提供基于Redis的分布式缓存功能，包括：
 * - 基础的CRUD操作
 * - 缓存统计和健康检查
 * - 连接管理和错误处理
 * - 序列化和反序列化
 */
let RedisCacheService = (() => {
    let _classDecorators = [(0, common_1.Injectable)()];
    let _classDescriptor;
    let _classExtraInitializers = [];
    let _classThis;
    var RedisCacheService = _classThis = class {
        constructor(config, keyFactory, logger) {
            this.config = config;
            this.keyFactory = keyFactory;
            this.logger = logger;
            this.redis = {};
            this.isConnected = false;
            this.stats = {
                totalEntries: 0,
                hits: 0,
                misses: 0,
                hitRate: 0,
                totalSize: 0,
                averageSize: 0,
                expiredEntries: 0,
                evictedEntries: 0,
                lastReset: Date.now(),
            };
        }
        /**
         * @method onModuleInit
         * @description 模块初始化时连接Redis
         */
        async onModuleInit() {
            await this.connect();
        }
        /**
         * @method onModuleDestroy
         * @description 模块销毁时断开Redis连接
         */
        async onModuleDestroy() {
            await this.disconnect();
        }
        /**
         * @method connect
         * @description 连接到Redis
         */
        async connect() {
            try {
                if (this.config.cluster && this.config.nodes) {
                    this.redis = new ioredis_1.default.Cluster(this.config.nodes, {
                        redisOptions: {
                            password: this.config.password,
                            db: this.config.db || 0,
                            connectTimeout: this.config.connectTimeout || 10000,
                            commandTimeout: this.config.commandTimeout || 5000,
                            maxRetriesPerRequest: this.config.retries || 3,
                        },
                    });
                }
                else if (this.config.sentinel && this.config.sentinels) {
                    this.redis = new ioredis_1.default({
                        sentinels: this.config.sentinels,
                        name: this.config.name || 'mymaster',
                        password: this.config.password,
                        db: this.config.db || 0,
                        connectTimeout: this.config.connectTimeout || 10000,
                        commandTimeout: this.config.commandTimeout || 5000,
                        maxRetriesPerRequest: this.config.retries || 3,
                    });
                }
                else {
                    this.redis = new ioredis_1.default({
                        host: this.config.host,
                        port: this.config.port,
                        password: this.config.password,
                        db: this.config.db || 0,
                        connectTimeout: this.config.connectTimeout || 10000,
                        commandTimeout: this.config.commandTimeout || 5000,
                        maxRetriesPerRequest: this.config.retries || 3,
                    });
                }
                // 监听连接事件
                this.redis.on('connect', () => {
                    this.logger.info('Redis connected', logging_1.LogContext.CACHE);
                    this.isConnected = true;
                });
                this.redis.on('ready', () => {
                    this.logger.info('Redis ready', logging_1.LogContext.CACHE);
                    this.isConnected = true;
                });
                this.redis.on('error', error => {
                    this.logger.error('Redis error', logging_1.LogContext.CACHE, undefined, error);
                    this.isConnected = false;
                });
                this.redis.on('close', () => {
                    this.logger.warn('Redis connection closed', logging_1.LogContext.CACHE);
                    this.isConnected = false;
                });
                this.redis.on('reconnecting', () => {
                    this.logger.info('Redis reconnecting...', logging_1.LogContext.CACHE);
                });
                // 等待连接建立
                await this.redis.ping();
                this.logger.info('Redis connection established successfully', logging_1.LogContext.CACHE);
            }
            catch (error) {
                this.logger.error('Failed to connect to Redis', logging_1.LogContext.CACHE, undefined, error);
                throw error;
            }
        }
        /**
         * @method disconnect
         * @description 断开Redis连接
         */
        async disconnect() {
            if (this.redis) {
                await this.redis.quit();
                this.isConnected = false;
                this.logger.info('Redis connection closed', logging_1.LogContext.CACHE);
            }
        }
        /**
         * @method get
         * @description 获取缓存值
         * @param key 缓存键
         * @returns 缓存值或null
         */
        async get(key) {
            try {
                const keyString = this.keyFactory.toString(key);
                const result = await this.redis.get(keyString);
                if (result === null) {
                    this.stats.misses++;
                    this.updateHitRate();
                    return null;
                }
                this.stats.hits++;
                this.updateHitRate();
                const cacheValue = JSON.parse(result);
                // 检查是否过期
                if (cacheValue.expiresAt && Date.now() > cacheValue.expiresAt) {
                    await this.delete(key);
                    this.stats.expiredEntries++;
                    this.stats.misses++;
                    this.updateHitRate();
                    return null;
                }
                // 更新访问统计
                cacheValue.accessCount++;
                cacheValue.lastAccessed = Date.now();
                await this.redis.set(keyString, JSON.stringify(cacheValue));
                return cacheValue.value;
            }
            catch (error) {
                this.logger.error('Error getting cache value', logging_1.LogContext.CACHE, undefined, error);
                this.stats.misses++;
                this.updateHitRate();
                return null;
            }
        }
        /**
         * @method set
         * @description 设置缓存值
         * @param key 缓存键
         * @param value 缓存值
         * @param options 缓存选项
         * @returns 是否成功
         */
        async set(key, value, options) {
            try {
                const keyString = this.keyFactory.toString(key);
                const now = Date.now();
                const cacheValue = {
                    value,
                    createdAt: now,
                    accessCount: 0,
                    lastAccessed: now,
                    version: key.version,
                    tags: key.tags,
                    metadata: {
                        type: cache_interface_1.CacheType.REDIS,
                        strategy: options?.strategy || cache_interface_1.CacheStrategy.TTL,
                    },
                };
                // 设置过期时间
                if (options?.ttl) {
                    cacheValue.expiresAt = now + options.ttl;
                }
                const serializedValue = JSON.stringify(cacheValue);
                const valueSize = Buffer.byteLength(serializedValue, 'utf8');
                // 使用Redis的EXPIRE命令设置过期时间
                if (options?.ttl) {
                    await this.redis.setex(keyString, Math.ceil(options.ttl / 1000), serializedValue);
                }
                else {
                    await this.redis.set(keyString, serializedValue);
                }
                // 更新统计
                this.stats.totalEntries++;
                this.stats.totalSize += valueSize;
                this.stats.averageSize = this.stats.totalSize / this.stats.totalEntries;
                return true;
            }
            catch (error) {
                this.logger.error('Error setting cache value', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method delete
         * @description 删除缓存值
         * @param key 缓存键
         * @returns 是否成功
         */
        async delete(key) {
            try {
                const keyString = this.keyFactory.toString(key);
                const result = await this.redis.del(keyString);
                if (result > 0) {
                    this.stats.totalEntries--;
                    // 注意：这里无法准确更新totalSize，因为我们需要获取被删除项的大小
                    return true;
                }
                return false;
            }
            catch (error) {
                this.logger.error('Error deleting cache value', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method exists
         * @description 检查缓存键是否存在
         * @param key 缓存键
         * @returns 是否存在
         */
        async exists(key) {
            try {
                const keyString = this.keyFactory.toString(key);
                const result = await this.redis.exists(keyString);
                return result === 1;
            }
            catch (error) {
                this.logger.error('Error checking cache key existence', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method clear
         * @description 清空缓存
         * @param namespace 命名空间（可选）
         * @returns 是否成功
         */
        async clear(namespace) {
            try {
                if (namespace) {
                    // 使用模式匹配删除指定命名空间的所有键
                    const pattern = `${namespace}:*`;
                    const keys = await this.redis.keys(pattern);
                    if (keys.length > 0) {
                        await this.redis.del(...keys);
                        this.stats.totalEntries -= keys.length;
                    }
                }
                else {
                    // 清空整个数据库
                    await this.redis.flushdb();
                    this.stats.totalEntries = 0;
                    this.stats.totalSize = 0;
                    this.stats.averageSize = 0;
                }
                return true;
            }
            catch (error) {
                this.logger.error('Error clearing cache', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method getStats
         * @description 获取缓存统计
         * @returns 缓存统计
         */
        async getStats() {
            try {
                // 获取Redis信息
                const info = await this.redis.info();
                const lines = info.split('\r\n');
                // 解析Redis统计信息
                for (const line of lines) {
                    if (line.startsWith('keyspace:')) {
                        const match = line.match(/keys=(\d+)/);
                        if (match) {
                            this.stats.totalEntries = parseInt(match[1], 10);
                            break;
                        }
                    }
                }
                return { ...this.stats };
            }
            catch (error) {
                this.logger.error('Error getting cache stats', logging_1.LogContext.CACHE, undefined, error);
                return { ...this.stats };
            }
        }
        /**
         * @method getHealth
         * @description 获取缓存健康状态
         * @returns 缓存健康状态
         */
        async getHealth() {
            const startTime = Date.now();
            try {
                await this.redis.ping();
                const responseTime = Date.now() - startTime;
                return {
                    healthy: true,
                    connected: this.isConnected,
                    responseTime,
                    lastCheck: Date.now(),
                };
            }
            catch (error) {
                const responseTime = Date.now() - startTime;
                return {
                    healthy: false,
                    connected: false,
                    responseTime,
                    error: error.message,
                    lastCheck: Date.now(),
                };
            }
        }
        /**
         * @method resetStats
         * @description 重置缓存统计
         */
        async resetStats() {
            this.stats = {
                totalEntries: 0,
                hits: 0,
                misses: 0,
                hitRate: 0,
                totalSize: 0,
                averageSize: 0,
                expiredEntries: 0,
                evictedEntries: 0,
                lastReset: Date.now(),
            };
        }
        /**
         * @private updateHitRate
         * @description 更新命中率
         */
        updateHitRate() {
            const total = this.stats.hits + this.stats.misses;
            this.stats.hitRate = total > 0 ? this.stats.hits / total : 0;
        }
    };
    __setFunctionName(_classThis, "RedisCacheService");
    (() => {
        const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
        __esDecorate(null, _classDescriptor = { value: _classThis }, _classDecorators, { kind: "class", name: _classThis.name, metadata: _metadata }, null, _classExtraInitializers);
        RedisCacheService = _classThis = _classDescriptor.value;
        if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
        __runInitializers(_classThis, _classExtraInitializers);
    })();
    return RedisCacheService = _classThis;
})();
exports.RedisCacheService = RedisCacheService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY2FjaGUvc3JjL3NlcnZpY2VzL3JlZGlzLWNhY2hlLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILDJDQUt3QjtBQUN4QixzREFBeUM7QUFDekMsbUVBU3VDO0FBRXZDLDZDQUFnRTtBQW1DaEU7Ozs7Ozs7OztHQVNHO0lBRVUsaUJBQWlCOzRCQUQ3QixJQUFBLG1CQUFVLEdBQUU7Ozs7O1FBbUJYLFlBQzBCLE1BQW9DLEVBQ2hDLFVBQTZDLEVBQzVDLE1BQTBDO1lBRjlCLFdBQU0sR0FBTixNQUFNLENBQWE7WUFDZixlQUFVLEdBQVYsVUFBVSxDQUFrQjtZQUMzQixXQUFNLEdBQU4sTUFBTSxDQUFtQjtZQWpCakUsVUFBSyxHQUFvQixFQUFxQixDQUFDO1lBQy9DLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1lBQ3BCLFVBQUssR0FBZTtnQkFDMUIsWUFBWSxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsT0FBTyxFQUFFLENBQUM7Z0JBQ1YsU0FBUyxFQUFFLENBQUM7Z0JBQ1osV0FBVyxFQUFFLENBQUM7Z0JBQ2QsY0FBYyxFQUFFLENBQUM7Z0JBQ2pCLGNBQWMsRUFBRSxDQUFDO2dCQUNqQixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTthQUN0QixDQUFDO1FBTUMsQ0FBQztRQUVKOzs7V0FHRztRQUNILEtBQUssQ0FBQyxZQUFZO1lBQ2hCLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3ZCLENBQUM7UUFFRDs7O1dBR0c7UUFDSCxLQUFLLENBQUMsZUFBZTtZQUNuQixNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUMxQixDQUFDO1FBRUQ7OztXQUdHO1FBQ0ssS0FBSyxDQUFD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QUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0QsQ0FBQzs7Ozs7UUEvYUgsNktBZ2JDOzs7UUFoYlksdURBQWlCOzs7O0FBQWpCLDhDQUFpQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9hcmxpZ2xlL1YxL0Fpb2ZpeC9haW9maXgtYWktc2Fhcy1wbGF0Zm9ybS9wYWNrYWdlcy9jYWNoZS9zcmMvc2VydmljZXMvcmVkaXMtY2FjaGUuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIHJlZGlzLWNhY2hlLnNlcnZpY2UudHNcbiAqIEBkZXNjcmlwdGlvbiBSZWRpc+e8k+WtmOacjeWKoVxuICpcbiAqIOivpeaWh+S7tuWunueOsOS6huWfuuS6jlJlZGlz55qE57yT5a2Y5pyN5Yqh77yM5YyF5ous77yaXG4gKiAtIOWfuuehgOeahENSVUTmk43kvZxcbiAqIC0g57yT5a2Y57uf6K6h5ZKM5YGl5bq35qOA5p+lXG4gKiAtIOi/nuaOpeeuoeeQhuWSjOmUmeivr+WkhOeQhlxuICogLSDluo/liJfljJblkozlj43luo/liJfljJZcbiAqXG4gKiDpgbXlvqpERETlkoxDbGVhbiBBcmNoaXRlY3R1cmXljp/liJnvvIzmj5Dkvpvpq5jmgKfog73nmoTliIbluIPlvI/nvJPlrZjjgIJcbiAqL1xuXG5pbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBPbk1vZHVsZURlc3Ryb3ksXG4gIE9uTW9kdWxlSW5pdCxcbiAgSW5qZWN0LFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgUmVkaXMsIHsgQ2x1c3RlciB9IGZyb20gJ2lvcmVkaXMnO1xuaW1wb3J0IHtcbiAgSUNhY2hlU2VydmljZSxcbiAgQ2FjaGVLZXksXG4gIENhY2hlVmFsdWUsXG4gIENhY2hlT3B0aW9ucyxcbiAgQ2FjaGVTdGF0cyxcbiAgQ2FjaGVIZWFsdGgsXG4gIENhY2hlVHlwZSxcbiAgQ2FjaGVTdHJhdGVneSxcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jYWNoZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHR5cGUgeyBJQ2FjaGVLZXlGYWN0b3J5IH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jYWNoZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGlub0xvZ2dlclNlcnZpY2UsIExvZ0NvbnRleHQgfSBmcm9tICdAYWlvZml4L2xvZ2dpbmcnO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgUmVkaXNDb25maWdcbiAqIEBkZXNjcmlwdGlvbiBSZWRpc+mFjee9ruaOpeWPo1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlZGlzQ29uZmlnIHtcbiAgLyoqIFJlZGlz5Li75py65Zyw5Z2AICovXG4gIGhvc3Q6IHN0cmluZztcbiAgLyoqIFJlZGlz56uv5Y+jICovXG4gIHBvcnQ6IG51bWJlcjtcbiAgLyoqIFJlZGlz5a+G56CBICovXG4gIHBhc3N3b3JkPzogc3RyaW5nO1xuICAvKiog5pWw5o2u5bqT57Si5byVICovXG4gIGRiPzogbnVtYmVyO1xuICAvKiog6L+e5o6l6LaF5pe25pe26Ze077yI5q+r56eS77yJICovXG4gIGNvbm5lY3RUaW1lb3V0PzogbnVtYmVyO1xuICAvKiog5ZG95Luk6LaF5pe25pe26Ze077yI5q+r56eS77yJICovXG4gIGNvbW1hbmRUaW1lb3V0PzogbnVtYmVyO1xuICAvKiog6YeN6K+V5qyh5pWwICovXG4gIHJldHJpZXM/OiBudW1iZXI7XG4gIC8qKiDph43or5Xlu7bov5/vvIjmr6vnp5LvvIkgKi9cbiAgcmV0cnlEZWxheT86IG51bWJlcjtcbiAgLyoqIOaYr+WQpuWQr+eUqOmbhue+pOaooeW8jyAqL1xuICBjbHVzdGVyPzogYm9vbGVhbjtcbiAgLyoqIOmbhue+pOiKgueCuSAqL1xuICBub2Rlcz86IEFycmF5PHsgaG9zdDogc3RyaW5nOyBwb3J0OiBudW1iZXIgfT47XG4gIC8qKiDmmK/lkKblkK/nlKjlk6jlhbXmqKHlvI8gKi9cbiAgc2VudGluZWw/OiBib29sZWFuO1xuICAvKiog5ZOo5YW16YWN572uICovXG4gIHNlbnRpbmVscz86IEFycmF5PHsgaG9zdDogc3RyaW5nOyBwb3J0OiBudW1iZXIgfT47XG4gIC8qKiDkuLvoioLngrnlkI3np7AgKi9cbiAgbmFtZT86IHN0cmluZztcbn1cblxuLyoqXG4gKiBAY2xhc3MgUmVkaXNDYWNoZVNlcnZpY2VcbiAqIEBkZXNjcmlwdGlvbiBSZWRpc+e8k+WtmOacjeWKoeWunueOsFxuICpcbiAqIOaPkOS+m+WfuuS6jlJlZGlz55qE5YiG5biD5byP57yT5a2Y5Yqf6IO977yM5YyF5ous77yaXG4gKiAtIOWfuuehgOeahENSVUTmk43kvZxcbiAqIC0g57yT5a2Y57uf6K6h5ZKM5YGl5bq35qOA5p+lXG4gKiAtIOi/nuaOpeeuoeeQhuWSjOmUmeivr+WkhOeQhlxuICogLSDluo/liJfljJblkozlj43luo/liJfljJZcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJlZGlzQ2FjaGVTZXJ2aWNlXG4gIGltcGxlbWVudHMgSUNhY2hlU2VydmljZSwgT25Nb2R1bGVJbml0LCBPbk1vZHVsZURlc3Ryb3lcbntcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IFBpbm9Mb2dnZXJTZXJ2aWNlO1xuICBwcml2YXRlIHJlZGlzOiBSZWRpcyB8IENsdXN0ZXIgPSB7fSBhcyBSZWRpcyB8IENsdXN0ZXI7XG4gIHByaXZhdGUgaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdGF0czogQ2FjaGVTdGF0cyA9IHtcbiAgICB0b3RhbEVudHJpZXM6IDAsXG4gICAgaGl0czogMCxcbiAgICBtaXNzZXM6IDAsXG4gICAgaGl0UmF0ZTogMCxcbiAgICB0b3RhbFNpemU6IDAsXG4gICAgYXZlcmFnZVNpemU6IDAsXG4gICAgZXhwaXJlZEVudHJpZXM6IDAsXG4gICAgZXZpY3RlZEVudHJpZXM6IDAsXG4gICAgbGFzdFJlc2V0OiBEYXRlLm5vdygpLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoJ1JFRElTX0NPTkZJRycpIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnOiBSZWRpc0NvbmZpZyxcbiAgICBASW5qZWN0KCdJQ2FjaGVLZXlGYWN0b3J5JykgcHJpdmF0ZSByZWFkb25seSBrZXlGYWN0b3J5OiBJQ2FjaGVLZXlGYWN0b3J5LFxuICAgIEBJbmplY3QoJ1Bpbm9Mb2dnZXJTZXJ2aWNlJykgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IFBpbm9Mb2dnZXJTZXJ2aWNlLFxuICApIHt9XG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgb25Nb2R1bGVJbml0XG4gICAqIEBkZXNjcmlwdGlvbiDmqKHlnZfliJ3lp4vljJbml7bov57mjqVSZWRpc1xuICAgKi9cbiAgYXN5bmMgb25Nb2R1bGVJbml0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgb25Nb2R1bGVEZXN0cm95XG4gICAqIEBkZXNjcmlwdGlvbiDmqKHlnZfplIDmr4Hml7bmlq3lvIBSZWRpc+i/nuaOpVxuICAgKi9cbiAgYXN5bmMgb25Nb2R1bGVEZXN0cm95KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuZGlzY29ubmVjdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY29ubmVjdFxuICAgKiBAZGVzY3JpcHRpb24g6L+e5o6l5YiwUmVkaXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmNsdXN0ZXIgJiYgdGhpcy5jb25maWcubm9kZXMpIHtcbiAgICAgICAgdGhpcy5yZWRpcyA9IG5ldyBSZWRpcy5DbHVzdGVyKHRoaXMuY29uZmlnLm5vZGVzLCB7XG4gICAgICAgICAgcmVkaXNPcHRpb25zOiB7XG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5jb25maWcucGFzc3dvcmQsXG4gICAgICAgICAgICBkYjogdGhpcy5jb25maWcuZGIgfHwgMCxcbiAgICAgICAgICAgIGNvbm5lY3RUaW1lb3V0OiB0aGlzLmNvbmZpZy5jb25uZWN0VGltZW91dCB8fCAxMDAwMCxcbiAgICAgICAgICAgIGNvbW1hbmRUaW1lb3V0OiB0aGlzLmNvbmZpZy5jb21tYW5kVGltZW91dCB8fCA1MDAwLFxuICAgICAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IHRoaXMuY29uZmlnLnJldHJpZXMgfHwgMyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcuc2VudGluZWwgJiYgdGhpcy5jb25maWcuc2VudGluZWxzKSB7XG4gICAgICAgIHRoaXMucmVkaXMgPSBuZXcgUmVkaXMoe1xuICAgICAgICAgIHNlbnRpbmVsczogdGhpcy5jb25maWcuc2VudGluZWxzLFxuICAgICAgICAgIG5hbWU6IHRoaXMuY29uZmlnLm5hbWUgfHwgJ215bWFzdGVyJyxcbiAgICAgICAgICBwYXNzd29yZDogdGhpcy5jb25maWcucGFzc3dvcmQsXG4gICAgICAgICAgZGI6IHRoaXMuY29uZmlnLmRiIHx8IDAsXG4gICAgICAgICAgY29ubmVjdFRpbWVvdXQ6IHRoaXMuY29uZmlnLmNvbm5lY3RUaW1lb3V0IHx8IDEwMDAwLFxuICAgICAgICAgIGNvbW1hbmRUaW1lb3V0OiB0aGlzLmNvbmZpZy5jb21tYW5kVGltZW91dCB8fCA1MDAwLFxuICAgICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiB0aGlzLmNvbmZpZy5yZXRyaWVzIHx8IDMsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZWRpcyA9IG5ldyBSZWRpcyh7XG4gICAgICAgICAgaG9zdDogdGhpcy5jb25maWcuaG9zdCxcbiAgICAgICAgICBwb3J0OiB0aGlzLmNvbmZpZy5wb3J0LFxuICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLmNvbmZpZy5wYXNzd29yZCxcbiAgICAgICAgICBkYjogdGhpcy5jb25maWcuZGIgfHwgMCxcbiAgICAgICAgICBjb25uZWN0VGltZW91dDogdGhpcy5jb25maWcuY29ubmVjdFRpbWVvdXQgfHwgMTAwMDAsXG4gICAgICAgICAgY29tbWFuZFRpbWVvdXQ6IHRoaXMuY29uZmlnLmNvbW1hbmRUaW1lb3V0IHx8IDUwMDAsXG4gICAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IHRoaXMuY29uZmlnLnJldHJpZXMgfHwgMyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIOebkeWQrOi/nuaOpeS6i+S7tlxuICAgICAgdGhpcy5yZWRpcy5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUmVkaXMgY29ubmVjdGVkJywgTG9nQ29udGV4dC5DQUNIRSk7XG4gICAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucmVkaXMub24oJ3JlYWR5JywgKCkgPT4ge1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdSZWRpcyByZWFkeScsIExvZ0NvbnRleHQuQ0FDSEUpO1xuICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnJlZGlzLm9uKCdlcnJvcicsIGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgJ1JlZGlzIGVycm9yJyxcbiAgICAgICAgICBMb2dDb250ZXh0LkNBQ0hFLFxuICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICBlcnJvciBhcyBFcnJvcixcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucmVkaXMub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdSZWRpcyBjb25uZWN0aW9uIGNsb3NlZCcsIExvZ0NvbnRleHQuQ0FDSEUpO1xuICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5yZWRpcy5vbigncmVjb25uZWN0aW5nJywgKCkgPT4ge1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdSZWRpcyByZWNvbm5lY3RpbmcuLi4nLCBMb2dDb250ZXh0LkNBQ0hFKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyDnrYnlvoXov57mjqXlu7rnq4tcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMucGluZygpO1xuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcbiAgICAgICAgJ1JlZGlzIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgTG9nQ29udGV4dC5DQUNIRSxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAnRmFpbGVkIHRvIGNvbm5lY3QgdG8gUmVkaXMnLFxuICAgICAgICBMb2dDb250ZXh0LkNBQ0hFLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGVycm9yIGFzIEVycm9yLFxuICAgICAgKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGRpc2Nvbm5lY3RcbiAgICogQGRlc2NyaXB0aW9uIOaWreW8gFJlZGlz6L+e5o6lXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGRpc2Nvbm5lY3QoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMucmVkaXMpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMucXVpdCgpO1xuICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnLCBMb2dDb250ZXh0LkNBQ0hFKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRcbiAgICogQGRlc2NyaXB0aW9uIOiOt+WPlue8k+WtmOWAvFxuICAgKiBAcGFyYW0ga2V5IOe8k+WtmOmUrlxuICAgKiBAcmV0dXJucyDnvJPlrZjlgLzmiJZudWxsXG4gICAqL1xuICBhc3luYyBnZXQ8VCA9IGFueT4oa2V5OiBDYWNoZUtleSk6IFByb21pc2U8VCB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qga2V5U3RyaW5nID0gdGhpcy5rZXlGYWN0b3J5LnRvU3RyaW5nKGtleSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnJlZGlzLmdldChrZXlTdHJpbmcpO1xuXG4gICAgICBpZiAocmVzdWx0ID09PSBudWxsKSB7XG4gICAgICAgIHRoaXMuc3RhdHMubWlzc2VzKys7XG4gICAgICAgIHRoaXMudXBkYXRlSGl0UmF0ZSgpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zdGF0cy5oaXRzKys7XG4gICAgICB0aGlzLnVwZGF0ZUhpdFJhdGUoKTtcblxuICAgICAgY29uc3QgY2FjaGVWYWx1ZTogQ2FjaGVWYWx1ZTxUPiA9IEpTT04ucGFyc2UocmVzdWx0KTtcblxuICAgICAgLy8g5qOA5p+l5piv5ZCm6L+H5pyfXG4gICAgICBpZiAoY2FjaGVWYWx1ZS5leHBpcmVzQXQgJiYgRGF0ZS5ub3coKSA+IGNhY2hlVmFsdWUuZXhwaXJlc0F0KSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVsZXRlKGtleSk7XG4gICAgICAgIHRoaXMuc3RhdHMuZXhwaXJlZEVudHJpZXMrKztcbiAgICAgICAgdGhpcy5zdGF0cy5taXNzZXMrKztcbiAgICAgICAgdGhpcy51cGRhdGVIaXRSYXRlKCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyDmm7TmlrDorr/pl67nu5/orqFcbiAgICAgIGNhY2hlVmFsdWUuYWNjZXNzQ291bnQrKztcbiAgICAgIGNhY2hlVmFsdWUubGFzdEFjY2Vzc2VkID0gRGF0ZS5ub3coKTtcbiAgICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0KGtleVN0cmluZywgSlNPTi5zdHJpbmdpZnkoY2FjaGVWYWx1ZSkpO1xuXG4gICAgICByZXR1cm4gY2FjaGVWYWx1ZS52YWx1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICdFcnJvciBnZXR0aW5nIGNhY2hlIHZhbHVlJyxcbiAgICAgICAgTG9nQ29udGV4dC5DQUNIRSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBlcnJvciBhcyBFcnJvcixcbiAgICAgICk7XG4gICAgICB0aGlzLnN0YXRzLm1pc3NlcysrO1xuICAgICAgdGhpcy51cGRhdGVIaXRSYXRlKCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBzZXRcbiAgICogQGRlc2NyaXB0aW9uIOiuvue9rue8k+WtmOWAvFxuICAgKiBAcGFyYW0ga2V5IOe8k+WtmOmUrlxuICAgKiBAcGFyYW0gdmFsdWUg57yT5a2Y5YC8XG4gICAqIEBwYXJhbSBvcHRpb25zIOe8k+WtmOmAiemhuVxuICAgKiBAcmV0dXJucyDmmK/lkKbmiJDlip9cbiAgICovXG4gIGFzeW5jIHNldDxUID0gYW55PihcbiAgICBrZXk6IENhY2hlS2V5LFxuICAgIHZhbHVlOiBULFxuICAgIG9wdGlvbnM/OiBQYXJ0aWFsPENhY2hlT3B0aW9ucz4sXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBrZXlTdHJpbmcgPSB0aGlzLmtleUZhY3RvcnkudG9TdHJpbmcoa2V5KTtcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICAgIGNvbnN0IGNhY2hlVmFsdWU6IENhY2hlVmFsdWU8VD4gPSB7XG4gICAgICAgIHZhbHVlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgICAgYWNjZXNzQ291bnQ6IDAsXG4gICAgICAgIGxhc3RBY2Nlc3NlZDogbm93LFxuICAgICAgICB2ZXJzaW9uOiBrZXkudmVyc2lvbixcbiAgICAgICAgdGFnczoga2V5LnRhZ3MsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgdHlwZTogQ2FjaGVUeXBlLlJFRElTLFxuICAgICAgICAgIHN0cmF0ZWd5OiBvcHRpb25zPy5zdHJhdGVneSB8fCBDYWNoZVN0cmF0ZWd5LlRUTCxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIC8vIOiuvue9rui/h+acn+aXtumXtFxuICAgICAgaWYgKG9wdGlvbnM/LnR0bCkge1xuICAgICAgICBjYWNoZVZhbHVlLmV4cGlyZXNBdCA9IG5vdyArIG9wdGlvbnMudHRsO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzZXJpYWxpemVkVmFsdWUgPSBKU09OLnN0cmluZ2lmeShjYWNoZVZhbHVlKTtcbiAgICAgIGNvbnN0IHZhbHVlU2l6ZSA9IEJ1ZmZlci5ieXRlTGVuZ3RoKHNlcmlhbGl6ZWRWYWx1ZSwgJ3V0ZjgnKTtcblxuICAgICAgLy8g5L2/55SoUmVkaXPnmoRFWFBJUkXlkb3ku6Torr7nva7ov4fmnJ/ml7bpl7RcbiAgICAgIGlmIChvcHRpb25zPy50dGwpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5zZXRleChcbiAgICAgICAgICBrZXlTdHJpbmcsXG4gICAgICAgICAgTWF0aC5jZWlsKG9wdGlvbnMudHRsIC8gMTAwMCksXG4gICAgICAgICAgc2VyaWFsaXplZFZhbHVlLFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5zZXQoa2V5U3RyaW5nLCBzZXJpYWxpemVkVmFsdWUpO1xuICAgICAgfVxuXG4gICAgICAvLyDmm7TmlrDnu5/orqFcbiAgICAgIHRoaXMuc3RhdHMudG90YWxFbnRyaWVzKys7XG4gICAgICB0aGlzLnN0YXRzLnRvdGFsU2l6ZSArPSB2YWx1ZVNpemU7XG4gICAgICB0aGlzLnN0YXRzLmF2ZXJhZ2VTaXplID0gdGhpcy5zdGF0cy50b3RhbFNpemUgLyB0aGlzLnN0YXRzLnRvdGFsRW50cmllcztcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAnRXJyb3Igc2V0dGluZyBjYWNoZSB2YWx1ZScsXG4gICAgICAgIExvZ0NvbnRleHQuQ0FDSEUsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3IgYXMgRXJyb3IsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGRlbGV0ZVxuICAgKiBAZGVzY3JpcHRpb24g5Yig6Zmk57yT5a2Y5YC8XG4gICAqIEBwYXJhbSBrZXkg57yT5a2Y6ZSuXG4gICAqIEByZXR1cm5zIOaYr+WQpuaIkOWKn1xuICAgKi9cbiAgYXN5bmMgZGVsZXRlKGtleTogQ2FjaGVLZXkpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qga2V5U3RyaW5nID0gdGhpcy5rZXlGYWN0b3J5LnRvU3RyaW5nKGtleSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnJlZGlzLmRlbChrZXlTdHJpbmcpO1xuXG4gICAgICBpZiAocmVzdWx0ID4gMCkge1xuICAgICAgICB0aGlzLnN0YXRzLnRvdGFsRW50cmllcy0tO1xuICAgICAgICAvLyDms6jmhI/vvJrov5nph4zml6Dms5Xlh4bnoa7mm7TmlrB0b3RhbFNpemXvvIzlm6DkuLrmiJHku6zpnIDopoHojrflj5booqvliKDpmaTpobnnmoTlpKflsI9cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICdFcnJvciBkZWxldGluZyBjYWNoZSB2YWx1ZScsXG4gICAgICAgIExvZ0NvbnRleHQuQ0FDSEUsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3IgYXMgRXJyb3IsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGV4aXN0c1xuICAgKiBAZGVzY3JpcHRpb24g5qOA5p+l57yT5a2Y6ZSu5piv5ZCm5a2Y5ZyoXG4gICAqIEBwYXJhbSBrZXkg57yT5a2Y6ZSuXG4gICAqIEByZXR1cm5zIOaYr+WQpuWtmOWcqFxuICAgKi9cbiAgYXN5bmMgZXhpc3RzKGtleTogQ2FjaGVLZXkpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qga2V5U3RyaW5nID0gdGhpcy5rZXlGYWN0b3J5LnRvU3RyaW5nKGtleSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnJlZGlzLmV4aXN0cyhrZXlTdHJpbmcpO1xuICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gMTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICdFcnJvciBjaGVja2luZyBjYWNoZSBrZXkgZXhpc3RlbmNlJyxcbiAgICAgICAgTG9nQ29udGV4dC5DQUNIRSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBlcnJvciBhcyBFcnJvcixcbiAgICAgICk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2xlYXJcbiAgICogQGRlc2NyaXB0aW9uIOa4heepuue8k+WtmFxuICAgKiBAcGFyYW0gbmFtZXNwYWNlIOWRveWQjeepuumXtO+8iOWPr+mAie+8iVxuICAgKiBAcmV0dXJucyDmmK/lkKbmiJDlip9cbiAgICovXG4gIGFzeW5jIGNsZWFyKG5hbWVzcGFjZT86IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAobmFtZXNwYWNlKSB7XG4gICAgICAgIC8vIOS9v+eUqOaooeW8j+WMuemFjeWIoOmZpOaMh+WumuWRveWQjeepuumXtOeahOaJgOaciemUrlxuICAgICAgICBjb25zdCBwYXR0ZXJuID0gYCR7bmFtZXNwYWNlfToqYDtcbiAgICAgICAgY29uc3Qga2V5cyA9IGF3YWl0IHRoaXMucmVkaXMua2V5cyhwYXR0ZXJuKTtcblxuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoLi4ua2V5cyk7XG4gICAgICAgICAgdGhpcy5zdGF0cy50b3RhbEVudHJpZXMgLT0ga2V5cy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIOa4heepuuaVtOS4quaVsOaNruW6k1xuICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLmZsdXNoZGIoKTtcbiAgICAgICAgdGhpcy5zdGF0cy50b3RhbEVudHJpZXMgPSAwO1xuICAgICAgICB0aGlzLnN0YXRzLnRvdGFsU2l6ZSA9IDA7XG4gICAgICAgIHRoaXMuc3RhdHMuYXZlcmFnZVNpemUgPSAwO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICdFcnJvciBjbGVhcmluZyBjYWNoZScsXG4gICAgICAgIExvZ0NvbnRleHQuQ0FDSEUsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3IgYXMgRXJyb3IsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdldFN0YXRzXG4gICAqIEBkZXNjcmlwdGlvbiDojrflj5bnvJPlrZjnu5/orqFcbiAgICogQHJldHVybnMg57yT5a2Y57uf6K6hXG4gICAqL1xuICBhc3luYyBnZXRTdGF0cygpOiBQcm9taXNlPENhY2hlU3RhdHM+IHtcbiAgICB0cnkge1xuICAgICAgLy8g6I635Y+WUmVkaXPkv6Hmga9cbiAgICAgIGNvbnN0IGluZm8gPSBhd2FpdCB0aGlzLnJlZGlzLmluZm8oKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gaW5mby5zcGxpdCgnXFxyXFxuJyk7XG5cbiAgICAgIC8vIOino+aekFJlZGlz57uf6K6h5L+h5oGvXG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aCgna2V5c3BhY2U6JykpIHtcbiAgICAgICAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goL2tleXM9KFxcZCspLyk7XG4gICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRzLnRvdGFsRW50cmllcyA9IHBhcnNlSW50KG1hdGNoWzFdLCAxMCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgLi4udGhpcy5zdGF0cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgJ0Vycm9yIGdldHRpbmcgY2FjaGUgc3RhdHMnLFxuICAgICAgICBMb2dDb250ZXh0LkNBQ0hFLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGVycm9yIGFzIEVycm9yLFxuICAgICAgKTtcbiAgICAgIHJldHVybiB7IC4uLnRoaXMuc3RhdHMgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRIZWFsdGhcbiAgICogQGRlc2NyaXB0aW9uIOiOt+WPlue8k+WtmOWBpeW6t+eKtuaAgVxuICAgKiBAcmV0dXJucyDnvJPlrZjlgaXlurfnirbmgIFcbiAgICovXG4gIGFzeW5jIGdldEhlYWx0aCgpOiBQcm9taXNlPENhY2hlSGVhbHRoPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLnBpbmcoKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGhlYWx0aHk6IHRydWUsXG4gICAgICAgIGNvbm5lY3RlZDogdGhpcy5pc0Nvbm5lY3RlZCxcbiAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICBsYXN0Q2hlY2s6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBoZWFsdGh5OiBmYWxzZSxcbiAgICAgICAgY29ubmVjdGVkOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICBlcnJvcjogKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlLFxuICAgICAgICBsYXN0Q2hlY2s6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHJlc2V0U3RhdHNcbiAgICogQGRlc2NyaXB0aW9uIOmHjee9rue8k+WtmOe7n+iuoVxuICAgKi9cbiAgYXN5bmMgcmVzZXRTdGF0cygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnN0YXRzID0ge1xuICAgICAgdG90YWxFbnRyaWVzOiAwLFxuICAgICAgaGl0czogMCxcbiAgICAgIG1pc3NlczogMCxcbiAgICAgIGhpdFJhdGU6IDAsXG4gICAgICB0b3RhbFNpemU6IDAsXG4gICAgICBhdmVyYWdlU2l6ZTogMCxcbiAgICAgIGV4cGlyZWRFbnRyaWVzOiAwLFxuICAgICAgZXZpY3RlZEVudHJpZXM6IDAsXG4gICAgICBsYXN0UmVzZXQ6IERhdGUubm93KCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZSB1cGRhdGVIaXRSYXRlXG4gICAqIEBkZXNjcmlwdGlvbiDmm7TmlrDlkb3kuK3njodcbiAgICovXG4gIHByaXZhdGUgdXBkYXRlSGl0UmF0ZSgpOiB2b2lkIHtcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMuc3RhdHMuaGl0cyArIHRoaXMuc3RhdHMubWlzc2VzO1xuICAgIHRoaXMuc3RhdHMuaGl0UmF0ZSA9IHRvdGFsID4gMCA/IHRoaXMuc3RhdHMuaGl0cyAvIHRvdGFsIDogMDtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9