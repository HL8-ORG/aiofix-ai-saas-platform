5168527352958a43ce266e780f1dfc2a
"use strict";
/**
 * @file redis-cache.service.ts
 * @description Redis缓存服务
 *
 * 该文件实现了基于Redis的缓存服务，包括：
 * - 基础的CRUD操作
 * - 缓存统计和健康检查
 * - 连接管理和错误处理
 * - 序列化和反序列化
 *
 * 遵循DDD和Clean Architecture原则，提供高性能的分布式缓存。
 */
var __esDecorate = (this && this.__esDecorate) || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {
    function accept(f) { if (f !== void 0 && typeof f !== "function") throw new TypeError("Function expected"); return f; }
    var kind = contextIn.kind, key = kind === "getter" ? "get" : kind === "setter" ? "set" : "value";
    var target = !descriptorIn && ctor ? contextIn["static"] ? ctor : ctor.prototype : null;
    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});
    var _, done = false;
    for (var i = decorators.length - 1; i >= 0; i--) {
        var context = {};
        for (var p in contextIn) context[p] = p === "access" ? {} : contextIn[p];
        for (var p in contextIn.access) context.access[p] = contextIn.access[p];
        context.addInitializer = function (f) { if (done) throw new TypeError("Cannot add initializers after decoration has completed"); extraInitializers.push(accept(f || null)); };
        var result = (0, decorators[i])(kind === "accessor" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);
        if (kind === "accessor") {
            if (result === void 0) continue;
            if (result === null || typeof result !== "object") throw new TypeError("Object expected");
            if (_ = accept(result.get)) descriptor.get = _;
            if (_ = accept(result.set)) descriptor.set = _;
            if (_ = accept(result.init)) initializers.unshift(_);
        }
        else if (_ = accept(result)) {
            if (kind === "field") initializers.unshift(_);
            else descriptor[key] = _;
        }
    }
    if (target) Object.defineProperty(target, contextIn.name, descriptor);
    done = true;
};
var __runInitializers = (this && this.__runInitializers) || function (thisArg, initializers, value) {
    var useValue = arguments.length > 2;
    for (var i = 0; i < initializers.length; i++) {
        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);
    }
    return useValue ? value : void 0;
};
var __setFunctionName = (this && this.__setFunctionName) || function (f, name, prefix) {
    if (typeof name === "symbol") name = name.description ? "[".concat(name.description, "]") : "";
    return Object.defineProperty(f, "name", { configurable: true, value: prefix ? "".concat(prefix, " ", name) : name });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.RedisCacheService = void 0;
const common_1 = require("@nestjs/common");
const ioredis_1 = __importDefault(require("ioredis"));
const cache_interface_1 = require("../interfaces/cache.interface");
const logging_1 = require("@aiofix/logging");
/**
 * @class RedisCacheService
 * @description Redis缓存服务实现
 *
 * 提供基于Redis的分布式缓存功能，包括：
 * - 基础的CRUD操作
 * - 缓存统计和健康检查
 * - 连接管理和错误处理
 * - 序列化和反序列化
 */
let RedisCacheService = (() => {
    let _classDecorators = [(0, common_1.Injectable)()];
    let _classDescriptor;
    let _classExtraInitializers = [];
    let _classThis;
    var RedisCacheService = _classThis = class {
        constructor(config, keyFactory, logger) {
            this.config = config;
            this.keyFactory = keyFactory;
            this.logger = logger;
            this.redis = {};
            this.isConnected = false;
            this.stats = {
                totalEntries: 0,
                hits: 0,
                misses: 0,
                hitRate: 0,
                totalSize: 0,
                averageSize: 0,
                expiredEntries: 0,
                evictedEntries: 0,
                lastReset: Date.now(),
            };
        }
        /**
         * @method onModuleInit
         * @description 模块初始化时连接Redis
         */
        async onModuleInit() {
            await this.connect();
        }
        /**
         * @method onModuleDestroy
         * @description 模块销毁时断开Redis连接
         */
        async onModuleDestroy() {
            await this.disconnect();
        }
        /**
         * @method connect
         * @description 连接到Redis
         */
        async connect() {
            try {
                if (this.config.cluster && this.config.nodes) {
                    this.redis = new ioredis_1.default.Cluster(this.config.nodes, {
                        redisOptions: {
                            password: this.config.password,
                            db: this.config.db || 0,
                            connectTimeout: this.config.connectTimeout || 10000,
                            commandTimeout: this.config.commandTimeout || 5000,
                            maxRetriesPerRequest: this.config.retries || 3,
                        },
                    });
                }
                else if (this.config.sentinel && this.config.sentinels) {
                    this.redis = new ioredis_1.default({
                        sentinels: this.config.sentinels,
                        name: this.config.name || 'mymaster',
                        password: this.config.password,
                        db: this.config.db || 0,
                        connectTimeout: this.config.connectTimeout || 10000,
                        commandTimeout: this.config.commandTimeout || 5000,
                        maxRetriesPerRequest: this.config.retries || 3,
                    });
                }
                else {
                    this.redis = new ioredis_1.default({
                        host: this.config.host,
                        port: this.config.port,
                        password: this.config.password,
                        db: this.config.db || 0,
                        connectTimeout: this.config.connectTimeout || 10000,
                        commandTimeout: this.config.commandTimeout || 5000,
                        maxRetriesPerRequest: this.config.retries || 3,
                    });
                }
                // 监听连接事件
                this.redis.on('connect', () => {
                    this.logger.info('Redis connected', logging_1.LogContext.CACHE);
                    this.isConnected = true;
                });
                this.redis.on('ready', () => {
                    this.logger.info('Redis ready', logging_1.LogContext.CACHE);
                    this.isConnected = true;
                });
                this.redis.on('error', error => {
                    this.logger.error('Redis error', logging_1.LogContext.CACHE, undefined, error);
                    this.isConnected = false;
                });
                this.redis.on('close', () => {
                    this.logger.warn('Redis connection closed', logging_1.LogContext.CACHE);
                    this.isConnected = false;
                });
                this.redis.on('reconnecting', () => {
                    this.logger.info('Redis reconnecting...', logging_1.LogContext.CACHE);
                });
                // 等待连接建立
                await this.redis.ping();
                this.logger.info('Redis connection established successfully', logging_1.LogContext.CACHE);
            }
            catch (error) {
                this.logger.error('Failed to connect to Redis', logging_1.LogContext.CACHE, undefined, error);
                throw error;
            }
        }
        /**
         * @method disconnect
         * @description 断开Redis连接
         */
        async disconnect() {
            if (this.redis) {
                await this.redis.quit();
                this.isConnected = false;
                this.logger.info('Redis connection closed', logging_1.LogContext.CACHE);
            }
        }
        /**
         * @method get
         * @description 获取缓存值
         * @param key 缓存键
         * @returns 缓存值或null
         */
        async get(key) {
            try {
                const keyString = this.keyFactory.toString(key);
                const result = await this.redis.get(keyString);
                if (result === null) {
                    this.stats.misses++;
                    this.updateHitRate();
                    return null;
                }
                this.stats.hits++;
                this.updateHitRate();
                const cacheValue = JSON.parse(result);
                // 检查是否过期
                if (cacheValue.expiresAt && Date.now() > cacheValue.expiresAt) {
                    await this.delete(key);
                    this.stats.expiredEntries++;
                    this.stats.misses++;
                    this.updateHitRate();
                    return null;
                }
                // 更新访问统计
                cacheValue.accessCount++;
                cacheValue.lastAccessed = Date.now();
                await this.redis.set(keyString, JSON.stringify(cacheValue));
                return cacheValue.value;
            }
            catch (error) {
                this.logger.error('Error getting cache value', logging_1.LogContext.CACHE, undefined, error);
                this.stats.misses++;
                this.updateHitRate();
                return null;
            }
        }
        /**
         * @method set
         * @description 设置缓存值
         * @param key 缓存键
         * @param value 缓存值
         * @param options 缓存选项
         * @returns 是否成功
         */
        async set(key, value, options) {
            try {
                const keyString = this.keyFactory.toString(key);
                const now = Date.now();
                const cacheValue = {
                    value,
                    createdAt: now,
                    accessCount: 0,
                    lastAccessed: now,
                    version: key.version,
                    tags: key.tags,
                    metadata: {
                        type: cache_interface_1.CacheType.REDIS,
                        strategy: options?.strategy || cache_interface_1.CacheStrategy.TTL,
                    },
                };
                // 设置过期时间
                if (options?.ttl) {
                    cacheValue.expiresAt = now + options.ttl;
                }
                const serializedValue = JSON.stringify(cacheValue);
                const valueSize = Buffer.byteLength(serializedValue, 'utf8');
                // 使用Redis的EXPIRE命令设置过期时间
                if (options?.ttl) {
                    await this.redis.setex(keyString, Math.ceil(options.ttl / 1000), serializedValue);
                }
                else {
                    await this.redis.set(keyString, serializedValue);
                }
                // 更新统计
                this.stats.totalEntries++;
                this.stats.totalSize += valueSize;
                this.stats.averageSize = this.stats.totalSize / this.stats.totalEntries;
                return true;
            }
            catch (error) {
                this.logger.error('Error setting cache value', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method delete
         * @description 删除缓存值
         * @param key 缓存键
         * @returns 是否成功
         */
        async delete(key) {
            try {
                const keyString = this.keyFactory.toString(key);
                const result = await this.redis.del(keyString);
                if (result > 0) {
                    this.stats.totalEntries--;
                    // 注意：这里无法准确更新totalSize，因为我们需要获取被删除项的大小
                    return true;
                }
                return false;
            }
            catch (error) {
                this.logger.error('Error deleting cache value', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method exists
         * @description 检查缓存键是否存在
         * @param key 缓存键
         * @returns 是否存在
         */
        async exists(key) {
            try {
                const keyString = this.keyFactory.toString(key);
                const result = await this.redis.exists(keyString);
                return result === 1;
            }
            catch (error) {
                this.logger.error('Error checking cache key existence', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method clear
         * @description 清空缓存
         * @param namespace 命名空间（可选）
         * @returns 是否成功
         */
        async clear(namespace) {
            try {
                if (namespace) {
                    // 使用模式匹配删除指定命名空间的所有键
                    const pattern = `${namespace}:*`;
                    const keys = await this.redis.keys(pattern);
                    if (keys.length > 0) {
                        await this.redis.del(...keys);
                        this.stats.totalEntries -= keys.length;
                    }
                }
                else {
                    // 清空整个数据库
                    await this.redis.flushdb();
                    this.stats.totalEntries = 0;
                    this.stats.totalSize = 0;
                    this.stats.averageSize = 0;
                }
                return true;
            }
            catch (error) {
                this.logger.error('Error clearing cache', logging_1.LogContext.CACHE, undefined, error);
                return false;
            }
        }
        /**
         * @method getStats
         * @description 获取缓存统计
         * @returns 缓存统计
         */
        async getStats() {
            try {
                // 获取Redis信息
                const info = await this.redis.info();
                const lines = info.split('\r\n');
                // 解析Redis统计信息
                for (const line of lines) {
                    if (line.startsWith('keyspace:')) {
                        const match = line.match(/keys=(\d+)/);
                        if (match) {
                            this.stats.totalEntries = parseInt(match[1], 10);
                            break;
                        }
                    }
                }
                return { ...this.stats };
            }
            catch (error) {
                this.logger.error('Error getting cache stats', logging_1.LogContext.CACHE, undefined, error);
                return { ...this.stats };
            }
        }
        /**
         * @method getHealth
         * @description 获取缓存健康状态
         * @returns 缓存健康状态
         */
        async getHealth() {
            const startTime = Date.now();
            try {
                await this.redis.ping();
                const responseTime = Date.now() - startTime;
                return {
                    healthy: true,
                    connected: this.isConnected,
                    responseTime,
                    lastCheck: Date.now(),
                };
            }
            catch (error) {
                const responseTime = Date.now() - startTime;
                return {
                    healthy: false,
                    connected: false,
                    responseTime,
                    error: error.message,
                    lastCheck: Date.now(),
                };
            }
        }
        /**
         * @method resetStats
         * @description 重置缓存统计
         */
        async resetStats() {
            this.stats = {
                totalEntries: 0,
                hits: 0,
                misses: 0,
                hitRate: 0,
                totalSize: 0,
                averageSize: 0,
                expiredEntries: 0,
                evictedEntries: 0,
                lastReset: Date.now(),
            };
        }
        /**
         * @private updateHitRate
         * @description 更新命中率
         */
        updateHitRate() {
            const total = this.stats.hits + this.stats.misses;
            this.stats.hitRate = total > 0 ? this.stats.hits / total : 0;
        }
    };
    __setFunctionName(_classThis, "RedisCacheService");
    (() => {
        const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
        __esDecorate(null, _classDescriptor = { value: _classThis }, _classDecorators, { kind: "class", name: _classThis.name, metadata: _metadata }, null, _classExtraInitializers);
        RedisCacheService = _classThis = _classDescriptor.value;
        if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
        __runInitializers(_classThis, _classExtraInitializers);
    })();
    return RedisCacheService = _classThis;
})();
exports.RedisCacheService = RedisCacheService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY2FjaGUvc3JjL3NlcnZpY2VzL3JlZGlzLWNhY2hlLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILDJDQUt3QjtBQUN4QixzREFBeUM7QUFDekMsbUVBU3VDO0FBRXZDLDZDQUFnRTtBQW1DaEU7Ozs7Ozs7OztHQVNHO0lBRVUsaUJBQWlCOzRCQUQ3QixJQUFBLG1CQUFVLEdBQUU7Ozs7O1FBbUJYLFlBQzBCLE1BQW9DLEVBQ2hDLFVBQTZDLEVBQzlDLE1BQTBDO1lBRjVCLFdBQU0sR0FBTixNQUFNLENBQWE7WUFDZixlQUFVLEdBQVYsVUFBVSxDQUFrQjtZQUM3QixXQUFNLEdBQU4sTUFBTSxDQUFtQjtZQWpCL0QsVUFBSyxHQUFvQixFQUFxQixDQUFDO1lBQy9DLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1lBQ3BCLFVBQUssR0FBZTtnQkFDMUIsWUFBWSxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsT0FBTyxFQUFFLENBQUM7Z0JBQ1YsU0FBUyxFQUFFLENBQUM7Z0JBQ1osV0FBVyxFQUFFLENBQUM7Z0JBQ2QsY0FBYyxFQUFFLENBQUM7Z0JBQ2pCLGNBQWMsRUFBRSxDQUFDO2dCQUNqQixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTthQUN0QixDQUFDO1FBTUMsQ0FBQztRQUVKOzs7V0FHRztRQUNILEtBQUssQ0FBQyxZQUFZO1lBQ2hCLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3ZCLENBQUM7UUFFRDs7O1dBR0c7UUFDSCxLQUFLLENBQUMsZUFBZTtZQUNuQixNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUMxQixDQUFDO1FBRUQ7OztXQUdHO1FBQ0ssS0FBSyxDQUFD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QUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0QsQ0FBQzs7Ozs7UUEvYUgsNktBZ2JDOzs7UUFoYlksdURBQWlCOzs7O0FBQWpCLDhDQUFpQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9hcmxpZ2xlL1YxL0Fpb2ZpeC9haW9maXgtYWktc2Fhcy1wbGF0Zm9ybS9wYWNrYWdlcy9jYWNoZS9zcmMvc2VydmljZXMvcmVkaXMtY2FjaGUuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIHJlZGlzLWNhY2hlLnNlcnZpY2UudHNcbiAqIEBkZXNjcmlwdGlvbiBSZWRpc+e8k+WtmOacjeWKoVxuICpcbiAqIOivpeaWh+S7tuWunueOsOS6huWfuuS6jlJlZGlz55qE57yT5a2Y5pyN5Yqh77yM5YyF5ous77yaXG4gKiAtIOWfuuehgOeahENSVUTmk43kvZxcbiAqIC0g57yT5a2Y57uf6K6h5ZKM5YGl5bq35qOA5p+lXG4gKiAtIOi/nuaOpeeuoeeQhuWSjOmUmeivr+WkhOeQhlxuICogLSDluo/liJfljJblkozlj43luo/liJfljJZcbiAqXG4gKiDpgbXlvqpERETlkoxDbGVhbiBBcmNoaXRlY3R1cmXljp/liJnvvIzmj5Dkvpvpq5jmgKfog73nmoTliIbluIPlvI/nvJPlrZjjgIJcbiAqL1xuXG5pbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBPbk1vZHVsZURlc3Ryb3ksXG4gIE9uTW9kdWxlSW5pdCxcbiAgSW5qZWN0LFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgUmVkaXMsIHsgQ2x1c3RlciB9IGZyb20gJ2lvcmVkaXMnO1xuaW1wb3J0IHtcbiAgSUNhY2hlU2VydmljZSxcbiAgQ2FjaGVLZXksXG4gIENhY2hlVmFsdWUsXG4gIENhY2hlT3B0aW9ucyxcbiAgQ2FjaGVTdGF0cyxcbiAgQ2FjaGVIZWFsdGgsXG4gIENhY2hlVHlwZSxcbiAgQ2FjaGVTdHJhdGVneSxcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jYWNoZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHR5cGUgeyBJQ2FjaGVLZXlGYWN0b3J5IH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jYWNoZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGlub0xvZ2dlclNlcnZpY2UsIExvZ0NvbnRleHQgfSBmcm9tICdAYWlvZml4L2xvZ2dpbmcnO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgUmVkaXNDb25maWdcbiAqIEBkZXNjcmlwdGlvbiBSZWRpc+mFjee9ruaOpeWPo1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlZGlzQ29uZmlnIHtcbiAgLyoqIFJlZGlz5Li75py65Zyw5Z2AICovXG4gIGhvc3Q6IHN0cmluZztcbiAgLyoqIFJlZGlz56uv5Y+jICovXG4gIHBvcnQ6IG51bWJlcjtcbiAgLyoqIFJlZGlz5a+G56CBICovXG4gIHBhc3N3b3JkPzogc3RyaW5nO1xuICAvKiog5pWw5o2u5bqT57Si5byVICovXG4gIGRiPzogbnVtYmVyO1xuICAvKiog6L+e5o6l6LaF5pe25pe26Ze077yI5q+r56eS77yJICovXG4gIGNvbm5lY3RUaW1lb3V0PzogbnVtYmVyO1xuICAvKiog5ZG95Luk6LaF5pe25pe26Ze077yI5q+r56eS77yJICovXG4gIGNvbW1hbmRUaW1lb3V0PzogbnVtYmVyO1xuICAvKiog6YeN6K+V5qyh5pWwICovXG4gIHJldHJpZXM/OiBudW1iZXI7XG4gIC8qKiDph43or5Xlu7bov5/vvIjmr6vnp5LvvIkgKi9cbiAgcmV0cnlEZWxheT86IG51bWJlcjtcbiAgLyoqIOaYr+WQpuWQr+eUqOmbhue+pOaooeW8jyAqL1xuICBjbHVzdGVyPzogYm9vbGVhbjtcbiAgLyoqIOmbhue+pOiKgueCuSAqL1xuICBub2Rlcz86IEFycmF5PHsgaG9zdDogc3RyaW5nOyBwb3J0OiBudW1iZXIgfT47XG4gIC8qKiDmmK/lkKblkK/nlKjlk6jlhbXmqKHlvI8gKi9cbiAgc2VudGluZWw/OiBib29sZWFuO1xuICAvKiog5ZOo5YW16YWN572uICovXG4gIHNlbnRpbmVscz86IEFycmF5PHsgaG9zdDogc3RyaW5nOyBwb3J0OiBudW1iZXIgfT47XG4gIC8qKiDkuLvoioLngrnlkI3np7AgKi9cbiAgbmFtZT86IHN0cmluZztcbn1cblxuLyoqXG4gKiBAY2xhc3MgUmVkaXNDYWNoZVNlcnZpY2VcbiAqIEBkZXNjcmlwdGlvbiBSZWRpc+e8k+WtmOacjeWKoeWunueOsFxuICpcbiAqIOaPkOS+m+WfuuS6jlJlZGlz55qE5YiG5biD5byP57yT5a2Y5Yqf6IO977yM5YyF5ous77yaXG4gKiAtIOWfuuehgOeahENSVUTmk43kvZxcbiAqIC0g57yT5a2Y57uf6K6h5ZKM5YGl5bq35qOA5p+lXG4gKiAtIOi/nuaOpeeuoeeQhuWSjOmUmeivr+WkhOeQhlxuICogLSDluo/liJfljJblkozlj43luo/liJfljJZcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJlZGlzQ2FjaGVTZXJ2aWNlXG4gIGltcGxlbWVudHMgSUNhY2hlU2VydmljZSwgT25Nb2R1bGVJbml0LCBPbk1vZHVsZURlc3Ryb3lcbntcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IFBpbm9Mb2dnZXJTZXJ2aWNlO1xuICBwcml2YXRlIHJlZGlzOiBSZWRpcyB8IENsdXN0ZXIgPSB7fSBhcyBSZWRpcyB8IENsdXN0ZXI7XG4gIHByaXZhdGUgaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBzdGF0czogQ2FjaGVTdGF0cyA9IHtcbiAgICB0b3RhbEVudHJpZXM6IDAsXG4gICAgaGl0czogMCxcbiAgICBtaXNzZXM6IDAsXG4gICAgaGl0UmF0ZTogMCxcbiAgICB0b3RhbFNpemU6IDAsXG4gICAgYXZlcmFnZVNpemU6IDAsXG4gICAgZXhwaXJlZEVudHJpZXM6IDAsXG4gICAgZXZpY3RlZEVudHJpZXM6IDAsXG4gICAgbGFzdFJlc2V0OiBEYXRlLm5vdygpLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoJ1JFRElTX0NPTkZJRycpIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnOiBSZWRpc0NvbmZpZyxcbiAgICBASW5qZWN0KCdJQ2FjaGVLZXlGYWN0b3J5JykgcHJpdmF0ZSByZWFkb25seSBrZXlGYWN0b3J5OiBJQ2FjaGVLZXlGYWN0b3J5LFxuICAgIEBJbmplY3QoUGlub0xvZ2dlclNlcnZpY2UpIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyOiBQaW5vTG9nZ2VyU2VydmljZSxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIG9uTW9kdWxlSW5pdFxuICAgKiBAZGVzY3JpcHRpb24g5qih5Z2X5Yid5aeL5YyW5pe26L+e5o6lUmVkaXNcbiAgICovXG4gIGFzeW5jIG9uTW9kdWxlSW5pdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIG9uTW9kdWxlRGVzdHJveVxuICAgKiBAZGVzY3JpcHRpb24g5qih5Z2X6ZSA5q+B5pe25pat5byAUmVkaXPov57mjqVcbiAgICovXG4gIGFzeW5jIG9uTW9kdWxlRGVzdHJveSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmRpc2Nvbm5lY3QoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNvbm5lY3RcbiAgICogQGRlc2NyaXB0aW9uIOi/nuaOpeWIsFJlZGlzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvbm5lY3QoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5jbHVzdGVyICYmIHRoaXMuY29uZmlnLm5vZGVzKSB7XG4gICAgICAgIHRoaXMucmVkaXMgPSBuZXcgUmVkaXMuQ2x1c3Rlcih0aGlzLmNvbmZpZy5ub2Rlcywge1xuICAgICAgICAgIHJlZGlzT3B0aW9uczoge1xuICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuY29uZmlnLnBhc3N3b3JkLFxuICAgICAgICAgICAgZGI6IHRoaXMuY29uZmlnLmRiIHx8IDAsXG4gICAgICAgICAgICBjb25uZWN0VGltZW91dDogdGhpcy5jb25maWcuY29ubmVjdFRpbWVvdXQgfHwgMTAwMDAsXG4gICAgICAgICAgICBjb21tYW5kVGltZW91dDogdGhpcy5jb25maWcuY29tbWFuZFRpbWVvdXQgfHwgNTAwMCxcbiAgICAgICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiB0aGlzLmNvbmZpZy5yZXRyaWVzIHx8IDMsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnNlbnRpbmVsICYmIHRoaXMuY29uZmlnLnNlbnRpbmVscykge1xuICAgICAgICB0aGlzLnJlZGlzID0gbmV3IFJlZGlzKHtcbiAgICAgICAgICBzZW50aW5lbHM6IHRoaXMuY29uZmlnLnNlbnRpbmVscyxcbiAgICAgICAgICBuYW1lOiB0aGlzLmNvbmZpZy5uYW1lIHx8ICdteW1hc3RlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuY29uZmlnLnBhc3N3b3JkLFxuICAgICAgICAgIGRiOiB0aGlzLmNvbmZpZy5kYiB8fCAwLFxuICAgICAgICAgIGNvbm5lY3RUaW1lb3V0OiB0aGlzLmNvbmZpZy5jb25uZWN0VGltZW91dCB8fCAxMDAwMCxcbiAgICAgICAgICBjb21tYW5kVGltZW91dDogdGhpcy5jb25maWcuY29tbWFuZFRpbWVvdXQgfHwgNTAwMCxcbiAgICAgICAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogdGhpcy5jb25maWcucmV0cmllcyB8fCAzLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVkaXMgPSBuZXcgUmVkaXMoe1xuICAgICAgICAgIGhvc3Q6IHRoaXMuY29uZmlnLmhvc3QsXG4gICAgICAgICAgcG9ydDogdGhpcy5jb25maWcucG9ydCxcbiAgICAgICAgICBwYXNzd29yZDogdGhpcy5jb25maWcucGFzc3dvcmQsXG4gICAgICAgICAgZGI6IHRoaXMuY29uZmlnLmRiIHx8IDAsXG4gICAgICAgICAgY29ubmVjdFRpbWVvdXQ6IHRoaXMuY29uZmlnLmNvbm5lY3RUaW1lb3V0IHx8IDEwMDAwLFxuICAgICAgICAgIGNvbW1hbmRUaW1lb3V0OiB0aGlzLmNvbmZpZy5jb21tYW5kVGltZW91dCB8fCA1MDAwLFxuICAgICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiB0aGlzLmNvbmZpZy5yZXRyaWVzIHx8IDMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyDnm5HlkKzov57mjqXkuovku7ZcbiAgICAgIHRoaXMucmVkaXMub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1JlZGlzIGNvbm5lY3RlZCcsIExvZ0NvbnRleHQuQ0FDSEUpO1xuICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnJlZGlzLm9uKCdyZWFkeScsICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUmVkaXMgcmVhZHknLCBMb2dDb250ZXh0LkNBQ0hFKTtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IHRydWU7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5yZWRpcy5vbignZXJyb3InLCBlcnJvciA9PiB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAgICdSZWRpcyBlcnJvcicsXG4gICAgICAgICAgTG9nQ29udGV4dC5DQUNIRSxcbiAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgZXJyb3IgYXMgRXJyb3IsXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnJlZGlzLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybignUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnLCBMb2dDb250ZXh0LkNBQ0hFKTtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucmVkaXMub24oJ3JlY29ubmVjdGluZycsICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUmVkaXMgcmVjb25uZWN0aW5nLi4uJywgTG9nQ29udGV4dC5DQUNIRSk7XG4gICAgICB9KTtcblxuICAgICAgLy8g562J5b6F6L+e5o6l5bu656uLXG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLnBpbmcoKTtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oXG4gICAgICAgICdSZWRpcyBjb25uZWN0aW9uIGVzdGFibGlzaGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIExvZ0NvbnRleHQuQ0FDSEUsXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgJ0ZhaWxlZCB0byBjb25uZWN0IHRvIFJlZGlzJyxcbiAgICAgICAgTG9nQ29udGV4dC5DQUNIRSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBlcnJvciBhcyBFcnJvcixcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBkaXNjb25uZWN0XG4gICAqIEBkZXNjcmlwdGlvbiDmlq3lvIBSZWRpc+i/nuaOpVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBkaXNjb25uZWN0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLnJlZGlzKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLnF1aXQoKTtcbiAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1JlZGlzIGNvbm5lY3Rpb24gY2xvc2VkJywgTG9nQ29udGV4dC5DQUNIRSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0XG4gICAqIEBkZXNjcmlwdGlvbiDojrflj5bnvJPlrZjlgLxcbiAgICogQHBhcmFtIGtleSDnvJPlrZjplK5cbiAgICogQHJldHVybnMg57yT5a2Y5YC85oiWbnVsbFxuICAgKi9cbiAgYXN5bmMgZ2V0PFQgPSBhbnk+KGtleTogQ2FjaGVLZXkpOiBQcm9taXNlPFQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGtleVN0cmluZyA9IHRoaXMua2V5RmFjdG9yeS50b1N0cmluZyhrZXkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZWRpcy5nZXQoa2V5U3RyaW5nKTtcblxuICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLnN0YXRzLm1pc3NlcysrO1xuICAgICAgICB0aGlzLnVwZGF0ZUhpdFJhdGUoKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc3RhdHMuaGl0cysrO1xuICAgICAgdGhpcy51cGRhdGVIaXRSYXRlKCk7XG5cbiAgICAgIGNvbnN0IGNhY2hlVmFsdWU6IENhY2hlVmFsdWU8VD4gPSBKU09OLnBhcnNlKHJlc3VsdCk7XG5cbiAgICAgIC8vIOajgOafpeaYr+WQpui/h+acn1xuICAgICAgaWYgKGNhY2hlVmFsdWUuZXhwaXJlc0F0ICYmIERhdGUubm93KCkgPiBjYWNoZVZhbHVlLmV4cGlyZXNBdCkge1xuICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZShrZXkpO1xuICAgICAgICB0aGlzLnN0YXRzLmV4cGlyZWRFbnRyaWVzKys7XG4gICAgICAgIHRoaXMuc3RhdHMubWlzc2VzKys7XG4gICAgICAgIHRoaXMudXBkYXRlSGl0UmF0ZSgpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8g5pu05paw6K6/6Zeu57uf6K6hXG4gICAgICBjYWNoZVZhbHVlLmFjY2Vzc0NvdW50Kys7XG4gICAgICBjYWNoZVZhbHVlLmxhc3RBY2Nlc3NlZCA9IERhdGUubm93KCk7XG4gICAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChrZXlTdHJpbmcsIEpTT04uc3RyaW5naWZ5KGNhY2hlVmFsdWUpKTtcblxuICAgICAgcmV0dXJuIGNhY2hlVmFsdWUudmFsdWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAnRXJyb3IgZ2V0dGluZyBjYWNoZSB2YWx1ZScsXG4gICAgICAgIExvZ0NvbnRleHQuQ0FDSEUsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3IgYXMgRXJyb3IsXG4gICAgICApO1xuICAgICAgdGhpcy5zdGF0cy5taXNzZXMrKztcbiAgICAgIHRoaXMudXBkYXRlSGl0UmF0ZSgpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgc2V0XG4gICAqIEBkZXNjcmlwdGlvbiDorr7nva7nvJPlrZjlgLxcbiAgICogQHBhcmFtIGtleSDnvJPlrZjplK5cbiAgICogQHBhcmFtIHZhbHVlIOe8k+WtmOWAvFxuICAgKiBAcGFyYW0gb3B0aW9ucyDnvJPlrZjpgInpoblcbiAgICogQHJldHVybnMg5piv5ZCm5oiQ5YqfXG4gICAqL1xuICBhc3luYyBzZXQ8VCA9IGFueT4oXG4gICAga2V5OiBDYWNoZUtleSxcbiAgICB2YWx1ZTogVCxcbiAgICBvcHRpb25zPzogUGFydGlhbDxDYWNoZU9wdGlvbnM+LFxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qga2V5U3RyaW5nID0gdGhpcy5rZXlGYWN0b3J5LnRvU3RyaW5nKGtleSk7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgICBjb25zdCBjYWNoZVZhbHVlOiBDYWNoZVZhbHVlPFQ+ID0ge1xuICAgICAgICB2YWx1ZSxcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIGFjY2Vzc0NvdW50OiAwLFxuICAgICAgICBsYXN0QWNjZXNzZWQ6IG5vdyxcbiAgICAgICAgdmVyc2lvbjoga2V5LnZlcnNpb24sXG4gICAgICAgIHRhZ3M6IGtleS50YWdzLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHR5cGU6IENhY2hlVHlwZS5SRURJUyxcbiAgICAgICAgICBzdHJhdGVneTogb3B0aW9ucz8uc3RyYXRlZ3kgfHwgQ2FjaGVTdHJhdGVneS5UVEwsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICAvLyDorr7nva7ov4fmnJ/ml7bpl7RcbiAgICAgIGlmIChvcHRpb25zPy50dGwpIHtcbiAgICAgICAgY2FjaGVWYWx1ZS5leHBpcmVzQXQgPSBub3cgKyBvcHRpb25zLnR0bDtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2VyaWFsaXplZFZhbHVlID0gSlNPTi5zdHJpbmdpZnkoY2FjaGVWYWx1ZSk7XG4gICAgICBjb25zdCB2YWx1ZVNpemUgPSBCdWZmZXIuYnl0ZUxlbmd0aChzZXJpYWxpemVkVmFsdWUsICd1dGY4Jyk7XG5cbiAgICAgIC8vIOS9v+eUqFJlZGlz55qERVhQSVJF5ZG95Luk6K6+572u6L+H5pyf5pe26Ze0XG4gICAgICBpZiAob3B0aW9ucz8udHRsKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0ZXgoXG4gICAgICAgICAga2V5U3RyaW5nLFxuICAgICAgICAgIE1hdGguY2VpbChvcHRpb25zLnR0bCAvIDEwMDApLFxuICAgICAgICAgIHNlcmlhbGl6ZWRWYWx1ZSxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0KGtleVN0cmluZywgc2VyaWFsaXplZFZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgLy8g5pu05paw57uf6K6hXG4gICAgICB0aGlzLnN0YXRzLnRvdGFsRW50cmllcysrO1xuICAgICAgdGhpcy5zdGF0cy50b3RhbFNpemUgKz0gdmFsdWVTaXplO1xuICAgICAgdGhpcy5zdGF0cy5hdmVyYWdlU2l6ZSA9IHRoaXMuc3RhdHMudG90YWxTaXplIC8gdGhpcy5zdGF0cy50b3RhbEVudHJpZXM7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgJ0Vycm9yIHNldHRpbmcgY2FjaGUgdmFsdWUnLFxuICAgICAgICBMb2dDb250ZXh0LkNBQ0hFLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGVycm9yIGFzIEVycm9yLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBkZWxldGVcbiAgICogQGRlc2NyaXB0aW9uIOWIoOmZpOe8k+WtmOWAvFxuICAgKiBAcGFyYW0ga2V5IOe8k+WtmOmUrlxuICAgKiBAcmV0dXJucyDmmK/lkKbmiJDlip9cbiAgICovXG4gIGFzeW5jIGRlbGV0ZShrZXk6IENhY2hlS2V5KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGtleVN0cmluZyA9IHRoaXMua2V5RmFjdG9yeS50b1N0cmluZyhrZXkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZWRpcy5kZWwoa2V5U3RyaW5nKTtcblxuICAgICAgaWYgKHJlc3VsdCA+IDApIHtcbiAgICAgICAgdGhpcy5zdGF0cy50b3RhbEVudHJpZXMtLTtcbiAgICAgICAgLy8g5rOo5oSP77ya6L+Z6YeM5peg5rOV5YeG56Gu5pu05pawdG90YWxTaXpl77yM5Zug5Li65oiR5Lus6ZyA6KaB6I635Y+W6KKr5Yig6Zmk6aG555qE5aSn5bCPXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAnRXJyb3IgZGVsZXRpbmcgY2FjaGUgdmFsdWUnLFxuICAgICAgICBMb2dDb250ZXh0LkNBQ0hFLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGVycm9yIGFzIEVycm9yLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBleGlzdHNcbiAgICogQGRlc2NyaXB0aW9uIOajgOafpee8k+WtmOmUruaYr+WQpuWtmOWcqFxuICAgKiBAcGFyYW0ga2V5IOe8k+WtmOmUrlxuICAgKiBAcmV0dXJucyDmmK/lkKblrZjlnKhcbiAgICovXG4gIGFzeW5jIGV4aXN0cyhrZXk6IENhY2hlS2V5KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGtleVN0cmluZyA9IHRoaXMua2V5RmFjdG9yeS50b1N0cmluZyhrZXkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZWRpcy5leGlzdHMoa2V5U3RyaW5nKTtcbiAgICAgIHJldHVybiByZXN1bHQgPT09IDE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAnRXJyb3IgY2hlY2tpbmcgY2FjaGUga2V5IGV4aXN0ZW5jZScsXG4gICAgICAgIExvZ0NvbnRleHQuQ0FDSEUsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3IgYXMgRXJyb3IsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNsZWFyXG4gICAqIEBkZXNjcmlwdGlvbiDmuIXnqbrnvJPlrZhcbiAgICogQHBhcmFtIG5hbWVzcGFjZSDlkb3lkI3nqbrpl7TvvIjlj6/pgInvvIlcbiAgICogQHJldHVybnMg5piv5ZCm5oiQ5YqfXG4gICAqL1xuICBhc3luYyBjbGVhcihuYW1lc3BhY2U/OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKG5hbWVzcGFjZSkge1xuICAgICAgICAvLyDkvb/nlKjmqKHlvI/ljLnphY3liKDpmaTmjIflrprlkb3lkI3nqbrpl7TnmoTmiYDmnInplK5cbiAgICAgICAgY29uc3QgcGF0dGVybiA9IGAke25hbWVzcGFjZX06KmA7XG4gICAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLnJlZGlzLmtleXMocGF0dGVybik7XG5cbiAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKC4uLmtleXMpO1xuICAgICAgICAgIHRoaXMuc3RhdHMudG90YWxFbnRyaWVzIC09IGtleXMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDmuIXnqbrmlbTkuKrmlbDmja7lupNcbiAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5mbHVzaGRiKCk7XG4gICAgICAgIHRoaXMuc3RhdHMudG90YWxFbnRyaWVzID0gMDtcbiAgICAgICAgdGhpcy5zdGF0cy50b3RhbFNpemUgPSAwO1xuICAgICAgICB0aGlzLnN0YXRzLmF2ZXJhZ2VTaXplID0gMDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAnRXJyb3IgY2xlYXJpbmcgY2FjaGUnLFxuICAgICAgICBMb2dDb250ZXh0LkNBQ0hFLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGVycm9yIGFzIEVycm9yLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRTdGF0c1xuICAgKiBAZGVzY3JpcHRpb24g6I635Y+W57yT5a2Y57uf6K6hXG4gICAqIEByZXR1cm5zIOe8k+WtmOe7n+iuoVxuICAgKi9cbiAgYXN5bmMgZ2V0U3RhdHMoKTogUHJvbWlzZTxDYWNoZVN0YXRzPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOiOt+WPllJlZGlz5L+h5oGvXG4gICAgICBjb25zdCBpbmZvID0gYXdhaXQgdGhpcy5yZWRpcy5pbmZvKCk7XG4gICAgICBjb25zdCBsaW5lcyA9IGluZm8uc3BsaXQoJ1xcclxcbicpO1xuXG4gICAgICAvLyDop6PmnpBSZWRpc+e7n+iuoeS/oeaBr1xuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ2tleXNwYWNlOicpKSB7XG4gICAgICAgICAgY29uc3QgbWF0Y2ggPSBsaW5lLm1hdGNoKC9rZXlzPShcXGQrKS8pO1xuICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0cy50b3RhbEVudHJpZXMgPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IC4uLnRoaXMuc3RhdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICdFcnJvciBnZXR0aW5nIGNhY2hlIHN0YXRzJyxcbiAgICAgICAgTG9nQ29udGV4dC5DQUNIRSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICBlcnJvciBhcyBFcnJvcixcbiAgICAgICk7XG4gICAgICByZXR1cm4geyAuLi50aGlzLnN0YXRzIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0SGVhbHRoXG4gICAqIEBkZXNjcmlwdGlvbiDojrflj5bnvJPlrZjlgaXlurfnirbmgIFcbiAgICogQHJldHVybnMg57yT5a2Y5YGl5bq354q25oCBXG4gICAqL1xuICBhc3luYyBnZXRIZWFsdGgoKTogUHJvbWlzZTxDYWNoZUhlYWx0aD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5yZWRpcy5waW5nKCk7XG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBoZWFsdGh5OiB0cnVlLFxuICAgICAgICBjb25uZWN0ZWQ6IHRoaXMuaXNDb25uZWN0ZWQsXG4gICAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgICAgbGFzdENoZWNrOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgcmVzcG9uc2VUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGVhbHRoeTogZmFsc2UsXG4gICAgICAgIGNvbm5lY3RlZDogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgICAgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSxcbiAgICAgICAgbGFzdENoZWNrOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCByZXNldFN0YXRzXG4gICAqIEBkZXNjcmlwdGlvbiDph43nva7nvJPlrZjnu5/orqFcbiAgICovXG4gIGFzeW5jIHJlc2V0U3RhdHMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5zdGF0cyA9IHtcbiAgICAgIHRvdGFsRW50cmllczogMCxcbiAgICAgIGhpdHM6IDAsXG4gICAgICBtaXNzZXM6IDAsXG4gICAgICBoaXRSYXRlOiAwLFxuICAgICAgdG90YWxTaXplOiAwLFxuICAgICAgYXZlcmFnZVNpemU6IDAsXG4gICAgICBleHBpcmVkRW50cmllczogMCxcbiAgICAgIGV2aWN0ZWRFbnRyaWVzOiAwLFxuICAgICAgbGFzdFJlc2V0OiBEYXRlLm5vdygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGUgdXBkYXRlSGl0UmF0ZVxuICAgKiBAZGVzY3JpcHRpb24g5pu05paw5ZG95Lit546HXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZUhpdFJhdGUoKTogdm9pZCB7XG4gICAgY29uc3QgdG90YWwgPSB0aGlzLnN0YXRzLmhpdHMgKyB0aGlzLnN0YXRzLm1pc3NlcztcbiAgICB0aGlzLnN0YXRzLmhpdFJhdGUgPSB0b3RhbCA+IDAgPyB0aGlzLnN0YXRzLmhpdHMgLyB0b3RhbCA6IDA7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==