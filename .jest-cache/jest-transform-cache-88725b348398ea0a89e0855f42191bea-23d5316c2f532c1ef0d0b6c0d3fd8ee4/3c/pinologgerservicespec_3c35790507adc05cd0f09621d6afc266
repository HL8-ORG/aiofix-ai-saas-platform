417a723706bc8b4b6468d6b99417b69e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const event_emitter_1 = require("@nestjs/event-emitter");
const nestjs_cls_1 = require("nestjs-cls");
const pino_logger_service_1 = require("./pino-logger.service");
const pino_logger_config_service_1 = require("./pino-logger-config.service");
const pino_logger_factory_1 = require("../factories/pino-logger.factory");
const logging_interface_1 = require("../interfaces/logging.interface");
describe('PinoLoggerService', () => {
    let service;
    let eventEmitter;
    let configService;
    let loggerFactory;
    // let _clsService: ClsService; // 暂时注释掉，因为测试中没有使用
    beforeEach(async () => {
        const mockLogger = {
            debug: jest.fn(),
            info: jest.fn(),
            warn: jest.fn(),
            error: jest.fn(),
            fatal: jest.fn(),
            trace: jest.fn(),
            child: jest.fn(),
            flush: jest.fn(),
        };
        const mockConfigService = {
            getConfig: jest.fn().mockReturnValue({
                level: 'info',
                format: 'json',
                colorize: true,
                timestamp: true,
                requestId: true,
                tenantId: true,
                userId: true,
                performance: true,
                stackTrace: true,
                filePath: undefined,
                rotation: { maxSize: '10m', maxFiles: 5, interval: '1d' },
                remote: undefined,
            }),
            getLevel: jest.fn().mockReturnValue('info'),
            setLevel: jest.fn(),
            updateConfig: jest.fn(),
        };
        const mockLoggerFactory = {
            createLogger: jest.fn().mockReturnValue(mockLogger),
            createChildLogger: jest.fn().mockReturnValue(mockLogger),
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                pino_logger_service_1.PinoLoggerService,
                {
                    provide: pino_logger_config_service_1.PinoLoggerConfigService,
                    useValue: mockConfigService,
                },
                {
                    provide: pino_logger_factory_1.PinoLoggerFactory,
                    useValue: mockLoggerFactory,
                },
                {
                    provide: event_emitter_1.EventEmitter2,
                    useValue: {
                        emit: jest.fn(),
                    },
                },
                {
                    provide: nestjs_cls_1.ClsService,
                    useValue: {
                        get: jest.fn(),
                        set: jest.fn(),
                        run: jest.fn(),
                        runWith: jest.fn(),
                        enter: jest.fn(),
                        exit: jest.fn(),
                        isActive: jest.fn().mockReturnValue(true),
                    },
                },
            ],
        }).compile();
        service = module.get(pino_logger_service_1.PinoLoggerService);
        eventEmitter = module.get(event_emitter_1.EventEmitter2);
        configService = module.get(pino_logger_config_service_1.PinoLoggerConfigService);
        loggerFactory = module.get(pino_logger_factory_1.PinoLoggerFactory);
        // _clsService = module.get<ClsService>(ClsService);
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('basic logging', () => {
        it('should log debug messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.debug('Debug message', logging_interface_1.LogContext.SYSTEM, { test: 'data' });
            expect(spy).toHaveBeenCalledWith('debug', 'Debug message', logging_interface_1.LogContext.SYSTEM, { test: 'data' }, undefined);
        });
        it('should log info messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.info('Info message', logging_interface_1.LogContext.BUSINESS, { operation: 'test' });
            expect(spy).toHaveBeenCalledWith('info', 'Info message', logging_interface_1.LogContext.BUSINESS, { operation: 'test' }, undefined);
        });
        it('should log warn messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.warn('Warning message', logging_interface_1.LogContext.AUTH, { userId: '123' });
            expect(spy).toHaveBeenCalledWith('warn', 'Warning message', logging_interface_1.LogContext.AUTH, { userId: '123' }, undefined);
        });
        it('should log error messages', () => {
            const error = new Error('Test error');
            const spy = jest.spyOn(service, 'log');
            service.error('Error message', logging_interface_1.LogContext.DATABASE, { query: 'SELECT *' }, error);
            expect(spy).toHaveBeenCalledWith('error', 'Error message', logging_interface_1.LogContext.DATABASE, { query: 'SELECT *' }, error);
        });
        it('should log fatal messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.fatal('Fatal message', logging_interface_1.LogContext.SYSTEM, { critical: true });
            expect(spy).toHaveBeenCalledWith('fatal', 'Fatal message', logging_interface_1.LogContext.SYSTEM, { critical: true }, undefined);
        });
        it('should log trace messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.trace('Trace message', logging_interface_1.LogContext.PERFORMANCE, { duration: 100 });
            expect(spy).toHaveBeenCalledWith('trace', 'Trace message', logging_interface_1.LogContext.PERFORMANCE, { duration: 100 }, undefined);
        });
    });
    describe('specialized logging', () => {
        it('should log performance messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.performance('database_query', 150, logging_interface_1.LogContext.DATABASE, {
                table: 'users',
            });
            expect(spy).toHaveBeenCalledWith('info', 'Performance: database_query took 150ms', logging_interface_1.LogContext.DATABASE, {
                table: 'users',
                operation: 'database_query',
                duration: 150,
                type: 'performance',
            });
        });
        it('should log business messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.business('User registered', {
                userId: '123',
                email: 'test@example.com',
            });
            expect(spy).toHaveBeenCalledWith('info', 'User registered', logging_interface_1.LogContext.BUSINESS, {
                userId: '123',
                email: 'test@example.com',
            });
        });
        it('should log security messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.security('Failed login attempt', {
                ip: '192.168.1.1',
                username: 'test',
            });
            expect(spy).toHaveBeenCalledWith('warn', 'Failed login attempt', logging_interface_1.LogContext.AUTH, {
                ip: '192.168.1.1',
                username: 'test',
            });
        });
    });
    describe('configuration', () => {
        it('should get and set log level', () => {
            jest.spyOn(configService, 'getLevel').mockReturnValue('info');
            jest.spyOn(configService, 'setLevel').mockImplementation(() => undefined);
            service.setLevel('debug');
            expect(configService.setLevel).toHaveBeenCalledWith('debug');
            expect(configService.getLevel).toHaveBeenCalled();
        });
        it('should get and update config', () => {
            const mockConfig = {
                level: 'warn',
                format: 'json',
                colorize: true,
                timestamp: true,
                requestId: true,
                tenantId: true,
                userId: true,
                performance: true,
                stackTrace: true,
                filePath: undefined,
                rotation: { maxSize: '10m', maxFiles: 5, interval: '1d' },
                remote: undefined,
            };
            jest.spyOn(configService, 'getConfig').mockReturnValue(mockConfig);
            jest
                .spyOn(configService, 'updateConfig')
                .mockImplementation(() => undefined);
            const config = service.getConfig();
            service.updateConfig({ level: 'warn' });
            expect(configService.getConfig).toHaveBeenCalled();
            expect(configService.updateConfig).toHaveBeenCalledWith({
                level: 'warn',
            });
            expect(config).toEqual(mockConfig);
        });
    });
    describe('child logger', () => {
        it('should create child logger', () => {
            const mockChildLogger = {
                debug: jest.fn(),
                info: jest.fn(),
                warn: jest.fn(),
                error: jest.fn(),
                fatal: jest.fn(),
                trace: jest.fn(),
            };
            jest
                .spyOn(loggerFactory, 'createChildLogger')
                .mockReturnValue(mockChildLogger);
            const childLogger = service.child(logging_interface_1.LogContext.DATABASE, {
                tenantId: '123',
            });
            expect(childLogger).toBeDefined();
            expect(childLogger).toBeInstanceOf(pino_logger_service_1.PinoLoggerService);
            expect(loggerFactory.createChildLogger).toHaveBeenCalledWith(expect.anything(), { context: logging_interface_1.LogContext.DATABASE, tenantId: '123' });
        });
    });
    describe('statistics', () => {
        it('should track log statistics', () => {
            // 重置统计
            service.resetStats();
            // 记录一些日志
            service.info('Test message 1', logging_interface_1.LogContext.BUSINESS);
            service.warn('Test message 2', logging_interface_1.LogContext.AUTH);
            service.error('Test message 3', logging_interface_1.LogContext.DATABASE);
            const stats = service.getStats();
            expect(stats.totalLogs).toBeGreaterThanOrEqual(3);
            expect(stats.logsByLevel.info).toBeGreaterThanOrEqual(1);
            expect(stats.logsByLevel.warn).toBeGreaterThanOrEqual(1);
            expect(stats.logsByLevel.error).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.BUSINESS]).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.AUTH]).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.DATABASE]).toBeGreaterThanOrEqual(1);
            expect(stats.averageLogSize).toBeGreaterThan(0);
            expect(stats.lastLogTime).toBeDefined();
        });
        it('should reset statistics', () => {
            // 记录一些日志
            service.info('Test message');
            // 重置统计
            service.resetStats();
            const stats = service.getStats();
            expect(stats.totalLogs).toBe(0);
            expect(stats.logsByLevel.info).toBe(0);
        });
    });
    describe('event emission', () => {
        it('should emit log events', () => {
            service.info('Test message', logging_interface_1.LogContext.BUSINESS, { test: 'data' });
            expect(eventEmitter.emit).toHaveBeenCalledWith('logger.log', expect.objectContaining({
                level: 'info',
                message: 'Test message',
                context: logging_interface_1.LogContext.BUSINESS,
                metadata: { test: 'data' },
            }));
        });
    });
    describe('lifecycle methods', () => {
        it('should flush and close logger', async () => {
            await expect(service.flush()).resolves.not.toThrow();
            await expect(service.close()).resolves.not.toThrow();
        });
        it('should handle module destruction', async () => {
            await expect(service.onModuleDestroy()).resolves.not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvbG9nZ2luZy9zcmMvc2VydmljZXMvcGluby1sb2dnZXIuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELHlEQUFzRDtBQUN0RCwyQ0FBd0M7QUFDeEMsK0RBQTBEO0FBQzFELDZFQUF1RTtBQUN2RSwwRUFBcUU7QUFDckUsdUVBQXVFO0FBRXZFLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxPQUEwQixDQUFDO0lBQy9CLElBQUksWUFBMkIsQ0FBQztJQUNoQyxJQUFJLGFBQXNDLENBQUM7SUFDM0MsSUFBSSxhQUFnQyxDQUFDO0lBQ3JDLGtEQUFrRDtJQUVsRCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxVQUFVLEdBQUc7WUFDakIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2pCLENBQUM7UUFFRixNQUFNLGlCQUFpQixHQUFHO1lBQ3hCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO2dCQUNuQyxLQUFLLEVBQUUsTUFBTTtnQkFDYixNQUFNLEVBQUUsTUFBTTtnQkFDZCxRQUFRLEVBQUUsSUFBSTtnQkFDZCxTQUFTLEVBQUUsSUFBSTtnQkFDZixTQUFTLEVBQUUsSUFBSTtnQkFDZixRQUFRLEVB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QUNqQyxFQUFFLENBQUMsK0JBQStCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0MsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNyRCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hELE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2FybGlnbGUvVjEvQWlvZml4L2Fpb2ZpeC1haS1zYWFzLXBsYXRmb3JtL3BhY2thZ2VzL2xvZ2dpbmcvc3JjL3NlcnZpY2VzL3Bpbm8tbG9nZ2VyLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlcjIgfSBmcm9tICdAbmVzdGpzL2V2ZW50LWVtaXR0ZXInO1xuaW1wb3J0IHsgQ2xzU2VydmljZSB9IGZyb20gJ25lc3Rqcy1jbHMnO1xuaW1wb3J0IHsgUGlub0xvZ2dlclNlcnZpY2UgfSBmcm9tICcuL3Bpbm8tbG9nZ2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGlub0xvZ2dlckNvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL3Bpbm8tbG9nZ2VyLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IFBpbm9Mb2dnZXJGYWN0b3J5IH0gZnJvbSAnLi4vZmFjdG9yaWVzL3Bpbm8tbG9nZ2VyLmZhY3RvcnknO1xuaW1wb3J0IHsgTG9nQ29udGV4dCwgTG9nTGV2ZWwgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2xvZ2dpbmcuaW50ZXJmYWNlJztcblxuZGVzY3JpYmUoJ1Bpbm9Mb2dnZXJTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogUGlub0xvZ2dlclNlcnZpY2U7XG4gIGxldCBldmVudEVtaXR0ZXI6IEV2ZW50RW1pdHRlcjI7XG4gIGxldCBjb25maWdTZXJ2aWNlOiBQaW5vTG9nZ2VyQ29uZmlnU2VydmljZTtcbiAgbGV0IGxvZ2dlckZhY3Rvcnk6IFBpbm9Mb2dnZXJGYWN0b3J5O1xuICAvLyBsZXQgX2Nsc1NlcnZpY2U6IENsc1NlcnZpY2U7IC8vIOaaguaXtuazqOmHiuaOie+8jOWboOS4uua1i+ivleS4reayoeacieS9v+eUqFxuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tMb2dnZXIgPSB7XG4gICAgICBkZWJ1ZzogamVzdC5mbigpLFxuICAgICAgaW5mbzogamVzdC5mbigpLFxuICAgICAgd2FybjogamVzdC5mbigpLFxuICAgICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICAgIGZhdGFsOiBqZXN0LmZuKCksXG4gICAgICB0cmFjZTogamVzdC5mbigpLFxuICAgICAgY2hpbGQ6IGplc3QuZm4oKSxcbiAgICAgIGZsdXNoOiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tDb25maWdTZXJ2aWNlID0ge1xuICAgICAgZ2V0Q29uZmlnOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgbGV2ZWw6ICdpbmZvJyxcbiAgICAgICAgZm9ybWF0OiAnanNvbicsXG4gICAgICAgIGNvbG9yaXplOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IHRydWUsXG4gICAgICAgIHJlcXVlc3RJZDogdHJ1ZSxcbiAgICAgICAgdGVuYW50SWQ6IHRydWUsXG4gICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHRydWUsXG4gICAgICAgIHN0YWNrVHJhY2U6IHRydWUsXG4gICAgICAgIGZpbGVQYXRoOiB1bmRlZmluZWQsXG4gICAgICAgIHJvdGF0aW9uOiB7IG1heFNpemU6ICcxMG0nLCBtYXhGaWxlczogNSwgaW50ZXJ2YWw6ICcxZCcgfSxcbiAgICAgICAgcmVtb3RlOiB1bmRlZmluZWQsXG4gICAgICB9KSxcbiAgICAgIGdldExldmVsOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdpbmZvJyksXG4gICAgICBzZXRMZXZlbDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlQ29uZmlnOiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tMb2dnZXJGYWN0b3J5ID0ge1xuICAgICAgY3JlYXRlTG9nZ2VyOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tMb2dnZXIpLFxuICAgICAgY3JlYXRlQ2hpbGRMb2dnZXI6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0xvZ2dlciksXG4gICAgfTtcblxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgUGlub0xvZ2dlclNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaW5vTG9nZ2VyQ29uZmlnU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0NvbmZpZ1NlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaW5vTG9nZ2VyRmFjdG9yeSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0xvZ2dlckZhY3RvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBFdmVudEVtaXR0ZXIyLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IENsc1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogamVzdC5mbigpLFxuICAgICAgICAgICAgc2V0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBydW46IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHJ1bldpdGg6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGVudGVyOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBleGl0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBpc0FjdGl2ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxQaW5vTG9nZ2VyU2VydmljZT4oUGlub0xvZ2dlclNlcnZpY2UpO1xuICAgIGV2ZW50RW1pdHRlciA9IG1vZHVsZS5nZXQ8RXZlbnRFbWl0dGVyMj4oRXZlbnRFbWl0dGVyMik7XG4gICAgY29uZmlnU2VydmljZSA9IG1vZHVsZS5nZXQ8UGlub0xvZ2dlckNvbmZpZ1NlcnZpY2U+KFxuICAgICAgUGlub0xvZ2dlckNvbmZpZ1NlcnZpY2UsXG4gICAgKTtcbiAgICBsb2dnZXJGYWN0b3J5ID0gbW9kdWxlLmdldDxQaW5vTG9nZ2VyRmFjdG9yeT4oUGlub0xvZ2dlckZhY3RvcnkpO1xuICAgIC8vIF9jbHNTZXJ2aWNlID0gbW9kdWxlLmdldDxDbHNTZXJ2aWNlPihDbHNTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnYmFzaWMgbG9nZ2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyBkZWJ1ZyBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuZGVidWcoJ0RlYnVnIG1lc3NhZ2UnLCBMb2dDb250ZXh0LlNZU1RFTSwgeyB0ZXN0OiAnZGF0YScgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2RlYnVnJyxcbiAgICAgICAgJ0RlYnVnIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LlNZU1RFTSxcbiAgICAgICAgeyB0ZXN0OiAnZGF0YScgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGluZm8gbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAnbG9nJyk7XG4gICAgICBzZXJ2aWNlLmluZm8oJ0luZm8gbWVzc2FnZScsIExvZ0NvbnRleHQuQlVTSU5FU1MsIHsgb3BlcmF0aW9uOiAndGVzdCcgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2luZm8nLFxuICAgICAgICAnSW5mbyBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgeyBvcGVyYXRpb246ICd0ZXN0JyB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgd2FybiBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2Uud2FybignV2FybmluZyBtZXNzYWdlJywgTG9nQ29udGV4dC5BVVRILCB7IHVzZXJJZDogJzEyMycgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ3dhcm4nLFxuICAgICAgICAnV2FybmluZyBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5BVVRILFxuICAgICAgICB7IHVzZXJJZDogJzEyMycgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGVycm9yIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuZXJyb3IoXG4gICAgICAgICdFcnJvciBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5EQVRBQkFTRSxcbiAgICAgICAgeyBxdWVyeTogJ1NFTEVDVCAqJyB9LFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgJ0Vycm9yIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LkRBVEFCQVNFLFxuICAgICAgICB7IHF1ZXJ5OiAnU0VMRUNUIConIH0sXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGZhdGFsIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS5mYXRhbCgnRmF0YWwgbWVzc2FnZScsIExvZ0NvbnRleHQuU1lTVEVNLCB7IGNyaXRpY2FsOiB0cnVlIH0pO1xuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdmYXRhbCcsXG4gICAgICAgICdGYXRhbCBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5TWVNURU0sXG4gICAgICAgIHsgY3JpdGljYWw6IHRydWUgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIHRyYWNlIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS50cmFjZSgnVHJhY2UgbWVzc2FnZScsIExvZ0NvbnRleHQuUEVSRk9STUFOQ0UsIHsgZHVyYXRpb246IDEwMCB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAndHJhY2UnLFxuICAgICAgICAnVHJhY2UgbWVzc2FnZScsXG4gICAgICAgIExvZ0NvbnRleHQuUEVSRk9STUFOQ0UsXG4gICAgICAgIHsgZHVyYXRpb246IDEwMCB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3BlY2lhbGl6ZWQgbG9nZ2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyBwZXJmb3JtYW5jZSBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UucGVyZm9ybWFuY2UoJ2RhdGFiYXNlX3F1ZXJ5JywgMTUwLCBMb2dDb250ZXh0LkRBVEFCQVNFLCB7XG4gICAgICAgIHRhYmxlOiAndXNlcnMnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2luZm8nLFxuICAgICAgICAnUGVyZm9ybWFuY2U6IGRhdGFiYXNlX3F1ZXJ5IHRvb2sgMTUwbXMnLFxuICAgICAgICBMb2dDb250ZXh0LkRBVEFCQVNFLFxuICAgICAgICB7XG4gICAgICAgICAgdGFibGU6ICd1c2VycycsXG4gICAgICAgICAgb3BlcmF0aW9uOiAnZGF0YWJhc2VfcXVlcnknLFxuICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXG4gICAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBidXNpbmVzcyBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuYnVzaW5lc3MoJ1VzZXIgcmVnaXN0ZXJlZCcsIHtcbiAgICAgICAgdXNlcklkOiAnMTIzJyxcbiAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdpbmZvJyxcbiAgICAgICAgJ1VzZXIgcmVnaXN0ZXJlZCcsXG4gICAgICAgIExvZ0NvbnRleHQuQlVTSU5FU1MsXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6ICcxMjMnLFxuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgc2VjdXJpdHkgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAnbG9nJyk7XG4gICAgICBzZXJ2aWNlLnNlY3VyaXR5KCdGYWlsZWQgbG9naW4gYXR0ZW1wdCcsIHtcbiAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnd2FybicsXG4gICAgICAgICdGYWlsZWQgbG9naW4gYXR0ZW1wdCcsXG4gICAgICAgIExvZ0NvbnRleHQuQVVUSCxcbiAgICAgICAge1xuICAgICAgICAgIGlwOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhbmQgc2V0IGxvZyBsZXZlbCcsICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oY29uZmlnU2VydmljZSwgJ2dldExldmVsJykubW9ja1JldHVyblZhbHVlKCdpbmZvJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbmZpZ1NlcnZpY2UsICdzZXRMZXZlbCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB1bmRlZmluZWQpO1xuXG4gICAgICBzZXJ2aWNlLnNldExldmVsKCdkZWJ1ZycpO1xuXG4gICAgICBleHBlY3QoY29uZmlnU2VydmljZS5zZXRMZXZlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2RlYnVnJyk7XG4gICAgICBleHBlY3QoY29uZmlnU2VydmljZS5nZXRMZXZlbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgYW5kIHVwZGF0ZSBjb25maWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xuICAgICAgICBsZXZlbDogJ3dhcm4nIGFzIExvZ0xldmVsLFxuICAgICAgICBmb3JtYXQ6ICdqc29uJyBhcyBhbnksXG4gICAgICAgIGNvbG9yaXplOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IHRydWUsXG4gICAgICAgIHJlcXVlc3RJZDogdHJ1ZSxcbiAgICAgICAgdGVuYW50SWQ6IHRydWUsXG4gICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHRydWUsXG4gICAgICAgIHN0YWNrVHJhY2U6IHRydWUsXG4gICAgICAgIGZpbGVQYXRoOiB1bmRlZmluZWQsXG4gICAgICAgIHJvdGF0aW9uOiB7IG1heFNpemU6ICcxMG0nLCBtYXhGaWxlczogNSwgaW50ZXJ2YWw6ICcxZCcgfSxcbiAgICAgICAgcmVtb3RlOiB1bmRlZmluZWQsXG4gICAgICB9O1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCAnZ2V0Q29uZmlnJykubW9ja1JldHVyblZhbHVlKG1vY2tDb25maWcpO1xuICAgICAgamVzdFxuICAgICAgICAuc3B5T24oY29uZmlnU2VydmljZSwgJ3VwZGF0ZUNvbmZpZycpXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gdW5kZWZpbmVkKTtcblxuICAgICAgY29uc3QgY29uZmlnID0gc2VydmljZS5nZXRDb25maWcoKTtcbiAgICAgIHNlcnZpY2UudXBkYXRlQ29uZmlnKHsgbGV2ZWw6ICd3YXJuJyB9KTtcblxuICAgICAgZXhwZWN0KGNvbmZpZ1NlcnZpY2UuZ2V0Q29uZmlnKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QoY29uZmlnU2VydmljZS51cGRhdGVDb25maWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgbGV2ZWw6ICd3YXJuJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbmZpZykudG9FcXVhbChtb2NrQ29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NoaWxkIGxvZ2dlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjaGlsZCBsb2dnZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ2hpbGRMb2dnZXIgPSB7XG4gICAgICAgIGRlYnVnOiBqZXN0LmZuKCksXG4gICAgICAgIGluZm86IGplc3QuZm4oKSxcbiAgICAgICAgd2FybjogamVzdC5mbigpLFxuICAgICAgICBlcnJvcjogamVzdC5mbigpLFxuICAgICAgICBmYXRhbDogamVzdC5mbigpLFxuICAgICAgICB0cmFjZTogamVzdC5mbigpLFxuICAgICAgfTtcbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKGxvZ2dlckZhY3RvcnksICdjcmVhdGVDaGlsZExvZ2dlcicpXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWUobW9ja0NoaWxkTG9nZ2VyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGNoaWxkTG9nZ2VyID0gc2VydmljZS5jaGlsZChMb2dDb250ZXh0LkRBVEFCQVNFLCB7XG4gICAgICAgIHRlbmFudElkOiAnMTIzJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoY2hpbGRMb2dnZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY2hpbGRMb2dnZXIpLnRvQmVJbnN0YW5jZU9mKFBpbm9Mb2dnZXJTZXJ2aWNlKTtcbiAgICAgIGV4cGVjdChsb2dnZXJGYWN0b3J5LmNyZWF0ZUNoaWxkTG9nZ2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKCksXG4gICAgICAgIHsgY29udGV4dDogTG9nQ29udGV4dC5EQVRBQkFTRSwgdGVuYW50SWQ6ICcxMjMnIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RhdGlzdGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIGxvZyBzdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgICAgLy8g6YeN572u57uf6K6hXG4gICAgICBzZXJ2aWNlLnJlc2V0U3RhdHMoKTtcblxuICAgICAgLy8g6K6w5b2V5LiA5Lqb5pel5b+XXG4gICAgICBzZXJ2aWNlLmluZm8oJ1Rlc3QgbWVzc2FnZSAxJywgTG9nQ29udGV4dC5CVVNJTkVTUyk7XG4gICAgICBzZXJ2aWNlLndhcm4oJ1Rlc3QgbWVzc2FnZSAyJywgTG9nQ29udGV4dC5BVVRIKTtcbiAgICAgIHNlcnZpY2UuZXJyb3IoJ1Rlc3QgbWVzc2FnZSAzJywgTG9nQ29udGV4dC5EQVRBQkFTRSk7XG5cbiAgICAgIGNvbnN0IHN0YXRzID0gc2VydmljZS5nZXRTdGF0cygpO1xuXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxMb2dzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUxldmVsLmluZm8pLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMubG9nc0J5TGV2ZWwud2FybikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlMZXZlbC5lcnJvcikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlDb250ZXh0W0xvZ0NvbnRleHQuQlVTSU5FU1NdKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKFxuICAgICAgICAxLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlDb250ZXh0W0xvZ0NvbnRleHQuQVVUSF0pLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMubG9nc0J5Q29udGV4dFtMb2dDb250ZXh0LkRBVEFCQVNFXSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChcbiAgICAgICAgMSxcbiAgICAgICk7XG4gICAgICBleHBlY3Qoc3RhdHMuYXZlcmFnZUxvZ1NpemUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sYXN0TG9nVGltZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIC8vIOiusOW9leS4gOS6m+aXpeW/l1xuICAgICAgc2VydmljZS5pbmZvKCdUZXN0IG1lc3NhZ2UnKTtcblxuICAgICAgLy8g6YeN572u57uf6K6hXG4gICAgICBzZXJ2aWNlLnJlc2V0U3RhdHMoKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldFN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxMb2dzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUxldmVsLmluZm8pLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudCBlbWlzc2lvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgbG9nIGV2ZW50cycsICgpID0+IHtcbiAgICAgIHNlcnZpY2UuaW5mbygnVGVzdCBtZXNzYWdlJywgTG9nQ29udGV4dC5CVVNJTkVTUywgeyB0ZXN0OiAnZGF0YScgfSk7XG5cbiAgICAgIGV4cGVjdChldmVudEVtaXR0ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdsb2dnZXIubG9nJyxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGxldmVsOiAnaW5mbycsXG4gICAgICAgICAgbWVzc2FnZTogJ1Rlc3QgbWVzc2FnZScsXG4gICAgICAgICAgY29udGV4dDogTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgICBtZXRhZGF0YTogeyB0ZXN0OiAnZGF0YScgfSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbGlmZWN5Y2xlIG1ldGhvZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmbHVzaCBhbmQgY2xvc2UgbG9nZ2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZmx1c2goKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNsb3NlKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2R1bGUgZGVzdHJ1Y3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5vbk1vZHVsZURlc3Ryb3koKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==