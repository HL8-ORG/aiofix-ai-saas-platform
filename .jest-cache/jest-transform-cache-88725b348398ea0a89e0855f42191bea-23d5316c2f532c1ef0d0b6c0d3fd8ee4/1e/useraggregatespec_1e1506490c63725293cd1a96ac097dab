d9657f5e7434b4754fdcb558e65cd6e5
"use strict";
/**
 * 用户聚合根测试
 *
 * 测试用户聚合根的基本功能，包括用户创建、资料更新等。
 *
 * @fileoverview 用户聚合根单元测试
 * @author AI开发团队
 * @since 1.0.0
 */
Object.defineProperty(exports, "__esModule", { value: true });
const user_aggregate_1 = require("./user.aggregate");
describe('User Aggregate', () => {
    describe('create', () => {
        it('should create user with valid data', () => {
            // Arrange
            const email = 'test@example.com';
            const password = 'Password123!';
            const name = 'Test User';
            // Act
            const user = user_aggregate_1.User.create(email, password, name);
            // Assert
            expect(user).toBeInstanceOf(user_aggregate_1.User);
            expect(user.id).toBeDefined();
            expect(user.email).toBe(email);
            expect(user.name).toBe(name);
            expect(user.status).toBe('active');
            expect(user.hasUncommittedEvents()).toBe(true);
            expect(user.getUncommittedEventsCount()).toBe(1);
            expect(user.uncommittedEvents[0]).toBeInstanceOf(user_aggregate_1.UserCreatedEvent);
        });
        it('should throw error for invalid email', () => {
            // Arrange
            const invalidEmail = 'invalid-email';
            const password = 'Password123!';
            const name = 'Test User';
            // Act & Assert
            expect(() => {
                user_aggregate_1.User.create(invalidEmail, password, name);
            }).toThrow('邮箱格式无效');
        });
        it('should throw error for weak password', () => {
            // Arrange
            const email = 'test@example.com';
            const weakPassword = '123';
            const name = 'Test User';
            // Act & Assert
            expect(() => {
                user_aggregate_1.User.create(email, weakPassword, name);
            }).toThrow('密码强度不足');
        });
        it('should throw error for empty name', () => {
            // Arrange
            const email = 'test@example.com';
            const password = 'Password123!';
            const emptyName = '';
            // Act & Assert
            expect(() => {
                user_aggregate_1.User.create(email, password, emptyName);
            }).toThrow('用户姓名不能为空');
        });
    });
    describe('updateProfile', () => {
        let user;
        beforeEach(() => {
            user = user_aggregate_1.User.create('test@example.com', 'Password123!', 'Test User');
            user.markEventsAsCommitted(); // 清除未提交事件
        });
        it('should update user profile successfully', () => {
            // Arrange
            const profile = {
                name: 'Updated Name',
                phone: '+1234567890',
                avatar: 'https://example.com/avatar.jpg',
            };
            // Act
            user.updateProfile(profile);
            // Assert
            expect(user.name).toBe('Updated Name');
            expect(user.phone).toBe('+1234567890');
            expect(user.avatar).toBe('https://example.com/avatar.jpg');
            expect(user.hasUncommittedEvents()).toBe(true);
            expect(user.getUncommittedEventsCount()).toBe(1);
            expect(user.uncommittedEvents[0]).toBeInstanceOf(user_aggregate_1.UserProfileUpdatedEvent);
        });
        it('should update partial profile', () => {
            // Arrange
            const profile = {
                name: 'New Name',
            };
            // Act
            user.updateProfile(profile);
            // Assert
            expect(user.name).toBe('New Name');
            expect(user.phone).toBe(''); // 未更新，保持原值
            expect(user.avatar).toBe(''); // 未更新，保持原值
        });
        it('should throw error for empty name', () => {
            // Arrange
            const profile = {
                name: '',
            };
            // Act & Assert
            expect(() => {
                user.updateProfile(profile);
            }).toThrow('用户姓名不能为空');
        });
        it('should throw error for invalid phone', () => {
            // Arrange
            const profile = {
                phone: 'invalid-phone',
            };
            // Act & Assert
            expect(() => {
                user.updateProfile(profile);
            }).toThrow('电话号码格式无效');
        });
    });
    describe('event sourcing', () => {
        it('should restore from history events', () => {
            // Arrange
            const user = user_aggregate_1.User.create('test@example.com', 'Password123!', 'Test User');
            const events = user.uncommittedEvents;
            user.markEventsAsCommitted();
            // 创建新用户实例
            const restoredUser = new user_aggregate_1.User(user.id);
            // Act
            restoredUser.loadFromHistory(events);
            // Assert
            expect(restoredUser.id).toBe(user.id);
            expect(restoredUser.email).toBe(user.email);
            expect(restoredUser.name).toBe(user.name);
            expect(restoredUser.status).toBe(user.status);
            expect(restoredUser.version).toBe(1);
        });
        it('should create and restore snapshot', () => {
            // Arrange
            const user = user_aggregate_1.User.create('test@example.com', 'Password123!', 'Test User');
            user.updateProfile({ name: 'Updated Name' });
            user.markEventsAsCommitted();
            // Act
            const snapshot = user.createSnapshot();
            const restoredUser = new user_aggregate_1.User(user.id);
            restoredUser.restoreFromSnapshot(snapshot);
            // Assert
            expect(restoredUser.id).toBe(user.id);
            expect(restoredUser.email).toBe(user.email);
            expect(restoredUser.name).toBe('Updated Name');
            expect(restoredUser.version).toBe(user.version);
        });
    });
    describe('version control', () => {
        it('should increment version on each event', () => {
            // Arrange
            const user = user_aggregate_1.User.create('test@example.com', 'Password123!', 'Test User');
            expect(user.version).toBe(1);
            // Act
            user.updateProfile({ name: 'Updated Name' });
            // Assert
            expect(user.version).toBe(2);
        });
        it('should maintain version consistency', () => {
            // Arrange
            const user = user_aggregate_1.User.create('test@example.com', 'Password123!', 'Test User');
            const initialVersion = user.version;
            // Act
            user.markEventsAsCommitted();
            // Assert
            expect(user.version).toBe(initialVersion);
            expect(user.hasUncommittedEvents()).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY29yZS9zcmMvZXhhbXBsZXMvdXNlci5hZ2dyZWdhdGUuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7O0dBUUc7O0FBRUgscURBSTBCO0FBRTFCLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7SUFDOUIsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxVQUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUcsa0JBQWtCLENBQUM7WUFDakMsTUFBTSxRQUFRLEdBQUcsY0FBYyxDQUFDO1lBQ2hDLE1BQU0sSUFBSSxHQUFHLFdBQVcsQ0FBQztZQUV6QixNQUFNO1lBQ04sTUFBTSxJQUFJLEdBQUcscUJBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUVoRCxTQUFTO1lBQ1QsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxxQkFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM5QixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3QixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDLENBQUMsSUFB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O1lBQzFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTdCLE1BQU07WUFDTixJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7WUFFN0MsU0FBUztZQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxVQUFVO1lBQ1YsTUFBTSxJQUFJLEdBQUcscUJBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQzFFLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7WUFFcEMsTUFBTTtZQUNOLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBRTdCLFNBQVM7WUFDVCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2FybGlnbGUvVjEvQWlvZml4L2Fpb2ZpeC1haS1zYWFzLXBsYXRmb3JtL3BhY2thZ2VzL2NvcmUvc3JjL2V4YW1wbGVzL3VzZXIuYWdncmVnYXRlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDnlKjmiLfogZrlkIjmoLnmtYvor5VcbiAqXG4gKiDmtYvor5XnlKjmiLfogZrlkIjmoLnnmoTln7rmnKzlip/og73vvIzljIXmi6znlKjmiLfliJvlu7rjgIHotYTmlpnmm7TmlrDnrYnjgIJcbiAqXG4gKiBAZmlsZW92ZXJ2aWV3IOeUqOaIt+iBmuWQiOagueWNleWFg+a1i+ivlVxuICogQGF1dGhvciBBSeW8gOWPkeWboumYn1xuICogQHNpbmNlIDEuMC4wXG4gKi9cblxuaW1wb3J0IHtcbiAgVXNlcixcbiAgVXNlckNyZWF0ZWRFdmVudCxcbiAgVXNlclByb2ZpbGVVcGRhdGVkRXZlbnQsXG59IGZyb20gJy4vdXNlci5hZ2dyZWdhdGUnO1xuXG5kZXNjcmliZSgnVXNlciBBZ2dyZWdhdGUnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdjcmVhdGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdXNlciB3aXRoIHZhbGlkIGRhdGEnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBlbWFpbCA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ1Bhc3N3b3JkMTIzISc7XG4gICAgICBjb25zdCBuYW1lID0gJ1Rlc3QgVXNlcic7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgdXNlciA9IFVzZXIuY3JlYXRlKGVtYWlsLCBwYXNzd29yZCwgbmFtZSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHVzZXIpLnRvQmVJbnN0YW5jZU9mKFVzZXIpO1xuICAgICAgZXhwZWN0KHVzZXIuaWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodXNlci5lbWFpbCkudG9CZShlbWFpbCk7XG4gICAgICBleHBlY3QodXNlci5uYW1lKS50b0JlKG5hbWUpO1xuICAgICAgZXhwZWN0KHVzZXIuc3RhdHVzKS50b0JlKCdhY3RpdmUnKTtcbiAgICAgIGV4cGVjdCh1c2VyLmhhc1VuY29tbWl0dGVkRXZlbnRzKCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodXNlci5nZXRVbmNvbW1pdHRlZEV2ZW50c0NvdW50KCkpLnRvQmUoMSk7XG4gICAgICBleHBlY3QodXNlci51bmNvbW1pdHRlZEV2ZW50c1swXSkudG9CZUluc3RhbmNlT2YoVXNlckNyZWF0ZWRFdmVudCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBpbnZhbGlkIGVtYWlsJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW52YWxpZEVtYWlsID0gJ2ludmFsaWQtZW1haWwnO1xuICAgICAgY29uc3QgcGFzc3dvcmQgPSAnUGFzc3dvcmQxMjMhJztcbiAgICAgIGNvbnN0IG5hbWUgPSAnVGVzdCBVc2VyJztcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBVc2VyLmNyZWF0ZShpbnZhbGlkRW1haWwsIHBhc3N3b3JkLCBuYW1lKTtcbiAgICAgIH0pLnRvVGhyb3coJ+mCrueuseagvOW8j+aXoOaViCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igd2VhayBwYXNzd29yZCcsICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVtYWlsID0gJ3Rlc3RAZXhhbXBsZS5jb20nO1xuICAgICAgY29uc3Qgd2Vha1Bhc3N3b3JkID0gJzEyMyc7XG4gICAgICBjb25zdCBuYW1lID0gJ1Rlc3QgVXNlcic7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgVXNlci5jcmVhdGUoZW1haWwsIHdlYWtQYXNzd29yZCwgbmFtZSk7XG4gICAgICB9KS50b1Rocm93KCflr4bnoIHlvLrluqbkuI3otrMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIGVtcHR5IG5hbWUnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBlbWFpbCA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ1Bhc3N3b3JkMTIzISc7XG4gICAgICBjb25zdCBlbXB0eU5hbWUgPSAnJztcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBVc2VyLmNyZWF0ZShlbWFpbCwgcGFzc3dvcmQsIGVtcHR5TmFtZSk7XG4gICAgICB9KS50b1Rocm93KCfnlKjmiLflp5PlkI3kuI3og73kuLrnqbonKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZVByb2ZpbGUnLCAoKSA9PiB7XG4gICAgbGV0IHVzZXI6IFVzZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHVzZXIgPSBVc2VyLmNyZWF0ZSgndGVzdEBleGFtcGxlLmNvbScsICdQYXNzd29yZDEyMyEnLCAnVGVzdCBVc2VyJyk7XG4gICAgICB1c2VyLm1hcmtFdmVudHNBc0NvbW1pdHRlZCgpOyAvLyDmuIXpmaTmnKrmj5DkuqTkuovku7ZcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHVzZXIgcHJvZmlsZSBzdWNjZXNzZnVsbHknLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBwcm9maWxlID0ge1xuICAgICAgICBuYW1lOiAnVXBkYXRlZCBOYW1lJyxcbiAgICAgICAgcGhvbmU6ICcrMTIzNDU2Nzg5MCcsXG4gICAgICAgIGF2YXRhcjogJ2h0dHBzOi8vZXhhbXBsZS5jb20vYXZhdGFyLmpwZycsXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3RcbiAgICAgIHVzZXIudXBkYXRlUHJvZmlsZShwcm9maWxlKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QodXNlci5uYW1lKS50b0JlKCdVcGRhdGVkIE5hbWUnKTtcbiAgICAgIGV4cGVjdCh1c2VyLnBob25lKS50b0JlKCcrMTIzNDU2Nzg5MCcpO1xuICAgICAgZXhwZWN0KHVzZXIuYXZhdGFyKS50b0JlKCdodHRwczovL2V4YW1wbGUuY29tL2F2YXRhci5qcGcnKTtcbiAgICAgIGV4cGVjdCh1c2VyLmhhc1VuY29tbWl0dGVkRXZlbnRzKCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodXNlci5nZXRVbmNvbW1pdHRlZEV2ZW50c0NvdW50KCkpLnRvQmUoMSk7XG4gICAgICBleHBlY3QodXNlci51bmNvbW1pdHRlZEV2ZW50c1swXSkudG9CZUluc3RhbmNlT2YoVXNlclByb2ZpbGVVcGRhdGVkRXZlbnQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgcGFydGlhbCBwcm9maWxlJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcHJvZmlsZSA9IHtcbiAgICAgICAgbmFtZTogJ05ldyBOYW1lJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIEFjdFxuICAgICAgdXNlci51cGRhdGVQcm9maWxlKHByb2ZpbGUpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdCh1c2VyLm5hbWUpLnRvQmUoJ05ldyBOYW1lJyk7XG4gICAgICBleHBlY3QodXNlci5waG9uZSkudG9CZSgnJyk7IC8vIOacquabtOaWsO+8jOS/neaMgeWOn+WAvFxuICAgICAgZXhwZWN0KHVzZXIuYXZhdGFyKS50b0JlKCcnKTsgLy8g5pyq5pu05paw77yM5L+d5oyB5Y6f5YC8XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBlbXB0eSBuYW1lJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcHJvZmlsZSA9IHtcbiAgICAgICAgbmFtZTogJycsXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIHVzZXIudXBkYXRlUHJvZmlsZShwcm9maWxlKTtcbiAgICAgIH0pLnRvVGhyb3coJ+eUqOaIt+Wnk+WQjeS4jeiDveS4uuepuicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgaW52YWxpZCBwaG9uZScsICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHByb2ZpbGUgPSB7XG4gICAgICAgIHBob25lOiAnaW52YWxpZC1waG9uZScsXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIHVzZXIudXBkYXRlUHJvZmlsZShwcm9maWxlKTtcbiAgICAgIH0pLnRvVGhyb3coJ+eUteivneWPt+eggeagvOW8j+aXoOaViCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXZlbnQgc291cmNpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXN0b3JlIGZyb20gaGlzdG9yeSBldmVudHMnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VyID0gVXNlci5jcmVhdGUoJ3Rlc3RAZXhhbXBsZS5jb20nLCAnUGFzc3dvcmQxMjMhJywgJ1Rlc3QgVXNlcicpO1xuICAgICAgY29uc3QgZXZlbnRzID0gdXNlci51bmNvbW1pdHRlZEV2ZW50cztcbiAgICAgIHVzZXIubWFya0V2ZW50c0FzQ29tbWl0dGVkKCk7XG5cbiAgICAgIC8vIOWIm+W7uuaWsOeUqOaIt+WunuS+i1xuICAgICAgY29uc3QgcmVzdG9yZWRVc2VyID0gbmV3IFVzZXIodXNlci5pZCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgcmVzdG9yZWRVc2VyLmxvYWRGcm9tSGlzdG9yeShldmVudHMpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN0b3JlZFVzZXIuaWQpLnRvQmUodXNlci5pZCk7XG4gICAgICBleHBlY3QocmVzdG9yZWRVc2VyLmVtYWlsKS50b0JlKHVzZXIuZW1haWwpO1xuICAgICAgZXhwZWN0KHJlc3RvcmVkVXNlci5uYW1lKS50b0JlKHVzZXIubmFtZSk7XG4gICAgICBleHBlY3QocmVzdG9yZWRVc2VyLnN0YXR1cykudG9CZSh1c2VyLnN0YXR1cyk7XG4gICAgICBleHBlY3QocmVzdG9yZWRVc2VyLnZlcnNpb24pLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbmQgcmVzdG9yZSBzbmFwc2hvdCcsICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHVzZXIgPSBVc2VyLmNyZWF0ZSgndGVzdEBleGFtcGxlLmNvbScsICdQYXNzd29yZDEyMyEnLCAnVGVzdCBVc2VyJyk7XG4gICAgICB1c2VyLnVwZGF0ZVByb2ZpbGUoeyBuYW1lOiAnVXBkYXRlZCBOYW1lJyB9KTtcbiAgICAgIHVzZXIubWFya0V2ZW50c0FzQ29tbWl0dGVkKCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3Qgc25hcHNob3QgPSB1c2VyLmNyZWF0ZVNuYXBzaG90KCk7XG4gICAgICBjb25zdCByZXN0b3JlZFVzZXIgPSBuZXcgVXNlcih1c2VyLmlkKTtcbiAgICAgIHJlc3RvcmVkVXNlci5yZXN0b3JlRnJvbVNuYXBzaG90KHNuYXBzaG90KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdG9yZWRVc2VyLmlkKS50b0JlKHVzZXIuaWQpO1xuICAgICAgZXhwZWN0KHJlc3RvcmVkVXNlci5lbWFpbCkudG9CZSh1c2VyLmVtYWlsKTtcbiAgICAgIGV4cGVjdChyZXN0b3JlZFVzZXIubmFtZSkudG9CZSgnVXBkYXRlZCBOYW1lJyk7XG4gICAgICBleHBlY3QocmVzdG9yZWRVc2VyLnZlcnNpb24pLnRvQmUodXNlci52ZXJzaW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcnNpb24gY29udHJvbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluY3JlbWVudCB2ZXJzaW9uIG9uIGVhY2ggZXZlbnQnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1c2VyID0gVXNlci5jcmVhdGUoJ3Rlc3RAZXhhbXBsZS5jb20nLCAnUGFzc3dvcmQxMjMhJywgJ1Rlc3QgVXNlcicpO1xuICAgICAgZXhwZWN0KHVzZXIudmVyc2lvbikudG9CZSgxKTtcblxuICAgICAgLy8gQWN0XG4gICAgICB1c2VyLnVwZGF0ZVByb2ZpbGUoeyBuYW1lOiAnVXBkYXRlZCBOYW1lJyB9KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QodXNlci52ZXJzaW9uKS50b0JlKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiB2ZXJzaW9uIGNvbnNpc3RlbmN5JywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdXNlciA9IFVzZXIuY3JlYXRlKCd0ZXN0QGV4YW1wbGUuY29tJywgJ1Bhc3N3b3JkMTIzIScsICdUZXN0IFVzZXInKTtcbiAgICAgIGNvbnN0IGluaXRpYWxWZXJzaW9uID0gdXNlci52ZXJzaW9uO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIHVzZXIubWFya0V2ZW50c0FzQ29tbWl0dGVkKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHVzZXIudmVyc2lvbikudG9CZShpbml0aWFsVmVyc2lvbik7XG4gICAgICBleHBlY3QodXNlci5oYXNVbmNvbW1pdHRlZEV2ZW50cygpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==