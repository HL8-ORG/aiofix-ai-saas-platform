{"version":3,"names":["config_1","cov_2kugv80ois","s","require","exports","default","registerAs","f","connection","host","b","process","env","REDIS_HOST","port","parseInt","REDIS_PORT","password","REDIS_PASSWORD","undefined","db","REDIS_DB","keyPrefix","REDIS_KEY_PREFIX","pool","min","REDIS_POOL_MIN","max","REDIS_POOL_MAX","acquireTimeoutMillis","REDIS_ACQUIRE_TIMEOUT","createTimeoutMillis","REDIS_CREATE_TIMEOUT","destroyTimeoutMillis","REDIS_DESTROY_TIMEOUT","idleTimeoutMillis","REDIS_IDLE_TIMEOUT","reapIntervalMillis","REDIS_REAP_INTERVAL","createRetryIntervalMillis","REDIS_CREATE_RETRY_INTERVAL","cache","defaultTtl","REDIS_DEFAULT_TTL","sessionTtl","REDIS_SESSION_TTL","permissionTtl","REDIS_PERMISSION_TTL","tenantConfigTtl","REDIS_TENANT_CONFIG_TTL","maxMemory","REDIS_MAX_MEMORY","maxMemoryPolicy","REDIS_MAX_MEMORY_POLICY","lock","defaultTimeout","REDIS_LOCK_TIMEOUT","retryDelay","REDIS_LOCK_RETRY_DELAY","retryCount","REDIS_LOCK_RETRY_COUNT","cluster","enabled","REDIS_CLUSTER_ENABLED","nodes","REDIS_CLUSTER_NODES","split","maxRedirections","REDIS_CLUSTER_MAX_REDIRECTIONS","sentinel","REDIS_SENTINEL_ENABLED","masterName","REDIS_SENTINEL_MASTER_NAME","sentinels","REDIS_SENTINEL_HOSTS","REDIS_SENTINEL_PASSWORD","health","REDIS_HEALTH_CHECK_ENABLED","interval","REDIS_HEALTH_CHECK_INTERVAL","timeout","REDIS_HEALTH_CHECK_TIMEOUT"],"sources":["/home/arligle/V1/Aiofix/aiofix-ai-saas-platform/packages/config/src/config/redis.ts"],"sourcesContent":["import { registerAs } from '@nestjs/config';\n\n/**\n * Redis Configuration\n *\n * Redis缓存配置模块，定义IAM系统的缓存策略和连接参数。\n * 支持多级缓存、分布式锁、会话存储等功能。\n *\n * 主要原理与机制如下：\n * 1. 使用@nestjs/config的registerAs创建命名空间配置\n * 2. 从环境变量读取Redis连接参数\n * 3. 提供默认值确保配置的完整性\n * 4. 支持集群和哨兵模式\n *\n * 功能与业务规则：\n * 1. Redis连接配置\n * 2. 缓存策略配置\n * 3. 分布式锁配置\n * 4. 会话存储配置\n *\n * @returns Redis配置对象\n */\nexport default registerAs('redis', () => ({\n  /**\n   * Redis连接配置\n   */\n  connection: {\n    host: process.env.REDIS_HOST || 'localhost',\n    port: parseInt(process.env.REDIS_PORT || '6379', 10),\n    password: process.env.REDIS_PASSWORD || undefined,\n    db: parseInt(process.env.REDIS_DB || '0', 10),\n    keyPrefix: process.env.REDIS_KEY_PREFIX || 'aiofix:iam:',\n  },\n\n  /**\n   * 连接池配置\n   */\n  pool: {\n    min: parseInt(process.env.REDIS_POOL_MIN || '2', 10),\n    max: parseInt(process.env.REDIS_POOL_MAX || '10', 10),\n    acquireTimeoutMillis: parseInt(\n      process.env.REDIS_ACQUIRE_TIMEOUT || '30000',\n      10,\n    ),\n    createTimeoutMillis: parseInt(\n      process.env.REDIS_CREATE_TIMEOUT || '30000',\n      10,\n    ),\n    destroyTimeoutMillis: parseInt(\n      process.env.REDIS_DESTROY_TIMEOUT || '5000',\n      10,\n    ),\n    idleTimeoutMillis: parseInt(process.env.REDIS_IDLE_TIMEOUT || '30000', 10),\n    reapIntervalMillis: parseInt(process.env.REDIS_REAP_INTERVAL || '1000', 10),\n    createRetryIntervalMillis: parseInt(\n      process.env.REDIS_CREATE_RETRY_INTERVAL || '200',\n      10,\n    ),\n  },\n\n  /**\n   * 缓存策略配置\n   */\n  cache: {\n    /**\n     * 默认TTL（秒）\n     */\n    defaultTtl: parseInt(process.env.REDIS_DEFAULT_TTL || '3600', 10),\n\n    /**\n     * 用户会话TTL（秒）\n     */\n    sessionTtl: parseInt(process.env.REDIS_SESSION_TTL || '86400', 10),\n\n    /**\n     * 权限缓存TTL（秒）\n     */\n    permissionTtl: parseInt(process.env.REDIS_PERMISSION_TTL || '1800', 10),\n\n    /**\n     * 租户配置TTL（秒）\n     */\n    tenantConfigTtl: parseInt(\n      process.env.REDIS_TENANT_CONFIG_TTL || '3600',\n      10,\n    ),\n\n    /**\n     * 最大内存使用量（字节）\n     */\n    maxMemory: process.env.REDIS_MAX_MEMORY || '2gb',\n\n    /**\n     * 内存策略\n     */\n    maxMemoryPolicy: process.env.REDIS_MAX_MEMORY_POLICY || 'allkeys-lru',\n  },\n\n  /**\n   * 分布式锁配置\n   */\n  lock: {\n    /**\n     * 锁默认超时时间（毫秒）\n     */\n    defaultTimeout: parseInt(process.env.REDIS_LOCK_TIMEOUT || '30000', 10),\n\n    /**\n     * 锁重试间隔（毫秒）\n     */\n    retryDelay: parseInt(process.env.REDIS_LOCK_RETRY_DELAY || '100', 10),\n\n    /**\n     * 锁重试次数\n     */\n    retryCount: parseInt(process.env.REDIS_LOCK_RETRY_COUNT || '10', 10),\n  },\n\n  /**\n   * 集群配置\n   */\n  cluster: {\n    enabled: process.env.REDIS_CLUSTER_ENABLED === 'true',\n    nodes: process.env.REDIS_CLUSTER_NODES?.split(',') || [],\n    maxRedirections: parseInt(\n      process.env.REDIS_CLUSTER_MAX_REDIRECTIONS || '16',\n      10,\n    ),\n  },\n\n  /**\n   * 哨兵配置\n   */\n  sentinel: {\n    enabled: process.env.REDIS_SENTINEL_ENABLED === 'true',\n    masterName: process.env.REDIS_SENTINEL_MASTER_NAME || 'mymaster',\n    sentinels: process.env.REDIS_SENTINEL_HOSTS?.split(',') || [],\n    password: process.env.REDIS_SENTINEL_PASSWORD || undefined,\n  },\n\n  /**\n   * 健康检查配置\n   */\n  health: {\n    enabled: process.env.REDIS_HEALTH_CHECK_ENABLED !== 'false',\n    interval: parseInt(process.env.REDIS_HEALTH_CHECK_INTERVAL || '30000', 10),\n    timeout: parseInt(process.env.REDIS_HEALTH_CHECK_TIMEOUT || '5000', 10),\n  },\n}));\n"],"mappings":"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","ignoreList":[]}