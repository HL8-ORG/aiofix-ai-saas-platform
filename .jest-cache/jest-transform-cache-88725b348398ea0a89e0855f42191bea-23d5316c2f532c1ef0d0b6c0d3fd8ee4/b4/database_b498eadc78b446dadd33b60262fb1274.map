{"version":3,"names":["config_1","cov_p1kkf46pa","s","require","exports","default","registerAs","f","type","b","process","env","DB_TYPE","postgresql","host","DB_HOST","port","parseInt","DB_PORT","username","DB_USERNAME","password","DB_PASSWORD","database","DB_NAME","schema","DB_SCHEMA","ssl","DB_SSL","sslMode","DB_SSL_MODE","mongodb","uri","MONGODB_URI","MONGODB_DATABASE","options","useNewUrlParser","useUnifiedTopology","pool","min","DB_POOL_MIN","max","DB_POOL_MAX","acquireTimeoutMillis","DB_ACQUIRE_TIMEOUT","createTimeoutMillis","DB_CREATE_TIMEOUT","destroyTimeoutMillis","DB_DESTROY_TIMEOUT","idleTimeoutMillis","DB_IDLE_TIMEOUT","reapIntervalMillis","DB_REAP_INTERVAL","createRetryIntervalMillis","DB_CREATE_RETRY_INTERVAL","sync","synchronize","DB_SYNCHRONIZE","migrationsRun","DB_MIGRATIONS_RUN","migrationsDir","DB_MIGRATIONS_DIR","migrationsTableName","DB_MIGRATIONS_TABLE","logging","enabled","DB_LOGGING","level","DB_LOG_LEVEL","slowQueryThreshold","DB_SLOW_QUERY_THRESHOLD"],"sources":["/home/arligle/V1/Aiofix/aiofix-ai-saas-platform/packages/config/src/config/database.ts"],"sourcesContent":["import { registerAs } from '@nestjs/config';\n\n/**\n * Database Configuration\n *\n * 数据库配置模块，定义IAM系统的数据库连接和配置参数。\n * 支持PostgreSQL作为主数据库，MongoDB作为事件存储。\n *\n * 主要原理与机制如下：\n * 1. 使用@nestjs/config的registerAs创建命名空间配置\n * 2. 从环境变量读取数据库连接参数\n * 3. 提供默认值确保配置的完整性\n * 4. 支持多环境配置（开发、测试、生产）\n *\n * 功能与业务规则：\n * 1. PostgreSQL主数据库配置\n * 2. MongoDB事件存储配置\n * 3. 连接池和性能优化配置\n * 4. 数据库迁移和同步配置\n *\n * @returns 数据库配置对象\n */\nexport default registerAs('database', () => ({\n  /**\n   * 主数据库类型\n   */\n  type: process.env.DB_TYPE || 'postgresql',\n\n  /**\n   * PostgreSQL主数据库配置\n   */\n  postgresql: {\n    host: process.env.DB_HOST || 'localhost',\n    port: parseInt(process.env.DB_PORT || '5432', 10),\n    username: process.env.DB_USERNAME || 'postgres',\n    password: process.env.DB_PASSWORD || 'password',\n    database: process.env.DB_NAME || 'aiofix_iam',\n    schema: process.env.DB_SCHEMA || 'public',\n    ssl: process.env.DB_SSL === 'true',\n    sslMode: process.env.DB_SSL_MODE || 'prefer',\n  },\n\n  /**\n   * MongoDB事件存储配置\n   */\n  mongodb: {\n    uri:\n      process.env.MONGODB_URI || 'mongodb://localhost:27017/aiofix_iam_events',\n    database: process.env.MONGODB_DATABASE || 'aiofix_iam_events',\n    options: {\n      useNewUrlParser: true,\n      useUnifiedTopology: true,\n    },\n  },\n\n  /**\n   * 连接池配置\n   */\n  pool: {\n    min: parseInt(process.env.DB_POOL_MIN || '2', 10),\n    max: parseInt(process.env.DB_POOL_MAX || '20', 10),\n    acquireTimeoutMillis: parseInt(\n      process.env.DB_ACQUIRE_TIMEOUT || '60000',\n      10,\n    ),\n    createTimeoutMillis: parseInt(process.env.DB_CREATE_TIMEOUT || '30000', 10),\n    destroyTimeoutMillis: parseInt(\n      process.env.DB_DESTROY_TIMEOUT || '5000',\n      10,\n    ),\n    idleTimeoutMillis: parseInt(process.env.DB_IDLE_TIMEOUT || '30000', 10),\n    reapIntervalMillis: parseInt(process.env.DB_REAP_INTERVAL || '1000', 10),\n    createRetryIntervalMillis: parseInt(\n      process.env.DB_CREATE_RETRY_INTERVAL || '200',\n      10,\n    ),\n  },\n\n  /**\n   * 同步和迁移配置\n   */\n  sync: {\n    synchronize: process.env.DB_SYNCHRONIZE === 'true',\n    migrationsRun: process.env.DB_MIGRATIONS_RUN !== 'false',\n    migrationsDir: process.env.DB_MIGRATIONS_DIR || 'src/migrations',\n    migrationsTableName: process.env.DB_MIGRATIONS_TABLE || 'migrations',\n  },\n\n  /**\n   * 日志配置\n   */\n  logging: {\n    enabled: process.env.DB_LOGGING === 'true',\n    level: process.env.DB_LOG_LEVEL || 'error',\n    slowQueryThreshold: parseInt(\n      process.env.DB_SLOW_QUERY_THRESHOLD || '1000',\n      10,\n    ),\n  },\n}));\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,QAAA;AAAA;AAAA,CAAAC,aAAA,GAAAC,CAAA,OAAAC,OAAA;AAEA;;;;;;;;;;;;;;;;;;;;AAAA;AAAAF,aAAA,GAAAC,CAAA;AAoBAE,OAAA,CAAAC,OAAA,GAAe,IAAAL,QAAA,CAAAM,UAAU,EAAC,UAAU,EAAE,MAAO;EAAA;EAAAL,aAAA,GAAAM,CAAA;EAAAN,aAAA,GAAAC,CAAA;EAAA;IAC3C;;;IAGAM,IAAI;IAAE;IAAA,CAAAP,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACC,OAAO;IAAA;IAAA,CAAAX,aAAA,GAAAQ,CAAA,UAAI,YAAY;IAEzC;;;IAGAI,UAAU,EAAE;MACVC,IAAI;MAAE;MAAA,CAAAb,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACI,OAAO;MAAA;MAAA,CAAAd,aAAA,GAAAQ,CAAA,UAAI,WAAW;MACxCO,IAAI,EAAEC,QAAQ;MAAC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACO,OAAO;MAAA;MAAA,CAAAjB,aAAA,GAAAQ,CAAA,UAAI,MAAM,GAAE,EAAE,CAAC;MACjDU,QAAQ;MAAE;MAAA,CAAAlB,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACS,WAAW;MAAA;MAAA,CAAAnB,aAAA,GAAAQ,CAAA,UAAI,UAAU;MAC/CY,QAAQ;MAAE;MAAA,CAAApB,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACW,WAAW;MAAA;MAAA,CAAArB,aAAA,GAAAQ,CAAA,UAAI,UAAU;MAC/Cc,QAAQ;MAAE;MAAA,CAAAtB,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACa,OAAO;MAAA;MAAA,CAAAvB,aAAA,GAAAQ,CAAA,UAAI,YAAY;MAC7CgB,MAAM;MAAE;MAAA,CAAAxB,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACe,SAAS;MAAA;MAAA,CAAAzB,aAAA,GAAAQ,CAAA,UAAI,QAAQ;MACzCkB,GAAG,EAAEjB,OAAO,CAACC,GAAG,CAACiB,MAAM,KAAK,MAAM;MAClCC,OAAO;MAAE;MAAA,CAAA5B,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACmB,WAAW;MAAA;MAAA,CAAA7B,aAAA,GAAAQ,CAAA,UAAI,QAAQ;KAC7C;IAED;;;IAGAsB,OAAO,EAAE;MACPC,GAAG;MACD;MAAA,CAAA/B,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACsB,WAAW;MAAA;MAAA,CAAAhC,aAAA,GAAAQ,CAAA,UAAI,6CAA6C;MAC1Ec,QAAQ;MAAE;MAAA,CAAAtB,aAAA,GAAAQ,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACuB,gBAAgB;MAAA;MAAA,CAAAjC,aAAA,GAAAQ,CAAA,UAAI,mBAAmB;MAC7D0B,OAAO,EAAE;QACPC,eAAe,EAAE,IAAI;QACrBC,kBAAkB,EAAE;;KAEvB;IAED;;;IAGAC,IAAI,EAAE;MACJC,GAAG,EAAEtB,QAAQ;MAAC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAAC6B,WAAW;MAAA;MAAA,CAAAvC,aAAA,GAAAQ,CAAA,WAAI,GAAG,GAAE,EAAE,CAAC;MACjDgC,GAAG,EAAExB,QAAQ;MAAC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAAC+B,WAAW;MAAA;MAAA,CAAAzC,aAAA,GAAAQ,CAAA,WAAI,IAAI,GAAE,EAAE,CAAC;MAClDkC,oBAAoB,EAAE1B,QAAQ;MAC5B;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACiC,kBAAkB;MAAA;MAAA,CAAA3C,aAAA,GAAAQ,CAAA,WAAI,OAAO,GACzC,EAAE,CACH;MACDoC,mBAAmB,EAAE5B,QAAQ;MAAC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACmC,iBAAiB;MAAA;MAAA,CAAA7C,aAAA,GAAAQ,CAAA,WAAI,OAAO,GAAE,EAAE,CAAC;MAC3EsC,oBAAoB,EAAE9B,QAAQ;MAC5B;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACqC,kBAAkB;MAAA;MAAA,CAAA/C,aAAA,GAAAQ,CAAA,WAAI,MAAM,GACxC,EAAE,CACH;MACDwC,iBAAiB,EAAEhC,QAAQ;MAAC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACuC,eAAe;MAAA;MAAA,CAAAjD,aAAA,GAAAQ,CAAA,WAAI,OAAO,GAAE,EAAE,CAAC;MACvE0C,kBAAkB,EAAElC,QAAQ;MAAC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACyC,gBAAgB;MAAA;MAAA,CAAAnD,aAAA,GAAAQ,CAAA,WAAI,MAAM,GAAE,EAAE,CAAC;MACxE4C,yBAAyB,EAAEpC,QAAQ;MACjC;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAAC2C,wBAAwB;MAAA;MAAA,CAAArD,aAAA,GAAAQ,CAAA,WAAI,KAAK,GAC7C,EAAE;KAEL;IAED;;;IAGA8C,IAAI,EAAE;MACJC,WAAW,EAAE9C,OAAO,CAACC,GAAG,CAAC8C,cAAc,KAAK,MAAM;MAClDC,aAAa,EAAEhD,OAAO,CAACC,GAAG,CAACgD,iBAAiB,KAAK,OAAO;MACxDC,aAAa;MAAE;MAAA,CAAA3D,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACkD,iBAAiB;MAAA;MAAA,CAAA5D,aAAA,GAAAQ,CAAA,WAAI,gBAAgB;MAChEqD,mBAAmB;MAAE;MAAA,CAAA7D,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACoD,mBAAmB;MAAA;MAAA,CAAA9D,aAAA,GAAAQ,CAAA,WAAI,YAAY;KACrE;IAED;;;IAGAuD,OAAO,EAAE;MACPC,OAAO,EAAEvD,OAAO,CAACC,GAAG,CAACuD,UAAU,KAAK,MAAM;MAC1CC,KAAK;MAAE;MAAA,CAAAlE,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACyD,YAAY;MAAA;MAAA,CAAAnE,aAAA,GAAAQ,CAAA,WAAI,OAAO;MAC1C4D,kBAAkB,EAAEpD,QAAQ;MAC1B;MAAA,CAAAhB,aAAA,GAAAQ,CAAA,WAAAC,OAAO,CAACC,GAAG,CAAC2D,uBAAuB;MAAA;MAAA,CAAArE,aAAA,GAAAQ,CAAA,WAAI,MAAM,GAC7C,EAAE;;GAGP;CAAC,CAAC","ignoreList":[]}