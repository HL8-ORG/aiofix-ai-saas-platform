e4c3546d004e8e75c231dd8c238b564d
"use strict";
/**
 * @file redis.config.spec.ts
 * @description Redis配置服务单元测试
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const config_1 = require("@nestjs/config");
const redis_config_1 = require("./redis.config");
describe('RedisConfigService', () => {
    let service;
    let configService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            imports: [config_1.ConfigModule],
            providers: [redis_config_1.RedisConfigService],
        }).compile();
        service = module.get(redis_config_1.RedisConfigService);
        configService = module.get(config_1.ConfigService);
    });
    describe('getCacheConfig', () => {
        it('should return default cache configuration', () => {
            jest.spyOn(configService, 'get').mockReturnValue(undefined);
            const config = service.getCacheConfig();
            expect(config).toEqual({
                host: 'localhost',
                port: 6379,
                password: 'aiofix_password',
                db: 0,
                keyPrefix: 'aiofix:cache:',
                ttl: 3600,
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                maxRetriesPerRequest: 3,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                retryDelayOnFailover: 100,
                enableOfflineQueue: false,
            });
        });
        it('should return configured cache configuration', () => {
            jest.spyOn(configService, 'get').mockImplementation((key) => {
                const configs = {
                    REDIS_HOST: 'redis-host',
                    REDIS_PORT: '6380',
                    REDIS_PASSWORD: 'redis_password',
                    REDIS_CACHE_DB: '1',
                    REDIS_CACHE_PREFIX: 'custom:cache:',
                    REDIS_CACHE_TTL: '7200',
                    REDIS_MAX_RETRIES: '5',
                    REDIS_RETRY_DELAY: '200',
                    REDIS_CONNECT_TIMEOUT: '15000',
                    REDIS_COMMAND_TIMEOUT: '8000',
                };
                return configs[key];
            });
            const config = service.getCacheConfig();
            expect(config).toEqual({
                host: 'redis-host',
                port: 6380,
                password: 'redis_password',
                db: 1,
                keyPrefix: 'custom:cache:',
                ttl: 7200,
                maxRetriesPerRequest: 5,
                retryDelayOnFailover: 200,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 15000,
                commandTimeout: 8000,
                enableOfflineQueue: false,
            });
        });
    });
    describe('getMessageQueueConfig', () => {
        it('should return default message queue configuration', () => {
            jest.spyOn(configService, 'get').mockReturnValue(undefined);
            const config = service.getMessageQueueConfig();
            expect(config).toEqual({
                host: 'localhost',
                port: 6379,
                password: 'aiofix_password',
                db: 1,
                keyPrefix: 'aiofix:queue:',
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            });
        });
        it('should return configured message queue configuration', () => {
            jest.spyOn(configService, 'get').mockImplementation((key) => {
                const configs = {
                    REDIS_HOST: 'redis-host',
                    REDIS_PORT: '6380',
                    REDIS_PASSWORD: 'redis_password',
                    REDIS_QUEUE_DB: '2',
                    REDIS_QUEUE_PREFIX: 'custom:queue:',
                    REDIS_MAX_RETRIES: '5',
                    REDIS_RETRY_DELAY: '200',
                };
                return configs[key];
            });
            const config = service.getMessageQueueConfig();
            expect(config).toEqual({
                host: 'redis-host',
                port: 6380,
                password: 'redis_password',
                db: 2,
                keyPrefix: 'custom:queue:',
                maxRetriesPerRequest: 5,
                retryDelayOnFailover: 200,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            });
        });
    });
    describe('getSessionConfig', () => {
        it('should return default session configuration', () => {
            jest.spyOn(configService, 'get').mockReturnValue(undefined);
            const config = service.getSessionConfig();
            expect(config).toEqual({
                host: 'localhost',
                port: 6379,
                password: 'aiofix_password',
                db: 2,
                keyPrefix: 'aiofix:session:',
                ttl: 86400,
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            });
        });
        it('should return configured session configuration', () => {
            jest.spyOn(configService, 'get').mockImplementation((key) => {
                const configs = {
                    REDIS_HOST: 'redis-host',
                    REDIS_PORT: '6380',
                    REDIS_PASSWORD: 'redis_password',
                    REDIS_SESSION_DB: '3',
                    REDIS_SESSION_PREFIX: 'custom:session:',
                    REDIS_SESSION_TTL: '172800',
                };
                return configs[key];
            });
            const config = service.getSessionConfig();
            expect(config).toEqual({
                host: 'redis-host',
                port: 6380,
                password: 'redis_password',
                db: 3,
                keyPrefix: 'custom:session:',
                ttl: 172800,
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            });
        });
    });
    describe('validateConfig', () => {
        it('should validate correct Redis config', () => {
            const config = {
                host: 'localhost',
                port: 6379,
                password: 'password',
                db: 0,
                keyPrefix: 'test:',
                ttl: 3600,
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            };
            const isValid = service.validateConfig(config);
            expect(isValid).toBe(true);
        });
        it('should reject config with missing required fields', () => {
            const config = {
                host: 'localhost',
                // 缺少 port, password, db 等必需字段
            };
            const isValid = service.validateConfig(config);
            expect(isValid).toBe(false);
        });
        it('should reject config with invalid port', () => {
            const config = {
                host: 'localhost',
                port: 'invalid',
                password: 'password',
                db: 0,
                keyPrefix: 'test:',
                ttl: 3600,
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            };
            const isValid = service.validateConfig(config);
            expect(isValid).toBe(false);
        });
        it('should reject config with invalid db number', () => {
            const config = {
                host: 'localhost',
                port: 6379,
                password: 'password',
                db: 'invalid',
                keyPrefix: 'test:',
                ttl: 3600,
                maxRetriesPerRequest: 3,
                retryDelayOnFailover: 100,
                enableReadyCheck: true,
                lazyConnect: true,
                keepAlive: 30000,
                family: 4,
                connectTimeout: 10000,
                commandTimeout: 5000,
                enableOfflineQueue: false,
            };
            const isValid = service.validateConfig(config);
            expect(isValid).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvZGF0YWJhc2Uvc3JjL2NvbmZpZy9yZWRpcy5jb25maWcuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQUVILDZDQUFzRDtBQUN0RCwyQ0FBNkQ7QUFDN0QsaURBQW9EO0FBRXBELFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsSUFBSSxPQUEyQixDQUFDO0lBQ2hDLElBQUksYUFBNEIsQ0FBQztJQUVqQyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELE9BQU8sRUFBRSxDQUFDLHFCQUFZLENBQUM7WUFDdkIsU0FBUyxFQUFFLENBQUMsaUNBQWtCLENBQUM7U0FDaEMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQXFCLGlDQUFrQixDQUFDLENBQUM7UUFDN0QsYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWdCLHNCQUFhLENBQUMsQ0FBQztJQUMzRCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtZQUNuRCxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFNUQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBRXhDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQ3JCLElBQUksRUFBRSxXQUFXO2dCQUNqQixJQUFJLEVBQUUsSUFBSTtnQkFDVixRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQixFQUFFLEVBQUUsQ0FBQztnQkFDTCxTQUFTLEVBQUUs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QUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLE1BQU0sR0FBRztnQkFDYixJQUFJLEVBQUUsV0FBVztnQkFDakIsSUFBSSxFQUFFLElBQUk7Z0JBQ1YsUUFBUSxFQUFFLFVBQVU7Z0JBQ3BCLEVBQUUsRUFBRSxTQUFnQjtnQkFDcEIsU0FBUyxFQUFFLE9BQU87Z0JBQ2xCLEdBQUcsRUFBRSxJQUFJO2dCQUNULG9CQUFvQixFQUFFLENBQUM7Z0JBQ3ZCLG9CQUFvQixFQUFFLEdBQUc7Z0JBQ3pCLGdCQUFnQixFQUFFLElBQUk7Z0JBQ3RCLFdBQVcsRUFBRSxJQUFJO2dCQUNqQixTQUFTLEVBQUUsS0FBSztnQkFDaEIsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsY0FBYyxFQUFFLEtBQUs7Z0JBQ3JCLGNBQWMsRUFBRSxJQUFJO2dCQUNwQixrQkFBa0IsRUFBRSxLQUFLO2FBQzFCLENBQUM7WUFFRixNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2FybGlnbGUvVjEvQWlvZml4L2Fpb2ZpeC1haS1zYWFzLXBsYXRmb3JtL3BhY2thZ2VzL2RhdGFiYXNlL3NyYy9jb25maWcvcmVkaXMuY29uZmlnLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSByZWRpcy5jb25maWcuc3BlYy50c1xuICogQGRlc2NyaXB0aW9uIFJlZGlz6YWN572u5pyN5Yqh5Y2V5YWD5rWL6K+VXG4gKi9cblxuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBDb25maWdNb2R1bGUsIENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBSZWRpc0NvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL3JlZGlzLmNvbmZpZyc7XG5cbmRlc2NyaWJlKCdSZWRpc0NvbmZpZ1NlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBSZWRpc0NvbmZpZ1NlcnZpY2U7XG4gIGxldCBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBpbXBvcnRzOiBbQ29uZmlnTW9kdWxlXSxcbiAgICAgIHByb3ZpZGVyczogW1JlZGlzQ29uZmlnU2VydmljZV0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8UmVkaXNDb25maWdTZXJ2aWNlPihSZWRpc0NvbmZpZ1NlcnZpY2UpO1xuICAgIGNvbmZpZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbmZpZ1NlcnZpY2U+KENvbmZpZ1NlcnZpY2UpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0Q2FjaGVDb25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBjYWNoZSBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCAnZ2V0JykubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHNlcnZpY2UuZ2V0Q2FjaGVDb25maWcoKTtcblxuICAgICAgZXhwZWN0KGNvbmZpZykudG9FcXVhbCh7XG4gICAgICAgIGhvc3Q6ICdsb2NhbGhvc3QnLFxuICAgICAgICBwb3J0OiA2Mzc5LFxuICAgICAgICBwYXNzd29yZDogJ2Fpb2ZpeF9wYXNzd29yZCcsXG4gICAgICAgIGRiOiAwLFxuICAgICAgICBrZXlQcmVmaXg6ICdhaW9maXg6Y2FjaGU6JyxcbiAgICAgICAgdHRsOiAzNjAwLFxuICAgICAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogMyxcbiAgICAgICAgcmV0cnlEZWxheU9uRmFpbG92ZXI6IDEwMCxcbiAgICAgICAgZW5hYmxlUmVhZHlDaGVjazogdHJ1ZSxcbiAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDMsXG4gICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICBrZWVwQWxpdmU6IDMwMDAwLFxuICAgICAgICBmYW1pbHk6IDQsXG4gICAgICAgIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gICAgICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAxMDAsXG4gICAgICAgIGVuYWJsZU9mZmxpbmVRdWV1ZTogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbmZpZ3VyZWQgY2FjaGUgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oY29uZmlnU2VydmljZSwgJ2dldCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgY29uZmlnczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgICBSRURJU19IT1NUOiAncmVkaXMtaG9zdCcsXG4gICAgICAgICAgUkVESVNfUE9SVDogJzYzODAnLFxuICAgICAgICAgIFJFRElTX1BBU1NXT1JEOiAncmVkaXNfcGFzc3dvcmQnLFxuICAgICAgICAgIFJFRElTX0NBQ0hFX0RCOiAnMScsXG4gICAgICAgICAgUkVESVNfQ0FDSEVfUFJFRklYOiAnY3VzdG9tOmNhY2hlOicsXG4gICAgICAgICAgUkVESVNfQ0FDSEVfVFRMOiAnNzIwMCcsXG4gICAgICAgICAgUkVESVNfTUFYX1JFVFJJRVM6ICc1JyxcbiAgICAgICAgICBSRURJU19SRVRSWV9ERUxBWTogJzIwMCcsXG4gICAgICAgICAgUkVESVNfQ09OTkVDVF9USU1FT1VUOiAnMTUwMDAnLFxuICAgICAgICAgIFJFRElTX0NPTU1BTkRfVElNRU9VVDogJzgwMDAnLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY29uZmlnc1trZXldO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHNlcnZpY2UuZ2V0Q2FjaGVDb25maWcoKTtcblxuICAgICAgZXhwZWN0KGNvbmZpZykudG9FcXVhbCh7XG4gICAgICAgIGhvc3Q6ICdyZWRpcy1ob3N0JyxcbiAgICAgICAgcG9ydDogNjM4MCxcbiAgICAgICAgcGFzc3dvcmQ6ICdyZWRpc19wYXNzd29yZCcsXG4gICAgICAgIGRiOiAxLFxuICAgICAgICBrZXlQcmVmaXg6ICdjdXN0b206Y2FjaGU6JyxcbiAgICAgICAgdHRsOiA3MjAwLFxuICAgICAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogNSxcbiAgICAgICAgcmV0cnlEZWxheU9uRmFpbG92ZXI6IDIwMCxcbiAgICAgICAgZW5hYmxlUmVhZHlDaGVjazogdHJ1ZSxcbiAgICAgICAgbGF6eUNvbm5lY3Q6IHRydWUsXG4gICAgICAgIGtlZXBBbGl2ZTogMzAwMDAsXG4gICAgICAgIGZhbWlseTogNCxcbiAgICAgICAgY29ubmVjdFRpbWVvdXQ6IDE1MDAwLFxuICAgICAgICBjb21tYW5kVGltZW91dDogODAwMCxcbiAgICAgICAgZW5hYmxlT2ZmbGluZVF1ZXVlOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0TWVzc2FnZVF1ZXVlQ29uZmlnJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgbWVzc2FnZSBxdWV1ZSBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCAnZ2V0JykubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHNlcnZpY2UuZ2V0TWVzc2FnZVF1ZXVlQ29uZmlnKCk7XG5cbiAgICAgIGV4cGVjdChjb25maWcpLnRvRXF1YWwoe1xuICAgICAgICBob3N0OiAnbG9jYWxob3N0JyxcbiAgICAgICAgcG9ydDogNjM3OSxcbiAgICAgICAgcGFzc3dvcmQ6ICdhaW9maXhfcGFzc3dvcmQnLFxuICAgICAgICBkYjogMSxcbiAgICAgICAga2V5UHJlZml4OiAnYWlvZml4OnF1ZXVlOicsXG4gICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxuICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxuICAgICAgICBlbmFibGVSZWFkeUNoZWNrOiB0cnVlLFxuICAgICAgICBsYXp5Q29ubmVjdDogdHJ1ZSxcbiAgICAgICAga2VlcEFsaXZlOiAzMDAwMCxcbiAgICAgICAgZmFtaWx5OiA0LFxuICAgICAgICBjb25uZWN0VGltZW91dDogMTAwMDAsXG4gICAgICAgIGNvbW1hbmRUaW1lb3V0OiA1MDAwLFxuICAgICAgICBlbmFibGVPZmZsaW5lUXVldWU6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb25maWd1cmVkIG1lc3NhZ2UgcXVldWUgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oY29uZmlnU2VydmljZSwgJ2dldCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgY29uZmlnczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgICBSRURJU19IT1NUOiAncmVkaXMtaG9zdCcsXG4gICAgICAgICAgUkVESVNfUE9SVDogJzYzODAnLFxuICAgICAgICAgIFJFRElTX1BBU1NXT1JEOiAncmVkaXNfcGFzc3dvcmQnLFxuICAgICAgICAgIFJFRElTX1FVRVVFX0RCOiAnMicsXG4gICAgICAgICAgUkVESVNfUVVFVUVfUFJFRklYOiAnY3VzdG9tOnF1ZXVlOicsXG4gICAgICAgICAgUkVESVNfTUFYX1JFVFJJRVM6ICc1JyxcbiAgICAgICAgICBSRURJU19SRVRSWV9ERUxBWTogJzIwMCcsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjb25maWdzW2tleV07XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY29uZmlnID0gc2VydmljZS5nZXRNZXNzYWdlUXVldWVDb25maWcoKTtcblxuICAgICAgZXhwZWN0KGNvbmZpZykudG9FcXVhbCh7XG4gICAgICAgIGhvc3Q6ICdyZWRpcy1ob3N0JyxcbiAgICAgICAgcG9ydDogNjM4MCxcbiAgICAgICAgcGFzc3dvcmQ6ICdyZWRpc19wYXNzd29yZCcsXG4gICAgICAgIGRiOiAyLFxuICAgICAgICBrZXlQcmVmaXg6ICdjdXN0b206cXVldWU6JyxcbiAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDUsXG4gICAgICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAyMDAsXG4gICAgICAgIGVuYWJsZVJlYWR5Q2hlY2s6IHRydWUsXG4gICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICBrZWVwQWxpdmU6IDMwMDAwLFxuICAgICAgICBmYW1pbHk6IDQsXG4gICAgICAgIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gICAgICAgIGVuYWJsZU9mZmxpbmVRdWV1ZTogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFNlc3Npb25Db25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBzZXNzaW9uIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKGNvbmZpZ1NlcnZpY2UsICdnZXQnKS5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgY29uc3QgY29uZmlnID0gc2VydmljZS5nZXRTZXNzaW9uQ29uZmlnKCk7XG5cbiAgICAgIGV4cGVjdChjb25maWcpLnRvRXF1YWwoe1xuICAgICAgICBob3N0OiAnbG9jYWxob3N0JyxcbiAgICAgICAgcG9ydDogNjM3OSxcbiAgICAgICAgcGFzc3dvcmQ6ICdhaW9maXhfcGFzc3dvcmQnLFxuICAgICAgICBkYjogMixcbiAgICAgICAga2V5UHJlZml4OiAnYWlvZml4OnNlc3Npb246JyxcbiAgICAgICAgdHRsOiA4NjQwMCxcbiAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDMsXG4gICAgICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAxMDAsXG4gICAgICAgIGVuYWJsZVJlYWR5Q2hlY2s6IHRydWUsXG4gICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICBrZWVwQWxpdmU6IDMwMDAwLFxuICAgICAgICBmYW1pbHk6IDQsXG4gICAgICAgIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gICAgICAgIGVuYWJsZU9mZmxpbmVRdWV1ZTogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbmZpZ3VyZWQgc2Vzc2lvbiBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCAnZ2V0JykubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBjb25maWdzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgICAgIFJFRElTX0hPU1Q6ICdyZWRpcy1ob3N0JyxcbiAgICAgICAgICBSRURJU19QT1JUOiAnNjM4MCcsXG4gICAgICAgICAgUkVESVNfUEFTU1dPUkQ6ICdyZWRpc19wYXNzd29yZCcsXG4gICAgICAgICAgUkVESVNfU0VTU0lPTl9EQjogJzMnLFxuICAgICAgICAgIFJFRElTX1NFU1NJT05fUFJFRklYOiAnY3VzdG9tOnNlc3Npb246JyxcbiAgICAgICAgICBSRURJU19TRVNTSU9OX1RUTDogJzE3MjgwMCcsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjb25maWdzW2tleV07XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY29uZmlnID0gc2VydmljZS5nZXRTZXNzaW9uQ29uZmlnKCk7XG5cbiAgICAgIGV4cGVjdChjb25maWcpLnRvRXF1YWwoe1xuICAgICAgICBob3N0OiAncmVkaXMtaG9zdCcsXG4gICAgICAgIHBvcnQ6IDYzODAsXG4gICAgICAgIHBhc3N3b3JkOiAncmVkaXNfcGFzc3dvcmQnLFxuICAgICAgICBkYjogMyxcbiAgICAgICAga2V5UHJlZml4OiAnY3VzdG9tOnNlc3Npb246JyxcbiAgICAgICAgdHRsOiAxNzI4MDAsXG4gICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxuICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxuICAgICAgICBlbmFibGVSZWFkeUNoZWNrOiB0cnVlLFxuICAgICAgICBsYXp5Q29ubmVjdDogdHJ1ZSxcbiAgICAgICAga2VlcEFsaXZlOiAzMDAwMCxcbiAgICAgICAgZmFtaWx5OiA0LFxuICAgICAgICBjb25uZWN0VGltZW91dDogMTAwMDAsXG4gICAgICAgIGNvbW1hbmRUaW1lb3V0OiA1MDAwLFxuICAgICAgICBlbmFibGVPZmZsaW5lUXVldWU6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZUNvbmZpZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGNvcnJlY3QgUmVkaXMgY29uZmlnJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBob3N0OiAnbG9jYWxob3N0JyxcbiAgICAgICAgcG9ydDogNjM3OSxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZCcsXG4gICAgICAgIGRiOiAwLFxuICAgICAgICBrZXlQcmVmaXg6ICd0ZXN0OicsXG4gICAgICAgIHR0bDogMzYwMCxcbiAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDMsXG4gICAgICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAxMDAsXG4gICAgICAgIGVuYWJsZVJlYWR5Q2hlY2s6IHRydWUsXG4gICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICBrZWVwQWxpdmU6IDMwMDAwLFxuICAgICAgICBmYW1pbHk6IDQsXG4gICAgICAgIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gICAgICAgIGVuYWJsZU9mZmxpbmVRdWV1ZTogZmFsc2UsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBpc1ZhbGlkID0gc2VydmljZS52YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBjb25maWcgd2l0aCBtaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgaG9zdDogJ2xvY2FsaG9zdCcsXG4gICAgICAgIC8vIOe8uuWwkSBwb3J0LCBwYXNzd29yZCwgZGIg562J5b+F6ZyA5a2X5q61XG4gICAgICB9IGFzIGFueTtcblxuICAgICAgY29uc3QgaXNWYWxpZCA9IHNlcnZpY2UudmFsaWRhdGVDb25maWcoY29uZmlnKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGNvbmZpZyB3aXRoIGludmFsaWQgcG9ydCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgaG9zdDogJ2xvY2FsaG9zdCcsXG4gICAgICAgIHBvcnQ6ICdpbnZhbGlkJyBhcyBhbnksXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQnLFxuICAgICAgICBkYjogMCxcbiAgICAgICAga2V5UHJlZml4OiAndGVzdDonLFxuICAgICAgICB0dGw6IDM2MDAsXG4gICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxuICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxuICAgICAgICBlbmFibGVSZWFkeUNoZWNrOiB0cnVlLFxuICAgICAgICBsYXp5Q29ubmVjdDogdHJ1ZSxcbiAgICAgICAga2VlcEFsaXZlOiAzMDAwMCxcbiAgICAgICAgZmFtaWx5OiA0LFxuICAgICAgICBjb25uZWN0VGltZW91dDogMTAwMDAsXG4gICAgICAgIGNvbW1hbmRUaW1lb3V0OiA1MDAwLFxuICAgICAgICBlbmFibGVPZmZsaW5lUXVldWU6IGZhbHNlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgaXNWYWxpZCA9IHNlcnZpY2UudmFsaWRhdGVDb25maWcoY29uZmlnKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGNvbmZpZyB3aXRoIGludmFsaWQgZGIgbnVtYmVyJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBob3N0OiAnbG9jYWxob3N0JyxcbiAgICAgICAgcG9ydDogNjM3OSxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZCcsXG4gICAgICAgIGRiOiAnaW52YWxpZCcgYXMgYW55LFxuICAgICAgICBrZXlQcmVmaXg6ICd0ZXN0OicsXG4gICAgICAgIHR0bDogMzYwMCxcbiAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDMsXG4gICAgICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAxMDAsXG4gICAgICAgIGVuYWJsZVJlYWR5Q2hlY2s6IHRydWUsXG4gICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICBrZWVwQWxpdmU6IDMwMDAwLFxuICAgICAgICBmYW1pbHk6IDQsXG4gICAgICAgIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gICAgICAgIGVuYWJsZU9mZmxpbmVRdWV1ZTogZmFsc2UsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBpc1ZhbGlkID0gc2VydmljZS52YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9