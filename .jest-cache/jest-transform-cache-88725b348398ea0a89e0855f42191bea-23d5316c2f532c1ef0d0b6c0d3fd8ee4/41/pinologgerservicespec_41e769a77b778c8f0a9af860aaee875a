6e5c3c51690470a66aae69a9c48e0f1e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const event_emitter_1 = require("@nestjs/event-emitter");
const nestjs_cls_1 = require("nestjs-cls");
const pino_logger_service_1 = require("./pino-logger.service");
const pino_logger_config_service_1 = require("./pino-logger-config.service");
const pino_logger_factory_1 = require("../factories/pino-logger.factory");
const logging_interface_1 = require("../interfaces/logging.interface");
describe('PinoLoggerService', () => {
    let service;
    let eventEmitter;
    let configService;
    let loggerFactory;
    // let _clsService: ClsService; // 暂时注释掉，因为测试中没有使用
    beforeEach(async () => {
        const mockLogger = {
            debug: jest.fn(),
            info: jest.fn(),
            warn: jest.fn(),
            error: jest.fn(),
            fatal: jest.fn(),
            trace: jest.fn(),
            child: jest.fn(),
            flush: jest.fn(),
        };
        const mockConfigService = {
            getConfig: jest.fn().mockReturnValue({
                level: 'info',
                format: 'json',
                colorize: true,
                timestamp: true,
                requestId: true,
                tenantId: true,
                userId: true,
                performance: true,
                stackTrace: true,
                filePath: undefined,
                rotation: { maxSize: '10m', maxFiles: 5, interval: '1d' },
                remote: undefined,
            }),
            getLevel: jest.fn().mockReturnValue('info'),
            setLevel: jest.fn(),
            updateConfig: jest.fn(),
        };
        const mockLoggerFactory = {
            createLogger: jest.fn().mockReturnValue(mockLogger),
            createChildLogger: jest.fn().mockReturnValue(mockLogger),
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                {
                    provide: pino_logger_service_1.PinoLoggerService,
                    useFactory: (eventEmitter, configService, loggerFactory, cls) => {
                        return new pino_logger_service_1.PinoLoggerService(eventEmitter, configService, loggerFactory, cls);
                    },
                    inject: [
                        event_emitter_1.EventEmitter2,
                        pino_logger_config_service_1.PinoLoggerConfigService,
                        pino_logger_factory_1.PinoLoggerFactory,
                        nestjs_cls_1.ClsService,
                    ],
                },
                {
                    provide: pino_logger_config_service_1.PinoLoggerConfigService,
                    useValue: mockConfigService,
                },
                {
                    provide: pino_logger_factory_1.PinoLoggerFactory,
                    useValue: mockLoggerFactory,
                },
                {
                    provide: event_emitter_1.EventEmitter2,
                    useValue: {
                        emit: jest.fn(),
                    },
                },
                {
                    provide: nestjs_cls_1.ClsService,
                    useValue: {
                        get: jest.fn(),
                        set: jest.fn(),
                        run: jest.fn(),
                        runWith: jest.fn(),
                        enter: jest.fn(),
                        exit: jest.fn(),
                        isActive: jest.fn().mockReturnValue(true),
                    },
                },
            ],
        }).compile();
        service = module.get(pino_logger_service_1.PinoLoggerService);
        eventEmitter = module.get(event_emitter_1.EventEmitter2);
        configService = module.get(pino_logger_config_service_1.PinoLoggerConfigService);
        loggerFactory = module.get(pino_logger_factory_1.PinoLoggerFactory);
        // _clsService = module.get<ClsService>(ClsService);
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('basic logging', () => {
        it('should log debug messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.debug('Debug message', logging_interface_1.LogContext.SYSTEM, { test: 'data' });
            expect(spy).toHaveBeenCalledWith('debug', 'Debug message', logging_interface_1.LogContext.SYSTEM, { test: 'data' }, undefined);
        });
        it('should log info messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.info('Info message', logging_interface_1.LogContext.BUSINESS, { operation: 'test' });
            expect(spy).toHaveBeenCalledWith('info', 'Info message', logging_interface_1.LogContext.BUSINESS, { operation: 'test' }, undefined);
        });
        it('should log warn messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.warn('Warning message', logging_interface_1.LogContext.AUTH, { userId: '123' });
            expect(spy).toHaveBeenCalledWith('warn', 'Warning message', logging_interface_1.LogContext.AUTH, { userId: '123' }, undefined);
        });
        it('should log error messages', () => {
            const error = new Error('Test error');
            const spy = jest.spyOn(service, 'log');
            service.error('Error message', logging_interface_1.LogContext.DATABASE, { query: 'SELECT *' }, error);
            expect(spy).toHaveBeenCalledWith('error', 'Error message', logging_interface_1.LogContext.DATABASE, { query: 'SELECT *' }, error);
        });
        it('should log fatal messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.fatal('Fatal message', logging_interface_1.LogContext.SYSTEM, { critical: true });
            expect(spy).toHaveBeenCalledWith('fatal', 'Fatal message', logging_interface_1.LogContext.SYSTEM, { critical: true }, undefined);
        });
        it('should log trace messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.trace('Trace message', logging_interface_1.LogContext.PERFORMANCE, { duration: 100 });
            expect(spy).toHaveBeenCalledWith('trace', 'Trace message', logging_interface_1.LogContext.PERFORMANCE, { duration: 100 }, undefined);
        });
    });
    describe('specialized logging', () => {
        it('should log performance messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.performance('database_query', 150, logging_interface_1.LogContext.DATABASE, {
                table: 'users',
            });
            expect(spy).toHaveBeenCalledWith('info', 'Performance: database_query took 150ms', logging_interface_1.LogContext.DATABASE, {
                table: 'users',
                operation: 'database_query',
                duration: 150,
                type: 'performance',
            });
        });
        it('should log business messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.business('User registered', {
                userId: '123',
                email: 'test@example.com',
            });
            expect(spy).toHaveBeenCalledWith('info', 'User registered', logging_interface_1.LogContext.BUSINESS, {
                userId: '123',
                email: 'test@example.com',
            });
        });
        it('should log security messages', () => {
            const spy = jest.spyOn(service, 'log');
            service.security('Failed login attempt', {
                ip: '192.168.1.1',
                username: 'test',
            });
            expect(spy).toHaveBeenCalledWith('warn', 'Failed login attempt', logging_interface_1.LogContext.AUTH, {
                ip: '192.168.1.1',
                username: 'test',
            });
        });
    });
    describe('configuration', () => {
        it('should get and set log level', () => {
            jest.spyOn(configService, 'getLevel').mockReturnValue('info');
            jest.spyOn(configService, 'setLevel').mockImplementation(() => undefined);
            service.setLevel('debug');
            expect(configService.setLevel).toHaveBeenCalledWith('debug');
            expect(configService.getLevel).toHaveBeenCalled();
        });
        it('should get and update config', () => {
            const mockConfig = {
                level: 'warn',
                format: 'json',
                colorize: true,
                timestamp: true,
                requestId: true,
                tenantId: true,
                userId: true,
                performance: true,
                stackTrace: true,
                filePath: undefined,
                rotation: { maxSize: '10m', maxFiles: 5, interval: '1d' },
                remote: undefined,
            };
            jest.spyOn(configService, 'getConfig').mockReturnValue(mockConfig);
            jest
                .spyOn(configService, 'updateConfig')
                .mockImplementation(() => undefined);
            const config = service.getConfig();
            service.updateConfig({ level: 'warn' });
            expect(configService.getConfig).toHaveBeenCalled();
            expect(configService.updateConfig).toHaveBeenCalledWith({
                level: 'warn',
            });
            expect(config).toEqual(mockConfig);
        });
    });
    describe('child logger', () => {
        it('should create child logger', () => {
            const mockChildLogger = {
                debug: jest.fn(),
                info: jest.fn(),
                warn: jest.fn(),
                error: jest.fn(),
                fatal: jest.fn(),
                trace: jest.fn(),
            };
            jest
                .spyOn(loggerFactory, 'createChildLogger')
                .mockReturnValue(mockChildLogger);
            const childLogger = service.child(logging_interface_1.LogContext.DATABASE, {
                tenantId: '123',
            });
            expect(childLogger).toBeDefined();
            expect(childLogger).toBeInstanceOf(pino_logger_service_1.PinoLoggerService);
            expect(loggerFactory.createChildLogger).toHaveBeenCalledWith(expect.anything(), { context: logging_interface_1.LogContext.DATABASE, tenantId: '123' });
        });
    });
    describe('statistics', () => {
        it('should track log statistics', () => {
            // 重置统计
            service.resetStats();
            // 记录一些日志
            service.info('Test message 1', logging_interface_1.LogContext.BUSINESS);
            service.warn('Test message 2', logging_interface_1.LogContext.AUTH);
            service.error('Test message 3', logging_interface_1.LogContext.DATABASE);
            const stats = service.getStats();
            expect(stats.totalLogs).toBeGreaterThanOrEqual(3);
            expect(stats.logsByLevel.info).toBeGreaterThanOrEqual(1);
            expect(stats.logsByLevel.warn).toBeGreaterThanOrEqual(1);
            expect(stats.logsByLevel.error).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.BUSINESS]).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.AUTH]).toBeGreaterThanOrEqual(1);
            expect(stats.logsByContext[logging_interface_1.LogContext.DATABASE]).toBeGreaterThanOrEqual(1);
            expect(stats.averageLogSize).toBeGreaterThan(0);
            expect(stats.lastLogTime).toBeDefined();
        });
        it('should reset statistics', () => {
            // 记录一些日志
            service.info('Test message');
            // 重置统计
            service.resetStats();
            const stats = service.getStats();
            expect(stats.totalLogs).toBe(0);
            expect(stats.logsByLevel.info).toBe(0);
        });
    });
    describe('event emission', () => {
        it('should emit log events', () => {
            service.info('Test message', logging_interface_1.LogContext.BUSINESS, { test: 'data' });
            expect(eventEmitter.emit).toHaveBeenCalledWith('logger.log', expect.objectContaining({
                level: 'info',
                message: 'Test message',
                context: logging_interface_1.LogContext.BUSINESS,
                metadata: { test: 'data' },
            }));
        });
    });
    describe('lifecycle methods', () => {
        it('should flush and close logger', async () => {
            await expect(service.flush()).resolves.not.toThrow();
            await expect(service.close()).resolves.not.toThrow();
        });
        it('should handle module destruction', async () => {
            await expect(service.onModuleDestroy()).resolves.not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvbG9nZ2luZy9zcmMvc2VydmljZXMvcGluby1sb2dnZXIuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELHlEQUFzRDtBQUN0RCwyQ0FBd0M7QUFDeEMsK0RBQTBEO0FBQzFELDZFQUF1RTtBQUN2RSwwRUFBcUU7QUFDckUsdUVBQXVFO0FBRXZFLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxPQUEwQixDQUFDO0lBQy9CLElBQUksWUFBMkIsQ0FBQztJQUNoQyxJQUFJLGFBQXNDLENBQUM7SUFDM0MsSUFBSSxhQUFnQyxDQUFDO0lBQ3JDLGtEQUFrRDtJQUVsRCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxVQUFVLEdBQUc7WUFDakIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2pCLENBQUM7UUFFRixNQUFNLGlCQUFpQixHQUFHO1lBQ3hCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO2dCQUNuQyxLQUFLLEVBQUUsTUFBTTtnQkFDYixNQUFNLEVBQUUsTUFBTTtnQkFDZCxRQUFRLEVBQUUsSUFBSTtnQkFDZCxTQUFTLEVBQUUsSUFBSTtnQkFDZixTQUFTLEVBQUUsSUFBSTtnQkFDZixRQUFRLEVB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QzVDLFlBQVksRUFDWixNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLEtBQUssRUFBRSxNQUFNO2dCQUNiLE9BQU8sRUFBRSxjQUFjO2dCQUN2QixPQUFPLEVBQUUsOEJBQVUsQ0FBQyxRQUFRO2dCQUM1QixRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFO2FBQzNCLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsRUFBRSxDQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDckQsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN2RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9hcmxpZ2xlL1YxL0Fpb2ZpeC9haW9maXgtYWktc2Fhcy1wbGF0Zm9ybS9wYWNrYWdlcy9sb2dnaW5nL3NyYy9zZXJ2aWNlcy9waW5vLWxvZ2dlci5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIyIH0gZnJvbSAnQG5lc3Rqcy9ldmVudC1lbWl0dGVyJztcbmltcG9ydCB7IENsc1NlcnZpY2UgfSBmcm9tICduZXN0anMtY2xzJztcbmltcG9ydCB7IFBpbm9Mb2dnZXJTZXJ2aWNlIH0gZnJvbSAnLi9waW5vLWxvZ2dlci5zZXJ2aWNlJztcbmltcG9ydCB7IFBpbm9Mb2dnZXJDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi9waW5vLWxvZ2dlci1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBQaW5vTG9nZ2VyRmFjdG9yeSB9IGZyb20gJy4uL2ZhY3Rvcmllcy9waW5vLWxvZ2dlci5mYWN0b3J5JztcbmltcG9ydCB7IExvZ0NvbnRleHQsIExvZ0xldmVsIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9sb2dnaW5nLmludGVyZmFjZSc7XG5cbmRlc2NyaWJlKCdQaW5vTG9nZ2VyU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFBpbm9Mb2dnZXJTZXJ2aWNlO1xuICBsZXQgZXZlbnRFbWl0dGVyOiBFdmVudEVtaXR0ZXIyO1xuICBsZXQgY29uZmlnU2VydmljZTogUGlub0xvZ2dlckNvbmZpZ1NlcnZpY2U7XG4gIGxldCBsb2dnZXJGYWN0b3J5OiBQaW5vTG9nZ2VyRmFjdG9yeTtcbiAgLy8gbGV0IF9jbHNTZXJ2aWNlOiBDbHNTZXJ2aWNlOyAvLyDmmoLml7bms6jph4rmjonvvIzlm6DkuLrmtYvor5XkuK3msqHmnInkvb/nlKhcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrTG9nZ2VyID0ge1xuICAgICAgZGVidWc6IGplc3QuZm4oKSxcbiAgICAgIGluZm86IGplc3QuZm4oKSxcbiAgICAgIHdhcm46IGplc3QuZm4oKSxcbiAgICAgIGVycm9yOiBqZXN0LmZuKCksXG4gICAgICBmYXRhbDogamVzdC5mbigpLFxuICAgICAgdHJhY2U6IGplc3QuZm4oKSxcbiAgICAgIGNoaWxkOiBqZXN0LmZuKCksXG4gICAgICBmbHVzaDogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBjb25zdCBtb2NrQ29uZmlnU2VydmljZSA9IHtcbiAgICAgIGdldENvbmZpZzogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIGxldmVsOiAnaW5mbycsXG4gICAgICAgIGZvcm1hdDogJ2pzb24nLFxuICAgICAgICBjb2xvcml6ZTogdHJ1ZSxcbiAgICAgICAgdGltZXN0YW1wOiB0cnVlLFxuICAgICAgICByZXF1ZXN0SWQ6IHRydWUsXG4gICAgICAgIHRlbmFudElkOiB0cnVlLFxuICAgICAgICB1c2VySWQ6IHRydWUsXG4gICAgICAgIHBlcmZvcm1hbmNlOiB0cnVlLFxuICAgICAgICBzdGFja1RyYWNlOiB0cnVlLFxuICAgICAgICBmaWxlUGF0aDogdW5kZWZpbmVkLFxuICAgICAgICByb3RhdGlvbjogeyBtYXhTaXplOiAnMTBtJywgbWF4RmlsZXM6IDUsIGludGVydmFsOiAnMWQnIH0sXG4gICAgICAgIHJlbW90ZTogdW5kZWZpbmVkLFxuICAgICAgfSksXG4gICAgICBnZXRMZXZlbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnaW5mbycpLFxuICAgICAgc2V0TGV2ZWw6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZUNvbmZpZzogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBjb25zdCBtb2NrTG9nZ2VyRmFjdG9yeSA9IHtcbiAgICAgIGNyZWF0ZUxvZ2dlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrTG9nZ2VyKSxcbiAgICAgIGNyZWF0ZUNoaWxkTG9nZ2VyOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tMb2dnZXIpLFxuICAgIH07XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaW5vTG9nZ2VyU2VydmljZSxcbiAgICAgICAgICB1c2VGYWN0b3J5OiAoXG4gICAgICAgICAgICBldmVudEVtaXR0ZXI6IEV2ZW50RW1pdHRlcjIsXG4gICAgICAgICAgICBjb25maWdTZXJ2aWNlOiBQaW5vTG9nZ2VyQ29uZmlnU2VydmljZSxcbiAgICAgICAgICAgIGxvZ2dlckZhY3Rvcnk6IFBpbm9Mb2dnZXJGYWN0b3J5LFxuICAgICAgICAgICAgY2xzOiBDbHNTZXJ2aWNlLFxuICAgICAgICAgICkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQaW5vTG9nZ2VyU2VydmljZShcbiAgICAgICAgICAgICAgZXZlbnRFbWl0dGVyLFxuICAgICAgICAgICAgICBjb25maWdTZXJ2aWNlLFxuICAgICAgICAgICAgICBsb2dnZXJGYWN0b3J5LFxuICAgICAgICAgICAgICBjbHMsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5qZWN0OiBbXG4gICAgICAgICAgICBFdmVudEVtaXR0ZXIyLFxuICAgICAgICAgICAgUGlub0xvZ2dlckNvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgICBQaW5vTG9nZ2VyRmFjdG9yeSxcbiAgICAgICAgICAgIENsc1NlcnZpY2UsXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFBpbm9Mb2dnZXJDb25maWdTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29uZmlnU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFBpbm9Mb2dnZXJGYWN0b3J5LFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrTG9nZ2VyRmFjdG9yeSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEV2ZW50RW1pdHRlcjIsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGVtaXQ6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ2xzU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZToge1xuICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBzZXQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHJ1bjogamVzdC5mbigpLFxuICAgICAgICAgICAgcnVuV2l0aDogamVzdC5mbigpLFxuICAgICAgICAgICAgZW50ZXI6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGV4aXQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFBpbm9Mb2dnZXJTZXJ2aWNlPihQaW5vTG9nZ2VyU2VydmljZSk7XG4gICAgZXZlbnRFbWl0dGVyID0gbW9kdWxlLmdldDxFdmVudEVtaXR0ZXIyPihFdmVudEVtaXR0ZXIyKTtcbiAgICBjb25maWdTZXJ2aWNlID0gbW9kdWxlLmdldDxQaW5vTG9nZ2VyQ29uZmlnU2VydmljZT4oXG4gICAgICBQaW5vTG9nZ2VyQ29uZmlnU2VydmljZSxcbiAgICApO1xuICAgIGxvZ2dlckZhY3RvcnkgPSBtb2R1bGUuZ2V0PFBpbm9Mb2dnZXJGYWN0b3J5PihQaW5vTG9nZ2VyRmFjdG9yeSk7XG4gICAgLy8gX2Nsc1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENsc1NlcnZpY2U+KENsc1NlcnZpY2UpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdiYXNpYyBsb2dnaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbG9nIGRlYnVnIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS5kZWJ1ZygnRGVidWcgbWVzc2FnZScsIExvZ0NvbnRleHQuU1lTVEVNLCB7IHRlc3Q6ICdkYXRhJyB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnZGVidWcnLFxuICAgICAgICAnRGVidWcgbWVzc2FnZScsXG4gICAgICAgIExvZ0NvbnRleHQuU1lTVEVNLFxuICAgICAgICB7IHRlc3Q6ICdkYXRhJyB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgaW5mbyBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2UuaW5mbygnSW5mbyBtZXNzYWdlJywgTG9nQ29udGV4dC5CVVNJTkVTUywgeyBvcGVyYXRpb246ICd0ZXN0JyB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnaW5mbycsXG4gICAgICAgICdJbmZvIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LkJVU0lORVNTLFxuICAgICAgICB7IG9wZXJhdGlvbjogJ3Rlc3QnIH0sXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyB3YXJuIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS53YXJuKCdXYXJuaW5nIG1lc3NhZ2UnLCBMb2dDb250ZXh0LkFVVEgsIHsgdXNlcklkOiAnMTIzJyB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnd2FybicsXG4gICAgICAgICdXYXJuaW5nIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LkFVVEgsXG4gICAgICAgIHsgdXNlcklkOiAnMTIzJyB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgZXJyb3IgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS5lcnJvcihcbiAgICAgICAgJ0Vycm9yIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LkRBVEFCQVNFLFxuICAgICAgICB7IHF1ZXJ5OiAnU0VMRUNUIConIH0sXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnZXJyb3InLFxuICAgICAgICAnRXJyb3IgbWVzc2FnZScsXG4gICAgICAgIExvZ0NvbnRleHQuREFUQUJBU0UsXG4gICAgICAgIHsgcXVlcnk6ICdTRUxFQ1QgKicgfSxcbiAgICAgICAgZXJyb3IsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgZmF0YWwgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAnbG9nJyk7XG4gICAgICBzZXJ2aWNlLmZhdGFsKCdGYXRhbCBtZXNzYWdlJywgTG9nQ29udGV4dC5TWVNURU0sIHsgY3JpdGljYWw6IHRydWUgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2ZhdGFsJyxcbiAgICAgICAgJ0ZhdGFsIG1lc3NhZ2UnLFxuICAgICAgICBMb2dDb250ZXh0LlNZU1RFTSxcbiAgICAgICAgeyBjcml0aWNhbDogdHJ1ZSB9LFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgdHJhY2UgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAnbG9nJyk7XG4gICAgICBzZXJ2aWNlLnRyYWNlKCdUcmFjZSBtZXNzYWdlJywgTG9nQ29udGV4dC5QRVJGT1JNQU5DRSwgeyBkdXJhdGlvbjogMTAwIH0pO1xuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICd0cmFjZScsXG4gICAgICAgICdUcmFjZSBtZXNzYWdlJyxcbiAgICAgICAgTG9nQ29udGV4dC5QRVJGT1JNQU5DRSxcbiAgICAgICAgeyBkdXJhdGlvbjogMTAwIH0sXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzcGVjaWFsaXplZCBsb2dnaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbG9nIHBlcmZvcm1hbmNlIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS5wZXJmb3JtYW5jZSgnZGF0YWJhc2VfcXVlcnknLCAxNTAsIExvZ0NvbnRleHQuREFUQUJBU0UsIHtcbiAgICAgICAgdGFibGU6ICd1c2VycycsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnaW5mbycsXG4gICAgICAgICdQZXJmb3JtYW5jZTogZGF0YWJhc2VfcXVlcnkgdG9vayAxNTBtcycsXG4gICAgICAgIExvZ0NvbnRleHQuREFUQUJBU0UsXG4gICAgICAgIHtcbiAgICAgICAgICB0YWJsZTogJ3VzZXJzJyxcbiAgICAgICAgICBvcGVyYXRpb246ICdkYXRhYmFzZV9xdWVyeScsXG4gICAgICAgICAgZHVyYXRpb246IDE1MCxcbiAgICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGJ1c2luZXNzIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2xvZycpO1xuICAgICAgc2VydmljZS5idXNpbmVzcygnVXNlciByZWdpc3RlcmVkJywge1xuICAgICAgICB1c2VySWQ6ICcxMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgfSk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2luZm8nLFxuICAgICAgICAnVXNlciByZWdpc3RlcmVkJyxcbiAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogJzEyMycsXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBzZWN1cml0eSBtZXNzYWdlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdsb2cnKTtcbiAgICAgIHNlcnZpY2Uuc2VjdXJpdHkoJ0ZhaWxlZCBsb2dpbiBhdHRlbXB0Jywge1xuICAgICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0JyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICd3YXJuJyxcbiAgICAgICAgJ0ZhaWxlZCBsb2dpbiBhdHRlbXB0JyxcbiAgICAgICAgTG9nQ29udGV4dC5BVVRILFxuICAgICAgICB7XG4gICAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICAgICAgdXNlcm5hbWU6ICd0ZXN0JyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGFuZCBzZXQgbG9nIGxldmVsJywgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCAnZ2V0TGV2ZWwnKS5tb2NrUmV0dXJuVmFsdWUoJ2luZm8nKTtcbiAgICAgIGplc3Quc3B5T24oY29uZmlnU2VydmljZSwgJ3NldExldmVsJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHVuZGVmaW5lZCk7XG5cbiAgICAgIHNlcnZpY2Uuc2V0TGV2ZWwoJ2RlYnVnJyk7XG5cbiAgICAgIGV4cGVjdChjb25maWdTZXJ2aWNlLnNldExldmVsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZGVidWcnKTtcbiAgICAgIGV4cGVjdChjb25maWdTZXJ2aWNlLmdldExldmVsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBhbmQgdXBkYXRlIGNvbmZpZycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDb25maWcgPSB7XG4gICAgICAgIGxldmVsOiAnd2FybicgYXMgTG9nTGV2ZWwsXG4gICAgICAgIGZvcm1hdDogJ2pzb24nIGFzIGFueSxcbiAgICAgICAgY29sb3JpemU6IHRydWUsXG4gICAgICAgIHRpbWVzdGFtcDogdHJ1ZSxcbiAgICAgICAgcmVxdWVzdElkOiB0cnVlLFxuICAgICAgICB0ZW5hbnRJZDogdHJ1ZSxcbiAgICAgICAgdXNlcklkOiB0cnVlLFxuICAgICAgICBwZXJmb3JtYW5jZTogdHJ1ZSxcbiAgICAgICAgc3RhY2tUcmFjZTogdHJ1ZSxcbiAgICAgICAgZmlsZVBhdGg6IHVuZGVmaW5lZCxcbiAgICAgICAgcm90YXRpb246IHsgbWF4U2l6ZTogJzEwbScsIG1heEZpbGVzOiA1LCBpbnRlcnZhbDogJzFkJyB9LFxuICAgICAgICByZW1vdGU6IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgICBqZXN0LnNweU9uKGNvbmZpZ1NlcnZpY2UsICdnZXRDb25maWcnKS5tb2NrUmV0dXJuVmFsdWUobW9ja0NvbmZpZyk7XG4gICAgICBqZXN0XG4gICAgICAgIC5zcHlPbihjb25maWdTZXJ2aWNlLCAndXBkYXRlQ29uZmlnJylcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB1bmRlZmluZWQpO1xuXG4gICAgICBjb25zdCBjb25maWcgPSBzZXJ2aWNlLmdldENvbmZpZygpO1xuICAgICAgc2VydmljZS51cGRhdGVDb25maWcoeyBsZXZlbDogJ3dhcm4nIH0pO1xuXG4gICAgICBleHBlY3QoY29uZmlnU2VydmljZS5nZXRDb25maWcpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChjb25maWdTZXJ2aWNlLnVwZGF0ZUNvbmZpZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBsZXZlbDogJ3dhcm4nLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoY29uZmlnKS50b0VxdWFsKG1vY2tDb25maWcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2hpbGQgbG9nZ2VyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNoaWxkIGxvZ2dlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDaGlsZExvZ2dlciA9IHtcbiAgICAgICAgZGVidWc6IGplc3QuZm4oKSxcbiAgICAgICAgaW5mbzogamVzdC5mbigpLFxuICAgICAgICB3YXJuOiBqZXN0LmZuKCksXG4gICAgICAgIGVycm9yOiBqZXN0LmZuKCksXG4gICAgICAgIGZhdGFsOiBqZXN0LmZuKCksXG4gICAgICAgIHRyYWNlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuICAgICAgamVzdFxuICAgICAgICAuc3B5T24obG9nZ2VyRmFjdG9yeSwgJ2NyZWF0ZUNoaWxkTG9nZ2VyJylcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZShtb2NrQ2hpbGRMb2dnZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgY2hpbGRMb2dnZXIgPSBzZXJ2aWNlLmNoaWxkKExvZ0NvbnRleHQuREFUQUJBU0UsIHtcbiAgICAgICAgdGVuYW50SWQ6ICcxMjMnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChjaGlsZExvZ2dlcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChjaGlsZExvZ2dlcikudG9CZUluc3RhbmNlT2YoUGlub0xvZ2dlclNlcnZpY2UpO1xuICAgICAgZXhwZWN0KGxvZ2dlckZhY3RvcnkuY3JlYXRlQ2hpbGRMb2dnZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKSxcbiAgICAgICAgeyBjb250ZXh0OiBMb2dDb250ZXh0LkRBVEFCQVNFLCB0ZW5hbnRJZDogJzEyMycgfSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgbG9nIHN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgICAvLyDph43nva7nu5/orqFcbiAgICAgIHNlcnZpY2UucmVzZXRTdGF0cygpO1xuXG4gICAgICAvLyDorrDlvZXkuIDkupvml6Xlv5dcbiAgICAgIHNlcnZpY2UuaW5mbygnVGVzdCBtZXNzYWdlIDEnLCBMb2dDb250ZXh0LkJVU0lORVNTKTtcbiAgICAgIHNlcnZpY2Uud2FybignVGVzdCBtZXNzYWdlIDInLCBMb2dDb250ZXh0LkFVVEgpO1xuICAgICAgc2VydmljZS5lcnJvcignVGVzdCBtZXNzYWdlIDMnLCBMb2dDb250ZXh0LkRBVEFCQVNFKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldFN0YXRzKCk7XG5cbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbExvZ3MpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMyk7XG4gICAgICBleHBlY3Qoc3RhdHMubG9nc0J5TGV2ZWwuaW5mbykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlMZXZlbC53YXJuKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUxldmVsLmVycm9yKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUNvbnRleHRbTG9nQ29udGV4dC5CVVNJTkVTU10pLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoXG4gICAgICAgIDEsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHN0YXRzLmxvZ3NCeUNvbnRleHRbTG9nQ29udGV4dC5BVVRIXSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5sb2dzQnlDb250ZXh0W0xvZ0NvbnRleHQuREFUQUJBU0VdKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKFxuICAgICAgICAxLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChzdGF0cy5hdmVyYWdlTG9nU2l6ZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLmxhc3RMb2dUaW1lKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNldCBzdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgICAgLy8g6K6w5b2V5LiA5Lqb5pel5b+XXG4gICAgICBzZXJ2aWNlLmluZm8oJ1Rlc3QgbWVzc2FnZScpO1xuXG4gICAgICAvLyDph43nva7nu5/orqFcbiAgICAgIHNlcnZpY2UucmVzZXRTdGF0cygpO1xuXG4gICAgICBjb25zdCBzdGF0cyA9IHNlcnZpY2UuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbExvZ3MpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMubG9nc0J5TGV2ZWwuaW5mbykudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V2ZW50IGVtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZW1pdCBsb2cgZXZlbnRzJywgKCkgPT4ge1xuICAgICAgc2VydmljZS5pbmZvKCdUZXN0IG1lc3NhZ2UnLCBMb2dDb250ZXh0LkJVU0lORVNTLCB7IHRlc3Q6ICdkYXRhJyB9KTtcblxuICAgICAgZXhwZWN0KGV2ZW50RW1pdHRlci5lbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2xvZ2dlci5sb2cnLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbGV2ZWw6ICdpbmZvJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVGVzdCBtZXNzYWdlJyxcbiAgICAgICAgICBjb250ZXh0OiBMb2dDb250ZXh0LkJVU0lORVNTLFxuICAgICAgICAgIG1ldGFkYXRhOiB7IHRlc3Q6ICdkYXRhJyB9LFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsaWZlY3ljbGUgbWV0aG9kcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZsdXNoIGFuZCBjbG9zZSBsb2dnZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5mbHVzaCgpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY2xvc2UoKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1vZHVsZSBkZXN0cnVjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLm9uTW9kdWxlRGVzdHJveSgpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9