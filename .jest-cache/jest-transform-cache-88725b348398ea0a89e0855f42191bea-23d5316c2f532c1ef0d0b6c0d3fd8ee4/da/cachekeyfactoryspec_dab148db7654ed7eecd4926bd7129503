8ec1996e22263b36d1df5c620ee5799c
"use strict";
/**
 * @file cache-key.factory.spec.ts
 * @description 缓存键工厂单元测试
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const cache_key_factory_1 = require("./cache-key.factory");
describe('CacheKeyFactory', () => {
    let factory;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [cache_key_factory_1.CacheKeyFactory],
        }).compile();
        factory = module.get(cache_key_factory_1.CacheKeyFactory);
    });
    describe('create', () => {
        it('should create basic cache key', () => {
            const result = factory.create('test-key');
            expect(result).toEqual({
                key: 'test-key',
                tags: [],
            });
        });
        it('should create cache key with options', () => {
            const options = {
                namespace: 'test-namespace',
                version: 'v2',
                tenantId: 'tenant-123',
                userId: 'user-456',
                tags: ['tag1', 'tag2'],
            };
            const result = factory.create('test-key', options);
            expect(result).toEqual({
                key: 'test-key',
                namespace: 'test-namespace',
                version: 'v2',
                tenantId: 'tenant-123',
                userId: 'user-456',
                tags: ['tag1', 'tag2'],
            });
        });
        it('should sanitize key name', () => {
            const result = factory.create('test key with spaces!@#');
            expect(result.key).toBe('test_key_with_spaces___');
        });
        it('should throw error for empty key', () => {
            expect(() => factory.create('')).toThrow('Cache key must be a non-empty string');
        });
        it('should throw error for null key', () => {
            expect(() => factory.create(null)).toThrow('Cache key must be a non-empty string');
        });
    });
    describe('createNamespace', () => {
        it('should create namespace cache key', () => {
            const result = factory.createNamespace('test-namespace', 'test-key');
            expect(result).toEqual({
                key: 'test-key',
                namespace: 'test-namespace',
                tags: [],
            });
        });
        it('should sanitize namespace', () => {
            const result = factory.createNamespace('Test Namespace!@#', 'test-key');
            expect(result.namespace).toBe('test_namespace___');
        });
    });
    describe('createTenant', () => {
        it('should create tenant cache key', () => {
            const result = factory.createTenant('tenant-123', 'test-key');
            expect(result).toEqual({
                key: 'test-key',
                tenantId: 'tenant-123',
                tags: [],
            });
        });
        it('should sanitize tenant ID', () => {
            const result = factory.createTenant('tenant 123!@#', 'test-key');
            expect(result.tenantId).toBe('tenant_123___');
        });
    });
    describe('createUser', () => {
        it('should create user cache key', () => {
            const result = factory.createUser('user-456', 'test-key');
            expect(result).toEqual({
                key: 'test-key',
                userId: 'user-456',
                tags: [],
            });
        });
        it('should sanitize user ID', () => {
            const result = factory.createUser('user 456!@#', 'test-key');
            expect(result.userId).toBe('user_456___');
        });
    });
    describe('createTagged', () => {
        it('should create tagged cache key', () => {
            const result = factory.createTagged('test-key', ['tag1', 'tag2']);
            expect(result).toEqual({
                key: 'test-key',
                tags: ['tag1', 'tag2'],
            });
        });
        it('should sanitize and deduplicate tags', () => {
            const result = factory.createTagged('test-key', [
                'tag1',
                'tag 1!@#',
                'tag1',
                'tag2',
            ]);
            expect(result.tags).toEqual(['tag1', 'tag_1___', 'tag2']);
        });
        it('should handle empty tags array', () => {
            const result = factory.createTagged('test-key', []);
            expect(result.tags).toEqual([]);
        });
    });
    describe('toString', () => {
        it('should convert basic cache key to string', () => {
            const cacheKey = {
                key: 'test-key',
                tags: [],
            };
            const result = factory.toString(cacheKey);
            expect(result).toBe('v1:test-key');
        });
        it('should convert complex cache key to string', () => {
            const cacheKey = {
                key: 'test-key',
                namespace: 'test-namespace',
                version: 'v2',
                tenantId: 'tenant-123',
                userId: 'user-456',
                tags: ['tag1', 'tag2'],
            };
            const result = factory.toString(cacheKey);
            expect(result).toBe('v2:test-namespace:tenant:tenant-123:user:user-456:tags:tag1,tag2:test-key');
        });
        it('should handle cache key without version', () => {
            const cacheKey = {
                key: 'test-key',
                tags: [],
            };
            delete cacheKey.version;
            const result = factory.toString(cacheKey);
            expect(result).toBe('v1:test-key');
        });
        it('should handle cache key with only namespace', () => {
            const cacheKey = {
                key: 'test-key',
                namespace: 'test-namespace',
                tags: [],
            };
            const result = factory.toString(cacheKey);
            expect(result).toBe('v1:test-namespace:test-key');
        });
    });
    describe('parse', () => {
        it('should parse basic cache key string', () => {
            const keyString = 'v1:test-key';
            const result = factory.parse(keyString);
            expect(result).toEqual({
                key: 'test-key',
                version: 'v1',
                tags: [],
            });
        });
        it('should parse complex cache key string', () => {
            const keyString = 'v2:test-namespace:tenant:tenant-123:user:user-456:tags:tag1,tag2:test-key';
            const result = factory.parse(keyString);
            expect(result).toEqual({
                key: 'test-key',
                namespace: 'test-namespace',
                version: 'v2',
                tenantId: 'tenant-123',
                userId: 'user-456',
                tags: ['tag1', 'tag2'],
            });
        });
        it('should parse cache key without version', () => {
            const keyString = 'v1:test-key';
            const result = factory.parse(keyString);
            expect(result).toEqual({
                key: 'test-key',
                version: 'v1',
                tags: [],
            });
        });
        it('should parse cache key with only namespace', () => {
            const keyString = 'v1:test-namespace:test-key';
            const result = factory.parse(keyString);
            expect(result).toEqual({
                key: 'test-key',
                namespace: 'test-namespace',
                version: 'v1',
                tags: [],
            });
        });
    });
    describe('createPattern', () => {
        it('should create pattern for wildcard matching', () => {
            const result = factory.createPattern('user:*:profile', {
                namespace: 'test-namespace',
                tenantId: 'tenant-123',
            });
            expect(result).toBe('v1:test-namespace:tenant:tenant-123:user:*:profile');
        });
    });
    describe('matchPattern', () => {
        it('should match exact pattern', () => {
            const cacheKey = {
                key: 'user-123-profile',
                namespace: 'test-namespace',
                tenantId: 'tenant-123',
                tags: [],
            };
            const pattern = 'v1:test-namespace:tenant:tenant-123:user-123-profile';
            const result = factory.matchPattern(cacheKey, pattern);
            expect(result).toBe(true);
        });
        it('should match wildcard pattern', () => {
            const cacheKey = {
                key: 'user-123-profile',
                namespace: 'test-namespace',
                tenantId: 'tenant-123',
                tags: [],
            };
            const pattern = 'v1:test-namespace:tenant:tenant-123:user-*-profile';
            const result = factory.matchPattern(cacheKey, pattern);
            expect(result).toBe(true);
        });
        it('should not match different pattern', () => {
            const cacheKey = {
                key: 'user-123-profile',
                namespace: 'test-namespace',
                tenantId: 'tenant-123',
                tags: [],
            };
            const pattern = 'v1:test-namespace:tenant:tenant-123:user-456-profile';
            const result = factory.matchPattern(cacheKey, pattern);
            expect(result).toBe(false);
        });
    });
    describe('extract methods', () => {
        const cacheKey = {
            key: 'test-key',
            namespace: 'test-namespace',
            version: 'v2',
            tenantId: 'tenant-123',
            userId: 'user-456',
            tags: ['tag1', 'tag2'],
        };
        it('should extract namespace', () => {
            const result = factory.extractNamespace(cacheKey);
            expect(result).toBe('test-namespace');
        });
        it('should extract tenant ID', () => {
            const result = factory.extractTenantId(cacheKey);
            expect(result).toBe('tenant-123');
        });
        it('should extract user ID', () => {
            const result = factory.extractUserId(cacheKey);
            expect(result).toBe('user-456');
        });
        it('should extract tags', () => {
            const result = factory.extractTags(cacheKey);
            expect(result).toEqual(['tag1', 'tag2']);
        });
    });
    describe('edge cases', () => {
        it('should handle cache key with special characters in key', () => {
            const result = factory.create('test@key#with$special%chars');
            expect(result.key).toBe('test_key_with_special_chars');
        });
        it('should handle cache key with multiple spaces', () => {
            const result = factory.create('test   key   with   spaces');
            expect(result.key).toBe('test___key___with___spaces');
        });
        it('should handle empty tags array', () => {
            const result = factory.create('test-key', { tags: [] });
            expect(result.tags).toEqual([]);
        });
        it('should handle undefined tags', () => {
            const result = factory.create('test-key', { tags: undefined });
            expect(result.tags).toEqual([]);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY2FjaGUvc3JjL2ZhY3Rvcmllcy9jYWNoZS1rZXkuZmFjdG9yeS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsNkNBQXNEO0FBQ3RELDJEQUFzRDtBQUd0RCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksT0FBd0IsQ0FBQztJQUU3QixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRSxDQUFDLG1DQUFlLENBQUM7U0FDN0IsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWtCLG1DQUFlLENBQUMsQ0FBQztJQUN6RCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7WUFDdkMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUxQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUNyQixHQUFHLEVBQUUsVUFBVTtnQkFDZixJQUFJLEVBQUUsRUFBRTthQUNULENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtZQUM5QyxNQUFNLE9BQU8sR0FBc0I7Z0JBQ2pDLFNBQVMsRUFBRSxnQkFBZ0I7Z0JBQzNCLE9BQU8sRUFBRSxJQUFJO2dCQUNiLFFBQVEsRUFBRSxZQUFZO2dCQUN0QixNQUFNLEVBQUUsVUFBVTtnQkFDbEIsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQzthQUN2QixDQUFDO1lBRUYsTUFBTSxN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QU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7WUFDeEMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUV4RCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7WUFDdEMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY2FjaGUvc3JjL2ZhY3Rvcmllcy9jYWNoZS1rZXkuZmFjdG9yeS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgY2FjaGUta2V5LmZhY3Rvcnkuc3BlYy50c1xuICogQGRlc2NyaXB0aW9uIOe8k+WtmOmUruW3peWOguWNleWFg+a1i+ivlVxuICovXG5cbmltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQ2FjaGVLZXlGYWN0b3J5IH0gZnJvbSAnLi9jYWNoZS1rZXkuZmFjdG9yeSc7XG5pbXBvcnQgeyBDYWNoZUtleSB9IGZyb20gJy4uL2ludGVyZmFjZXMvY2FjaGUuaW50ZXJmYWNlJztcblxuZGVzY3JpYmUoJ0NhY2hlS2V5RmFjdG9yeScsICgpID0+IHtcbiAgbGV0IGZhY3Rvcnk6IENhY2hlS2V5RmFjdG9yeTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbQ2FjaGVLZXlGYWN0b3J5XSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBmYWN0b3J5ID0gbW9kdWxlLmdldDxDYWNoZUtleUZhY3Rvcnk+KENhY2hlS2V5RmFjdG9yeSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYmFzaWMgY2FjaGUga2V5JywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5jcmVhdGUoJ3Rlc3Qta2V5Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBrZXk6ICd0ZXN0LWtleScsXG4gICAgICAgIHRhZ3M6IFtdLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjYWNoZSBrZXkgd2l0aCBvcHRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9uczogUGFydGlhbDxDYWNoZUtleT4gPSB7XG4gICAgICAgIG5hbWVzcGFjZTogJ3Rlc3QtbmFtZXNwYWNlJyxcbiAgICAgICAgdmVyc2lvbjogJ3YyJyxcbiAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICB0YWdzOiBbJ3RhZzEnLCAndGFnMiddLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5jcmVhdGUoJ3Rlc3Qta2V5Jywgb3B0aW9ucyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBrZXk6ICd0ZXN0LWtleScsXG4gICAgICAgIG5hbWVzcGFjZTogJ3Rlc3QtbmFtZXNwYWNlJyxcbiAgICAgICAgdmVyc2lvbjogJ3YyJyxcbiAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICB0YWdzOiBbJ3RhZzEnLCAndGFnMiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGtleSBuYW1lJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5jcmVhdGUoJ3Rlc3Qga2V5IHdpdGggc3BhY2VzIUAjJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQua2V5KS50b0JlKCd0ZXN0X2tleV93aXRoX3NwYWNlc19fXycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgZW1wdHkga2V5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IGZhY3RvcnkuY3JlYXRlKCcnKSkudG9UaHJvdyhcbiAgICAgICAgJ0NhY2hlIGtleSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZycsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgbnVsbCBrZXknLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4gZmFjdG9yeS5jcmVhdGUobnVsbCBhcyB1bmtub3duKSkudG9UaHJvdyhcbiAgICAgICAgJ0NhY2hlIGtleSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZycsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlTmFtZXNwYWNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5hbWVzcGFjZSBjYWNoZSBrZXknLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LmNyZWF0ZU5hbWVzcGFjZSgndGVzdC1uYW1lc3BhY2UnLCAndGVzdC1rZXknKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIGtleTogJ3Rlc3Qta2V5JyxcbiAgICAgICAgbmFtZXNwYWNlOiAndGVzdC1uYW1lc3BhY2UnLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzYW5pdGl6ZSBuYW1lc3BhY2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LmNyZWF0ZU5hbWVzcGFjZSgnVGVzdCBOYW1lc3BhY2UhQCMnLCAndGVzdC1rZXknKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lc3BhY2UpLnRvQmUoJ3Rlc3RfbmFtZXNwYWNlX19fJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVUZW5hbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdGVuYW50IGNhY2hlIGtleScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlVGVuYW50KCd0ZW5hbnQtMTIzJywgJ3Rlc3Qta2V5Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBrZXk6ICd0ZXN0LWtleScsXG4gICAgICAgIHRlbmFudElkOiAndGVuYW50LTEyMycsXG4gICAgICAgIHRhZ3M6IFtdLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIHRlbmFudCBJRCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlVGVuYW50KCd0ZW5hbnQgMTIzIUAjJywgJ3Rlc3Qta2V5Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGVuYW50SWQpLnRvQmUoJ3RlbmFudF8xMjNfX18nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZVVzZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdXNlciBjYWNoZSBrZXknLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LmNyZWF0ZVVzZXIoJ3VzZXItNDU2JywgJ3Rlc3Qta2V5Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBrZXk6ICd0ZXN0LWtleScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItNDU2JyxcbiAgICAgICAgdGFnczogW10sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgdXNlciBJRCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlVXNlcigndXNlciA0NTYhQCMnLCAndGVzdC1rZXknKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC51c2VySWQpLnRvQmUoJ3VzZXJfNDU2X19fJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVUYWdnZWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdGFnZ2VkIGNhY2hlIGtleScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlVGFnZ2VkKCd0ZXN0LWtleScsIFsndGFnMScsICd0YWcyJ10pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICB0YWdzOiBbJ3RhZzEnLCAndGFnMiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGFuZCBkZWR1cGxpY2F0ZSB0YWdzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5jcmVhdGVUYWdnZWQoJ3Rlc3Qta2V5JywgW1xuICAgICAgICAndGFnMScsXG4gICAgICAgICd0YWcgMSFAIycsXG4gICAgICAgICd0YWcxJyxcbiAgICAgICAgJ3RhZzInLFxuICAgICAgXSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGFncykudG9FcXVhbChbJ3RhZzEnLCAndGFnXzFfX18nLCAndGFnMiddKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHRhZ3MgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LmNyZWF0ZVRhZ2dlZCgndGVzdC1rZXknLCBbXSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGFncykudG9FcXVhbChbXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd0b1N0cmluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNvbnZlcnQgYmFzaWMgY2FjaGUga2V5IHRvIHN0cmluZycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5OiBDYWNoZUtleSA9IHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkudG9TdHJpbmcoY2FjaGVLZXkpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCd2MTp0ZXN0LWtleScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb252ZXJ0IGNvbXBsZXggY2FjaGUga2V5IHRvIHN0cmluZycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5OiBDYWNoZUtleSA9IHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICBuYW1lc3BhY2U6ICd0ZXN0LW5hbWVzcGFjZScsXG4gICAgICAgIHZlcnNpb246ICd2MicsXG4gICAgICAgIHRlbmFudElkOiAndGVuYW50LTEyMycsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItNDU2JyxcbiAgICAgICAgdGFnczogWyd0YWcxJywgJ3RhZzInXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkudG9TdHJpbmcoY2FjaGVLZXkpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKFxuICAgICAgICAndjI6dGVzdC1uYW1lc3BhY2U6dGVuYW50OnRlbmFudC0xMjM6dXNlcjp1c2VyLTQ1Njp0YWdzOnRhZzEsdGFnMjp0ZXN0LWtleScsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FjaGUga2V5IHdpdGhvdXQgdmVyc2lvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5OiBDYWNoZUtleSA9IHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgIH07XG4gICAgICBkZWxldGUgY2FjaGVLZXkudmVyc2lvbjtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS50b1N0cmluZyhjYWNoZUtleSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3YxOnRlc3Qta2V5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjYWNoZSBrZXkgd2l0aCBvbmx5IG5hbWVzcGFjZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5OiBDYWNoZUtleSA9IHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICBuYW1lc3BhY2U6ICd0ZXN0LW5hbWVzcGFjZScsXG4gICAgICAgIHRhZ3M6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS50b1N0cmluZyhjYWNoZUtleSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3YxOnRlc3QtbmFtZXNwYWNlOnRlc3Qta2V5Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwYXJzZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHBhcnNlIGJhc2ljIGNhY2hlIGtleSBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBrZXlTdHJpbmcgPSAndjE6dGVzdC1rZXknO1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5wYXJzZShrZXlTdHJpbmcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICB2ZXJzaW9uOiAndjEnLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXJzZSBjb21wbGV4IGNhY2hlIGtleSBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBrZXlTdHJpbmcgPVxuICAgICAgICAndjI6dGVzdC1uYW1lc3BhY2U6dGVuYW50OnRlbmFudC0xMjM6dXNlcjp1c2VyLTQ1Njp0YWdzOnRhZzEsdGFnMjp0ZXN0LWtleSc7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LnBhcnNlKGtleVN0cmluZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBrZXk6ICd0ZXN0LWtleScsXG4gICAgICAgIG5hbWVzcGFjZTogJ3Rlc3QtbmFtZXNwYWNlJyxcbiAgICAgICAgdmVyc2lvbjogJ3YyJyxcbiAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICB0YWdzOiBbJ3RhZzEnLCAndGFnMiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBhcnNlIGNhY2hlIGtleSB3aXRob3V0IHZlcnNpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBrZXlTdHJpbmcgPSAndjE6dGVzdC1rZXknO1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5wYXJzZShrZXlTdHJpbmcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAga2V5OiAndGVzdC1rZXknLFxuICAgICAgICB2ZXJzaW9uOiAndjEnLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXJzZSBjYWNoZSBrZXkgd2l0aCBvbmx5IG5hbWVzcGFjZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGtleVN0cmluZyA9ICd2MTp0ZXN0LW5hbWVzcGFjZTp0ZXN0LWtleSc7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LnBhcnNlKGtleVN0cmluZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBrZXk6ICd0ZXN0LWtleScsXG4gICAgICAgIG5hbWVzcGFjZTogJ3Rlc3QtbmFtZXNwYWNlJyxcbiAgICAgICAgdmVyc2lvbjogJ3YxJyxcbiAgICAgICAgdGFnczogW10sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZVBhdHRlcm4nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF0dGVybiBmb3Igd2lsZGNhcmQgbWF0Y2hpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5LmNyZWF0ZVBhdHRlcm4oJ3VzZXI6Kjpwcm9maWxlJywge1xuICAgICAgICBuYW1lc3BhY2U6ICd0ZXN0LW5hbWVzcGFjZScsXG4gICAgICAgIHRlbmFudElkOiAndGVuYW50LTEyMycsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgndjE6dGVzdC1uYW1lc3BhY2U6dGVuYW50OnRlbmFudC0xMjM6dXNlcjoqOnByb2ZpbGUnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21hdGNoUGF0dGVybicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hdGNoIGV4YWN0IHBhdHRlcm4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZUtleTogQ2FjaGVLZXkgPSB7XG4gICAgICAgIGtleTogJ3VzZXItMTIzLXByb2ZpbGUnLFxuICAgICAgICBuYW1lc3BhY2U6ICd0ZXN0LW5hbWVzcGFjZScsXG4gICAgICAgIHRlbmFudElkOiAndGVuYW50LTEyMycsXG4gICAgICAgIHRhZ3M6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcGF0dGVybiA9ICd2MTp0ZXN0LW5hbWVzcGFjZTp0ZW5hbnQ6dGVuYW50LTEyMzp1c2VyLTEyMy1wcm9maWxlJztcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkubWF0Y2hQYXR0ZXJuKGNhY2hlS2V5LCBwYXR0ZXJuKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWF0Y2ggd2lsZGNhcmQgcGF0dGVybicsICgpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5OiBDYWNoZUtleSA9IHtcbiAgICAgICAga2V5OiAndXNlci0xMjMtcHJvZmlsZScsXG4gICAgICAgIG5hbWVzcGFjZTogJ3Rlc3QtbmFtZXNwYWNlJyxcbiAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgdGFnczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBwYXR0ZXJuID0gJ3YxOnRlc3QtbmFtZXNwYWNlOnRlbmFudDp0ZW5hbnQtMTIzOnVzZXItKi1wcm9maWxlJztcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkubWF0Y2hQYXR0ZXJuKGNhY2hlS2V5LCBwYXR0ZXJuKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IG1hdGNoIGRpZmZlcmVudCBwYXR0ZXJuJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGVLZXk6IENhY2hlS2V5ID0ge1xuICAgICAgICBrZXk6ICd1c2VyLTEyMy1wcm9maWxlJyxcbiAgICAgICAgbmFtZXNwYWNlOiAndGVzdC1uYW1lc3BhY2UnLFxuICAgICAgICB0ZW5hbnRJZDogJ3RlbmFudC0xMjMnLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHBhdHRlcm4gPSAndjE6dGVzdC1uYW1lc3BhY2U6dGVuYW50OnRlbmFudC0xMjM6dXNlci00NTYtcHJvZmlsZSc7XG4gICAgICBjb25zdCByZXN1bHQgPSBmYWN0b3J5Lm1hdGNoUGF0dGVybihjYWNoZUtleSwgcGF0dGVybik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXh0cmFjdCBtZXRob2RzJywgKCkgPT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5OiBDYWNoZUtleSA9IHtcbiAgICAgIGtleTogJ3Rlc3Qta2V5JyxcbiAgICAgIG5hbWVzcGFjZTogJ3Rlc3QtbmFtZXNwYWNlJyxcbiAgICAgIHZlcnNpb246ICd2MicsXG4gICAgICB0ZW5hbnRJZDogJ3RlbmFudC0xMjMnLFxuICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgdGFnczogWyd0YWcxJywgJ3RhZzInXSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IG5hbWVzcGFjZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuZXh0cmFjdE5hbWVzcGFjZShjYWNoZUtleSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCd0ZXN0LW5hbWVzcGFjZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IHRlbmFudCBJRCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuZXh0cmFjdFRlbmFudElkKGNhY2hlS2V5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3RlbmFudC0xMjMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB1c2VyIElEJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5leHRyYWN0VXNlcklkKGNhY2hlS2V5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3VzZXItNDU2Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgdGFncycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuZXh0cmFjdFRhZ3MoY2FjaGVLZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbJ3RhZzEnLCAndGFnMiddKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2VkZ2UgY2FzZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FjaGUga2V5IHdpdGggc3BlY2lhbCBjaGFyYWN0ZXJzIGluIGtleScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlKCd0ZXN0QGtleSN3aXRoJHNwZWNpYWwlY2hhcnMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5rZXkpLnRvQmUoJ3Rlc3Rfa2V5X3dpdGhfc3BlY2lhbF9jaGFycycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FjaGUga2V5IHdpdGggbXVsdGlwbGUgc3BhY2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5jcmVhdGUoJ3Rlc3QgICBrZXkgICB3aXRoICAgc3BhY2VzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQua2V5KS50b0JlKCd0ZXN0X19fa2V5X19fd2l0aF9fX3NwYWNlcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgdGFncyBhcnJheScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlKCd0ZXN0LWtleScsIHsgdGFnczogW10gfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGFncykudG9FcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmRlZmluZWQgdGFncycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkuY3JlYXRlKCd0ZXN0LWtleScsIHsgdGFnczogdW5kZWZpbmVkIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRhZ3MpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9