fd2087f6b9fd2baaeff68ed93f54fd0f
"use strict";
var __esDecorate = (this && this.__esDecorate) || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {
    function accept(f) { if (f !== void 0 && typeof f !== "function") throw new TypeError("Function expected"); return f; }
    var kind = contextIn.kind, key = kind === "getter" ? "get" : kind === "setter" ? "set" : "value";
    var target = !descriptorIn && ctor ? contextIn["static"] ? ctor : ctor.prototype : null;
    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});
    var _, done = false;
    for (var i = decorators.length - 1; i >= 0; i--) {
        var context = {};
        for (var p in contextIn) context[p] = p === "access" ? {} : contextIn[p];
        for (var p in contextIn.access) context.access[p] = contextIn.access[p];
        context.addInitializer = function (f) { if (done) throw new TypeError("Cannot add initializers after decoration has completed"); extraInitializers.push(accept(f || null)); };
        var result = (0, decorators[i])(kind === "accessor" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);
        if (kind === "accessor") {
            if (result === void 0) continue;
            if (result === null || typeof result !== "object") throw new TypeError("Object expected");
            if (_ = accept(result.get)) descriptor.get = _;
            if (_ = accept(result.set)) descriptor.set = _;
            if (_ = accept(result.init)) initializers.unshift(_);
        }
        else if (_ = accept(result)) {
            if (kind === "field") initializers.unshift(_);
            else descriptor[key] = _;
        }
    }
    if (target) Object.defineProperty(target, contextIn.name, descriptor);
    done = true;
};
var __runInitializers = (this && this.__runInitializers) || function (thisArg, initializers, value) {
    var useValue = arguments.length > 2;
    for (var i = 0; i < initializers.length; i++) {
        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);
    }
    return useValue ? value : void 0;
};
var __setFunctionName = (this && this.__setFunctionName) || function (f, name, prefix) {
    if (typeof name === "symbol") name = name.description ? "[".concat(name.description, "]") : "";
    return Object.defineProperty(f, "name", { configurable: true, value: prefix ? "".concat(prefix, " ", name) : name });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigService = void 0;
const common_1 = require("@nestjs/common");
const config_loader_1 = require("./config-loader");
const logging_1 = require("@aiofix/logging");
/**
 * @class ConfigService
 * @description
 * IAM系统配置服务，负责管理和提供系统中所有配置信息。
 * 该服务是配置管理的核心组件，提供了配置的加载、获取、验证等功能。
 *
 * 主要原理与机制如下：
 * 1. 使用NestJS的依赖注入机制，作为全局服务提供配置访问
 * 2. 在构造函数中异步初始化配置，确保配置在服务启动时加载完成
 * 3. 使用只读配置对象，防止运行时配置被意外修改
 * 4. 提供类型安全的配置访问方法，支持泛型约束
 * 5. 集成环境变量管理，支持动态配置更新
 * 6. 使用自定义的PinoLoggerService进行日志记录，提供高性能的结构化日志
 *
 * 功能与业务规则：
 * 1. 配置加载和初始化
 * 2. 配置获取和验证
 * 3. 环境变量管理
 * 4. 配置模块化访问
 * 5. 类型安全的配置操作
 * 6. 结构化日志记录
 */
let ConfigService = (() => {
    let _classDecorators = [(0, common_1.Injectable)()];
    let _classDescriptor;
    let _classExtraInitializers = [];
    let _classThis;
    var ConfigService = _classThis = class {
        /**
         * @constructor
         * @description
         * 配置服务构造函数，在服务实例化时自动初始化配置。
         * 由于构造函数不能是异步的，所以使用void调用异步初始化方法。
         *
         * @param logger 自定义的Pino日志服务实例
         */
        constructor(logger) {
            /** 环境配置对象 */
            this.environment = {
                production: process.env.NODE_ENV === 'production',
                env: {},
            };
            /** 系统配置对象 */
            this.config = {};
            this.logger = logger;
            void this.initConfig();
        }
        /**
         * @function initConfig
         * @description
         * 初始化配置和环境变量。该方法在服务启动时被调用，负责加载所有配置信息
         * 并设置环境变量。由于构造函数不能是异步的，所以使用独立的异步方法。
         *
         * 主要原理与机制如下：
         * 1. 调用getConfig()方法获取完整的配置对象
         * 2. 遍历环境配置，动态设置process.env环境变量
         * 3. 记录生产环境状态到日志中
         * 4. 确保配置在服务启动前完成加载
         * 5. 使用自定义的PinoLoggerService记录结构化日志
         *
         * 功能与业务规则：
         * 1. 配置加载和初始化
         * 2. 环境变量设置
         * 3. 启动状态日志记录
         * 4. 配置验证和错误处理
         * 5. 结构化日志记录
         *
         * @returns {Promise<void>} 返回一个Promise，表示配置初始化过程
         */
        async initConfig() {
            this.config = (0, config_loader_1.getConfig)();
            // 动态设置环境变量
            if (this.environment.env) {
                Object.entries(this.environment.env).forEach(([key, value]) => {
                    process.env[key] = value;
                });
            }
            if (this.logger) {
                this.logger.info(`配置服务初始化完成，生产环境状态: ${this.environment.production}`, logging_1.LogContext.CONFIG, {
                    isProduction: this.environment.production,
                    nodeEnv: process.env.NODE_ENV,
                    configKeys: Object.keys(this.config),
                });
            }
        }
        /**
         * @function getConfig
         * @description
         * 获取完整的配置对象，返回一个只读的配置副本。该方法提供了对系统所有配置的访问，
         * 同时确保返回的配置对象不会被意外修改。
         *
         * 主要原理与机制如下：
         * 1. 使用Object.freeze()创建不可变的配置对象
         * 2. 使用展开运算符创建配置对象的深拷贝
         * 3. 返回只读类型，防止运行时修改
         * 4. 提供类型安全的配置访问
         * 5. 记录配置访问日志，便于审计和调试
         *
         * 功能与业务规则：
         * 1. 完整配置获取
         * 2. 配置对象保护
         * 3. 类型安全访问
         * 4. 配置完整性保证
         * 5. 配置访问审计
         *
         * @returns {Readonly<Partial<IamConfig>>} 返回只读的完整配置对象
         */
        getConfig() {
            this.logger.debug('获取完整配置对象', logging_1.LogContext.CONFIG, {
                configKeys: Object.keys(this.config),
                timestamp: new Date().toISOString(),
            });
            return Object.freeze({ ...this.config });
        }
        /**
         * @function getConfigValue
         * @description
         * 获取指定的配置值，支持泛型类型安全。该方法提供了对特定配置模块的访问，
         * 如果配置键不存在会抛出错误。
         *
         * 主要原理与机制如下：
         * 1. 使用泛型K约束配置键的类型
         * 2. 检查配置键是否存在，不存在则抛出错误
         * 3. 返回只读的配置值，确保类型安全
         * 4. 支持TypeScript的类型推断
         * 5. 记录配置访问日志，便于审计和调试
         *
         * 功能与业务规则：
         * 1. 特定配置获取
         * 2. 配置键验证
         * 3. 类型安全访问
         * 4. 错误处理和提示
         * 5. 配置访问审计
         *
         * @template K - 配置键的类型
         * @param {K} key - 要获取的配置键
         * @returns {Readonly<IamConfig[K]>} 返回只读的配置值
         * @throws {Error} 当配置键不存在时抛出错误
         */
        getConfigValue(key) {
            if (!(key in this.config)) {
                this.logger.error(`配置键不存在: ${String(key)}`, logging_1.LogContext.CONFIG, {
                    requestedKey: String(key),
                    availableKeys: Object.keys(this.config),
                    timestamp: new Date().toISOString(),
                });
                throw new Error(`Configuration key "${String(key)}" not found.`);
            }
            this.logger.debug(`获取配置值: ${String(key)}`, logging_1.LogContext.CONFIG, {
                configKey: String(key),
                timestamp: new Date().toISOString(),
            });
            return this.config[key];
        }
        /**
         * @getter appConfig
         * @description
         * 获取应用基础配置，包含应用名称、版本、环境等基础信息。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的应用配置对象
         */
        get appConfig() {
            return this.config.app ?? {};
        }
        /**
         * @getter databaseConfig
         * @description
         * 获取数据库配置，包含数据库连接、ORM配置、连接池等设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的数据库配置对象
         */
        get databaseConfig() {
            return this.config.database ?? {};
        }
        /**
         * @getter redisConfig
         * @description
         * 获取Redis缓存配置，包含连接信息、缓存策略、分布式锁等设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的Redis配置对象
         */
        get redisConfig() {
            return this.config.redis ?? {};
        }
        /**
         * @getter jwtConfig
         * @description
         * 获取JWT认证配置，包含密钥、令牌过期时间、多租户支持等设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的JWT配置对象
         */
        get jwtConfig() {
            return this.config.jwt ?? {};
        }
        /**
         * @getter emailConfig
         * @description
         * 获取邮件服务配置，包含SMTP设置、邮件模板、发送策略等配置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的邮件配置对象
         */
        get emailConfig() {
            return this.config.email ?? {};
        }
        /**
         * @getter loggingConfig
         * @description
         * 获取日志系统配置，包含日志级别、输出格式、聚合设置等配置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的日志配置对象
         */
        get loggingConfig() {
            return this.config.logging ?? {};
        }
        /**
         * @getter settingConfig
         * @description
         * 获取系统设置配置，包含系统级配置项和全局设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的系统设置配置对象
         */
        get settingConfig() {
            return this.config.setting ?? {};
        }
        /**
         * @getter keycloakConfig
         * @description
         * 获取Keycloak集成配置，包含第三方认证服务的连接和设置。
         *
         * @returns {Readonly<Record<string, unknown>>} 返回只读的Keycloak配置对象
         */
        get keycloakConfig() {
            return this.config.keycloak ?? {};
        }
        /**
         * @getter dbMikroOrmConnectionOptions
         * @description
         * 获取MikroORM连接配置选项，用于数据库连接和ORM操作。
         *
         * @returns {Readonly<MikroOrmModuleOptions>} 返回只读的MikroORM配置对象
         */
        get dbMikroOrmConnectionOptions() {
            return this.config.database?.dbMikroOrmConnectionOptions ?? {};
        }
        /**
         * @getter dbKnexConnectionOptions
         * @description
         * 获取Knex连接配置选项，用于复杂查询和数据库迁移。
         *
         * @returns {Readonly<KnexModuleOptions>} 返回只读的Knex配置对象
         */
        get dbKnexConnectionOptions() {
            return (this.config.database?.dbKnexConnectionOptions ?? {
                config: {},
            });
        }
        /**
         * @function get
         * @description
         * 获取环境变量值，支持类型推断。该方法提供了对环境变量的类型安全访问，
         * 如果环境变量不存在会抛出错误。
         *
         * 主要原理与机制如下：
         * 1. 使用泛型K约束环境变量键的类型
         * 2. 检查环境变量是否存在，不存在则抛出错误
         * 3. 返回类型安全的环境变量值
         * 4. 支持TypeScript的类型推断和自动补全
         * 5. 记录环境变量访问日志，便于审计和调试
         *
         * 功能与业务规则：
         * 1. 环境变量获取
         * 2. 类型安全访问
         * 3. 错误处理和提示
         * 4. 环境变量验证
         * 5. 环境变量访问审计
         *
         * @template K - 环境变量键的类型
         * @param {K} key - 要获取的环境变量键
         * @returns {string} 返回对应的环境变量值
         * @throws {Error} 当环境变量不存在时抛出错误
         */
        get(key) {
            const value = process.env[key];
            if (!value) {
                this.logger.error(`环境变量未定义: ${key}`, logging_1.LogContext.CONFIG, {
                    requestedKey: key,
                    availableEnvVars: Object.keys(process.env).filter(k => k.startsWith('DB_') || k.startsWith('LOG_') || k.startsWith('JWT_')),
                    timestamp: new Date().toISOString(),
                });
                throw new Error(`Environment variable "${key}" is not defined.`);
            }
            this.logger.debug(`获取环境变量: ${key}`, logging_1.LogContext.CONFIG, {
                envKey: key,
                hasValue: !!value,
                timestamp: new Date().toISOString(),
            });
            return value;
        }
        /**
         * @function isProd
         * @description
         * 检查应用是否运行在生产环境模式。该方法用于判断当前运行环境，
         * 帮助应用根据环境调整行为。
         *
         * 主要原理与机制如下：
         * 1. 从环境配置中获取production标志
         * 2. 返回布尔值表示是否为生产环境
         * 3. 用于条件逻辑和环境相关配置
         *
         * 功能与业务规则：
         * 1. 环境判断
         * 2. 条件逻辑支持
         * 3. 环境相关配置
         * 4. 调试和部署支持
         *
         * @returns {boolean} 返回true表示生产环境，false表示非生产环境
         */
        isProd() {
            return this.environment.production;
        }
    };
    __setFunctionName(_classThis, "ConfigService");
    (() => {
        const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
        __esDecorate(null, _classDescriptor = { value: _classThis }, _classDecorators, { kind: "class", name: _classThis.name, metadata: _metadata }, null, _classExtraInitializers);
        ConfigService = _classThis = _classDescriptor.value;
        if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
        __runInitializers(_classThis, _classExtraInitializers);
    })();
    return ConfigService = _classThis;
})();
exports.ConfigService = ConfigService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY29uZmlnL3NyYy9jb25maWcuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUE0QztBQUc1QyxtREFBNEM7QUFDNUMsNkNBQWdFO0FBMkNoRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBcUJHO0lBRVUsYUFBYTs0QkFEekIsSUFBQSxtQkFBVSxHQUFFOzs7OztRQVlYOzs7Ozs7O1dBT0c7UUFDSCxZQUFZLE1BQXlCO1lBbEJyQyxhQUFhO1lBQ0ksZ0JBQVcsR0FBRztnQkFDN0IsVUFBVSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLFlBQVk7Z0JBQ2pELEdBQUcsRUFBRSxFQUE0QjthQUNsQyxDQUFDO1lBR0YsYUFBYTtZQUNMLFdBQU0sR0FBdUIsRUFBRSxDQUFDO1lBV3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQ3JCLEtBQUssSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3pCLENBQUM7UUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1dBcUJHO1FBQ0ssS0FBSyxDQUFDLFVBQVU7WUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFBLHlCQUFTLEdBQUUsQ0FBQztZQUUxQixXQUFXO1lBQ1gsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUN6QixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRTtvQkFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQzNCLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksSUFBSSxDQUFDLE1BQU0sRUFB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Q3RFO29CQUNELFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtpQkFDcEMsQ0FBQyxDQUFDO2dCQUNILE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLEdBQUcsbUJBQW1CLENBQUMsQ0FBQztZQUNuRSxDQUFDO1lBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxHQUFHLEVBQUUsRUFBRSxvQkFBVSxDQUFDLE1BQU0sRUFBRTtnQkFDckQsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsUUFBUSxFQUFFLENBQUMsQ0FBQyxLQUFLO2dCQUNqQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7YUFDcEMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7OztXQWtCRztRQUNILE1BQU07WUFDSixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDO1FBQ3JDLENBQUM7Ozs7O1FBclVILDZLQXNVQzs7O1FBdFVZLHVEQUFhOzs7O0FBQWIsc0NBQWEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvY29uZmlnL3NyYy9jb25maWcuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgTWlrcm9Pcm1Nb2R1bGVPcHRpb25zIH0gZnJvbSAnQG1pa3JvLW9ybS9uZXN0anMnO1xuaW1wb3J0IHsgS25leE1vZHVsZU9wdGlvbnMgfSBmcm9tICduZXN0LWtuZXhqcyc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL2NvbmZpZy1sb2FkZXInO1xuaW1wb3J0IHsgUGlub0xvZ2dlclNlcnZpY2UsIExvZ0NvbnRleHQgfSBmcm9tICdAYWlvZml4L2xvZ2dpbmcnO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgSWFtQ29uZmlnXG4gKiBAZGVzY3JpcHRpb25cbiAqIElBTeezu+e7n+mFjee9ruaOpeWPo++8jOWumuS5ieS6huezu+e7n+S4reaJgOaciemFjee9ruaooeWdl+eahOe7k+aehOOAglxuICog6K+l5o6l5Y+j5YyF5ZCr5LqG5bqU55So5Z+656GA6YWN572u44CB5pWw5o2u5bqT6YWN572u44CB57yT5a2Y6YWN572u44CB6K6k6K+B6YWN572u562J5ZCE5Liq5qih5Z2X55qE6YWN572u5a6a5LmJ44CCXG4gKlxuICog5Li76KaB5Y6f55CG5LiO5py65Yi25aaC5LiL77yaXG4gKiAxLiDkvb/nlKhUeXBlU2NyaXB05o6l5Y+j5a6a5LmJ6YWN572u57uT5p6E77yM56Gu5L+d57G75Z6L5a6J5YWoXG4gKiAyLiDmr4/kuKrphY3nva7mqKHlnZfpg73mnInni6znq4vnmoTlkb3lkI3nqbrpl7TvvIzpgb/lhY3phY3nva7lhrLnqoFcbiAqIDMuIOaUr+aMgemFjee9rueahOW1jOWll+e7k+aehO+8jOS+v+S6jue7hOe7h+WkjeadgueahOmFjee9rumhuVxuICogNC4g5L2/55SoUmVjb3JkPHN0cmluZywgdW5rbm93bj7nsbvlnovmj5DkvpvngbXmtLvmgKfvvIzlhbfkvZPnsbvlnovlnKjov5DooYzml7bnoa7lrppcbiAqXG4gKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAqIDEuIOW6lOeUqOWfuuehgOmFjee9ru+8iGFwcO+8ie+8muW6lOeUqOWQjeensOOAgeeJiOacrOOAgeeOr+Wig+etiVxuICogMi4g5pWw5o2u5bqT6YWN572u77yIZGF0YWJhc2XvvInvvJrmlbDmja7lupPov57mjqXjgIFPUk3phY3nva7nrYlcbiAqIDMuIOe8k+WtmOmFjee9ru+8iHJlZGlz77yJ77yaUmVkaXPov57mjqXjgIHnvJPlrZjnrZbnlaXnrYlcbiAqIDQuIOiupOivgemFjee9ru+8iGp3dO+8ie+8mkpXVOWvhumSpeOAgeS7pOeJjOmFjee9ruetiVxuICogNS4g6YKu5Lu26YWN572u77yIZW1haWzvvInvvJrpgq7ku7bmnI3liqHjgIHmqKHmnb/phY3nva7nrYlcbiAqIDYuIOaXpeW/l+mFjee9ru+8iGxvZ2dpbmfvvInvvJrml6Xlv5fnuqfliKvjgIHovpPlh7rphY3nva7nrYlcbiAqIDcuIOezu+e7n+iuvue9ru+8iHNldHRpbmfvvInvvJrns7vnu5/nuqfphY3nva7poblcbiAqIDguIOesrOS4ieaWuembhuaIkO+8iGtleWNsb2Fr77yJ77yaS2V5Y2xvYWvorqTor4HmnI3liqHphY3nva5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJYW1Db25maWcge1xuICAvKiog5bqU55So5Z+656GA6YWN572uICovXG4gIGFwcDogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIC8qKiDmlbDmja7lupPphY3nva4gKi9cbiAgZGF0YWJhc2U6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiogUmVkaXPnvJPlrZjphY3nva4gKi9cbiAgcmVkaXM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiogSldU6K6k6K+B6YWN572uICovXG4gIGp3dDogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIC8qKiDpgq7ku7bmnI3liqHphY3nva4gKi9cbiAgZW1haWw6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiog5pel5b+X57O757uf6YWN572uICovXG4gIGxvZ2dpbmc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiog57O757uf6K6+572u6YWN572uICovXG4gIHNldHRpbmc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAvKiogS2V5Y2xvYWvpm4bmiJDphY3nva4gKi9cbiAga2V5Y2xvYWs6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG4vKipcbiAqIEBjbGFzcyBDb25maWdTZXJ2aWNlXG4gKiBAZGVzY3JpcHRpb25cbiAqIElBTeezu+e7n+mFjee9ruacjeWKoe+8jOi0n+i0o+euoeeQhuWSjOaPkOS+m+ezu+e7n+S4reaJgOaciemFjee9ruS/oeaBr+OAglxuICog6K+l5pyN5Yqh5piv6YWN572u566h55CG55qE5qC45b+D57uE5Lu277yM5o+Q5L6b5LqG6YWN572u55qE5Yqg6L2944CB6I635Y+W44CB6aqM6K+B562J5Yqf6IO944CCXG4gKlxuICog5Li76KaB5Y6f55CG5LiO5py65Yi25aaC5LiL77yaXG4gKiAxLiDkvb/nlKhOZXN0SlPnmoTkvp3otZbms6jlhaXmnLrliLbvvIzkvZzkuLrlhajlsYDmnI3liqHmj5DkvpvphY3nva7orr/pl65cbiAqIDIuIOWcqOaehOmAoOWHveaVsOS4reW8guatpeWIneWni+WMlumFjee9ru+8jOehruS/nemFjee9ruWcqOacjeWKoeWQr+WKqOaXtuWKoOi9veWujOaIkFxuICogMy4g5L2/55So5Y+q6K+76YWN572u5a+56LGh77yM6Ziy5q2i6L+Q6KGM5pe26YWN572u6KKr5oSP5aSW5L+u5pS5XG4gKiA0LiDmj5DkvpvnsbvlnovlronlhajnmoTphY3nva7orr/pl67mlrnms5XvvIzmlK/mjIHms5vlnovnuqbmnZ9cbiAqIDUuIOmbhuaIkOeOr+Wig+WPmOmHj+euoeeQhu+8jOaUr+aMgeWKqOaAgemFjee9ruabtOaWsFxuICogNi4g5L2/55So6Ieq5a6a5LmJ55qEUGlub0xvZ2dlclNlcnZpY2Xov5vooYzml6Xlv5forrDlvZXvvIzmj5Dkvpvpq5jmgKfog73nmoTnu5PmnoTljJbml6Xlv5dcbiAqXG4gKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAqIDEuIOmFjee9ruWKoOi9veWSjOWIneWni+WMllxuICogMi4g6YWN572u6I635Y+W5ZKM6aqM6K+BXG4gKiAzLiDnjq/looPlj5jph4/nrqHnkIZcbiAqIDQuIOmFjee9ruaooeWdl+WMluiuv+mXrlxuICogNS4g57G75Z6L5a6J5YWo55qE6YWN572u5pON5L2cXG4gKiA2LiDnu5PmnoTljJbml6Xlv5forrDlvZVcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENvbmZpZ1NlcnZpY2Uge1xuICAvKiog546v5aKD6YWN572u5a+56LGhICovXG4gIHByaXZhdGUgcmVhZG9ubHkgZW52aXJvbm1lbnQgPSB7XG4gICAgcHJvZHVjdGlvbjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcbiAgICBlbnY6IHt9IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXG4gIH07XG4gIC8qKiDml6Xlv5fmnI3liqHlrp7kvosgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IFBpbm9Mb2dnZXJTZXJ2aWNlO1xuICAvKiog57O757uf6YWN572u5a+56LGhICovXG4gIHByaXZhdGUgY29uZmlnOiBQYXJ0aWFsPElhbUNvbmZpZz4gPSB7fTtcblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDphY3nva7mnI3liqHmnoTpgKDlh73mlbDvvIzlnKjmnI3liqHlrp7kvovljJbml7boh6rliqjliJ3lp4vljJbphY3nva7jgIJcbiAgICog55Sx5LqO5p6E6YCg5Ye95pWw5LiN6IO95piv5byC5q2l55qE77yM5omA5Lul5L2/55Sodm9pZOiwg+eUqOW8guatpeWIneWni+WMluaWueazleOAglxuICAgKlxuICAgKiBAcGFyYW0gbG9nZ2VyIOiHquWumuS5ieeahFBpbm/ml6Xlv5fmnI3liqHlrp7kvotcbiAgICovXG4gIGNvbnN0cnVjdG9yKGxvZ2dlcjogUGlub0xvZ2dlclNlcnZpY2UpIHtcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcbiAgICB2b2lkIHRoaXMuaW5pdENvbmZpZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBmdW5jdGlvbiBpbml0Q29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDliJ3lp4vljJbphY3nva7lkoznjq/looPlj5jph4/jgILor6Xmlrnms5XlnKjmnI3liqHlkK/liqjml7booqvosIPnlKjvvIzotJ/otKPliqDovb3miYDmnInphY3nva7kv6Hmga9cbiAgICog5bm26K6+572u546v5aKD5Y+Y6YeP44CC55Sx5LqO5p6E6YCg5Ye95pWw5LiN6IO95piv5byC5q2l55qE77yM5omA5Lul5L2/55So54us56uL55qE5byC5q2l5pa55rOV44CCXG4gICAqXG4gICAqIOS4u+imgeWOn+eQhuS4juacuuWItuWmguS4i++8mlxuICAgKiAxLiDosIPnlKhnZXRDb25maWcoKeaWueazleiOt+WPluWujOaVtOeahOmFjee9ruWvueixoVxuICAgKiAyLiDpgY3ljobnjq/looPphY3nva7vvIzliqjmgIHorr7nva5wcm9jZXNzLmVudueOr+Wig+WPmOmHj1xuICAgKiAzLiDorrDlvZXnlJ/kuqfnjq/looPnirbmgIHliLDml6Xlv5fkuK1cbiAgICogNC4g56Gu5L+d6YWN572u5Zyo5pyN5Yqh5ZCv5Yqo5YmN5a6M5oiQ5Yqg6L29XG4gICAqIDUuIOS9v+eUqOiHquWumuS5ieeahFBpbm9Mb2dnZXJTZXJ2aWNl6K6w5b2V57uT5p6E5YyW5pel5b+XXG4gICAqXG4gICAqIOWKn+iDveS4juS4muWKoeinhOWIme+8mlxuICAgKiAxLiDphY3nva7liqDovb3lkozliJ3lp4vljJZcbiAgICogMi4g546v5aKD5Y+Y6YeP6K6+572uXG4gICAqIDMuIOWQr+WKqOeKtuaAgeaXpeW/l+iusOW9lVxuICAgKiA0LiDphY3nva7pqozor4HlkozplJnor6/lpITnkIZcbiAgICogNS4g57uT5p6E5YyW5pel5b+X6K6w5b2VXG4gICAqXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fSDov5Tlm57kuIDkuKpQcm9taXNl77yM6KGo56S66YWN572u5Yid5aeL5YyW6L+H56iLXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGluaXRDb25maWcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5jb25maWcgPSBnZXRDb25maWcoKTtcblxuICAgIC8vIOWKqOaAgeiuvue9rueOr+Wig+WPmOmHj1xuICAgIGlmICh0aGlzLmVudmlyb25tZW50LmVudikge1xuICAgICAgT2JqZWN0LmVudHJpZXModGhpcy5lbnZpcm9ubWVudC5lbnYpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBwcm9jZXNzLmVudltrZXldID0gdmFsdWU7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sb2dnZXIpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oXG4gICAgICAgIGDphY3nva7mnI3liqHliJ3lp4vljJblrozmiJDvvIznlJ/kuqfnjq/looPnirbmgIE6ICR7dGhpcy5lbnZpcm9ubWVudC5wcm9kdWN0aW9ufWAsXG4gICAgICAgIExvZ0NvbnRleHQuQ09ORklHLFxuICAgICAgICB7XG4gICAgICAgICAgaXNQcm9kdWN0aW9uOiB0aGlzLmVudmlyb25tZW50LnByb2R1Y3Rpb24sXG4gICAgICAgICAgbm9kZUVudjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYsXG4gICAgICAgICAgY29uZmlnS2V5czogT2JqZWN0LmtleXModGhpcy5jb25maWcpLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGZ1bmN0aW9uIGdldENvbmZpZ1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W5a6M5pW055qE6YWN572u5a+56LGh77yM6L+U5Zue5LiA5Liq5Y+q6K+755qE6YWN572u5Ymv5pys44CC6K+l5pa55rOV5o+Q5L6b5LqG5a+557O757uf5omA5pyJ6YWN572u55qE6K6/6Zeu77yMXG4gICAqIOWQjOaXtuehruS/nei/lOWbnueahOmFjee9ruWvueixoeS4jeS8muiiq+aEj+WkluS/ruaUueOAglxuICAgKlxuICAgKiDkuLvopoHljp/nkIbkuI7mnLrliLblpoLkuIvvvJpcbiAgICogMS4g5L2/55SoT2JqZWN0LmZyZWV6ZSgp5Yib5bu65LiN5Y+v5Y+Y55qE6YWN572u5a+56LGhXG4gICAqIDIuIOS9v+eUqOWxleW8gOi/kOeul+espuWIm+W7uumFjee9ruWvueixoeeahOa3seaLt+i0nVxuICAgKiAzLiDov5Tlm57lj6ror7vnsbvlnovvvIzpmLLmraLov5DooYzml7bkv67mlLlcbiAgICogNC4g5o+Q5L6b57G75Z6L5a6J5YWo55qE6YWN572u6K6/6ZeuXG4gICAqIDUuIOiusOW9lemFjee9ruiuv+mXruaXpeW/l++8jOS+v+S6juWuoeiuoeWSjOiwg+ivlVxuICAgKlxuICAgKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAgICogMS4g5a6M5pW06YWN572u6I635Y+WXG4gICAqIDIuIOmFjee9ruWvueixoeS/neaKpFxuICAgKiAzLiDnsbvlnovlronlhajorr/pl65cbiAgICogNC4g6YWN572u5a6M5pW05oCn5L+d6K+BXG4gICAqIDUuIOmFjee9ruiuv+mXruWuoeiuoVxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UGFydGlhbDxJYW1Db25maWc+Pn0g6L+U5Zue5Y+q6K+755qE5a6M5pW06YWN572u5a+56LGhXG4gICAqL1xuICBwdWJsaWMgZ2V0Q29uZmlnKCk6IFJlYWRvbmx5PFBhcnRpYWw8SWFtQ29uZmlnPj4ge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKCfojrflj5blrozmlbTphY3nva7lr7nosaEnLCBMb2dDb250ZXh0LkNPTkZJRywge1xuICAgICAgY29uZmlnS2V5czogT2JqZWN0LmtleXModGhpcy5jb25maWcpLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfSk7XG4gICAgcmV0dXJuIE9iamVjdC5mcmVlemUoeyAuLi50aGlzLmNvbmZpZyB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZnVuY3Rpb24gZ2V0Q29uZmlnVmFsdWVcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPluaMh+WumueahOmFjee9ruWAvO+8jOaUr+aMgeazm+Wei+exu+Wei+WuieWFqOOAguivpeaWueazleaPkOS+m+S6huWvueeJueWumumFjee9ruaooeWdl+eahOiuv+mXru+8jFxuICAgKiDlpoLmnpzphY3nva7plK7kuI3lrZjlnKjkvJrmipvlh7rplJnor6/jgIJcbiAgICpcbiAgICog5Li76KaB5Y6f55CG5LiO5py65Yi25aaC5LiL77yaXG4gICAqIDEuIOS9v+eUqOazm+Wei0vnuqbmnZ/phY3nva7plK7nmoTnsbvlnotcbiAgICogMi4g5qOA5p+l6YWN572u6ZSu5piv5ZCm5a2Y5Zyo77yM5LiN5a2Y5Zyo5YiZ5oqb5Ye66ZSZ6K+vXG4gICAqIDMuIOi/lOWbnuWPquivu+eahOmFjee9ruWAvO+8jOehruS/neexu+Wei+WuieWFqFxuICAgKiA0LiDmlK/mjIFUeXBlU2NyaXB055qE57G75Z6L5o6o5patXG4gICAqIDUuIOiusOW9lemFjee9ruiuv+mXruaXpeW/l++8jOS+v+S6juWuoeiuoeWSjOiwg+ivlVxuICAgKlxuICAgKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAgICogMS4g54m55a6a6YWN572u6I635Y+WXG4gICAqIDIuIOmFjee9rumUrumqjOivgVxuICAgKiAzLiDnsbvlnovlronlhajorr/pl65cbiAgICogNC4g6ZSZ6K+v5aSE55CG5ZKM5o+Q56S6XG4gICAqIDUuIOmFjee9ruiuv+mXruWuoeiuoVxuICAgKlxuICAgKiBAdGVtcGxhdGUgSyAtIOmFjee9rumUrueahOexu+Wei1xuICAgKiBAcGFyYW0ge0t9IGtleSAtIOimgeiOt+WPlueahOmFjee9rumUrlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8SWFtQ29uZmlnW0tdPn0g6L+U5Zue5Y+q6K+755qE6YWN572u5YC8XG4gICAqIEB0aHJvd3Mge0Vycm9yfSDlvZPphY3nva7plK7kuI3lrZjlnKjml7bmipvlh7rplJnor69cbiAgICovXG4gIHB1YmxpYyBnZXRDb25maWdWYWx1ZTxLIGV4dGVuZHMga2V5b2YgSWFtQ29uZmlnPihcbiAgICBrZXk6IEssXG4gICk6IFJlYWRvbmx5PElhbUNvbmZpZ1tLXT4ge1xuICAgIGlmICghKGtleSBpbiB0aGlzLmNvbmZpZykpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGDphY3nva7plK7kuI3lrZjlnKg6ICR7U3RyaW5nKGtleSl9YCwgTG9nQ29udGV4dC5DT05GSUcsIHtcbiAgICAgICAgcmVxdWVzdGVkS2V5OiBTdHJpbmcoa2V5KSxcbiAgICAgICAgYXZhaWxhYmxlS2V5czogT2JqZWN0LmtleXModGhpcy5jb25maWcpLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb25maWd1cmF0aW9uIGtleSBcIiR7U3RyaW5nKGtleSl9XCIgbm90IGZvdW5kLmApO1xuICAgIH1cblxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGDojrflj5bphY3nva7lgLw6ICR7U3RyaW5nKGtleSl9YCwgTG9nQ29udGV4dC5DT05GSUcsIHtcbiAgICAgIGNvbmZpZ0tleTogU3RyaW5nKGtleSksXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmNvbmZpZ1trZXldIGFzIFJlYWRvbmx5PElhbUNvbmZpZ1tLXT47XG4gIH1cblxuICAvKipcbiAgICogQGdldHRlciBhcHBDb25maWdcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPluW6lOeUqOWfuuehgOmFjee9ru+8jOWMheWQq+W6lOeUqOWQjeensOOAgeeJiOacrOOAgeeOr+Wig+etieWfuuehgOS/oeaBr+OAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+fSDov5Tlm57lj6ror7vnmoTlupTnlKjphY3nva7lr7nosaFcbiAgICovXG4gIGdldCBhcHBDb25maWcoKTogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuYXBwID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgZGF0YWJhc2VDb25maWdcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPluaVsOaNruW6k+mFjee9ru+8jOWMheWQq+aVsOaNruW6k+i/nuaOpeOAgU9STemFjee9ruOAgei/nuaOpeaxoOetieiuvue9ruOAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+fSDov5Tlm57lj6ror7vnmoTmlbDmja7lupPphY3nva7lr7nosaFcbiAgICovXG4gIGdldCBkYXRhYmFzZUNvbmZpZygpOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5kYXRhYmFzZSA/PyB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZ2V0dGVyIHJlZGlzQ29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5ZSZWRpc+e8k+WtmOmFjee9ru+8jOWMheWQq+i/nuaOpeS/oeaBr+OAgee8k+WtmOetlueVpeOAgeWIhuW4g+W8j+mUgeetieiuvue9ruOAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+fSDov5Tlm57lj6ror7vnmoRSZWRpc+mFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IHJlZGlzQ29uZmlnKCk6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnJlZGlzID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgand0Q29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5ZKV1TorqTor4HphY3nva7vvIzljIXlkKvlr4bpkqXjgIHku6TniYzov4fmnJ/ml7bpl7TjgIHlpJrnp5/miLfmlK/mjIHnrYnorr7nva7jgIJcbiAgICpcbiAgICogQHJldHVybnMge1JlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+Pn0g6L+U5Zue5Y+q6K+755qESldU6YWN572u5a+56LGhXG4gICAqL1xuICBnZXQgand0Q29uZmlnKCk6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmp3dCA/PyB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZ2V0dGVyIGVtYWlsQ29uZmlnXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDojrflj5bpgq7ku7bmnI3liqHphY3nva7vvIzljIXlkKtTTVRQ6K6+572u44CB6YKu5Lu25qih5p2/44CB5Y+R6YCB562W55Wl562J6YWN572u44CCXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj59IOi/lOWbnuWPquivu+eahOmCruS7tumFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IGVtYWlsQ29uZmlnKCk6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmVtYWlsID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgbG9nZ2luZ0NvbmZpZ1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W5pel5b+X57O757uf6YWN572u77yM5YyF5ZCr5pel5b+X57qn5Yir44CB6L6T5Ye65qC85byP44CB6IGa5ZCI6K6+572u562J6YWN572u44CCXG4gICAqXG4gICAqIEByZXR1cm5zIHtSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj59IOi/lOWbnuWPquivu+eahOaXpeW/l+mFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IGxvZ2dpbmdDb25maWcoKTogUmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcubG9nZ2luZyA/PyB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZ2V0dGVyIHNldHRpbmdDb25maWdcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPluezu+e7n+iuvue9rumFjee9ru+8jOWMheWQq+ezu+e7n+e6p+mFjee9rumhueWSjOWFqOWxgOiuvue9ruOAglxuICAgKlxuICAgKiBAcmV0dXJucyB7UmVhZG9ubHk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+fSDov5Tlm57lj6ror7vnmoTns7vnu5/orr7nva7phY3nva7lr7nosaFcbiAgICovXG4gIGdldCBzZXR0aW5nQ29uZmlnKCk6IFJlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnNldHRpbmcgPz8ge307XG4gIH1cblxuICAvKipcbiAgICogQGdldHRlciBrZXljbG9ha0NvbmZpZ1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+WS2V5Y2xvYWvpm4bmiJDphY3nva7vvIzljIXlkKvnrKzkuInmlrnorqTor4HmnI3liqHnmoTov57mjqXlkozorr7nva7jgIJcbiAgICpcbiAgICogQHJldHVybnMge1JlYWRvbmx5PFJlY29yZDxzdHJpbmcsIHVua25vd24+Pn0g6L+U5Zue5Y+q6K+755qES2V5Y2xvYWvphY3nva7lr7nosaFcbiAgICovXG4gIGdldCBrZXljbG9ha0NvbmZpZygpOiBSZWFkb25seTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5rZXljbG9hayA/PyB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZ2V0dGVyIGRiTWlrcm9Pcm1Db25uZWN0aW9uT3B0aW9uc1xuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+WTWlrcm9PUk3ov57mjqXphY3nva7pgInpobnvvIznlKjkuo7mlbDmja7lupPov57mjqXlkoxPUk3mk43kvZzjgIJcbiAgICpcbiAgICogQHJldHVybnMge1JlYWRvbmx5PE1pa3JvT3JtTW9kdWxlT3B0aW9ucz59IOi/lOWbnuWPquivu+eahE1pa3JvT1JN6YWN572u5a+56LGhXG4gICAqL1xuICBnZXQgZGJNaWtyb09ybUNvbm5lY3Rpb25PcHRpb25zKCk6IFJlYWRvbmx5PE1pa3JvT3JtTW9kdWxlT3B0aW9ucz4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5kYXRhYmFzZT8uZGJNaWtyb09ybUNvbm5lY3Rpb25PcHRpb25zID8/IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBnZXR0ZXIgZGJLbmV4Q29ubmVjdGlvbk9wdGlvbnNcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOiOt+WPlktuZXjov57mjqXphY3nva7pgInpobnvvIznlKjkuo7lpI3mnYLmn6Xor6LlkozmlbDmja7lupPov4Hnp7vjgIJcbiAgICpcbiAgICogQHJldHVybnMge1JlYWRvbmx5PEtuZXhNb2R1bGVPcHRpb25zPn0g6L+U5Zue5Y+q6K+755qES25leOmFjee9ruWvueixoVxuICAgKi9cbiAgZ2V0IGRiS25leENvbm5lY3Rpb25PcHRpb25zKCk6IFJlYWRvbmx5PEtuZXhNb2R1bGVPcHRpb25zPiB7XG4gICAgcmV0dXJuICh0aGlzLmNvbmZpZy5kYXRhYmFzZT8uZGJLbmV4Q29ubmVjdGlvbk9wdGlvbnMgPz8ge1xuICAgICAgY29uZmlnOiB7fSxcbiAgICB9KSBhcyBSZWFkb25seTxLbmV4TW9kdWxlT3B0aW9ucz47XG4gIH1cblxuICAvKipcbiAgICogQGZ1bmN0aW9uIGdldFxuICAgKiBAZGVzY3JpcHRpb25cbiAgICog6I635Y+W546v5aKD5Y+Y6YeP5YC877yM5pSv5oyB57G75Z6L5o6o5pat44CC6K+l5pa55rOV5o+Q5L6b5LqG5a+5546v5aKD5Y+Y6YeP55qE57G75Z6L5a6J5YWo6K6/6Zeu77yMXG4gICAqIOWmguaenOeOr+Wig+WPmOmHj+S4jeWtmOWcqOS8muaKm+WHuumUmeivr+OAglxuICAgKlxuICAgKiDkuLvopoHljp/nkIbkuI7mnLrliLblpoLkuIvvvJpcbiAgICogMS4g5L2/55So5rOb5Z6LS+e6puadn+eOr+Wig+WPmOmHj+mUrueahOexu+Wei1xuICAgKiAyLiDmo4Dmn6Xnjq/looPlj5jph4/mmK/lkKblrZjlnKjvvIzkuI3lrZjlnKjliJnmipvlh7rplJnor69cbiAgICogMy4g6L+U5Zue57G75Z6L5a6J5YWo55qE546v5aKD5Y+Y6YeP5YC8XG4gICAqIDQuIOaUr+aMgVR5cGVTY3JpcHTnmoTnsbvlnovmjqjmlq3lkozoh6rliqjooaXlhahcbiAgICogNS4g6K6w5b2V546v5aKD5Y+Y6YeP6K6/6Zeu5pel5b+X77yM5L6/5LqO5a6h6K6h5ZKM6LCD6K+VXG4gICAqXG4gICAqIOWKn+iDveS4juS4muWKoeinhOWIme+8mlxuICAgKiAxLiDnjq/looPlj5jph4/ojrflj5ZcbiAgICogMi4g57G75Z6L5a6J5YWo6K6/6ZeuXG4gICAqIDMuIOmUmeivr+WkhOeQhuWSjOaPkOekulxuICAgKiA0LiDnjq/looPlj5jph4/pqozor4FcbiAgICogNS4g546v5aKD5Y+Y6YeP6K6/6Zeu5a6h6K6hXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSBLIC0g546v5aKD5Y+Y6YeP6ZSu55qE57G75Z6LXG4gICAqIEBwYXJhbSB7S30ga2V5IC0g6KaB6I635Y+W55qE546v5aKD5Y+Y6YeP6ZSuXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IOi/lOWbnuWvueW6lOeahOeOr+Wig+WPmOmHj+WAvFxuICAgKiBAdGhyb3dzIHtFcnJvcn0g5b2T546v5aKD5Y+Y6YeP5LiN5a2Y5Zyo5pe25oqb5Ye66ZSZ6K+vXG4gICAqL1xuICBnZXQ8SyBleHRlbmRzIHN0cmluZz4oa2V5OiBLKTogc3RyaW5nIHtcbiAgICBjb25zdCB2YWx1ZSA9IHByb2Nlc3MuZW52W2tleV07XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYOeOr+Wig+WPmOmHj+acquWumuS5iTogJHtrZXl9YCwgTG9nQ29udGV4dC5DT05GSUcsIHtcbiAgICAgICAgcmVxdWVzdGVkS2V5OiBrZXksXG4gICAgICAgIGF2YWlsYWJsZUVudlZhcnM6IE9iamVjdC5rZXlzKHByb2Nlc3MuZW52KS5maWx0ZXIoXG4gICAgICAgICAgayA9PlxuICAgICAgICAgICAgay5zdGFydHNXaXRoKCdEQl8nKSB8fCBrLnN0YXJ0c1dpdGgoJ0xPR18nKSB8fCBrLnN0YXJ0c1dpdGgoJ0pXVF8nKSxcbiAgICAgICAgKSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRW52aXJvbm1lbnQgdmFyaWFibGUgXCIke2tleX1cIiBpcyBub3QgZGVmaW5lZC5gKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ2dlci5kZWJ1Zyhg6I635Y+W546v5aKD5Y+Y6YePOiAke2tleX1gLCBMb2dDb250ZXh0LkNPTkZJRywge1xuICAgICAgZW52S2V5OiBrZXksXG4gICAgICBoYXNWYWx1ZTogISF2YWx1ZSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBmdW5jdGlvbiBpc1Byb2RcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOajgOafpeW6lOeUqOaYr+WQpui/kOihjOWcqOeUn+S6p+eOr+Wig+aooeW8j+OAguivpeaWueazleeUqOS6juWIpOaWreW9k+WJjei/kOihjOeOr+Wig++8jFxuICAgKiDluK7liqnlupTnlKjmoLnmja7njq/looPosIPmlbTooYzkuLrjgIJcbiAgICpcbiAgICog5Li76KaB5Y6f55CG5LiO5py65Yi25aaC5LiL77yaXG4gICAqIDEuIOS7jueOr+Wig+mFjee9ruS4reiOt+WPlnByb2R1Y3Rpb27moIflv5dcbiAgICogMi4g6L+U5Zue5biD5bCU5YC86KGo56S65piv5ZCm5Li655Sf5Lqn546v5aKDXG4gICAqIDMuIOeUqOS6juadoeS7tumAu+i+keWSjOeOr+Wig+ebuOWFs+mFjee9rlxuICAgKlxuICAgKiDlip/og73kuI7kuJrliqHop4TliJnvvJpcbiAgICogMS4g546v5aKD5Yik5patXG4gICAqIDIuIOadoeS7tumAu+i+keaUr+aMgVxuICAgKiAzLiDnjq/looPnm7jlhbPphY3nva5cbiAgICogNC4g6LCD6K+V5ZKM6YOo572y5pSv5oyBXG4gICAqXG4gICAqIEByZXR1cm5zIHtib29sZWFufSDov5Tlm550cnVl6KGo56S655Sf5Lqn546v5aKD77yMZmFsc2XooajnpLrpnZ7nlJ/kuqfnjq/looNcbiAgICovXG4gIGlzUHJvZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5lbnZpcm9ubWVudC5wcm9kdWN0aW9uO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=