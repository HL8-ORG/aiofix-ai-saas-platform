c7539fb22a01b01c35ef3f5d60ba2735
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const rxjs_1 = require("rxjs");
const pino_logging_interceptor_1 = require("./pino-logging.interceptor");
const pino_logger_service_1 = require("../services/pino-logger.service");
const logging_interface_1 = require("../interfaces/logging.interface");
describe('PinoLoggingInterceptor', () => {
    let interceptor;
    let logger;
    let mockExecutionContext;
    let mockCallHandler;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                pino_logging_interceptor_1.PinoLoggingInterceptor,
                {
                    provide: pino_logger_service_1.PinoLoggerService,
                    useValue: {
                        debug: jest.fn(),
                        info: jest.fn(),
                        error: jest.fn(),
                        performance: jest.fn(),
                    },
                },
            ],
        }).compile();
        interceptor = module.get(pino_logging_interceptor_1.PinoLoggingInterceptor);
        logger = module.get(pino_logger_service_1.PinoLoggerService);
        // 重置模拟
        jest.clearAllMocks();
    });
    beforeEach(() => {
        // 设置模拟执行上下文
        mockExecutionContext = {
            getHandler: jest.fn().mockReturnValue({ name: 'testMethod' }),
            getClass: jest.fn().mockReturnValue({ name: 'TestController' }),
            getArgs: jest.fn().mockReturnValue([
                {
                    method: 'GET',
                    requestId: 'req-123',
                    tenantId: 'tenant-123',
                    userId: 'user-456',
                },
                { statusCode: 200 },
                { id: 1, name: 'test' },
            ]),
            switchToHttp: jest.fn().mockReturnValue({
                getRequest: jest.fn().mockReturnValue({
                    requestId: 'req-123',
                    tenantId: 'tenant-123',
                    userId: 'user-456',
                }),
            }),
        };
        // 设置模拟调用处理器
        mockCallHandler = {
            handle: jest.fn().mockReturnValue((0, rxjs_1.of)({ success: true, data: 'test' })),
        };
    });
    it('should be defined', () => {
        expect(interceptor).toBeDefined();
    });
    describe('successful method execution', () => {
        it('should log method start and success', done => {
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: result => {
                    expect(logger.debug).toHaveBeenCalledWith('Method Start: TestController.testMethod', logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        methodId: expect.unknown(String),
                        className: 'TestController',
                        methodName: 'testMethod',
                        requestId: 'req-123',
                        tenantId: 'tenant-123',
                        userId: 'user-456',
                        parameters: [{ id: 1, name: 'test' }],
                    }));
                    expect(logger.info).toHaveBeenCalledWith(expect.stringMatching(/Method Success: TestController\.testMethod - \d+ms/), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        methodId: expect.unknown(String),
                        className: 'TestController',
                        methodName: 'testMethod',
                        requestId: 'req-123',
                        tenantId: 'tenant-123',
                        userId: 'user-456',
                        result: { success: true, data: 'test' },
                        duration: expect.unknown(Number),
                    }));
                    expect(logger.performance).toHaveBeenCalledWith('method_execution', expect.unknown(Number), logging_interface_1.LogContext.PERFORMANCE, expect.objectContaining({
                        methodId: expect.unknown(String),
                        className: 'TestController',
                        methodName: 'testMethod',
                    }));
                    expect(result).toEqual({ success: true, data: 'test' });
                    done();
                },
                error: done,
            });
        });
        it('should generate unique method ID for each call', done => {
            const methodIds = [];
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    const debugCall = logger.debug.mock.calls[0];
                    const methodId = debugCall[2].methodId;
                    methodIds.push(methodId);
                    interceptor
                        .intercept(mockExecutionContext, mockCallHandler)
                        .subscribe({
                        next: () => {
                            const secondDebugCall = logger.debug.mock
                                .calls[1];
                            const secondMethodId = secondDebugCall[2].methodId;
                            methodIds.push(secondMethodId);
                            expect(methodIds[0]).not.toBe(methodIds[1]);
                            expect(methodIds[0]).toMatch(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/);
                            expect(methodIds[1]).toMatch(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/);
                            done();
                        },
                        error: done,
                    });
                },
                error: done,
            });
        });
    });
    describe('method execution with error', () => {
        it('should log method start and error', done => {
            const testError = new Error('Test error');
            mockCallHandler.handle = jest
                .fn()
                .mockReturnValue((0, rxjs_1.throwError)(() => testError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    done(new Error('Should not reach here'));
                },
                error: error => {
                    expect(logger.debug).toHaveBeenCalledWith('Method Start: TestController.testMethod', logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        methodId: expect.unknown(String),
                        className: 'TestController',
                        methodName: 'testMethod',
                    }));
                    expect(logger.error).toHaveBeenCalledWith(expect.stringMatching(/Method Error: TestController\.testMethod - \d+ms/), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        methodId: expect.unknown(String),
                        className: 'TestController',
                        methodName: 'testMethod',
                        parameters: [{ id: 1, name: 'test' }],
                        duration: expect.unknown(Number),
                    }), testError);
                    expect(error).toBe(testError);
                    done();
                },
            });
        });
    });
    describe('parameter extraction', () => {
        it('should filter out HTTP request and response objects', done => {
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        parameters: [{ id: 1, name: 'test' }],
                    }));
                    done();
                },
                error: done,
            });
        });
        it('should handle empty parameters', done => {
            mockExecutionContext.getArgs = jest
                .fn()
                .mockReturnValue([{ method: 'GET' }, { statusCode: 200 }]);
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        parameters: [],
                    }));
                    done();
                },
                error: done,
            });
        });
    });
    describe('parameter sanitization', () => {
        it('should sanitize sensitive parameters', done => {
            mockExecutionContext.getArgs = jest.fn().mockReturnValue([
                { method: 'GET' },
                { statusCode: 200 },
                {
                    username: 'testuser',
                    password: 'secret123',
                    token: 'jwt-token',
                    email: 'test@example.com',
                },
            ]);
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        parameters: [
                            {
                                username: 'testuser',
                                password: '[REDACTED]',
                                token: '[REDACTED]',
                                email: 'test@example.com',
                            },
                        ],
                    }));
                    done();
                },
                error: done,
            });
        });
        it('should sanitize nested sensitive parameters', done => {
            mockExecutionContext.getArgs = jest.fn().mockReturnValue([
                { method: 'GET' },
                { statusCode: 200 },
                {
                    user: {
                        name: 'testuser',
                        credentials: {
                            password: 'secret123',
                            apiKey: 'key123',
                        },
                    },
                },
            ]);
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        parameters: [
                            {
                                user: {
                                    name: 'testuser',
                                    credentials: {
                                        password: '[REDACTED]',
                                        apiKey: '[REDACTED]',
                                    },
                                },
                            },
                        ],
                    }));
                    done();
                },
                error: done,
            });
        });
        it('should sanitize array parameters', done => {
            mockExecutionContext.getArgs = jest.fn().mockReturnValue([
                { method: 'GET' },
                { statusCode: 200 },
                [
                    { id: 1, password: 'secret1' },
                    { id: 2, password: 'secret2' },
                ],
            ]);
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        parameters: [
                            [
                                { id: 1, password: '[REDACTED]' },
                                { id: 2, password: '[REDACTED]' },
                            ],
                        ],
                    }));
                    done();
                },
                error: done,
            });
        });
    });
    describe('result sanitization', () => {
        it('should sanitize sensitive result fields', done => {
            mockCallHandler.handle = jest.fn().mockReturnValue((0, rxjs_1.of)({
                success: true,
                user: {
                    id: 1,
                    name: 'testuser',
                    password: 'secret123',
                    token: 'jwt-token',
                },
            }));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.info).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        result: {
                            success: true,
                            user: {
                                id: 1,
                                name: 'testuser',
                                password: '[REDACTED]',
                                token: '[REDACTED]',
                            },
                        },
                    }));
                    done();
                },
                error: done,
            });
        });
    });
    describe('context extraction', () => {
        it('should extract context from request', done => {
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        requestId: 'req-123',
                        tenantId: 'tenant-123',
                        userId: 'user-456',
                    }));
                    done();
                },
                error: done,
            });
        });
        it('should handle missing context', done => {
            mockExecutionContext.switchToHttp = jest.fn().mockReturnValue({
                getRequest: jest.fn().mockReturnValue({}),
            });
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: () => {
                    expect(logger.debug).toHaveBeenCalledWith(expect.unknown(String), logging_interface_1.LogContext.BUSINESS, expect.objectContaining({
                        requestId: undefined,
                        tenantId: undefined,
                        userId: undefined,
                    }));
                    done();
                },
                error: done,
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvbG9nZ2luZy9zcmMvaW50ZXJjZXB0b3JzL3Bpbm8tbG9nZ2luZy5pbnRlcmNlcHRvci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBRXRELCtCQUFzQztBQUN0Qyx5RUFBb0U7QUFDcEUseUVBQW9FO0FBQ3BFLHVFQUE2RDtBQUU3RCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLElBQUksV0FBbUMsQ0FBQztJQUN4QyxJQUFJLE1BQXlCLENBQUM7SUFDOUIsSUFBSSxvQkFBc0MsQ0FBQztJQUMzQyxJQUFJLGVBQTRCLENBQUM7SUFFakMsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1QsaURBQXNCO2dCQUN0QjtvQkFDRSxPQUFPLEVBQUUsdUNBQWlCO29CQUMxQixRQUFRLEVBQUU7d0JBQ1IsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUNoQixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtxQkFDdkI7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUF5QixpREFBc0IsQ0FBQyxDQUFDO1FBQ3pFLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFvQix1Q0FBaUIsQ0FBQyxDQUFDO1FBRTFELE9BQU87UUFDUCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsWUFBWTtRQUNaLG9CQUFvQixHQUFH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LENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLFNBQVMsRUFBRSxTQUFTO3dCQUNwQixRQUFRLEVBQUUsWUFBWTt3QkFDdEIsTUFBTSxFQUFFLFVBQVU7cUJBQ25CLENBQUMsQ0FDSCxDQUFDO29CQUNGLElBQUksRUFBRSxDQUFDO2dCQUNULENBQUM7Z0JBQ0QsS0FBSyxFQUFFLElBQUk7YUFDWixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxJQUFJLENBQUMsRUFBRTtZQUN6QyxvQkFBb0IsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztnQkFDNUQsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDO2FBQzFDLENBQUMsQ0FBQztZQUVILFdBQVcsQ0FBQyxTQUFTLENBQUMsb0JBQW9CLEVBQUUsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUNyRSxJQUFJLEVBQUUsR0FBRyxFQUFFO29CQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsb0JBQW9CLENBQ3ZDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQ3RCLDhCQUFVLENBQUMsUUFBUSxFQUNuQixNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3RCLFNBQVMsRUFBRSxTQUFTO3dCQUNwQixRQUFRLEVBQUUsU0FBUzt3QkFDbkIsTUFBTSxFQUFFLFNBQVM7cUJBQ2xCLENBQUMsQ0FDSCxDQUFDO29CQUNGLElBQUksRUFBRSxDQUFDO2dCQUNULENBQUM7Z0JBQ0QsS0FBSyxFQUFFLElBQUk7YUFDWixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvYXJsaWdsZS9WMS9BaW9maXgvYWlvZml4LWFpLXNhYXMtcGxhdGZvcm0vcGFja2FnZXMvbG9nZ2luZy9zcmMvaW50ZXJjZXB0b3JzL3Bpbm8tbG9nZ2luZy5pbnRlcmNlcHRvci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgRXhlY3V0aW9uQ29udGV4dCwgQ2FsbEhhbmRsZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUGlub0xvZ2dpbmdJbnRlcmNlcHRvciB9IGZyb20gJy4vcGluby1sb2dnaW5nLmludGVyY2VwdG9yJztcbmltcG9ydCB7IFBpbm9Mb2dnZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcGluby1sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBMb2dDb250ZXh0IH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9sb2dnaW5nLmludGVyZmFjZSc7XG5cbmRlc2NyaWJlKCdQaW5vTG9nZ2luZ0ludGVyY2VwdG9yJywgKCkgPT4ge1xuICBsZXQgaW50ZXJjZXB0b3I6IFBpbm9Mb2dnaW5nSW50ZXJjZXB0b3I7XG4gIGxldCBsb2dnZXI6IFBpbm9Mb2dnZXJTZXJ2aWNlO1xuICBsZXQgbW9ja0V4ZWN1dGlvbkNvbnRleHQ6IEV4ZWN1dGlvbkNvbnRleHQ7XG4gIGxldCBtb2NrQ2FsbEhhbmRsZXI6IENhbGxIYW5kbGVyO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgUGlub0xvZ2dpbmdJbnRlcmNlcHRvcixcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFBpbm9Mb2dnZXJTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBkZWJ1ZzogamVzdC5mbigpLFxuICAgICAgICAgICAgaW5mbzogamVzdC5mbigpLFxuICAgICAgICAgICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHBlcmZvcm1hbmNlOiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgaW50ZXJjZXB0b3IgPSBtb2R1bGUuZ2V0PFBpbm9Mb2dnaW5nSW50ZXJjZXB0b3I+KFBpbm9Mb2dnaW5nSW50ZXJjZXB0b3IpO1xuICAgIGxvZ2dlciA9IG1vZHVsZS5nZXQ8UGlub0xvZ2dlclNlcnZpY2U+KFBpbm9Mb2dnZXJTZXJ2aWNlKTtcblxuICAgIC8vIOmHjee9ruaooeaLn1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyDorr7nva7mqKHmi5/miafooYzkuIrkuIvmlodcbiAgICBtb2NrRXhlY3V0aW9uQ29udGV4dCA9IHtcbiAgICAgIGdldEhhbmRsZXI6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBuYW1lOiAndGVzdE1ldGhvZCcgfSksXG4gICAgICBnZXRDbGFzczogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IG5hbWU6ICdUZXN0Q29udHJvbGxlcicgfSksXG4gICAgICBnZXRBcmdzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgcmVxdWVzdElkOiAncmVxLTEyMycsXG4gICAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTQ1NicsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzQ29kZTogMjAwIH0sXG4gICAgICAgIHsgaWQ6IDEsIG5hbWU6ICd0ZXN0JyB9LFxuICAgICAgXSksXG4gICAgICBzd2l0Y2hUb0h0dHA6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBnZXRSZXF1ZXN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICByZXF1ZXN0SWQ6ICdyZXEtMTIzJyxcbiAgICAgICAgICB0ZW5hbnRJZDogJ3RlbmFudC0xMjMnLFxuICAgICAgICAgIHVzZXJJZDogJ3VzZXItNDU2JyxcbiAgICAgICAgfSksXG4gICAgICB9KSxcbiAgICB9IGFzIHVua25vd247XG5cbiAgICAvLyDorr7nva7mqKHmi5/osIPnlKjlpITnkIblmahcbiAgICBtb2NrQ2FsbEhhbmRsZXIgPSB7XG4gICAgICBoYW5kbGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUob2YoeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiAndGVzdCcgfSkpLFxuICAgIH07XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICBleHBlY3QoaW50ZXJjZXB0b3IpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdWNjZXNzZnVsIG1ldGhvZCBleGVjdXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBsb2cgbWV0aG9kIHN0YXJ0IGFuZCBzdWNjZXNzJywgZG9uZSA9PiB7XG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogcmVzdWx0ID0+IHtcbiAgICAgICAgICBleHBlY3QobG9nZ2VyLmRlYnVnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAgICdNZXRob2QgU3RhcnQ6IFRlc3RDb250cm9sbGVyLnRlc3RNZXRob2QnLFxuICAgICAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgbWV0aG9kSWQ6IGV4cGVjdC51bmtub3duKFN0cmluZyksXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogJ1Rlc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgbWV0aG9kTmFtZTogJ3Rlc3RNZXRob2QnLFxuICAgICAgICAgICAgICByZXF1ZXN0SWQ6ICdyZXEtMTIzJyxcbiAgICAgICAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiBbeyBpZDogMSwgbmFtZTogJ3Rlc3QnIH1dLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGV4cGVjdChsb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgICBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoXG4gICAgICAgICAgICAgIC9NZXRob2QgU3VjY2VzczogVGVzdENvbnRyb2xsZXJcXC50ZXN0TWV0aG9kIC0gXFxkK21zLyxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBMb2dDb250ZXh0LkJVU0lORVNTLFxuICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBtZXRob2RJZDogZXhwZWN0LnVua25vd24oU3RyaW5nKSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnVGVzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICBtZXRob2ROYW1lOiAndGVzdE1ldGhvZCcsXG4gICAgICAgICAgICAgIHJlcXVlc3RJZDogJ3JlcS0xMjMnLFxuICAgICAgICAgICAgICB0ZW5hbnRJZDogJ3RlbmFudC0xMjMnLFxuICAgICAgICAgICAgICB1c2VySWQ6ICd1c2VyLTQ1NicsXG4gICAgICAgICAgICAgIHJlc3VsdDogeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiAndGVzdCcgfSxcbiAgICAgICAgICAgICAgZHVyYXRpb246IGV4cGVjdC51bmtub3duKE51bWJlciksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgZXhwZWN0KGxvZ2dlci5wZXJmb3JtYW5jZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgICAnbWV0aG9kX2V4ZWN1dGlvbicsXG4gICAgICAgICAgICBleHBlY3QudW5rbm93bihOdW1iZXIpLFxuICAgICAgICAgICAgTG9nQ29udGV4dC5QRVJGT1JNQU5DRSxcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgbWV0aG9kSWQ6IGV4cGVjdC51bmtub3duKFN0cmluZyksXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogJ1Rlc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgbWV0aG9kTmFtZTogJ3Rlc3RNZXRob2QnLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiAndGVzdCcgfSk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgbWV0aG9kIElEIGZvciBlYWNoIGNhbGwnLCBkb25lID0+IHtcbiAgICAgIGNvbnN0IG1ldGhvZElkczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBjb25zdCBkZWJ1Z0NhbGwgPSAobG9nZ2VyLmRlYnVnIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXTtcbiAgICAgICAgICBjb25zdCBtZXRob2RJZCA9IGRlYnVnQ2FsbFsyXS5tZXRob2RJZDtcbiAgICAgICAgICBtZXRob2RJZHMucHVzaChtZXRob2RJZCk7XG5cbiAgICAgICAgICBpbnRlcmNlcHRvclxuICAgICAgICAgICAgLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKVxuICAgICAgICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmREZWJ1Z0NhbGwgPSAobG9nZ2VyLmRlYnVnIGFzIGplc3QuTW9jaykubW9ja1xuICAgICAgICAgICAgICAgICAgLmNhbGxzWzFdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZE1ldGhvZElkID0gc2Vjb25kRGVidWdDYWxsWzJdLm1ldGhvZElkO1xuICAgICAgICAgICAgICAgIG1ldGhvZElkcy5wdXNoKHNlY29uZE1ldGhvZElkKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChtZXRob2RJZHNbMF0pLm5vdC50b0JlKG1ldGhvZElkc1sxXSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KG1ldGhvZElkc1swXSkudG9NYXRjaChcbiAgICAgICAgICAgICAgICAgIC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzAtOWEtZl17NH0tWzAtOWEtZl17NH0tWzAtOWEtZl17MTJ9JC8sXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBleHBlY3QobWV0aG9kSWRzWzFdKS50b01hdGNoKFxuICAgICAgICAgICAgICAgICAgL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMC05YS1mXXs0fS1bMC05YS1mXXs0fS1bMC05YS1mXXsxMn0kLyxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZXJyb3I6IGRvbmUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGRvbmUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21ldGhvZCBleGVjdXRpb24gd2l0aCBlcnJvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyBtZXRob2Qgc3RhcnQgYW5kIGVycm9yJywgZG9uZSA9PiB7XG4gICAgICBjb25zdCB0ZXN0RXJyb3IgPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcbiAgICAgIG1vY2tDYWxsSGFuZGxlci5oYW5kbGUgPSBqZXN0XG4gICAgICAgIC5mbigpXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWUodGhyb3dFcnJvcigoKSA9PiB0ZXN0RXJyb3IpKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBkb25lKG5ldyBFcnJvcignU2hvdWxkIG5vdCByZWFjaCBoZXJlJykpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZXJyb3IgPT4ge1xuICAgICAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgJ01ldGhvZCBTdGFydDogVGVzdENvbnRyb2xsZXIudGVzdE1ldGhvZCcsXG4gICAgICAgICAgICBMb2dDb250ZXh0LkJVU0lORVNTLFxuICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBtZXRob2RJZDogZXhwZWN0LnVua25vd24oU3RyaW5nKSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnVGVzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICBtZXRob2ROYW1lOiAndGVzdE1ldGhvZCcsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgZXhwZWN0KGxvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgICBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoXG4gICAgICAgICAgICAgIC9NZXRob2QgRXJyb3I6IFRlc3RDb250cm9sbGVyXFwudGVzdE1ldGhvZCAtIFxcZCttcy8sXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgbWV0aG9kSWQ6IGV4cGVjdC51bmtub3duKFN0cmluZyksXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogJ1Rlc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgbWV0aG9kTmFtZTogJ3Rlc3RNZXRob2QnLFxuICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiBbeyBpZDogMSwgbmFtZTogJ3Rlc3QnIH1dLFxuICAgICAgICAgICAgICBkdXJhdGlvbjogZXhwZWN0LnVua25vd24oTnVtYmVyKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGVzdEVycm9yLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmUodGVzdEVycm9yKTtcbiAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BhcmFtZXRlciBleHRyYWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmlsdGVyIG91dCBIVFRQIHJlcXVlc3QgYW5kIHJlc3BvbnNlIG9iamVjdHMnLCBkb25lID0+IHtcbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGxvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgICBleHBlY3QudW5rbm93bihTdHJpbmcpLFxuICAgICAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgcGFyYW1ldGVyczogW3sgaWQ6IDEsIG5hbWU6ICd0ZXN0JyB9XSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgcGFyYW1ldGVycycsIGRvbmUgPT4ge1xuICAgICAgbW9ja0V4ZWN1dGlvbkNvbnRleHQuZ2V0QXJncyA9IGplc3RcbiAgICAgICAgLmZuKClcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZShbeyBtZXRob2Q6ICdHRVQnIH0sIHsgc3RhdHVzQ29kZTogMjAwIH1dKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBleHBlY3QobG9nZ2VyLmRlYnVnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAgIGV4cGVjdC51bmtub3duKFN0cmluZyksXG4gICAgICAgICAgICBMb2dDb250ZXh0LkJVU0lORVNTLFxuICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiBbXSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncGFyYW1ldGVyIHNhbml0aXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIHNlbnNpdGl2ZSBwYXJhbWV0ZXJzJywgZG9uZSA9PiB7XG4gICAgICBtb2NrRXhlY3V0aW9uQ29udGV4dC5nZXRBcmdzID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXG4gICAgICAgIHsgbWV0aG9kOiAnR0VUJyB9LFxuICAgICAgICB7IHN0YXR1c0NvZGU6IDIwMCB9LFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdzZWNyZXQxMjMnLFxuICAgICAgICAgIHRva2VuOiAnand0LXRva2VuJyxcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICB9LFxuICAgICAgXSk7XG5cbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGxvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgICBleHBlY3QudW5rbm93bihTdHJpbmcpLFxuICAgICAgICAgICAgTG9nQ29udGV4dC5CVVNJTkVTUyxcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgcGFyYW1ldGVyczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAndGVzdHVzZXInLFxuICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICdbUkVEQUNURURdJyxcbiAgICAgICAgICAgICAgICAgIHRva2VuOiAnW1JFREFDVEVEXScsXG4gICAgICAgICAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGRvbmUsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgbmVzdGVkIHNlbnNpdGl2ZSBwYXJhbWV0ZXJzJywgZG9uZSA9PiB7XG4gICAgICBtb2NrRXhlY3V0aW9uQ29udGV4dC5nZXRBcmdzID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXG4gICAgICAgIHsgbWV0aG9kOiAnR0VUJyB9LFxuICAgICAgICB7IHN0YXR1c0NvZGU6IDIwMCB9LFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgbmFtZTogJ3Rlc3R1c2VyJyxcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgICAgICAgIHBhc3N3b3JkOiAnc2VjcmV0MTIzJyxcbiAgICAgICAgICAgICAgYXBpS2V5OiAna2V5MTIzJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0pO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgZXhwZWN0LnVua25vd24oU3RyaW5nKSxcbiAgICAgICAgICAgIExvZ0NvbnRleHQuQlVTSU5FU1MsXG4gICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgIHBhcmFtZXRlcnM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0dXNlcicsXG4gICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICdbUkVEQUNURURdJyxcbiAgICAgICAgICAgICAgICAgICAgICBhcGlLZXk6ICdbUkVEQUNURURdJyxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzYW5pdGl6ZSBhcnJheSBwYXJhbWV0ZXJzJywgZG9uZSA9PiB7XG4gICAgICBtb2NrRXhlY3V0aW9uQ29udGV4dC5nZXRBcmdzID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXG4gICAgICAgIHsgbWV0aG9kOiAnR0VUJyB9LFxuICAgICAgICB7IHN0YXR1c0NvZGU6IDIwMCB9LFxuICAgICAgICBbXG4gICAgICAgICAgeyBpZDogMSwgcGFzc3dvcmQ6ICdzZWNyZXQxJyB9LFxuICAgICAgICAgIHsgaWQ6IDIsIHBhc3N3b3JkOiAnc2VjcmV0MicgfSxcbiAgICAgICAgXSxcbiAgICAgIF0pO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgZXhwZWN0LnVua25vd24oU3RyaW5nKSxcbiAgICAgICAgICAgIExvZ0NvbnRleHQuQlVTSU5FU1MsXG4gICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgIHBhcmFtZXRlcnM6IFtcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICB7IGlkOiAxLCBwYXNzd29yZDogJ1tSRURBQ1RFRF0nIH0sXG4gICAgICAgICAgICAgICAgICB7IGlkOiAyLCBwYXNzd29yZDogJ1tSRURBQ1RFRF0nIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVzdWx0IHNhbml0aXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIHNlbnNpdGl2ZSByZXN1bHQgZmllbGRzJywgZG9uZSA9PiB7XG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcbiAgICAgICAgb2Yoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICBuYW1lOiAndGVzdHVzZXInLFxuICAgICAgICAgICAgcGFzc3dvcmQ6ICdzZWNyZXQxMjMnLFxuICAgICAgICAgICAgdG9rZW46ICdqd3QtdG9rZW4nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBleHBlY3QobG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgZXhwZWN0LnVua25vd24oU3RyaW5nKSxcbiAgICAgICAgICAgIExvZ0NvbnRleHQuQlVTSU5FU1MsXG4gICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgIHJlc3VsdDoge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICAgICAgICBuYW1lOiAndGVzdHVzZXInLFxuICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICdbUkVEQUNURURdJyxcbiAgICAgICAgICAgICAgICAgIHRva2VuOiAnW1JFREFDVEVEXScsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29udGV4dCBleHRyYWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXh0cmFjdCBjb250ZXh0IGZyb20gcmVxdWVzdCcsIGRvbmUgPT4ge1xuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBleHBlY3QobG9nZ2VyLmRlYnVnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAgIGV4cGVjdC51bmtub3duKFN0cmluZyksXG4gICAgICAgICAgICBMb2dDb250ZXh0LkJVU0lORVNTLFxuICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICByZXF1ZXN0SWQ6ICdyZXEtMTIzJyxcbiAgICAgICAgICAgICAgdGVuYW50SWQ6ICd0ZW5hbnQtMTIzJyxcbiAgICAgICAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKTtcbiAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBkb25lLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIGNvbnRleHQnLCBkb25lID0+IHtcbiAgICAgIG1vY2tFeGVjdXRpb25Db250ZXh0LnN3aXRjaFRvSHR0cCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBnZXRSZXF1ZXN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHt9KSxcbiAgICAgIH0pO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdChsb2dnZXIuZGVidWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgZXhwZWN0LnVua25vd24oU3RyaW5nKSxcbiAgICAgICAgICAgIExvZ0NvbnRleHQuQlVTSU5FU1MsXG4gICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgIHJlcXVlc3RJZDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB0ZW5hbnRJZDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB1c2VySWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZG9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9