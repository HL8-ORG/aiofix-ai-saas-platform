{"version":3,"names":["ValueObject","constructor","value","cov_tn7b26wh","f","s","_value","Object","freeze","equals","other","b","deepEquals","a","undefined","Array","isArray","length","i","keysA","keys","keysB","key","includes","toString","JSON","stringify","hashCode","exports"],"sources":["/home/arligle/V1/Aiofix/aiofix-ai-saas-platform/packages/core/src/domain/value-object.ts"],"sourcesContent":["/**\n * @class ValueObject\n * @description\n * 值对象基类，封装不变性约束、相等性判断和业务概念。\n *\n * 不变性约束：\n * 1. 值对象一旦创建不可变更\n * 2. 所有属性都是只读的\n * 3. 通过Object.freeze确保不可变性\n *\n * 相等性判断：\n * 1. 基于值而不是引用进行相等性比较\n * 2. 支持深度比较复杂对象\n * 3. 提供哈希码计算用于集合操作\n *\n * 业务概念封装：\n * 1. 封装业务概念和验证逻辑\n * 2. 提供类型安全的业务操作\n * 3. 隐藏实现细节，暴露业务接口\n *\n * @property {T} _value 值对象的内部值，不可变\n *\n * @example\n * ```typescript\n * class Email extends ValueObject<string> {\n *   constructor(value: string) {\n *     super(value);\n *     this.validateEmail(value);\n *   }\n *\n *   private validateEmail(email: string): void {\n *     if (!email.includes('@')) {\n *       throw new Error('Invalid email format');\n *     }\n *   }\n * }\n *\n * const email1 = new Email('user@example.com');\n * const email2 = new Email('user@example.com');\n * console.log(email1.equals(email2)); // true\n * ```\n * @template T 值对象的类型\n * @abstract\n * @since 1.0.0\n */\nexport abstract class ValueObject<T> {\n  protected readonly _value: T;\n\n  constructor(value: T) {\n    this._value = Object.freeze(value);\n  }\n\n  /**\n   * 获取值对象的值\n   *\n   * @returns 值对象的值\n   */\n  public get value(): T {\n    return this._value;\n  }\n\n  /**\n   * 比较两个值对象是否相等\n   *\n   * @param other 另一个值对象\n   * @returns 是否相等\n   */\n  public equals(other: ValueObject<T>): boolean {\n    if (this === other) {\n      return true;\n    }\n\n    return this.deepEquals(this._value, other._value);\n  }\n\n  /**\n   * 深度比较两个值是否相等\n   *\n   * @param a 第一个值\n   * @param b 第二个值\n   * @returns 是否相等\n   */\n  private deepEquals(a: unknown, b: unknown): boolean {\n    if (a === b) {\n      return true;\n    }\n\n    if (a === null || b === null || a === undefined || b === undefined) {\n      return false;\n    }\n\n    if (typeof a !== typeof b) {\n      return false;\n    }\n\n    if (typeof a === 'object') {\n      if (Array.isArray(a) !== Array.isArray(b)) {\n        return false;\n      }\n\n      if (Array.isArray(a)) {\n        if (!Array.isArray(b) || a.length !== b.length) {\n          return false;\n        }\n        for (let i = 0; i < a.length; i++) {\n          if (!this.deepEquals(a[i], b[i])) {\n            return false;\n          }\n        }\n        return true;\n      }\n\n      const keysA = Object.keys(a as Record<string, unknown>);\n      const keysB = Object.keys(b as Record<string, unknown>);\n\n      if (keysA.length !== keysB.length) {\n        return false;\n      }\n\n      for (const key of keysA) {\n        if (!keysB.includes(key)) {\n          return false;\n        }\n        if (\n          !this.deepEquals(\n            (a as Record<string, unknown>)[key],\n            (b as Record<string, unknown>)[key],\n          )\n        ) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * 获取值对象的字符串表示\n   *\n   * @returns 字符串表示\n   */\n  public toString(): string {\n    if (typeof this._value === 'string') {\n      return this._value;\n    }\n    return JSON.stringify(this._value);\n  }\n\n  /**\n   * 获取值对象的哈希码\n   *\n   * @returns 哈希码\n   */\n  public hashCode(): string {\n    return this.toString();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}