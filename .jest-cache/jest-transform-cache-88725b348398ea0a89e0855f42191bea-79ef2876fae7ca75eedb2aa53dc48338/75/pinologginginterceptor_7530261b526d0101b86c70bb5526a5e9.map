{"version":3,"names":["common_1","cov_c8dgmnb52","s","require","rxjs_1","operators_1","uuid_1","logging_interface_1","PinoLoggingInterceptor","f","Injectable","constructor","logger","sensitiveParameters","intercept","context","next","startTime","Date","now","methodId","generateMethodId","request","switchToHttp","getRequest","requestId","tenantId","userId","handler","getHandler","className","getClass","name","methodName","parameters","extractParameters","methodLogData","sanitizeParameters","logMethodStart","handle","pipe","tap","result","duration","completedLogData","sanitizeResult","logMethodSuccess","catchError","error","errorLogData","logMethodError","throwError","v4","args","getArgs","filter","arg","index","b","method","statusCode","undefined","map","param","sanitizeObject","obj","Array","isArray","item","sanitized","key","value","Object","entries","includes","toLowerCase","data","debug","LogContext","BUSINESS","info","performance","PERFORMANCE","__esDecorate","_classDescriptor","_classThis","_classDecorators","kind","metadata","_metadata","_classExtraInitializers","__runInitializers","exports"],"sources":["/home/arligle/V1/Aiofix/aiofix-ai-saas-platform/packages/logging/src/interceptors/pino-logging.interceptor.ts"],"sourcesContent":["import {\n  Injectable,\n  NestInterceptor,\n  ExecutionContext,\n  CallHandler,\n} from '@nestjs/common';\nimport { Observable, throwError } from 'rxjs';\n\nimport { tap, catchError } from 'rxjs/operators';\nimport { v4 as uuidv4 } from 'uuid';\nimport { PinoLoggerService } from '../services/pino-logger.service';\nimport { LogContext } from '../interfaces/logging.interface';\n\n/**\n * @interface MethodLogData\n * @description 方法日志数据结构\n */\ninterface MethodLogData {\n  methodId: string;\n  className: string;\n  methodName: string;\n  startTime: number;\n  requestId?: string;\n  tenantId?: string;\n  userId?: string;\n  parameters?: unknown[];\n  result?: unknown;\n  error?: Error;\n  duration?: number;\n}\n\n/**\n * @class PinoLoggingInterceptor\n * @description\n * Pino日志拦截器，负责记录方法调用的详细日志。\n *\n * 主要功能包括：\n * 1. 为每个方法调用生成唯一ID\n * 2. 记录方法调用的开始和结束时间\n * 3. 记录方法参数和返回值\n * 4. 计算方法执行时间\n * 5. 记录异常信息\n * 6. 支持请求上下文追踪\n *\n * 设计原则：\n * - 高性能：最小化对方法执行的影响\n * - 结构化：提供结构化的日志数据\n * - 可配置：支持不同级别的日志记录\n * - 安全性：敏感参数过滤\n */\n@Injectable()\nexport class PinoLoggingInterceptor implements NestInterceptor {\n  private readonly sensitiveParameters = [\n    'password',\n    'token',\n    'secret',\n    'apikey',\n    'api_key',\n    'api-key',\n  ];\n\n  constructor(private readonly logger: PinoLoggerService) {}\n\n  /**\n   * @method intercept\n   * @description 拦截器主方法\n   * @param {ExecutionContext} context 执行上下文\n   * @param {CallHandler} next 下一个处理器\n   * @returns {Observable<unknown>} 可观察对象\n   */\n  intercept(context: ExecutionContext, next: CallHandler): Observable<unknown> {\n    const startTime = Date.now();\n    const methodId = this.generateMethodId();\n    const request = context.switchToHttp().getRequest();\n\n    // 提取上下文信息\n    const requestId = request?.requestId;\n    const tenantId = request?.tenantId;\n    const userId = request?.userId;\n\n    // 获取方法信息\n    const handler = context.getHandler();\n    const className = context.getClass().name;\n    const methodName = handler.name;\n\n    // 获取方法参数\n    const parameters = this.extractParameters(context);\n\n    // 创建方法日志数据\n    const methodLogData: MethodLogData = {\n      methodId,\n      className,\n      methodName,\n      startTime,\n      requestId,\n      tenantId,\n      userId,\n      parameters: this.sanitizeParameters(parameters),\n    };\n\n    // 记录方法开始日志\n    this.logMethodStart(methodLogData);\n\n    return next.handle().pipe(\n      tap(result => {\n        // 记录方法成功完成\n        const duration = Date.now() - startTime;\n        const completedLogData: MethodLogData = {\n          ...methodLogData,\n          result: this.sanitizeResult(result),\n          duration,\n        };\n        this.logMethodSuccess(completedLogData);\n      }),\n      catchError(error => {\n        // 记录方法异常\n        const duration = Date.now() - startTime;\n        const errorLogData: MethodLogData = {\n          ...methodLogData,\n          error,\n          duration,\n        };\n        this.logMethodError(errorLogData);\n        return throwError(() => error);\n      }),\n    );\n  }\n\n  /**\n   * @private\n   * @method generateMethodId\n   * @description 生成方法调用ID\n   * @returns {string} 方法调用ID\n   */\n  private generateMethodId(): string {\n    return uuidv4();\n  }\n\n  /**\n   * @private\n   * @method extractParameters\n   * @description 提取方法参数\n   * @param {ExecutionContext} context 执行上下文\n   * @returns {unknown[]} 方法参数\n   */\n  private extractParameters(context: ExecutionContext): unknown[] {\n    const args = context.getArgs();\n\n    // 过滤掉请求和响应对象，只保留业务参数\n    return args.filter((arg, index) => {\n      // 通常前两个参数是 request 和 response\n      if (index === 0 && arg?.method) return false; // HTTP request\n      if (index === 1 && arg?.statusCode !== undefined) return false; // HTTP response\n      return true;\n    });\n  }\n\n  /**\n   * @private\n   * @method sanitizeParameters\n   * @description 清理方法参数，移除敏感信息\n   * @param {unknown[]} parameters 方法参数\n   * @returns {unknown[]} 清理后的参数\n   */\n  private sanitizeParameters(parameters: unknown[]): unknown[] {\n    return parameters.map(param => this.sanitizeObject(param));\n  }\n\n  /**\n   * @private\n   * @method sanitizeResult\n   * @description 清理方法返回值，移除敏感信息\n   * @param {unknown} result 方法返回值\n   * @returns {unknown} 清理后的返回值\n   */\n  private sanitizeResult(result: unknown): unknown {\n    return this.sanitizeObject(result);\n  }\n\n  /**\n   * @private\n   * @method sanitizeObject\n   * @description 清理对象，移除敏感信息\n   * @param {unknown} obj 要清理的对象\n   * @returns {unknown} 清理后的对象\n   */\n  private sanitizeObject(obj: unknown): unknown {\n    if (!obj || typeof obj !== 'object') {\n      return obj;\n    }\n\n    // 如果是数组，递归处理每个元素\n    if (Array.isArray(obj)) {\n      return obj.map(item => this.sanitizeObject(item));\n    }\n\n    // 如果是对象，递归处理每个属性\n    const sanitized = { ...(obj as Record<string, unknown>) };\n\n    for (const [key, value] of Object.entries(sanitized)) {\n      if (this.sensitiveParameters.includes(key.toLowerCase())) {\n        (sanitized as Record<string, unknown>)[key] = '[REDACTED]';\n      } else if (typeof value === 'object' && value !== null) {\n        (sanitized as Record<string, unknown>)[key] =\n          this.sanitizeObject(value);\n      }\n    }\n\n    return sanitized;\n  }\n\n  /**\n   * @private\n   * @method logMethodStart\n   * @description 记录方法开始日志\n   * @param {MethodLogData} data 方法日志数据\n   */\n  private logMethodStart(data: MethodLogData): void {\n    this.logger.debug(\n      `Method Start: ${data.className}.${data.methodName}`,\n      LogContext.BUSINESS,\n      {\n        methodId: data.methodId,\n        className: data.className,\n        methodName: data.methodName,\n        requestId: data.requestId,\n        tenantId: data.tenantId,\n        userId: data.userId,\n        parameters: data.parameters,\n      },\n    );\n  }\n\n  /**\n   * @private\n   * @method logMethodSuccess\n   * @description 记录方法成功完成日志\n   * @param {MethodLogData} data 方法日志数据\n   */\n  private logMethodSuccess(data: MethodLogData): void {\n    this.logger.info(\n      `Method Success: ${data.className}.${data.methodName} - ${data.duration}ms`,\n      LogContext.BUSINESS,\n      {\n        methodId: data.methodId,\n        className: data.className,\n        methodName: data.methodName,\n        requestId: data.requestId,\n        tenantId: data.tenantId,\n        userId: data.userId,\n        result: data.result,\n        duration: data.duration,\n      },\n    );\n\n    // 记录性能日志\n    this.logger.performance(\n      'method_execution',\n      data.duration ?? 0,\n      LogContext.PERFORMANCE,\n      {\n        methodId: data.methodId,\n        className: data.className,\n        methodName: data.methodName,\n        requestId: data.requestId,\n        tenantId: data.tenantId,\n        userId: data.userId,\n      },\n    );\n  }\n\n  /**\n   * @private\n   * @method logMethodError\n   * @description 记录方法异常日志\n   * @param {MethodLogData} data 方法日志数据\n   */\n  private logMethodError(data: MethodLogData): void {\n    this.logger.error(\n      `Method Error: ${data.className}.${data.methodName} - ${data.duration}ms`,\n      LogContext.BUSINESS,\n      {\n        methodId: data.methodId,\n        className: data.className,\n        methodName: data.methodName,\n        requestId: data.requestId,\n        tenantId: data.tenantId,\n        userId: data.userId,\n        parameters: data.parameters,\n        duration: data.duration,\n      },\n      data.error,\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}