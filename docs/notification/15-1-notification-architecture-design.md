# é€šçŸ¥æ¨¡å—æ¶æ„è®¾è®¡

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†é€šçŸ¥æ¨¡å—çš„æŠ€æœ¯æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡åŸåˆ™ã€ä»£ç ç»„ç»‡æ¶æ„ã€å­é¢†åŸŸåˆ’åˆ†ç­–ç•¥ã€äº‹ä»¶é©±åŠ¨ç­–ç•¥å’ŒåŒ…ç»“æ„è®¾è®¡ã€‚

## 1. æ¶æ„è®¾è®¡åŸåˆ™

- **DDDæ¶æ„**: éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ŒæŒ‰ä¸šåŠ¡é¢†åŸŸç»„ç»‡ä»£ç 
- **Clean Architecture**: éµå¾ªæ¸…æ´æ¶æ„ï¼Œç¡®ä¿ä¾èµ–å€’ç½®
- **CQRS**: å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼Œä¼˜åŒ–è¯»å†™æ€§èƒ½
- **å…¨é¢äº‹ä»¶é©±åŠ¨**: æ‰€æœ‰ä¸šåŠ¡æ“ä½œéƒ½é€šè¿‡äº‹ä»¶é©±åŠ¨ï¼Œå®ç°æ¾è€¦åˆå’Œæœ€ç»ˆä¸€è‡´æ€§
- **å¤šç§Ÿæˆ·**: æ”¯æŒç§Ÿæˆ·çº§æ•°æ®éš”ç¦»å’Œé…ç½®
- **å¾®æœåŠ¡**: æ”¯æŒç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- **å­é¢†åŸŸåˆ’åˆ†**: åŸºäºé¢‘é“å’Œé€šçŸ¥æ–¹å¼åˆ’åˆ†å­é¢†åŸŸ
- **èšåˆæ ¹ä¸å®ä½“åˆ†ç¦»**: èšåˆæ ¹è´Ÿè´£ä¸šåŠ¡åè°ƒï¼Œé¢†åŸŸå®ä½“è´Ÿè´£çŠ¶æ€ç®¡ç†

## 2. èšåˆæ ¹ä¸é¢†åŸŸå®ä½“è®¾è®¡æ¨¡å¼

æœ¬è®¾è®¡é‡‡ç”¨**èšåˆæ ¹ä¸é¢†åŸŸå®ä½“åˆ†ç¦»**çš„æ¶æ„æ¨¡å¼ï¼š

### 2.1 èšåˆæ ¹ (Aggregate Root)

- **èŒè´£**: ä¸šåŠ¡åè°ƒã€äº‹ä»¶å‘å¸ƒã€äº‹åŠ¡è¾¹ç•Œæ§åˆ¶
- **ç»§æ‰¿**: `EventSourcedAggregateRoot`
- **ç‰¹ç‚¹**: ä¸ç›´æ¥ç®¡ç†çŠ¶æ€ï¼Œé€šè¿‡ç»„åˆé¢†åŸŸå®ä½“å®ç°ä¸šåŠ¡é€»è¾‘

### 2.2 é¢†åŸŸå®ä½“ (Domain Entity)

- **èŒè´£**: çŠ¶æ€ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯ã€åŸºç¡€è®¾æ–½åŠŸèƒ½
- **ç»§æ‰¿**: `BaseEntity`
- **ç‰¹ç‚¹**: æä¾›å®¡è®¡è¿½è¸ªã€ä¹è§‚é”ã€è½¯åˆ é™¤ç­‰ä¼ä¸šçº§åŠŸèƒ½

### 2.3 è®¾è®¡ä¼˜åŠ¿

1. **èŒè´£åˆ†ç¦»**: èšåˆæ ¹ä¸“æ³¨ä¸šåŠ¡åè°ƒï¼Œå®ä½“ä¸“æ³¨çŠ¶æ€ç®¡ç†
2. **åŸºç¡€è®¾æ–½å¤ç”¨**: é€šè¿‡BaseEntityæä¾›ç»Ÿä¸€çš„å®¡è®¡å’Œç‰ˆæœ¬æ§åˆ¶
3. **äº‹ä»¶é©±åŠ¨**: èšåˆæ ¹è´Ÿè´£äº‹ä»¶å‘å¸ƒï¼Œå®ä½“è´Ÿè´£çŠ¶æ€å˜æ›´
4. **å¯æµ‹è¯•æ€§**: èšåˆæ ¹å’Œå®ä½“å¯ä»¥ç‹¬ç«‹æµ‹è¯•
5. **å¯ç»´æŠ¤æ€§**: ä¸šåŠ¡é€»è¾‘å’ŒåŸºç¡€è®¾æ–½åŠŸèƒ½åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤

## 3. ä»£ç ç»„ç»‡æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           é€šçŸ¥æ¨¡å—ä»£ç ç»„ç»‡æ¶æ„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  packages/notification/                                                         â”‚
â”‚  â”œâ”€â”€ in-app/                    # ç«™å†…ä¿¡å­é¢†åŸŸåŒ…                                â”‚
â”‚  â”‚   â”œâ”€â”€ src/                                                                   â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ domain/            # é¢†åŸŸå±‚                                        â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/    # èšåˆæ ¹                                        â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif.aggregate.ts                                 â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ entities/      # é¢†åŸŸå®ä½“                                      â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif.entity.ts                                    â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/ # å€¼å¯¹è±¡                                        â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ notif-id.vo.ts                                            â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant-id.vo.ts                                           â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user-id.vo.ts                                             â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ notif-type.vo.ts                                          â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ notif-priority.vo.ts                                      â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ read-status.vo.ts                                         â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ events/        # é¢†åŸŸäº‹ä»¶                                      â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ in-app-notif-created.event.ts                             â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ in-app-notif-read.event.ts                                â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif-archived.event.ts                            â”‚
â”‚  â”‚   â”‚   â”‚   â””â”€â”€ services/      # é¢†åŸŸæœåŠ¡                                      â”‚
â”‚  â”‚   â”‚   â”‚       â””â”€â”€ notif-center.service.ts                                   â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ application/       # åº”ç”¨å±‚                                        â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ commands/      # å‘½ä»¤                                          â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-in-app-notif.command.ts                            â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mark-as-read.command.ts                                   â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ archive-notif.command.ts                                  â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ queries/       # æŸ¥è¯¢                                          â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ get-in-app-notifs.query.ts                                â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ get-notif-stats.query.ts                                  â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/      # å‘½ä»¤/æŸ¥è¯¢å¤„ç†å™¨                               â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-in-app-notif.handler.ts                            â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mark-as-read.handler.ts                                   â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ archive-notif.handler.ts                                  â”‚
â”‚  â”‚   â”‚   â”‚   â””â”€â”€ services/      # åº”ç”¨æœåŠ¡                                      â”‚
â”‚  â”‚   â”‚   â”‚       â””â”€â”€ in-app-notif.service.ts                                   â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½å±‚                                    â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/  # ä»“å‚¨å®ç°                                      â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif.repository.ts                                â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ entities/      # æ•°æ®åº“å®ä½“                                    â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif.entity.ts                                    â”‚
â”‚  â”‚   â”‚   â”‚   â””â”€â”€ adapters/      # å¤–éƒ¨æœåŠ¡é€‚é…å™¨                                â”‚
â”‚  â”‚   â”‚   â”‚       â””â”€â”€ database.adapter.ts                                       â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ interface/         # æ¥å£å±‚                                        â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/   # æ§åˆ¶å™¨                                        â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif.controller.ts                                â”‚
â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ dtos/          # æ•°æ®ä¼ è¾“å¯¹è±¡                                  â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-in-app-notif.dto.ts                                â”‚
â”‚  â”‚   â”‚   â”‚   â”‚   â””â”€â”€ in-app-notif.dto.ts                                       â”‚
â”‚  â”‚   â”‚   â”‚   â””â”€â”€ guards/        # å®ˆå«                                          â”‚
â”‚  â”‚   â”‚   â”‚       â””â”€â”€ notif.guard.ts                                            â”‚
â”‚  â”‚   â”‚   â””â”€â”€ index.ts           # åŒ…å…¥å£æ–‡ä»¶                                    â”‚
â”‚  â”‚   â”œâ”€â”€ package.json           # åŒ…é…ç½®                                        â”‚
â”‚  â”‚   â””â”€â”€ tsconfig.json          # TypeScripté…ç½®                                â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”œâ”€â”€ email/                     # é‚®ä»¶é€šçŸ¥å­é¢†åŸŸåŒ…                              â”‚
â”‚  â”œâ”€â”€ push/                      # æ¨é€é€šçŸ¥å­é¢†åŸŸåŒ…                              â”‚
â”‚  â”œâ”€â”€ sms/                       # çŸ­ä¿¡é€šçŸ¥å­é¢†åŸŸåŒ…                              â”‚
â”‚  â”œâ”€â”€ orchestration/             # é€šçŸ¥ç¼–æ’å­é¢†åŸŸåŒ…                              â”‚
â”‚  â”œâ”€â”€ preferences/               # ç”¨æˆ·åå¥½å­é¢†åŸŸåŒ…                              â”‚
â”‚  â”œâ”€â”€ analytics/                 # é€šçŸ¥ç»Ÿè®¡å­é¢†åŸŸåŒ…                              â”‚
â”‚  â”œâ”€â”€ templates/                 # æ¨¡æ¿ç®¡ç†å­é¢†åŸŸåŒ…                              â”‚
â”‚  â””â”€â”€ events/                    # äº‹ä»¶é›†æˆå­é¢†åŸŸåŒ…                              â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              æ¶æ„å±‚æ¬¡è¯´æ˜                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ“ domain/          # é¢†åŸŸå±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–å¤–éƒ¨æ¡†æ¶                    â”‚
â”‚  â”‚   â”œâ”€â”€ aggregates/ # èšåˆæ ¹ - ä¸šåŠ¡åè°ƒå’Œäº‹ä»¶å‘å¸ƒ                              â”‚
â”‚  â”‚   â”œâ”€â”€ entities/   # é¢†åŸŸå®ä½“ - çŠ¶æ€ç®¡ç†å’ŒåŸºç¡€è®¾æ–½åŠŸèƒ½                        â”‚
â”‚  â”‚   â”œâ”€â”€ value-objects/ # å€¼å¯¹è±¡ - ä¸å¯å˜çš„æ•°æ®ç»“æ„                             â”‚
â”‚  â”‚   â”œâ”€â”€ events/     # é¢†åŸŸäº‹ä»¶ - ä¸šåŠ¡çŠ¶æ€å˜æ›´é€šçŸ¥                              â”‚
â”‚  â”‚   â””â”€â”€ services/   # é¢†åŸŸæœåŠ¡ - è·¨èšåˆçš„ä¸šåŠ¡é€»è¾‘                              â”‚
â”‚  â”‚                                                                             â”‚
â”‚  ğŸ“ application/     # åº”ç”¨å±‚ - ç”¨ä¾‹åè°ƒï¼Œä¾èµ–é¢†åŸŸå±‚                            â”‚
â”‚  â”‚   â”œâ”€â”€ commands/   # å‘½ä»¤ - å†™æ“ä½œè¯·æ±‚                                        â”‚
â”‚  â”‚   â”œâ”€â”€ queries/    # æŸ¥è¯¢ - è¯»æ“ä½œè¯·æ±‚                                        â”‚
â”‚  â”‚   â”œâ”€â”€ handlers/   # å¤„ç†å™¨ - å‘½ä»¤/æŸ¥è¯¢å¤„ç†é€»è¾‘                               â”‚
â”‚  â”‚   â””â”€â”€ services/   # åº”ç”¨æœåŠ¡ - ç”¨ä¾‹åè°ƒæœåŠ¡                                  â”‚
â”‚  â”‚                                                                             â”‚
â”‚  ğŸ“ infrastructure/  # åŸºç¡€è®¾æ–½å±‚ - æŠ€æœ¯å®ç°ï¼Œä¾èµ–åº”ç”¨å±‚                        â”‚
â”‚  â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨å®ç° - æ•°æ®æŒä¹…åŒ–                                  â”‚
â”‚  â”‚   â”œâ”€â”€ entities/   # æ•°æ®åº“å®ä½“ - ORMæ˜ å°„                                     â”‚
â”‚  â”‚   â””â”€â”€ adapters/   # å¤–éƒ¨æœåŠ¡é€‚é…å™¨ - ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ                          â”‚
â”‚  â”‚                                                                             â”‚
â”‚  ğŸ“ interface/       # æ¥å£å±‚ - å¤–éƒ¨æ¥å£ï¼Œä¾èµ–åº”ç”¨å±‚                            â”‚
â”‚  â”‚   â”œâ”€â”€ controllers/ # æ§åˆ¶å™¨ - HTTP APIç«¯ç‚¹                                   â”‚
â”‚  â”‚   â”œâ”€â”€ dtos/       # æ•°æ®ä¼ è¾“å¯¹è±¡ - APIæ•°æ®æ ¼å¼                               â”‚
â”‚  â”‚   â””â”€â”€ guards/     # å®ˆå« - æƒé™æ§åˆ¶å’ŒéªŒè¯                                    â”‚
â”‚  â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. å­é¢†åŸŸåˆ’åˆ†ç­–ç•¥

### 4.1 æ ¸å¿ƒå­é¢†åŸŸ

- **ç«™å†…ä¿¡å­é¢†åŸŸ (In-App Notif)**: ç«™å†…é€šçŸ¥çš„åˆ›å»ºã€å­˜å‚¨ã€å±•ç¤ºã€çŠ¶æ€ç®¡ç†
- **é‚®ä»¶é€šçŸ¥å­é¢†åŸŸ (Email Notif)**: é‚®ä»¶é€šçŸ¥çš„å‘é€ã€æ¨¡æ¿ç®¡ç†ã€çŠ¶æ€è·Ÿè¸ª
- **æ¨é€é€šçŸ¥å­é¢†åŸŸ (Push Notif)**: Webæ¨é€ã€ç§»åŠ¨ç«¯æ¨é€çš„ç®¡ç†å’Œå‘é€
- **çŸ­ä¿¡é€šçŸ¥å­é¢†åŸŸ (SMS Notif)**: çŸ­ä¿¡é€šçŸ¥çš„å‘é€ã€æˆæœ¬æ§åˆ¶ã€çŠ¶æ€ç®¡ç†

### 4.2 æ”¯æ’‘å­é¢†åŸŸ

- **é€šçŸ¥ç¼–æ’å­é¢†åŸŸ (Notif Orchestration)**: åè°ƒä¸åŒé¢‘é“çš„é€šçŸ¥å‘é€ã€ä¼˜å…ˆçº§ç®¡ç†
- **ç”¨æˆ·åå¥½å­é¢†åŸŸ (User Preferences)**: ç”¨æˆ·å¯¹ä¸åŒé¢‘é“çš„åå¥½è®¾ç½®
- **é€šçŸ¥ç»Ÿè®¡å­é¢†åŸŸ (Notif Analytics)**: å„é¢‘é“é€šçŸ¥æ•ˆæœç»Ÿè®¡ã€ç”¨æˆ·è¡Œä¸ºåˆ†æ

### 4.3 é€šç”¨å­é¢†åŸŸ

- **æ¨¡æ¿ç®¡ç†å­é¢†åŸŸ (Template Management)**: è·¨é¢‘é“çš„æ¨¡æ¿ç®¡ç†ã€å†…å®¹æ¸²æŸ“
- **äº‹ä»¶é›†æˆå­é¢†åŸŸ (Event Integration)**: ä¸šåŠ¡äº‹ä»¶åˆ°é€šçŸ¥äº‹ä»¶çš„è½¬æ¢å’Œè·¯ç”±

## 5. äº‹ä»¶é©±åŠ¨ç­–ç•¥

### 5.1 ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„åœºæ™¯

- **è·¨å­é¢†åŸŸé€šçŸ¥è§¦å‘**: ç”¨æˆ·æ³¨å†Œã€æƒé™å˜æ›´ã€ç³»ç»Ÿç»´æŠ¤ç­‰ä¸šåŠ¡äº‹ä»¶
- **å¼‚æ­¥é€šçŸ¥å‘é€**: é‚®ä»¶å‘é€é˜Ÿåˆ—ã€æ‰¹é‡é€šçŸ¥å¤„ç†
- **å®¡è®¡å’Œç»Ÿè®¡**: é€šçŸ¥å‘é€è®°å½•ã€ç”¨æˆ·è¡Œä¸ºåˆ†æ
- **å­é¢†åŸŸè§£è€¦**: å„å­é¢†åŸŸé€šè¿‡äº‹ä»¶è¿›è¡Œäº¤äº’

### 5.2 äº‹ä»¶é©±åŠ¨æ¶æ„è®¾è®¡

åŸºäºå…¨é¢äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹è®¾è®¡ç­–ç•¥ï¼š

- **æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ**: ä½¿ç”¨Redis + Bullé˜Ÿåˆ—å®ç°å¼‚æ­¥äº‹ä»¶å¤„ç†
- **äº‹ä»¶å­˜å‚¨**: æ‰€æœ‰é¢†åŸŸäº‹ä»¶æŒä¹…åŒ–åˆ°äº‹ä»¶å­˜å‚¨ï¼Œæ”¯æŒå®¡è®¡å’Œé‡æ”¾
- **å¼‚æ­¥å¤„ç†**: æ‰€æœ‰äº‹ä»¶é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ï¼Œä¿è¯ç³»ç»Ÿå“åº”æ€§
- **é‡è¯•æœºåˆ¶**: å¤±è´¥äº‹ä»¶è‡ªåŠ¨é‡è¯•ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿ç­–ç•¥
- **æ­»ä¿¡é˜Ÿåˆ—**: æ°¸ä¹…å¤±è´¥çš„äº‹ä»¶è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- **æœ€ç»ˆä¸€è‡´æ€§**: é€šè¿‡å¼‚æ­¥äº‹ä»¶å¤„ç†å®ç°æœ€ç»ˆä¸€è‡´æ€§

## 6. åŒ…ç»“æ„è®¾è®¡

### 6.1 ç‹¬ç«‹åŒ…ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€šçŸ¥é¢†åŸŸæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç«™å†…ä¿¡å­é¢†åŸŸ (In-App Notif)                               â”‚
â”‚  â”œâ”€â”€ InAppNotif Aggregate                                  â”‚
â”‚  â”œâ”€â”€ NotifCenter Service                                   â”‚
â”‚  â””â”€â”€ ReadStatus Value Object                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é‚®ä»¶é€šçŸ¥å­é¢†åŸŸ (Email Notif)                              â”‚
â”‚  â”œâ”€â”€ EmailNotif Aggregate                                  â”‚
â”‚  â”œâ”€â”€ EmailTemplate Aggregate                               â”‚
â”‚  â””â”€â”€ EmailDelivery Service                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨é€é€šçŸ¥å­é¢†åŸŸ (Push Notif)                               â”‚
â”‚  â”œâ”€â”€ PushNotif Aggregate                                   â”‚
â”‚  â”œâ”€â”€ PushChannel Aggregate                                 â”‚
â”‚  â””â”€â”€ PushDelivery Service                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŸ­ä¿¡é€šçŸ¥å­é¢†åŸŸ (SMS Notif)                                â”‚
â”‚  â”œâ”€â”€ SmsNotif Aggregate                                    â”‚
â”‚  â”œâ”€â”€ SmsProvider Aggregate                                 â”‚
â”‚  â””â”€â”€ SmsDelivery Service                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€šçŸ¥ç¼–æ’å­é¢†åŸŸ (Notif Orchestration)                       â”‚
â”‚  â”œâ”€â”€ NotifOrchestrator Service                             â”‚
â”‚  â”œâ”€â”€ ChannelSelector Service                               â”‚
â”‚  â””â”€â”€ PriorityManager Service                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·åå¥½å­é¢†åŸŸ (User Preferences)                          â”‚
â”‚  â”œâ”€â”€ ChannelPreference Aggregate                           â”‚
â”‚  â”œâ”€â”€ NotifSettings Value Object                            â”‚
â”‚  â””â”€â”€ PreferenceService                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€šçŸ¥ç»Ÿè®¡å­é¢†åŸŸ (Notif Analytics)                          â”‚
â”‚  â”œâ”€â”€ ChannelStats Aggregate                                â”‚
â”‚  â”œâ”€â”€ DeliveryRate Value Object                             â”‚
â”‚  â””â”€â”€ AnalyticsService                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨¡æ¿ç®¡ç†å­é¢†åŸŸ (Template Management)                       â”‚
â”‚  â”œâ”€â”€ MultiChannelTemplate Aggregate                        â”‚
â”‚  â”œâ”€â”€ TemplateRenderer Service                              â”‚
â”‚  â””â”€â”€ ContentAdapter Service                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº‹ä»¶é›†æˆå­é¢†åŸŸ (Event Integration)                         â”‚
â”‚  â”œâ”€â”€ EventMapper Service                                   â”‚
â”‚  â”œâ”€â”€ NotifTrigger Service                                  â”‚
â”‚  â””â”€â”€ EventRouter Service                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 åŒ…ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒ…ä¾èµ–å…³ç³»å›¾                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  orchestration (ç¼–æ’åŒ…)                                    â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: in-app                                          â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: email                                           â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: push                                            â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: sms                                             â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: preferences                                     â”‚
â”‚  â””â”€â”€ ä¾èµ–: templates                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  events (äº‹ä»¶é›†æˆåŒ…)                                        â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: orchestration                                   â”‚
â”‚  â””â”€â”€ ä¾èµ–: å…¶ä»–ä¸šåŠ¡æ¨¡å— (user, tenant, platform)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  analytics (ç»Ÿè®¡åŒ…)                                         â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: in-app                                          â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: email                                           â”‚
â”‚  â”œâ”€â”€ ä¾èµ–: push                                            â”‚
â”‚  â””â”€â”€ ä¾èµ–: sms                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒé€šçŸ¥åŒ… (ç‹¬ç«‹è¿è¡Œ)                                      â”‚
â”‚  â”œâ”€â”€ in-app                                                â”‚
â”‚  â”œâ”€â”€ email                                                 â”‚
â”‚  â”œâ”€â”€ push                                                  â”‚
â”‚  â”œâ”€â”€ sms                                                   â”‚
â”‚  â”œâ”€â”€ preferences                                           â”‚
â”‚  â””â”€â”€ templates                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 åŒ…ç®¡ç†ç­–ç•¥

**ç‹¬ç«‹éƒ¨ç½²èƒ½åŠ›**ï¼š

- æ¯ä¸ªå­é¢†åŸŸåŒ…éƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- æ”¯æŒå¾®æœåŠ¡æ¶æ„ï¼Œæ¯ä¸ªåŒ…å¯ä»¥éƒ¨ç½²ä¸ºç‹¬ç«‹çš„æœåŠ¡
- æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ¯ä¸ªåŒ…æœ‰ç‹¬ç«‹çš„Dockeré•œåƒ

**ç‰ˆæœ¬ç®¡ç†**ï¼š

- æ¯ä¸ªåŒ…æœ‰ç‹¬ç«‹çš„ç‰ˆæœ¬å·
- æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
- æ”¯æŒåŒ…çš„ç‹¬ç«‹å‡çº§å’Œå›æ»š

**ä¾èµ–ç®¡ç†**ï¼š

- ä½¿ç”¨pnpm workspaceç®¡ç†åŒ…ä¾èµ–
- æ”¯æŒåŒ…çš„å¾ªç¯ä¾èµ–æ£€æµ‹
- æ”¯æŒåŒ…çš„ä¾èµ–ç‰ˆæœ¬é”å®š

**å¼€å‘æ•ˆç‡**ï¼š

- æ”¯æŒåŒ…çš„ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- æ”¯æŒåŒ…çš„ç‹¬ç«‹CI/CDæµæ°´çº¿
- æ”¯æŒåŒ…çš„ç‹¬ç«‹æ–‡æ¡£å’Œå‘å¸ƒ

### 6.4 å‘½åçº¦å®š

**ä»£ç å‘½åè§„èŒƒ**ï¼š

- åŒ…åï¼šä½¿ç”¨ç®€æ´çš„è‹±æ–‡å•è¯ï¼Œå¦‚ `in-app`ã€`email`ã€`push`ã€`sms`
- ç±»åï¼šä½¿ç”¨ `Notif` ä½œä¸º `Notification` çš„ç®€å†™
- æ–‡ä»¶åï¼šä½¿ç”¨ `notif` ç®€å†™ï¼Œå¦‚ `in-app-notif.aggregate.ts`
- å˜é‡åï¼šä½¿ç”¨ `notif` ç®€å†™ï¼Œå¦‚ `const notif = new InAppNotif()`

**å‘½åç¤ºä¾‹**ï¼š

```typescript
// èšåˆæ ¹ç±»å
export class InAppNotif extends EventSourcedAggregateRoot
export class EmailNotif extends EventSourcedAggregateRoot
export class PushNotif extends EventSourcedAggregateRoot
export class SmsNotif extends EventSourcedAggregateRoot
export class NotifPreferences extends EventSourcedAggregateRoot
export class NotifOrchestration extends EventSourcedAggregateRoot

// æ–‡ä»¶å
in-app-notif.aggregate.ts
email-notif.aggregate.ts
push-notif.aggregate.ts
sms-notif.aggregate.ts
notif-preferences.aggregate.ts
notif-orchestration.aggregate.ts

// å˜é‡å
const notif = new InAppNotif();
const emailNotif = new EmailNotif();
const pushNotif = new PushNotif();
const preferences = new NotifPreferences();
const orchestration = new NotifOrchestration();

// å‘½ä»¤å’ŒæŸ¥è¯¢ç±»å
export class CreateInAppNotifCommand
export class GetInAppNotifsQuery
export class MarkNotifAsReadCommand
export class CreateNotifPreferencesCommand
export class GetNotifPreferencesQuery
export class CreateNotifOrchestrationCommand

// äº‹ä»¶ç±»å
export class InAppNotifCreatedEvent
export class EmailNotifSentEvent
export class PushNotifDeliveredEvent
export class NotifPreferencesCreatedEvent
export class NotifPreferencesUpdatedEvent
export class NotifOrchestrationCreatedEvent
export class NotifOrchestrationCompletedEvent

// æœåŠ¡ç±»å
export class NotifOrchestratorService
export class NotifAnalyticsService
export class NotifTemplateService
export class NotifPreferencesService
export class NotifOrchestrationService
```

### 6.5 åŒ…é…ç½®ç¤ºä¾‹

**package.json ç¤ºä¾‹ (in-app)**ï¼š

```json
{
  "name": "@aiofix/notif-in-app",
  "version": "1.0.0",
  "description": "ç«™å†…ä¿¡é€šçŸ¥å­é¢†åŸŸåŒ…",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "tsc",
    "test": "jest",
    "lint": "eslint src/**/*.ts",
    "dev": "tsc --watch"
  },
  "dependencies": {
    "@aiofix/shared": "workspace:*",
    "@aiofix/domain": "workspace:*",
    "uuid": "^9.0.0"
  },
  "devDependencies": {
    "@types/uuid": "^9.0.0",
    "typescript": "^5.0.0",
    "jest": "^29.0.0"
  },
  "peerDependencies": {
    "@nestjs/common": "^10.0.0",
    "@nestjs/core": "^10.0.0"
  }
}
```

**tsconfig.json ç¤ºä¾‹**ï¼š

```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "**/*.spec.ts", "**/*.test.ts"]
}
```

**pnpm-workspace.yaml é…ç½®**ï¼š

```yaml
packages:
  - 'packages/*'
  - 'packages/notif/*'
```

## 7. æ¶æ„ä¼˜åŠ¿

### 7.1 æ¨¡å—åŒ–è®¾è®¡

- **ç‹¬ç«‹éƒ¨ç½²**: æ¯ä¸ªå­é¢†åŸŸåŒ…éƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- **æ¾è€¦åˆ**: é€šè¿‡äº‹ä»¶é©±åŠ¨å®ç°å­é¢†åŸŸé—´çš„æ¾è€¦åˆ
- **é«˜å†…èš**: æ¯ä¸ªå­é¢†åŸŸå†…éƒ¨é«˜åº¦å†…èšï¼ŒèŒè´£æ˜ç¡®

### 7.2 å¯æ‰©å±•æ€§

- **æ°´å¹³æ‰©å±•**: æ”¯æŒå¾®æœåŠ¡æ¶æ„çš„æ°´å¹³æ‰©å±•
- **åŠŸèƒ½æ‰©å±•**: æ”¯æŒæ–°é€šçŸ¥æ¸ é“çš„è½»æ¾æ·»åŠ 
- **é…ç½®æ‰©å±•**: æ”¯æŒå¤šç§Ÿæˆ·é…ç½®çš„çµæ´»æ‰©å±•

### 7.3 å¯ç»´æŠ¤æ€§

- **æ¸…æ™°åˆ†å±‚**: Clean Architectureç¡®ä¿æ¸…æ™°çš„ä»£ç åˆ†å±‚
- **èŒè´£åˆ†ç¦»**: èšåˆæ ¹ä¸å®ä½“åˆ†ç¦»ï¼ŒèŒè´£æ˜ç¡®
- **æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„å‘½åçº¦å®šå’Œä»£ç è§„èŒƒ

### 7.4 å¯æµ‹è¯•æ€§

- **å•å…ƒæµ‹è¯•**: æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- **é›†æˆæµ‹è¯•**: æ”¯æŒå­é¢†åŸŸé—´çš„é›†æˆæµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æ”¯æŒå®Œæ•´çš„ä¸šåŠ¡æµç¨‹æµ‹è¯•

## 8. æ€»ç»“

é€šçŸ¥æ¨¡å—çš„æ¶æ„è®¾è®¡åŸºäºDDD + Clean Architecture + CQRS + äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œé€šè¿‡å­é¢†åŸŸåˆ’åˆ†å’ŒåŒ…ç»“æ„è®¾è®¡ï¼Œå®ç°äº†é«˜åº¦çš„æ¨¡å—åŒ–ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚è¿™ç§è®¾è®¡æ—¢æ»¡è¶³äº†å¤šç§Ÿæˆ·SaaSå¹³å°çš„éœ€æ±‚ï¼Œåˆä¿æŒäº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-01-01  
**ç»´æŠ¤è€…**: é¡¹ç›®å¼€å‘å›¢é˜Ÿ
