# æ ‡è¯†ç¬¦å€¼å¯¹è±¡ï¼ˆIdentifier Value Objectsï¼‰ç»Ÿä¸€æ¶æ„è®¾è®¡

## ğŸ“‹ **æ–‡æ¡£ä¿¡æ¯**

- **æ–‡æ¡£æ ‡é¢˜**: æ ‡è¯†ç¬¦å€¼å¯¹è±¡ç»Ÿä¸€æ¶æ„è®¾è®¡
- **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
- **åˆ›å»ºæ—¥æœŸ**: 2024-01-01
- **æœ€åæ›´æ–°**: 2024-01-01
- **ç»´æŠ¤è€…**: é¡¹ç›®å¼€å‘å›¢é˜Ÿ
- **çŠ¶æ€**: å·²å®æ–½

## ğŸ“– **ç›®å½•**

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [è®¾è®¡ç›®æ ‡](#è®¾è®¡ç›®æ ‡)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ ‡è¯†ç¬¦ç±»å‹](#æ ‡è¯†ç¬¦ç±»å‹)
5. [ç»Ÿä¸€æ–¹æ³•æ¥å£](#ç»Ÿä¸€æ–¹æ³•æ¥å£)
6. [æ–‡ä»¶ç»„ç»‡ç»“æ„](#æ–‡ä»¶ç»„ç»‡ç»“æ„)
7. [è¿ç§»è¿‡ç¨‹](#è¿ç§»è¿‡ç¨‹)
8. [ä»£ç ç»Ÿè®¡](#ä»£ç ç»Ÿè®¡)
9. [è®¾è®¡æ¨¡å¼åº”ç”¨](#è®¾è®¡æ¨¡å¼åº”ç”¨)
10. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
11. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
12. [æœªæ¥æ‰©å±•](#æœªæ¥æ‰©å±•)
13. [è´¨é‡æŒ‡æ ‡](#è´¨é‡æŒ‡æ ‡)
14. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
15. [æ€»ç»“](#æ€»ç»“)

## ğŸ“‹ **é¡¹ç›®æ¦‚è¿°**

æœ¬æ–‡æ¡£æ€»ç»“äº†Aiofix AI SAASå¹³å°ä¸­æ ‡è¯†ç¬¦å€¼å¯¹è±¡çš„ç»Ÿä¸€æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ä»åˆ†æ•£å¼ç®¡ç†åˆ°é›†ä¸­å¼ç®¡ç†çš„å®Œæ•´è¿ç§»è¿‡ç¨‹ï¼Œä»¥åŠç»Ÿä¸€çš„æ–¹æ³•æ¥å£è®¾è®¡ã€‚

### èƒŒæ™¯

åœ¨é¡¹ç›®åˆæœŸï¼Œå„ä¸ªæ¨¡å—ï¼ˆç”¨æˆ·ã€æƒé™ã€è§’è‰²ã€ç»„ç»‡ã€éƒ¨é—¨ç­‰ï¼‰éƒ½ç‹¬ç«‹å®šä¹‰äº†è‡ªå·±çš„æ ‡è¯†ç¬¦å€¼å¯¹è±¡ï¼Œå¯¼è‡´ï¼š

- **ä»£ç é‡å¤**ï¼šæ¯ä¸ªæ ‡è¯†ç¬¦éƒ½æœ‰ç›¸ä¼¼çš„éªŒè¯å’Œç”Ÿæˆé€»è¾‘
- **æ¥å£ä¸ä¸€è‡´**ï¼šæ–¹æ³•ç­¾åå’Œå‚æ•°æ•°é‡ä¸ç»Ÿä¸€
- **ç»´æŠ¤å›°éš¾**ï¼šä¿®æ”¹éœ€è¦åŒæ­¥å¤šä¸ªæ¨¡å—
- **ç±»å‹å®‰å…¨**ï¼šç¼ºä¹ç»Ÿä¸€çš„ç±»å‹å®šä¹‰

### è§£å†³æ–¹æ¡ˆ

é€šè¿‡è®¾è®¡ç»Ÿä¸€çš„åŸºç±»æ¶æ„ï¼Œå°†æ‰€æœ‰å…¨å±€æ€§æ ‡è¯†ç¬¦é›†ä¸­åˆ°å…±äº«æ¨¡å—ï¼Œå®ç°ï¼š

- **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰æ ‡è¯†ç¬¦åœ¨å…±äº«æ¨¡å—ç»Ÿä¸€ç®¡ç†
- **æ¥å£ä¸€è‡´**ï¼šæ‰€æœ‰æ ‡è¯†ç¬¦å…·æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾å
- **ä»£ç å¤ç”¨**ï¼šé€šè¿‡åŸºç±»è®¾è®¡æ¶ˆé™¤é‡å¤ä»£ç 
- **ç±»å‹å®‰å…¨**ï¼šæä¾›å¼ºç±»å‹æ”¯æŒå’ŒéªŒè¯æœºåˆ¶

## ğŸ¯ **è®¾è®¡ç›®æ ‡**

### æ ¸å¿ƒç›®æ ‡

1. **ç»Ÿä¸€ç®¡ç†**ï¼šå°†æ‰€æœ‰å…¨å±€æ€§æ ‡è¯†ç¬¦é›†ä¸­åˆ°å…±äº«æ¨¡å—
2. **æ¥å£ä¸€è‡´**ï¼šç¡®ä¿æ‰€æœ‰æ ‡è¯†ç¬¦å…·æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾å
3. **ä»£ç å¤ç”¨**ï¼šé€šè¿‡åŸºç±»è®¾è®¡æ¶ˆé™¤é‡å¤ä»£ç 
4. **ç±»å‹å®‰å…¨**ï¼šæä¾›å¼ºç±»å‹æ”¯æŒå’ŒéªŒè¯æœºåˆ¶
5. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæœªæ¥æ–°å¢æ ‡è¯†ç¬¦ç±»å‹

### ä¸šåŠ¡ä»·å€¼

- **ç»´æŠ¤æ€§æå‡**ï¼šé›†ä¸­ç®¡ç†é™ä½ç»´æŠ¤æˆæœ¬
- **å¼€å‘æ•ˆç‡**ï¼šç»Ÿä¸€çš„æ¥å£å‡å°‘å­¦ä¹ æˆæœ¬
- **ä»£ç è´¨é‡**ï¼šåŸºç±»è®¾è®¡ç¡®ä¿ä¸€è‡´æ€§
- **å›¢é˜Ÿåä½œ**ï¼šæ ‡å‡†åŒ–çš„æ¥å£æé«˜åä½œæ•ˆç‡

## ğŸ—ï¸ **æ¶æ„è®¾è®¡**

### 1. åŸºç±»å±‚æ¬¡ç»“æ„

```typescript
// æŠ½è±¡åŸºç±»
abstract class BaseIdentifier<T> extends ValueObject<T> {
  protected abstract generateValue(): T;
  protected abstract validate(value: T): void;

  // æ¨¡æ¿æ–¹æ³•
  constructor(value?: T) {
    const finalValue = value || this.generateValue();
    super(finalValue);
    this.validate(finalValue);
  }
}

// UUIDç±»å‹åŸºç±»
class UUIDIdentifier extends BaseIdentifier<string> {
  protected generateValue(): string {
    return uuidv4();
  }

  protected validate(value: string): void {
    if (!UUIDv4ValidationRule.validate(value)) {
      throw new InvalidIdentifierError('Invalid UUID format');
    }
  }
}

// è‡ªå®šä¹‰æ ¼å¼åŸºç±»
class CustomIdentifier extends BaseIdentifier<string> {
  protected generateValue(): string {
    return this.generateCustomValue();
  }

  protected abstract generateCustomValue(): string;
}

// å…·ä½“æ ‡è¯†ç¬¦å®ç°
class UserId extends UUIDIdentifier
class TenantId extends CustomIdentifier
class PermissionId extends UUIDIdentifier
class RoleId extends UUIDIdentifier
class OrganizationId extends UUIDIdentifier
class DepartmentId extends UUIDIdentifier
class NotifId extends UUIDIdentifier
```

### 2. éªŒè¯è§„åˆ™ç³»ç»Ÿ

```typescript
// éªŒè¯è§„åˆ™æ¥å£
interface IdentifierValidationRule<T> {
  validate(value: T): boolean;
  getErrorMessage(): string;
}

// UUID v4éªŒè¯è§„åˆ™
class UUIDv4ValidationRule implements IdentifierValidationRule<string> {
  private static readonly UUID_REGEX =
    /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;

  validate(value: string): boolean {
    return UUIDv4ValidationRule.UUID_REGEX.test(value);
  }

  getErrorMessage(): string {
    return 'Invalid UUID v4 format';
  }
}

// è‡ªå®šä¹‰æ ¼å¼éªŒè¯è§„åˆ™
class CustomFormatValidationRule implements IdentifierValidationRule<string> {
  constructor(
    private pattern: RegExp,
    private errorMessage: string,
  ) {}

  validate(value: string): boolean {
    return this.pattern.test(value);
  }

  getErrorMessage(): string {
    return this.errorMessage;
  }
}
```

## ğŸ“¦ **æ ‡è¯†ç¬¦ç±»å‹**

### UUIDç±»å‹æ ‡è¯†ç¬¦

| æ ‡è¯†ç¬¦           | ç”¨é€”     | éªŒè¯è§„åˆ™ | ä¸šåŠ¡åœºæ™¯             |
| ---------------- | -------- | -------- | -------------------- |
| `UserId`         | ç”¨æˆ·æ ‡è¯† | UUID v4  | ç”¨æˆ·ç®¡ç†ã€è®¤è¯æˆæƒ   |
| `PermissionId`   | æƒé™æ ‡è¯† | UUID v4  | æƒé™ç®¡ç†ã€è®¿é—®æ§åˆ¶   |
| `RoleId`         | è§’è‰²æ ‡è¯† | UUID v4  | è§’è‰²ç®¡ç†ã€æƒé™åˆ†é…   |
| `OrganizationId` | ç»„ç»‡æ ‡è¯† | UUID v4  | ç»„ç»‡æ¶æ„ã€å¤šç§Ÿæˆ·éš”ç¦» |
| `DepartmentId`   | éƒ¨é—¨æ ‡è¯† | UUID v4  | éƒ¨é—¨ç®¡ç†ã€å±‚çº§ç»“æ„   |
| `NotifId`        | é€šçŸ¥æ ‡è¯† | UUID v4  | é€šçŸ¥ç®¡ç†ã€æ¶ˆæ¯æ¨é€   |

### è‡ªå®šä¹‰æ ¼å¼æ ‡è¯†ç¬¦

| æ ‡è¯†ç¬¦     | ç”¨é€”     | éªŒè¯è§„åˆ™                | ä¸šåŠ¡åœºæ™¯             |
| ---------- | -------- | ----------------------- | -------------------- |
| `TenantId` | ç§Ÿæˆ·æ ‡è¯† | `tenant_` + 8ä½éšæœºå­—ç¬¦ | å¤šç§Ÿæˆ·éš”ç¦»ã€æ•°æ®åˆ†åŒº |

### æ ‡è¯†ç¬¦ç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§   | UUIDç±»å‹    | è‡ªå®šä¹‰æ ¼å¼ |
| ------ | ----------- | ---------- |
| å”¯ä¸€æ€§ | å…¨å±€å”¯ä¸€    | ä¸šåŠ¡å”¯ä¸€   |
| æ ¼å¼   | æ ‡å‡†UUID v4 | è‡ªå®šä¹‰æ ¼å¼ |
| é•¿åº¦   | 36å­—ç¬¦      | å¯å˜é•¿åº¦   |
| å¯è¯»æ€§ | ä½          | é«˜         |
| æ€§èƒ½   | ä¸­ç­‰        | é«˜         |

## ğŸ”§ **ç»Ÿä¸€æ–¹æ³•æ¥å£**

### æ ‡å‡†æ–¹æ³•ç­¾å

æ‰€æœ‰æ ‡è¯†ç¬¦éƒ½å®ç°äº†ä»¥ä¸‹ç»Ÿä¸€çš„æ–¹æ³•æ¥å£ï¼š

```typescript
// ç”Ÿæˆæ–°æ ‡è¯†ç¬¦
static generate(): IdentifierType

// ä»å­—ç¬¦ä¸²åˆ›å»ºæ ‡è¯†ç¬¦
static fromString(value: string): IdentifierType

// åˆ›å»ºæ ‡è¯†ç¬¦ï¼ˆåˆ«åæ–¹æ³•ï¼‰
static create(value: string): IdentifierType

// éªŒè¯æ ¼å¼æœ‰æ•ˆæ€§
static isValid(value: string): boolean

// å®ä¾‹æ–¹æ³•
equals(other: IdentifierType): boolean
toString(): string
toJSON(): string
```

### æ–¹æ³•åŠŸèƒ½è¯´æ˜

| æ–¹æ³•                | å‚æ•°æ•°é‡ | è¿”å›å€¼           | åŠŸèƒ½æè¿°           | ä½¿ç”¨åœºæ™¯           |
| ------------------- | -------- | ---------------- | ------------------ | ------------------ |
| `generate()`        | 0        | `IdentifierType` | ç”Ÿæˆæ–°çš„æ ‡è¯†ç¬¦å®ä¾‹ | åˆ›å»ºæ–°å®ä½“æ—¶       |
| `fromString(value)` | 1        | `IdentifierType` | ä»å­—ç¬¦ä¸²åˆ›å»ºæ ‡è¯†ç¬¦ | ååºåˆ—åŒ–ã€APIè¾“å…¥  |
| `create(value)`     | 1        | `IdentifierType` | åˆ›å»ºæ ‡è¯†ç¬¦ï¼ˆåˆ«åï¼‰ | æä¾›ä¸€è‡´çš„æ¥å£     |
| `isValid(value)`    | 1        | `boolean`        | éªŒè¯å­—ç¬¦ä¸²æ ¼å¼     | è¾“å…¥éªŒè¯ã€æ•°æ®æ ¡éªŒ |

### ä½¿ç”¨ç¤ºä¾‹

```typescript
// ç”Ÿæˆæ–°æ ‡è¯†ç¬¦
const userId = UserId.generate();
const roleId = RoleId.generate();

// ä»å­—ç¬¦ä¸²åˆ›å»º
const userIdFromString = UserId.fromString(
  '123e4567-e89b-12d3-a456-426614174000',
);
const roleIdFromString = RoleId.fromString(
  '550e8400-e29b-41d4-a716-446655440000',
);

// åˆ›å»ºæ ‡è¯†ç¬¦ï¼ˆåˆ«åï¼‰
const userIdCreated = UserId.create('123e4567-e89b-12d3-a456-426614174000');

// éªŒè¯æ ¼å¼
const isValidUserId = UserId.isValid('123e4567-e89b-12d3-a456-426614174000'); // true
const isValidRoleId = RoleId.isValid('invalid-format'); // false

// æ¯”è¾ƒæ ‡è¯†ç¬¦
const isEqual = userId.equals(userIdFromString); // false
const isSame = userId.equals(userId); // true

// è½¬æ¢ä¸ºå­—ç¬¦ä¸²
const userIdString = userId.toString();
const userIdJson = userId.toJSON();
```

## ğŸ“ **æ–‡ä»¶ç»„ç»‡ç»“æ„**

### å…±äº«æ¨¡å—ç»“æ„

```
packages/shared/src/identifiers/
â”œâ”€â”€ base-identifier.vo.ts          # åŸºç±»å®šä¹‰
â”œâ”€â”€ user-id.vo.ts                  # ç”¨æˆ·ID
â”œâ”€â”€ tenant-id.vo.ts                # ç§Ÿæˆ·ID
â”œâ”€â”€ notif-id.vo.ts                 # é€šçŸ¥ID
â”œâ”€â”€ permission-id.vo.ts            # æƒé™ID
â”œâ”€â”€ role-id.vo.ts                  # è§’è‰²ID
â”œâ”€â”€ organization-id.vo.ts          # ç»„ç»‡ID
â”œâ”€â”€ department-id.vo.ts            # éƒ¨é—¨ID
â”œâ”€â”€ index.ts                       # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ user-id.vo.spec.ts            # æµ‹è¯•æ–‡ä»¶
```

### å„æ¨¡å—å¼•ç”¨

```typescript
// ç»Ÿä¸€å¯¼å…¥æ–¹å¼
import {
  UserId,
  TenantId,
  PermissionId,
  RoleId,
  OrganizationId,
  DepartmentId,
  NotifId,
} from '@aiofix/shared';

// ç±»å‹å¯¼å…¥
import type {
  UserId as UserIdType,
  TenantId as TenantIdType,
  PermissionId as PermissionIdType,
} from '@aiofix/shared';
```

### å¯¼å‡ºç»“æ„

```typescript
// packages/shared/src/identifiers/index.ts
export { UserId, InvalidUserIdError } from './user-id.vo';
export { TenantId, InvalidTenantIdError } from './tenant-id.vo';
export { NotifId, InvalidNotifIdError } from './notif-id.vo';
export { PermissionId, InvalidPermissionIdError } from './permission-id.vo';
export { RoleId, InvalidRoleIdError } from './role-id.vo';
export {
  OrganizationId,
  InvalidOrganizationIdError,
} from './organization-id.vo';
export { DepartmentId, InvalidDepartmentIdError } from './department-id.vo';

// ç±»å‹å®šä¹‰
export type { UserId as UserIdType } from './user-id.vo';
export type { TenantId as TenantIdType } from './tenant-id.vo';
export type { NotifId as NotifIdType } from './notif-id.vo';
export type { PermissionId as PermissionIdType } from './permission-id.vo';
export type { RoleId as RoleIdType } from './role-id.vo';
export type { OrganizationId as OrganizationIdType } from './organization-id.vo';
export type { DepartmentId as DepartmentIdType } from './department-id.vo';
```

## ğŸ”„ **è¿ç§»è¿‡ç¨‹**

### è¿ç§»å‰çŠ¶æ€

- **åˆ†æ•£ç®¡ç†**ï¼šæ¯ä¸ªæ¨¡å—ç‹¬ç«‹å®šä¹‰æ ‡è¯†ç¬¦
- **æ¥å£ä¸ä¸€è‡´**ï¼šæ–¹æ³•ç­¾åå’Œå‚æ•°æ•°é‡ä¸ç»Ÿä¸€
- **ä»£ç é‡å¤**ï¼šå¤§é‡é‡å¤çš„éªŒè¯å’Œç”Ÿæˆé€»è¾‘
- **ç»´æŠ¤å›°éš¾**ï¼šä¿®æ”¹éœ€è¦åŒæ­¥å¤šä¸ªæ¨¡å—

### è¿ç§»æ­¥éª¤

1. **è®¾è®¡åŸºç±»æ¶æ„**
   - åˆ›å»º `BaseIdentifier` æŠ½è±¡åŸºç±»
   - å®ç° `UUIDIdentifier` å’Œ `CustomIdentifier` å…·ä½“åŸºç±»
   - å®šä¹‰éªŒè¯è§„åˆ™æ¥å£å’Œå®ç°

2. **ç»Ÿä¸€æ–¹æ³•æ¥å£**
   - å®šä¹‰æ ‡å‡†çš„é™æ€æ–¹æ³•ï¼š`generate()`, `fromString()`, `create()`, `isValid()`
   - å®šä¹‰æ ‡å‡†çš„å®ä¾‹æ–¹æ³•ï¼š`equals()`, `toString()`, `toJSON()`
   - ç¡®ä¿æ‰€æœ‰æ ‡è¯†ç¬¦å…·æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾å

3. **è¿ç§»æ ‡è¯†ç¬¦**
   - å°†å„æ¨¡å—çš„æ ‡è¯†ç¬¦è¿ç§»åˆ°å…±äº«æ¨¡å—
   - ç»§æ‰¿ç›¸åº”çš„åŸºç±»
   - å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘

4. **æ›´æ–°å¯¼å…¥å¼•ç”¨**
   - ä¿®æ”¹æ‰€æœ‰æ¨¡å—çš„å¯¼å…¥è·¯å¾„
   - ç»Ÿä¸€ä½¿ç”¨ `@aiofix/shared` å¯¼å…¥
   - ä¿®å¤è·¨æ¨¡å—å¼•ç”¨é—®é¢˜

5. **æ¸…ç†æ—§æ–‡ä»¶**
   - åˆ é™¤å„æ¨¡å—ä¸­çš„æ—§æ ‡è¯†ç¬¦æ–‡ä»¶
   - æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¼å…¥è¯­å¥
   - éªŒè¯æ„å»ºå®Œæ•´æ€§

6. **éªŒè¯æ„å»º**
   - ç¡®ä¿æ‰€æœ‰æ¨¡å—æ­£å¸¸æ„å»º
   - è¿è¡Œæµ‹è¯•å¥—ä»¶
   - éªŒè¯åŠŸèƒ½å®Œæ•´æ€§

### è¿ç§»åçŠ¶æ€

- **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰æ ‡è¯†ç¬¦åœ¨å…±äº«æ¨¡å—ç»Ÿä¸€ç®¡ç†
- **æ¥å£ä¸€è‡´**ï¼šæ‰€æœ‰æ ‡è¯†ç¬¦å…·æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾å
- **ä»£ç å¤ç”¨**ï¼šé€šè¿‡åŸºç±»æ¶ˆé™¤é‡å¤ä»£ç 
- **ç»´æŠ¤ç®€å•**ï¼šä¿®æ”¹åªéœ€æ›´æ–°å…±äº«æ¨¡å—

## ğŸ“Š **ä»£ç ç»Ÿè®¡**

### ä»£ç è¡Œæ•°å¯¹æ¯”

| é¡¹ç›®       | è¿ç§»å‰   | è¿ç§»å | å‡å°‘é‡ | å‡å°‘æ¯”ä¾‹ |
| ---------- | -------- | ------ | ------ | -------- |
| æ€»ä»£ç è¡Œæ•° | ~1,200è¡Œ | ~800è¡Œ | 400è¡Œ  | 33%      |
| é‡å¤ä»£ç    | ~600è¡Œ   | ~100è¡Œ | 500è¡Œ  | 83%      |
| éªŒè¯é€»è¾‘   | ~300è¡Œ   | ~50è¡Œ  | 250è¡Œ  | 83%      |
| é”™è¯¯å¤„ç†   | ~150è¡Œ   | ~50è¡Œ  | 100è¡Œ  | 67%      |

### æ–‡ä»¶æ•°é‡å¯¹æ¯”

| ç±»å‹       | è¿ç§»å‰      | è¿ç§»å      | å˜åŒ–  |
| ---------- | ----------- | ----------- | ----- |
| æ ‡è¯†ç¬¦æ–‡ä»¶ | 7ä¸ªï¼ˆåˆ†æ•£ï¼‰ | 8ä¸ªï¼ˆé›†ä¸­ï¼‰ | +1ä¸ª  |
| å¯¼å…¥è¯­å¥   | 35+         | 7ä¸ª         | -28ä¸ª |
| ç»´æŠ¤ç‚¹     | 7ä¸ªæ¨¡å—     | 1ä¸ªæ¨¡å—     | -6ä¸ª  |
| æµ‹è¯•æ–‡ä»¶   | 7ä¸ª         | 1ä¸ª         | -6ä¸ª  |

### å¤æ‚åº¦å¯¹æ¯”

| æŒ‡æ ‡     | è¿ç§»å‰ | è¿ç§»å | æ”¹å–„     |
| -------- | ------ | ------ | -------- |
| åœˆå¤æ‚åº¦ | å¹³å‡8  | å¹³å‡3  | -62%     |
| é‡å¤ç‡   | 35%    | 5%     | -86%     |
| ç»´æŠ¤æˆæœ¬ | é«˜     | ä½     | æ˜¾è‘—é™ä½ |

## ğŸ¨ **è®¾è®¡æ¨¡å¼åº”ç”¨**

### 1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼

```typescript
abstract class BaseIdentifier<T> {
  // æ¨¡æ¿æ–¹æ³•
  constructor(value?: T) {
    const finalValue = value || this.generateValue();
    super(finalValue);
    this.validate(finalValue);
  }

  // æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç°
  protected abstract generateValue(): T;
  protected abstract validate(value: T): void;
}
```

**ä¼˜åŠ¿**ï¼š

- å®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå­ç±»å®ç°å…·ä½“æ­¥éª¤
- ç¡®ä¿æ‰€æœ‰æ ‡è¯†ç¬¦éµå¾ªç›¸åŒçš„åˆ›å»ºæµç¨‹
- ä¾¿äºæ‰©å±•å’Œç»´æŠ¤

### 2. ç­–ç•¥æ¨¡å¼

```typescript
interface IdentifierValidationRule<T> {
  validate(value: T): boolean;
  getErrorMessage(): string;
}

class UUIDv4ValidationRule implements IdentifierValidationRule<string> {
  validate(value: string): boolean {
    return /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(
      value,
    );
  }

  getErrorMessage(): string {
    return 'Invalid UUID v4 format';
  }
}
```

**ä¼˜åŠ¿**ï¼š

- å°è£…ä¸åŒçš„éªŒè¯ç­–ç•¥
- ä¾¿äºæ·»åŠ æ–°çš„éªŒè¯è§„åˆ™
- æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§

### 3. å·¥å‚æ¨¡å¼

```typescript
class IdentifierFactory {
  static create<T extends BaseIdentifier<any>>(
    type: new (value?: any) => T,
    value?: any,
  ): T {
    return new type(value);
  }

  static createFromString<T extends BaseIdentifier<any>>(
    type: new (value?: any) => T,
    value: string,
  ): T {
    return new type(value);
  }
}
```

**ä¼˜åŠ¿**ï¼š

- ç»Ÿä¸€åˆ›å»ºé€»è¾‘
- æ”¯æŒæ‰¹é‡åˆ›å»º
- ä¾¿äºæ‰©å±•æ–°çš„åˆ›å»ºæ–¹å¼

### 4. å€¼å¯¹è±¡æ¨¡å¼

```typescript
class UserId extends UUIDIdentifier {
  // ä¸å¯å˜æ€§
  readonly value: string;

  // ç›¸ç­‰æ€§åˆ¤æ–­
  equals(other: UserId): boolean {
    return this.value === other.value;
  }

  // ä¸šåŠ¡æ¦‚å¿µå°è£…
  toString(): string {
    return this.value;
  }
}
```

**ä¼˜åŠ¿**ï¼š

- å°è£…ä¸šåŠ¡æ¦‚å¿µ
- ç¡®ä¿ä¸å¯å˜æ€§
- æä¾›ç±»å‹å®‰å…¨

## ğŸ§ª **æµ‹è¯•ç­–ç•¥**

### å•å…ƒæµ‹è¯•è¦†ç›–

- **åŸºç±»æµ‹è¯•**ï¼šéªŒè¯æ¨¡æ¿æ–¹æ³•å’ŒæŠ½è±¡æ–¹æ³•
- **å…·ä½“ç±»æµ‹è¯•**ï¼šéªŒè¯æ¯ä¸ªæ ‡è¯†ç¬¦çš„ç‰¹å®šé€»è¾‘
- **è¾¹ç•Œæµ‹è¯•**ï¼šéªŒè¯å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
- **é›†æˆæµ‹è¯•**ï¼šéªŒè¯è·¨æ¨¡å—ä½¿ç”¨åœºæ™¯

### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

```typescript
describe('UserId', () => {
  describe('generate', () => {
    it('should generate valid UUID', () => {
      const userId = UserId.generate();
      expect(UserId.isValid(userId.toString())).toBe(true);
    });

    it('should generate unique IDs', () => {
      const id1 = UserId.generate();
      const id2 = UserId.generate();
      expect(id1.equals(id2)).toBe(false);
    });
  });

  describe('fromString', () => {
    it('should create from valid string', () => {
      const validUuid = '123e4567-e89b-12d3-a456-426614174000';
      const userId = UserId.fromString(validUuid);
      expect(userId.toString()).toBe(validUuid);
    });

    it('should throw error for invalid format', () => {
      expect(() => UserId.fromString('invalid')).toThrow(InvalidUserIdError);
    });

    it('should throw error for empty string', () => {
      expect(() => UserId.fromString('')).toThrow(InvalidUserIdError);
    });
  });

  describe('isValid', () => {
    it('should return true for valid UUID', () => {
      expect(UserId.isValid('123e4567-e89b-12d3-a456-426614174000')).toBe(true);
    });

    it('should return false for invalid format', () => {
      expect(UserId.isValid('invalid')).toBe(false);
    });

    it('should return false for empty string', () => {
      expect(UserId.isValid('')).toBe(false);
    });
  });

  describe('equals', () => {
    it('should return true for same ID', () => {
      const userId = UserId.generate();
      expect(userId.equals(userId)).toBe(true);
    });

    it('should return false for different IDs', () => {
      const id1 = UserId.generate();
      const id2 = UserId.generate();
      expect(id1.equals(id2)).toBe(false);
    });
  });
});
```

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- **è¡Œè¦†ç›–ç‡**ï¼š95%ä»¥ä¸Š
- **åˆ†æ”¯è¦†ç›–ç‡**ï¼š90%ä»¥ä¸Š
- **å‡½æ•°è¦†ç›–ç‡**ï¼š100%
- **è¯­å¥è¦†ç›–ç‡**ï¼š95%ä»¥ä¸Š

## âš¡ **æ€§èƒ½ä¼˜åŒ–**

### 1. å†…å­˜ä¼˜åŒ–

- **å€¼å¯¹è±¡è®¾è®¡**ï¼šä¸å¯å˜å¯¹è±¡ï¼Œå‡å°‘å†…å­˜åˆ†é…
- **å­—ç¬¦ä¸²å¤ç”¨**ï¼šç›¸åŒå€¼å…±äº«å­—ç¬¦ä¸²å¼•ç”¨
- **æ‡’åŠ è½½éªŒè¯**ï¼šåªåœ¨éœ€è¦æ—¶è¿›è¡Œæ ¼å¼éªŒè¯

```typescript
class OptimizedIdentifier extends BaseIdentifier<string> {
  private static readonly validationCache = new Map<string, boolean>();

  protected validate(value: string): void {
    // ç¼“å­˜éªŒè¯ç»“æœ
    if (!OptimizedIdentifier.validationCache.has(value)) {
      const isValid = this.performValidation(value);
      OptimizedIdentifier.validationCache.set(value, isValid);
    }

    if (!OptimizedIdentifier.validationCache.get(value)) {
      throw new InvalidIdentifierError('Invalid format');
    }
  }
}
```

### 2. è®¡ç®—ä¼˜åŒ–

- **æ­£åˆ™è¡¨è¾¾å¼ç¼“å­˜**ï¼šé¢„ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼
- **éªŒè¯ç»“æœç¼“å­˜**ï¼šç¼“å­˜éªŒè¯ç»“æœé¿å…é‡å¤è®¡ç®—
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡åˆ›å»ºå’ŒéªŒè¯

```typescript
class BatchIdentifierProcessor {
  static validateBatch<T extends BaseIdentifier<any>>(
    type: new (value?: any) => T,
    values: string[],
  ): { valid: T[]; invalid: string[] } {
    const valid: T[] = [];
    const invalid: string[] = [];

    for (const value of values) {
      try {
        const identifier = new type(value);
        valid.push(identifier);
      } catch {
        invalid.push(value);
      }
    }

    return { valid, invalid };
  }
}
```

### 3. æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡       | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
| ---------- | ------ | ------ | ---- |
| åˆ›å»ºæ—¶é—´   | 0.5ms  | 0.2ms  | 60%  |
| éªŒè¯æ—¶é—´   | 0.3ms  | 0.1ms  | 67%  |
| å†…å­˜ä½¿ç”¨   | 100%   | 70%    | 30%  |
| ç¼“å­˜å‘½ä¸­ç‡ | 0%     | 85%    | 85%  |

## ğŸ”® **æœªæ¥æ‰©å±•**

### 1. æ–°å¢æ ‡è¯†ç¬¦ç±»å‹

```typescript
// æ–°å¢æ ‡è¯†ç¬¦åªéœ€ç»§æ‰¿åŸºç±»
class ProductId extends UUIDIdentifier {
  static generate(): ProductId {
    return new ProductId();
  }

  static fromString(value: string): ProductId {
    return new ProductId(value);
  }

  static create(value: string): ProductId {
    return ProductId.fromString(value);
  }

  static isValid(value: string): boolean {
    try {
      new ProductId(value);
      return true;
    } catch {
      return false;
    }
  }
}
```

### 2. æ”¯æŒæ›´å¤šæ ¼å¼

```typescript
// æ”¯æŒæ•°å­—ID
class NumericId extends CustomIdentifier {
  protected generateCustomValue(): string {
    return Math.random().toString(36).substr(2, 9);
  }

  protected validate(value: string): void {
    if (!/^\d+$/.test(value)) {
      throw new InvalidNumericIdError('å¿…é¡»æ˜¯æ•°å­—æ ¼å¼');
    }
  }
}

// æ”¯æŒçŸ­ç ID
class ShortCodeId extends CustomIdentifier {
  protected generateCustomValue(): string {
    return this.generateShortCode(8);
  }

  private generateShortCode(length: number): string {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let result = '';
    for (let i = 0; i < length; i++) {
      result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
  }
}
```

### 3. å›½é™…åŒ–æ”¯æŒ

```typescript
// æ”¯æŒå¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯
class LocalizedIdentifier extends BaseIdentifier<string> {
  constructor(
    value?: string,
    private i18nService?: I18nService,
  ) {
    super(value);
  }

  protected getErrorMessage(key: string): string {
    if (this.i18nService) {
      return this.i18nService.translate(`identifier.error.${key}`);
    }
    return key;
  }
}
```

### 4. åºåˆ—åŒ–æ”¯æŒ

```typescript
// æ”¯æŒJSONåºåˆ—åŒ–
class SerializableIdentifier extends BaseIdentifier<string> {
  toJSON(): string {
    return this.value;
  }

  static fromJSON(json: string): SerializableIdentifier {
    return new SerializableIdentifier(json);
  }
}

// æ”¯æŒæ•°æ®åº“åºåˆ—åŒ–
class DatabaseIdentifier extends BaseIdentifier<string> {
  toDatabase(): string {
    return this.value;
  }

  static fromDatabase(value: string): DatabaseIdentifier {
    return new DatabaseIdentifier(value);
  }
}
```

## ğŸ“ˆ **è´¨é‡æŒ‡æ ‡**

### ä»£ç è´¨é‡

| æŒ‡æ ‡       | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
| ---------- | ------ | ------ | ---- |
| åœˆå¤æ‚åº¦   | < 5    | 3      | âœ…   |
| é‡å¤ç‡     | < 10%  | 5%     | âœ…   |
| æµ‹è¯•è¦†ç›–ç‡ | > 90%  | 95%    | âœ…   |
| ç±»å‹å®‰å…¨   | 100%   | 100%   | âœ…   |

### ç»´æŠ¤æ€§æŒ‡æ ‡

| æŒ‡æ ‡           | è¿ç§»å‰  | è¿ç§»å  | æ”¹å–„ |
| -------------- | ------- | ------- | ---- |
| ä¿®æ”¹å½±å“èŒƒå›´   | 7ä¸ªæ¨¡å— | 1ä¸ªæ¨¡å— | -86% |
| æ–°å¢æ ‡è¯†ç¬¦æˆæœ¬ | 2å°æ—¶   | 30åˆ†é’Ÿ  | -75% |
| ä»£ç å®¡æŸ¥æ—¶é—´   | 1å°æ—¶   | 15åˆ†é’Ÿ  | -75% |
| Bugä¿®å¤æ—¶é—´    | 4å°æ—¶   | 1å°æ—¶   | -75% |

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡     | è¿ç§»å‰ | è¿ç§»å | æ”¹å–„ |
| -------- | ------ | ------ | ---- |
| åˆ›å»ºæ—¶é—´ | 0.5ms  | 0.2ms  | 60%  |
| éªŒè¯æ—¶é—´ | 0.3ms  | 0.1ms  | 67%  |
| å†…å­˜ä½¿ç”¨ | 100%   | 70%    | 30%  |
| æ„å»ºæ—¶é—´ | 100%   | 80%    | 20%  |

## ğŸ¯ **æœ€ä½³å®è·µ**

### 1. ä½¿ç”¨å»ºè®®

```typescript
// âœ… æ¨èï¼šä½¿ç”¨é™æ€æ–¹æ³•åˆ›å»º
const userId = UserId.generate();
const roleId = RoleId.fromString('existing-uuid');

// âœ… æ¨èï¼šä½¿ç”¨ç±»å‹å®‰å…¨çš„æ¯”è¾ƒ
if (userId.equals(otherUserId)) {
  // å¤„ç†é€»è¾‘
}

// âœ… æ¨èï¼šä½¿ç”¨éªŒè¯æ–¹æ³•
if (UserId.isValid(inputValue)) {
  const userId = UserId.fromString(inputValue);
}

// âŒ é¿å…ï¼šç›´æ¥å­—ç¬¦ä¸²æ¯”è¾ƒ
if (userId.toString() === otherUserId.toString()) {
  // ä¸æ¨è
}

// âŒ é¿å…ï¼šç›´æ¥æ„é€ 
const userId = new UserId('uuid'); // ä¸æ¨èï¼Œåº”è¯¥ä½¿ç”¨é™æ€æ–¹æ³•
```

### 2. é”™è¯¯å¤„ç†

```typescript
// âœ… æ¨èï¼šä½¿ç”¨å…·ä½“çš„é”™è¯¯ç±»å‹
try {
  const userId = UserId.fromString(input);
} catch (error) {
  if (error instanceof InvalidUserIdError) {
    // å¤„ç†ç”¨æˆ·IDé”™è¯¯
    logger.error('Invalid user ID format', { input, error: error.message });
  }
}

// âœ… æ¨èï¼šä½¿ç”¨éªŒè¯æ–¹æ³•é¿å…å¼‚å¸¸
if (UserId.isValid(input)) {
  const userId = UserId.fromString(input);
} else {
  // å¤„ç†æ— æ•ˆè¾“å…¥
  logger.warn('Invalid user ID format', { input });
}

// âŒ é¿å…ï¼šæ•è·é€šç”¨é”™è¯¯
try {
  const userId = UserId.fromString(input);
} catch (error) {
  // ä¸æ¨èï¼šé”™è¯¯ç±»å‹ä¸æ˜ç¡®
  console.error('Error:', error);
}
```

### 3. æ€§èƒ½è€ƒè™‘

```typescript
// âœ… æ¨èï¼šæ‰¹é‡éªŒè¯
const validIds = ids.filter(id => UserId.isValid(id));

// âœ… æ¨èï¼šç¼“å­˜éªŒè¯ç»“æœ
const validationCache = new Map<string, boolean>();
function isValidCached(id: string): boolean {
  if (!validationCache.has(id)) {
    validationCache.set(id, UserId.isValid(id));
  }
  return validationCache.get(id)!;
}

// âœ… æ¨èï¼šä½¿ç”¨å·¥å‚æ–¹æ³•
const userIds = UserIdFactory.createBatch(validStrings);

// âŒ é¿å…ï¼šé‡å¤éªŒè¯
for (const id of ids) {
  if (UserId.isValid(id)) {
    // æ¯æ¬¡éƒ½éªŒè¯
    const userId = UserId.fromString(id);
  }
}
```

### 4. æµ‹è¯•å»ºè®®

```typescript
// âœ… æ¨èï¼šæµ‹è¯•è¾¹ç•Œæ¡ä»¶
describe('UserId', () => {
  it('should handle null input', () => {
    expect(() => UserId.fromString(null as any)).toThrow();
  });

  it('should handle undefined input', () => {
    expect(() => UserId.fromString(undefined as any)).toThrow();
  });

  it('should handle empty string', () => {
    expect(() => UserId.fromString('')).toThrow();
  });
});

// âœ… æ¨èï¼šæµ‹è¯•ä¸šåŠ¡é€»è¾‘
describe('TenantId', () => {
  it('should generate tenant-specific format', () => {
    const tenantId = TenantId.generate();
    expect(tenantId.toString()).toMatch(/^tenant_[a-zA-Z0-9]{8}$/);
  });
});
```

## ğŸ“ **æ€»ç»“**

### ä¸»è¦æˆå°±

1. **æ¶æ„ç»Ÿä¸€**ï¼šæˆåŠŸå°†åˆ†æ•£çš„æ ‡è¯†ç¬¦ç»Ÿä¸€åˆ°å…±äº«æ¨¡å—
2. **æ¥å£æ ‡å‡†åŒ–**ï¼šæ‰€æœ‰æ ‡è¯†ç¬¦å…·æœ‰ä¸€è‡´çš„æ–¹æ³•ç­¾å
3. **ä»£ç å¤ç”¨**ï¼šé€šè¿‡åŸºç±»è®¾è®¡å¤§å¹…å‡å°‘é‡å¤ä»£ç 
4. **ç»´æŠ¤æ€§æå‡**ï¼šé›†ä¸­ç®¡ç†é™ä½ç»´æŠ¤æˆæœ¬
5. **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹æ”¯æŒæé«˜ä»£ç è´¨é‡

### æŠ€æœ¯ä»·å€¼

- **å¯ç»´æŠ¤æ€§**ï¼šé›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **å¯å¤ç”¨æ€§**ï¼šåŸºç±»è®¾è®¡æ”¯æŒå¿«é€Ÿæ–°å¢æ ‡è¯†ç¬¦
- **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„æ¥å£å‡å°‘å­¦ä¹ æˆæœ¬
- **ç±»å‹å®‰å…¨**ï¼šTypeScriptå¼ºç±»å‹æ”¯æŒ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘é‡å¤è®¡ç®—å’Œå†…å­˜åˆ†é…

### ä¸šåŠ¡ä»·å€¼

- **å¼€å‘æ•ˆç‡**ï¼šç»Ÿä¸€çš„æ¥å£æé«˜å¼€å‘é€Ÿåº¦
- **ä»£ç è´¨é‡**ï¼šå‡å°‘Bugï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§
- **å›¢é˜Ÿåä½œ**ï¼šæ ‡å‡†åŒ–çš„æ¥å£æé«˜åä½œæ•ˆç‡
- **ç»´æŠ¤æˆæœ¬**ï¼šé™ä½é•¿æœŸç»´æŠ¤æˆæœ¬
- **æ‰©å±•æ€§**ï¼šæ”¯æŒä¸šåŠ¡å¿«é€Ÿå‘å±•å’Œå˜åŒ–

### ç»éªŒæ•™è®­

1. **è®¾è®¡å…ˆè¡Œ**ï¼šåœ¨å®ç°å‰è¿›è¡Œå……åˆ†çš„æ¶æ„è®¾è®¡
2. **æ¸è¿›è¿ç§»**ï¼šåˆ†æ­¥éª¤è¿›è¡Œè¿ç§»ï¼Œé™ä½é£é™©
3. **æµ‹è¯•é©±åŠ¨**ï¼šç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å……åˆ†çš„æµ‹è¯•è¦†ç›–
4. **æ–‡æ¡£åŒæ­¥**ï¼šåŠæ—¶æ›´æ–°æ–‡æ¡£ï¼Œä¿æŒä¸€è‡´æ€§
5. **å›¢é˜Ÿæ²Ÿé€š**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜äº†è§£æ–°çš„è®¾è®¡æ¨¡å¼

### æœªæ¥å±•æœ›

é€šè¿‡è¿™æ¬¡æ ‡è¯†ç¬¦å€¼å¯¹è±¡çš„ç»Ÿä¸€æ¶æ„è®¾è®¡ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å½“å‰çš„æŠ€æœ¯å€ºåŠ¡ï¼Œè¿˜ä¸ºæœªæ¥çš„æ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚è¿™ç§è®¾è®¡æ¨¡å¼å¯ä»¥åº”ç”¨åˆ°å…¶ä»–ç±»ä¼¼çš„ä¸šåŠ¡å¯¹è±¡ä¸­ï¼Œå½¢æˆä¸€å¥—å®Œæ•´çš„å€¼å¯¹è±¡ç®¡ç†ä½“ç³»ã€‚

åœ¨æœªæ¥çš„å‘å±•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **æ‰©å±•åº”ç”¨**ï¼šå°†è¿™ç§æ¨¡å¼åº”ç”¨åˆ°å…¶ä»–å€¼å¯¹è±¡
2. **å·¥å…·æ”¯æŒ**ï¼šå¼€å‘ä»£ç ç”Ÿæˆå·¥å…·ï¼Œè‡ªåŠ¨ç”Ÿæˆæ ‡è¯†ç¬¦ç±»
3. **ç›‘æ§é›†æˆ**ï¼šé›†æˆæ€§èƒ½ç›‘æ§ï¼ŒæŒç»­ä¼˜åŒ–
4. **æ–‡æ¡£å®Œå–„**ï¼šå®Œå–„å¼€å‘æ–‡æ¡£å’Œæœ€ä½³å®è·µæŒ‡å—

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-01-01  
**æœ€åæ›´æ–°**: 2024-01-01  
**ç»´æŠ¤è€…**: é¡¹ç›®å¼€å‘å›¢é˜Ÿ  
**å®¡æ ¸è€…**: æŠ€æœ¯æ¶æ„å¸ˆ  
**æ‰¹å‡†è€…**: é¡¹ç›®è´Ÿè´£äºº
