# AI开发配置文件

## 项目概述

这是一个现代化的SAAS平台项目，采用DDD + Clean Architecture + CQRS + 事件溯源架构 + 事件驱动架构，支持多租户数据隔离，提供完整的用户管理、组织管理、权限管理等功能。

## 技术栈

- **后端框架**：NestJS + TypeScript + Fastify
- **数据库**：PostgreSQL + MongoDB + Redis
- **ORM**：MikroORM
- **架构模式**：DDD + Clean Architecture + CQRS + 事件溯源 + 事件驱动
- **包管理**：pnpm

## 开发原则

### 1. 架构原则

- 严格按照DDD和Clean Architecture分层
- 确保依赖倒置原则
- 保持领域层的纯净性
- 实现CQRS和事件溯源模式
- 实现事件驱动模式

### 2. 代码质量原则

- 使用TypeScript严格模式
- 编写详细的中文注释
- 遵循TSDoc规范
- 实现完整的错误处理

### 3. 测试原则

- 每个模块都要有单元测试
- 关键业务流程要有集成测试
- 重要接口要有端到端测试
- 测试覆盖率要达到80%以上

## 项目结构

```
aiofix-saas-platform/
├── packages/                    # 共享包
│   ├── common/                 # 公共基础包
│   ├── core/                   # 核心架构包
│   └── shared/                 # 共享内核包
├── apps/                       # 应用项目
│   ├── monolith/               # 单体应用
│   ├── microservices/          # 微服务应用
│   └── gateway/                # API网关
├── docs/                       # 文档
├── scripts/                    # 部署脚本
├── docker/                     # Docker配置
├── k8s/                        # Kubernetes配置
└── monitoring/                 # 监控配置
```

## 核心概念

### 多租户架构

- 平台级 → 租户级 → 组织级 → 部门级 → 用户级
- 五层数据隔离架构
- 支持数据分类和共享策略

### 用户管理

- 平台用户：所有用户的基础身份
- 租户用户：从平台用户分配而来
- 支持用户兼职多个组织/部门

### 权限管理

- 8种基础角色
- 基于角色的访问控制（RBAC）
- 细粒度权限控制

## 开发指南

### 1. 开始开发前

- 阅读业务需求文档：`docs/business-requirements.md`
- 阅读技术设计文档：`docs/technical-design/README.md`
- 阅读开发计划：`docs/development-plan.md`
- **重要**：阅读 `docs/technical-design-guide-for-ai.mdc` 了解技术设计方案查阅指南
- **快速查阅**：参考 `docs/quick-reference.mdc` 快速定位需要查阅的文档

### 2. 开发过程中

- **设计先行**：必须先查阅相关技术设计文档，再编写代码
- 遵循项目的架构规范
- 使用AI开发提示词指导开发
- 保持代码与文档同步
- 确保实现与设计文档完全一致

### 3. 开发完成后

- 进行代码检查和测试
- 更新相关文档
- 提交代码审查

## AI开发提示词

### 项目初始化提示词

```
你是一个全栈工程师，精通TypeScript语言，有丰富的Node.js开发经验。

项目背景：
- 这是一个现代化的SAAS平台项目，支持多租户架构
- 采用DDD + Clean Architecture + CQRS + 事件溯源架构 + 事件驱动架构
- 技术栈：NestJS + TypeScript + Fastify + MikroORM + PostgreSQL + MongoDB + Redis

开发原则：
- 使用中文回答问题和编写注释
- 编写注释应当按照TSDoc规范，并加入代码设计原理或机制，以及业务规则或业务逻辑
- 修改代码时应当同时修改相应的注释，确保代码与注释一致
- 使用pnpm作为包管理器
- 完成代码编写后应当进行代码linter检查，及时修复报错

项目文档：
- 业务需求文档：`docs/business-requirements.md`
- 技术设计文档：`docs/technical-design/README.md`
- 开发计划：`docs/development-plan.md`
- 技术设计查阅指南：`docs/technical-design-guide-for-ai.mdc`
- 快速查阅指南：`docs/quick-reference.mdc`
```

### 领域模型开发提示词

```
请先查阅 ../../docs/technical-design/03-domain-layer.md 和 ../../docs/business-requirements.md，了解领域模型设计，然后为[具体聚合根名称]开发领域模型：

要求：
1. 创建聚合根类，包含业务逻辑和不变性约束
2. 定义值对象，封装业务概念
3. 创建领域事件，记录状态变更
4. 实现业务规则验证
5. 添加详细的中文注释

参考文档：
- 业务需求：`docs/business-requirements.md`
- 领域层设计：`docs/technical-design/03-domain-layer.md`
- 架构概览：`docs/technical-design/01-architecture-overview.md`

请确保：
- 聚合根保持业务不变性
- 所有状态变更都通过事件记录
- 业务规则在领域层实现
- 考虑多租户数据隔离
- 严格按照设计文档实现
```

### 应用层开发提示词

```
请先查阅 ../../docs/technical-design/05-application-layer.md 和 ../../docs/technical-design/07-event-sourcing.md，了解应用层设计和事件驱动架构，然后为[具体功能模块]开发应用层代码：

要求：
1. 创建命令和查询定义
2. 实现命令处理器和查询处理器
3. 创建应用服务协调业务用例
4. 实现事件处理器更新读模型
5. 添加事务管理

参考文档：
- 应用层设计：`docs/technical-design/05-application-layer.md`
- 事件驱动架构设计：`docs/technical-design/07-event-sourcing.md`
- 分层架构：`docs/technical-design/02-layered-architecture.md`

请确保：
- 命令处理器实现业务用例
- 查询处理器优化读性能
- 事件处理器保持读模型同步
- 事务边界正确设置
- 严格按照设计文档实现
```

### 事件驱动架构开发提示词

```
请先查阅 ../../docs/technical-design/07-event-sourcing.md 和 ../../docs/technical-design/06-infrastructure.md，了解事件驱动架构设计，然后实现相关功能：

要求：
1. 实现消息队列服务（Redis + Bull）
2. 实现事件总线服务
3. 实现异步事件处理器
4. 配置事件存储和重试机制
5. 添加详细的中文注释

参考文档：
- 事件驱动架构设计：`docs/technical-design/07-event-sourcing.md`
- 基础设施层设计：`docs/technical-design/06-infrastructure.md`
- 代码注释规范：`docs/code-annotation-specification.mdc`

请确保：
- 严格按照设计文档实现
- 遵循事件驱动架构原则
- 使用完整的TSDoc注释
- 实现完整的错误处理
```

### 通知模块开发提示词

```
请先查阅 ../../docs/technical-design/notification-design.md，了解通知模块的完整设计，然后实现相关功能：

要求：
1. 按照5个子领域划分实现
2. 实现各聚合根的业务方法
3. 实现通知编排策略
4. 集成外部服务适配器
5. 添加详细的中文注释

参考文档：
- 通知模块设计：`docs/technical-design/notification-design.md`
- 应用层设计：`docs/technical-design/05-application-layer.md`
- 基础设施层设计：`docs/technical-design/06-infrastructure.md`

请确保：
- 严格按照子领域划分实现
- 遵循DDD和Clean Architecture原则
- 实现完整的事件驱动处理
- 使用完整的TSDoc注释
```

## 常用命令

### 开发环境

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm run dev

# 运行测试
pnpm run test

# 代码检查
pnpm run lint

# 构建项目
pnpm run build
```

### 数据库操作

```bash
# 生成迁移文件
pnpm run migration:generate

# 运行迁移
pnpm run migration:run

# 回滚迁移
pnpm run migration:revert
```

### Docker操作

```bash
# 启动开发环境
docker-compose up -d

# 停止开发环境
docker-compose down

# 查看日志
docker-compose logs -f
```

## 配置文件组织

### 主要配置文件

- **项目级配置**：`.ai-config.md`（本文件）- 适用于所有AI开发工具
- **Cursor特定配置**：`.cursor/rules/project-config.mdc` - Cursor IDE特定规则
- **技术设计查阅指南**：`.cursor/rules/technical-design-guide-for-ai.mdc` - 详细的开发环节查阅指南
- **快速查阅指南**：`.cursor/rules/quick-reference.mdc` - 快速定位需要查阅的文档
- **代码注释规范**：`.cursor/rules/code-annotation-specification.mdc` - TSDoc注释规范

### 配置层次

1. **项目级配置**（`.ai-config.md`）：通用配置，适用于所有AI工具
2. **IDE特定配置**（`.cursor/rules/`）：Cursor IDE特定规则和配置
   - 技术设计查阅指南
   - 快速查阅指南
   - 代码注释规范
3. **模块级配置**：各模块内部的特定配置

## 注意事项

1. **设计先行**：开发前必须先查阅相关技术设计文档
2. **架构遵循**：严格按照DDD和Clean Architecture原则
3. **代码质量**：确保代码质量和测试覆盖
4. **文档同步**：保持代码与文档的一致性
5. **性能考虑**：注意性能优化和缓存策略
6. **安全考虑**：实现数据隔离和权限控制
7. **配置管理**：项目级配置优先，IDE特定配置作为补充

## 联系方式

如有问题或建议，请：

1. 查看相关文档
2. 参考AI开发提示词
3. 联系项目团队

---

**配置文件版本**：2.0  
**创建日期**：2024-01-01  
**最后更新**：2024-01-01  
**维护者**：项目开发团队
